{"version":3,"sources":["firebaseConfig.js","global.js","firestore.js","cacheManager.js","authManager.js","uiManager.js","admin.js","email.js","app.js"],"names":["firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","window","brevoConfig","senderEmail","senderName","adminEmail","appConfig","version","environment","features","multiSpecialist","categories","realTimeValidation","firebase","apps","length","initializeApp","firebaseAuth","auth","db","firestore","handleFirebaseError","error","console","unavailable","code","message","googleProvider","GoogleAuthProvider","addScope","Error","firestoreDB","obtenerConfiguracion","doc","collection","get","exists","data","horarioApertura","replace","horarioCierre","diasLaborales","Array","isArray","every","item","str","trim","startsWith","endsWith","JSON","parse","map","Number","split","filter","n","isNaN","e","procesarDiasLaborales","diasNoLaborables","Boolean","obtenerConfigGeneral","async","orderBy","docs","id","categoriaId","where","categorias","categoriasId","obtenerEspecialistasPorServicio","servicioId","servicioDoc","servicioData","this","obtenerEspecialistasPorCategoria","obtenerTurnosPorEspecialistaYFecha","especialistaId","fecha","slotsPorEspecialista","obtenerTurnosPorEspecialistasYFecha","especialistasIds","promises","Promise","all","flat","verificarDisponibilidadParaEspecialistas","horario","limit","empty","generarHorariosDisponiblesEspecialista","duracionRequerida","config","especialistaDoc","turnosOcupados","especialista","diaKey","Date","getDay","horarioDia","horarioLaboral","activo","inicio","fin","slotsOcupados","_calcularSlotsOcupados","_generarHorarios","fechaSeleccionada","horaApertura","parseInt","minApertura","horaCierre","minCierre","duracion","duracionTurno","duracionTurnoBase","warn","horarios","horaActual","minActual","cierreMinutos","horarioStr","toString","padStart","inicioMinutos","finMinutos","cabeEnJornada","todosLosSlotsDisponibles","min","minutoSlot","horarioSlot","Math","floor","includes","ocupado","push","hora","disponible","_generarHorariosBasicos","dentroDeJornada","obtenerHorariosComunesDisponibles","duracionTotal","horariosPorEspecialista","horariosDisponibles","_encontrarHorariosComunes","_puedeAcomodarDuracion","horarioInicio","diaSemana","horaInicioStr","minutoInicioStr","horaInicio","horaCierreStr","minutoCierreStr","minutoCierre","Object","keys","horariosComunes","i","horariosEspecialista","_encontrarHorariosComunesConDuracion","horariosBase","horarioBase","todosDisponibles","minutos","horarioSlotStr","find","h","_filtrarHorariosPorHoraActual","ahora","tiempoActualMinutos","getHours","getMinutes","horaStr","minutoStr","verificarDisponibilidad","verificarDisponibilidadEspecialistas","datosReserva","especialistas","verificarDisponibilidadEspecialista","especialistaData","verificarBloqueosEspecialista","fechaTimestamp","getTime","snapshot","bloqueo","inicioBloqueo","fechaInicio","finBloqueo","fechaFin","obtenerTurnosSolapados","minutoFin","minutoFinAjustado","horarioFin","userId","add","timestamp","FieldValue","serverTimestamp","expiresAt","now","eliminarBloqueoTemporal","bloqueoId","delete","obtenerTurnosPorUsuario","hoy","setHours","fechaHoy","toISOString","guardarTurno","turnoData","serviciosSnapshot","FieldPath","documentId","serviciosIds","serviciosOrdenados","especialistasPorCategoria","serviciosPorEspecialista","forEach","servicio","nombre","offsetGlobalMinutos","servicioInicioMinutos","servicioFinMinutos","horaSlot","especialistaIds","log","docRef","estado","createdAt","actualizadoEl","generarHorariosDisponibles","turnos","turno","minuto","cacheMonitor","hits","misses","savings","incrementHit","logStats","incrementMiss","total","hitRate","round","addSavings","amount","cache","servicios","horarios_multi","ttl","esValido","clave","idEspecifico","guardar","datos","obtener","estimarLecturasAhorradas","limpiarEspecifico","forzarActualizacionEspecialistas","precacheDatosEsenciales","allSettled","firestoreSeguro","obtenerCategorias","obtenerServicios","limpiarCache","key","actualizarCacheEspecialistas","guardarCacheEnStorage","cacheData","fechaGuardado","localStorage","setItem","stringify","cargarCacheDesdeStorage","getItem","parsed","unaHora","removeItem","limpiarCacheEspecialistasPorCategoria","addEventListener","document","usuarioActual","esPaginaAdmin","location","pathname","inicializarAuth","manejarRedirectResult","onAuthStateChanged","user","actualizarUIUsuario","actualizarBotonAdmin","cargarDatosUsuario","uid","configurarEventosAuth","removeEventListener","manejarClicAuth","esBotonAuthPrincipal","target","closest","esBotonAuthMenu","preventDefault","stopPropagation","iniciarSesionGoogle","cerrarSesion","manejarOpcionProtegida","classList","contains","esUsuarioAdministrador","href","mostrarError","deshabilitarBotonesAuth","provider","setCustomParameters","prompt","result","signInWithPopup","email","manejarAutenticacionRedirect","mostrarErrorAuth","sessionStorage","signInWithRedirect","redirectError","getRedirectResult","then","preAuthUrl","catch","signOut","setTimeout","reload","mostrarMensajeExito","deshabilitar","getElementById","btn","boton","disabled","style","opacity","innerHTML","mensaje","alert","guardarUsuario","displayName","photoURL","limpiarUsuario","authContainer","navItemsAuth","querySelectorAll","navItemsNoAuth","display","actualizarSubmenusDinamicos","actualizarVisibilidadMenu","cargarTurnosUsuario","ultimaCargaTurnos","CACHE_DURACION","pasoActual","autocompletarFormulario","opcion","mostrarBotonLogin","contenedor","querySelector","parentElement","nombreInput","emailInput","value","validarNombre","validarEmail","telefono","phoneNumber","cargarDatosGuardados","usuarioGuardado","mensajeExito","createElement","className","body","appendChild","remove","nombreUsuario","emailUsuario","textContent","elementosAuth","elementosNoAuth","inicializarAcordeonMenu","iniciarAutenticacionAnonima","userCredential","signInAnonymously","intervaloActualizacionTurnos","el","overlay","modal","mensajePersonalizado","calcularDuracionTotal","horas","cerrarModal","animation","ErrorHandler","mostrar","tipo","toUpperCase","manejarErrorFirestore","contexto","Validador","prop","hasOwnProperty","categoria","filtrarInvalidos","btnMenu","menuLateral","toggle","inicializarCierreMenuOverlay","inicializarAcordeonesServicios","header","dataset","container","nextElementSibling","icono","c","otherIcon","previousElementSibling","estaAbierto","inicializarAcordeonesEspecialistas","lista","l","toggleLoader","btnSiguiente","loader","menuItem","listItem","submenu","isActive","cerrarTodosLosSubmenus","quitarClaseActiveNav","element","nav","menuIcon","navElement","menu","obtenerDatosContactoSeguro","datosGenerales","empresa","contactoCache","actualizarMenuContacto","direccionElement","direccion","telefonoElement","emailElement","redes","redesSociales","instagramLink","equisLink","whatsappLink","instagram","equis","whatsapp","inicializarMenuContactoDefinitivo","formatearFecha","fechaStr","getDate","getMonth","calcularHorarioFin","duracionMinutos","totalMinutos","minutosFin","usuario","currentUser","submenuUl","turnosHTML","fechaFormateada","montoFormateado","montoTotal","toLocaleString","join","inicializarSistemaTurnosUsuario","configurarObservadorMenu","detenerActualizacionAutomatica","MutationObserver","mutations","mutation","attributeName","iniciarActualizacionAutomatica","observe","attributes","setInterval","clearInterval","forzarActualizacionTurnos","applyListeners","toggleClass","undefined","stringClass","jQuery","esAdminPage","ADMIN_UID","obtenerElementosAdmin","adminPanel","loginBtn","logoutBtn","calendar","turnosList","fechaTitulo","modalEditar","formEditar","btnEliminarModal","closeModal","elements","currentTurnoId","especialistasMap","especialistasCargando","pendientesDeActualizacion","serviciosMap","initAdmin","verificarFirestore","assign","handleAuthState","signInWithGoogle","guardarCambiosTurno","setupModalEvents","inicializarGestionServicios","inicializarGestionPersonal","inicializarNavegacionAdmin","cargarEspecialistas","cargarServicios","showAdminPanel","initCalendar","showLoginScreen","destroy","navEnlaces","seccionCalendario","seccionServicios","seccionPersonal","mostrarSeccion","seccion","actualizarOverlay","enlaceActivo","navAdmin","rect","getBoundingClientRect","navRect","enlaceStyles","getComputedStyle","paddingLeft","parseFloat","paddingRight","overlayLeft","left","overlayWidth","width","cambiarSeccion","enlace","textoEnlace","cargarServiciosYMostrar","cargarPersonalYMostrar","enlaces","calendario","personal","enlaceActivoInicial","inicializarNavegacionCuandoPanelListo","inicializarTabBar","activarEnlace","activeEnlace","currentActive","parentNode","mostrarMensajeError","mensajeError","mostrarLoading","loading","nuevoMapa","size","cargados","callback","obtenerNombreEspecialista","cargarEspecialistaIndividual","formatearNombreDesdeId","refetchEvents","txt","charAt","substr","toLowerCase","recargarEspecialistasYVista","obtenerConfiguracionPorDefecto","dias","strClean","normalizarDias","sort","a","b","validarHorario","horarioEnMinutos","aperturaH","aperturaM","cierreH","cierreM","valido","FullCalendar","Calendar","initialView","locale","headerToolbar","center","right","selectable","selectMirror","dayMaxEvents","selectOverlap","height","contentHeight","allDaySlot","slotMinTime","slotMaxTime","slotDuration","slotLabelInterval","slotLabelFormat","hour","minute","hour12","dateClick","info","dayEl","moreLink","click","getEvents","event","eventStart","start","dateStr","extendedProps","esContador","loadTurnosForDate","events","fetchInfo","successCallback","failureCallback","startStr","endStr","clienteNombre","cliente","serviciosNombres","obtenerNombresServicios","crearEventoTurno","slots","reduce","serviciosEspecificos","s","eventClick","abrirModalEdicion","select","unselect","views","dayGridMonth","dayMaxEventRows","displayEventTime","timeGridWeek","dayHeaderFormat","weekday","day","month","slotEventOverlap","eventMinHeight","timeGridDay","year","eventTimeFormat","viewDidMount","eventDidMount","startTime","toLocaleTimeString","endTime","end","tooltipContent","setAttribute","render","esMultiplesEspecialistas","especialistaNombre","titulo","horaFinCalculada","turnoBaseId","colorBordeGrupo","generarColorDesdeId","title","allDay","turnoId","todosLosEspecialistas","observaciones","calcularDuracionEnMinutos","borderColor","backgroundColor","getEventColorBySpecialist","textColor","coloresGrupo","hash","charCodeAt","abs","coloresFijos","esp_analia_solange","esp_agustin_matias","esp_blondie_flores","esp_monica_flores","coloresRespaldo","getEventColor","minutoInicio","horaFin","recargarVistaCalendario","vistaActual","view","tipoVista","type","fechaActual","currentStart","changeView","date","fechaObj","fechaAjustada","getTimezoneOffset","options","toLocaleDateString","renderTurnos","nombresEspecialistas","serviciosInfo","espId","nombreEsp","nombresServicios","horariosInfo","tagName","card","detalles","icon","currentTarget","getAttribute","confirm","eliminarTurno","abrirModalEdicionPorId","generarOpcionesHorario","infoHTML","onclick","configurarModalEliminar","loadingIndicator","selectHorario","minutoActual","option","inicioEnMinutos","finEnMinutos","turnosSolapados","turnoHorario","turnoHora","turnoMinuto","turnoInicio","turnoFin","verificarDisponibilidadCompletaEspecialista","turnoIdExcluir","nombreEspecialista","minutoApertura","turnosConflictivos","turnoExistente","existenteHora","existenteMinuto","existenteInicio","existenteFin","haySolapamiento","verificarDisponibilidadCompleta","nuevoTurno","turnoActual","entries","primerSlot","disponibilidad","token","getIdTokenResult","claims","admin","nuevoHorario","nuevaFecha","validacionHorario","turnoDoc","algunEspecialistaDisponible","mensajesError","diaSemanaConfig","nuevaHora","nuevoMinuto","horaOriginal","minutoOriginal","desplazamientoMinutos","turnoActualizado","nuevosSlotsPorEspecialista","nuevosServiciosPorEspecialista","todosLosSlots","horarioInicioGlobal","horarioFinGlobal","horaInicioGlobal","minutoInicioGlobal","minutosInicioGlobal","minutosNuevoInicio","slotsOriginales","primerSlotOriginal","minutosNuevoSlot","nuevoMinutoSlot","nuevoPrimerSlot","nuevosSlotsEspecialista","slotMinutos","slotMinuto","nuevoSlot","slotFinMinutos","horaFinGlobal","minutoFinGlobal","nuevoHorarioFin","Set","nuevosSlotsOcupados","update","fechaTurno","btnEliminar","replaceWith","cloneNode","categoriasMap","btnAgregarServicio","abrirModalServicio","configurarModalServicio","categoriasSnapshot","mostrarServiciosEnUI","serviciosList","serviciosPorCategoria","values","html","crearHTMLServicio","configurarEventosServicios","precioFormateado","formatearPrecio","precio","duracionFormateada","formatearDuracionAdmin","promo","eliminarServicio","form","closeBtn","guardarServicio","cargarCategoriasEnSelect","llenarSelectConCategorias","orden","reset","descripcion","checked","nuevoId","generarIdServicio","verificarIdUnico","creadoEl","set","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","mins","personalMap","btnAgregarPersonal","abrirModalPersonal","configurarModalPersonal","personalSnapshot","mostrarPersonalEnUI","personalList","crearHTMLPersonal","configurarEventosPersonal","obtenerDiasLaborales","fotoUrl","lunes","martes","miercoles","jueves","viernes","sabado","domingo","diasActivos","dia","personalId","eliminarPersonal","guardarPersonal","cargarCategoriasCheckboxesPersonal","configurarUploaderImagen","contenedorCheckboxes","llenarCheckboxesConCategorias","categoriasOrdenadas","filePreview","previewImg","uploadLabel","resetearFormularioPersonal","src","establecerCategoriasSeleccionadas","establecerHorarioLaboral","checkbox","activoCheckbox","inicioInput","finInput","archivoImagen","files","fotoUrlExistente","personalData","obtenerCategoriasSeleccionadas","obtenerHorarioLaboralFromForm","subirImagenPersonal","generarIdPersonal","checkboxes","from","categoriasIds","normalizarParaId","texto","normalize","coleccion","storage","archivo","name","extension","pop","nombreArchivo","storageRef","ref","child","put","downloadURL","getDownloadURL","fileInput","removeBtn","uploadContainer","reader","FileReader","onload","readAsDataURL","archivos","dataTransfer","dispatchEvent","Event","funcionesVacias","funcName","enviarEmailConfirmacion","datosTurno","emailData","to","subject","htmlContent","reserva","getFullYear","bcc","enviarEmail","functions","httpsCallable","success","totalPasos","precios","Corte","Alisado","duraciones","observacion","mejorEspecialistaPorCategoria","calendarioFechaActual","fechasDisponiblesCalendario","coordenadasLocal","elementos","progreso","btnAnterior","pasos","resumenNombre","resumenEmail","resumenTelefono","resumenServicio","resumenFecha","resumenHorario","resumenObservacion","resumenEspecialistas","contenedorEspecialistas","probarConexion","obtenerTurnosPorFecha","cargarConfiguracion","cargarDatosGenerales","usuarioLS","inicializarEventos","actualizarInterfaz","categoriasValidas","serviciosValidos","serviciosDisponibles","actualizarUIServicios","observer","paso3","cargarFechasYHorarios","cached","cacheKey","horariosCache","generarHorariosMultiplesEspecialistas","resultados","index","status","autenticarParaReserva","bloquearTurnoTemporal","usuarioId","retrocederPaso","avanzarPaso","actualizarServiciosSeleccionados","seleccionarElemento","horarioSeleccionado","esp","validacion","validarDisponibilidadCompleta","validarTelefono","especialistaEl","categoriaSection","especialistaElement","seleccionarEspecialista","actualizarResumenEspecialistas","calcularSubtotal","subtotal","ahorroTotal","precioOriginal","elementoAhorro","serviciosSeleccionados","actualizarContadoresCategoria","serviciosProcesados","serv","servicioNombre","servicioCompleto","tienePromo","precioFinal","calcularSenia","mostrarEspecialistas","actualizarResumenServicios","especialistasPromises","catId","reason","elemento","especialistaExistenteIndex","findIndex","elementoAnterior","splice","cargarFechasDisponibles","cargarHorariosDisponibles","contenedorFechas","fechasDisponibles","setDate","fechaElement","slice","contenedorHorarios","horarioElement","validarDatosContacto","test","resumenServicios","serviciosHTML","precioMostrado","badgePromo","obtenerNombreCategoria","cat","confirmarReserva","fechaCreacion","senia","mostrarConfirmacion","reiniciarFormulario","userDoc","userData","logout","nombreLocal","logoUrl","logo","alt","contactarPorWhatsApp","url","encodeURIComponent","open","abrirUbicacion","lat","lng","contenedorServicios","serviciosCategoria","tienePromociones","some","categoriaEl","svgPromo","serviciosContainer","servicioEl","cursor","contador","debugServicios","buscarEspecialistasAutomaticos","validarPaso","actualizarResumenContinuo","guardarDatosFormulario","actualizarResumen","infoEspecialista","limpiarSeleccion","errorElement","actualizarPasos","actualizarBotones","simularReserva","errorReserva","requestAnimationFrame","completarReserva","inicializarDisponibilidad","actualizarUIFechas","generarFechasDisponibles","turnoInicioMin","turnoFinMin","obtenerFechasComunesDisponibles","todasLasFechas","fechasValidas","ahoraArg","timeZone","hoyArg","empezarDesdeManana","diaInicial","esDiaLaboral","formatearFechaDisplay","obtenerFechaSeleccionada","partes","mes","cargandoFechas","contenedorCalendario","sinFechas","primeraFechaDisponible","obtenerPrimeraFechaDisponibleEspecialistas","fechaPrimera","renderizarCalendario","debugVisualizacionFechas","seleccionarFechaAutomaticamente","cargarHorariosParaFecha","cargandoHorarios","sinHorarios","horariosFiltrados","filtrarHorariosPorHoraActual","actualizarUIHorarios","encontrarHorariosComunes","horariosOcupados","t","seleccionarHorario","verificarDisponibilidadEnTiempoReal","manejarClickHorario","crearContenedorHorarios","paso","pasoElement","errores","msg","errorServicio","errorEspecialista","categoriasServicios","categoriasConEspecialista","errorFecha","errorHorario","validarFormulario","errorGeneral","errorGeneralExistente","nombreValido","emailValido","telefonoValido","ceil","input","errorMsg","valor","word","resumenContinuo","paso6","botonNuevaReserva","insertAdjacentHTML","demoPaso6","seleccionPredeterminada","especialistasContainer","img","especialistaCompleto","avatarUrl","btnVerEspecialistas","hasEventListener","limpiarFechasYHorarios","serviciosLength","serviciosEnCategoria","serviciosTexto","opcionDisponibilidad","infoAdicional","calificacion","stack","actualizarUIEspecialistas","paso2","plantilla","sinEspecialistas","especialistasAutomaticos","espAuto","mejorEspecialista","obtenerEspecialistaConMejorDisponibilidad","disponibilidadEspecialistas","puntuacionDisponibilidad","diasEvaluados","fechaEvaluar","horariosDisponiblesFiltrados","bloquesDisponibles","encontrarBloquesDisponibles","disponibilidadPromedio","puntuacion","fallbackError","bloques","slotsNecesarios","bloqueValido","j","calcularHoraFin","agregarEventosBotones","btnBuscarDisponibilidad","toggleLista","botonesEspecialista","botonesHTML","esDuracionValida","mostrarErrorDisponibilidad","especialistasNoDisponibles","fechasComunes","generarFechasDisponiblesConEspecialistas","f","diaElement","actualizarSubtituloHorarios","obtenerHorariosComunes","puedeAcomodarDuracion","configuracion","seleccionarFecha","formatearFechaParaDebug","getUTCDay","formatearDuracion","inicializarCalendario","debounce","func","wait","timeout","args","clearTimeout","debouncedCargarHorarios","btnPrev","btnNext","setMonth","mesAnioElement","diasContainer","anio","primerDia","diasEnMes","diaInicio","diaVacio","String","fechaLocal","hoyFormateado","seleccionarFechaCalendario","subtitulo","diaNumero","resumenFechaHora","resumenCliente","actualizarResumenFechaHora","actualizarResumenCliente","serviciosLista","precioTotal","precioSenia","totalDuracion","totalPrecio","totalSenia","especialistasLista","resumenHora","svgFecha","svgHora","atencionElement","horariosAtencion","twitterLink","twitter","inicializarMapasEnDirecciones","escucharCambiosConfigGeneral","onSnapshot","inicializarMapas","geocodificarDireccion","google","maps","Geocoder","geocode","address","results","geometry","elementoDireccion","coordenadas","popup","urlMapaEstatico","imgMapa","onerror","coordenadasGeocodificadas","urlMaps"],"mappings":"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","file":"bundle.min.js","sourcesContent":["// firebaseConfig.js - Versin completa\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAlrmioVjkpD9tVgq3ZQZTJyPn4TkfMkFk\",\r\n  authDomain: \"peluqueria-completa.firebaseapp.com\",\r\n  projectId: \"peluqueria-completa\",\r\n  storageBucket: \"peluqueria-completa.firebasestorage.app\",\r\n  messagingSenderId: \"48556844588\",\r\n  appId: \"1:48556844588:web:7ff13754150b12b69d9389\",\r\n  measurementId: \"G-Z5GX6CDV9R\"\r\n};\r\n\r\n// Configuracin Brevo\r\nwindow.brevoConfig = {\r\n  senderEmail: \"no-reply@gestionturno.com\",\r\n  senderName: \"DemoPro GestinTurno\",\r\n  adminEmail: \"agustinmatiasf@gmail.com\"\r\n};\r\n\r\n// Configuracin Especfica de la App\r\nwindow.appConfig = {\r\n  version: \"2.0\",\r\n  environment: \"production\",\r\n  features: {\r\n    multiSpecialist: true,  \r\n    categories: true,       \r\n    realTimeValidation: true\r\n  }\r\n};\r\n\r\n// Inicializar Firebase\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\n\r\n// Exportar las instancias necesarias\r\nwindow.firebaseAuth = firebase.auth();\r\nwindow.db = firebase.firestore();\r\n\r\nwindow.handleFirebaseError = (error) => {\r\n  console.error('Firebase Error:', error);\r\n  \r\n  const errorMap = {\r\n    'permission-denied': 'No tienes permisos para esta accin',\r\n    'unavailable': 'Error de conexin. Intenta nuevamente',\r\n    'not-found': 'Recurso no encontrado'\r\n  };\r\n  \r\n  return errorMap[error.code] || error.message;\r\n};","window.googleProvider = new firebase.auth.GoogleAuthProvider();\r\nwindow.googleProvider.addScope('profile');\r\nwindow.googleProvider.addScope('email');","(() => {\r\n  if (!firebase.apps.length) {\r\n    throw new Error('Firebase no est inicializado');\r\n  }\r\n\r\n  const { db } = window;\r\n\r\n  window.firestoreDB = {\r\n    // Obtener configuracin\r\n    async obtenerConfiguracion() {\r\n      const doc = await db.collection('config').doc('horarios').get();\r\n      if (!doc.exists) throw new Error(\"No se encontr configuracin\");\r\n      \r\n      const data = doc.data();\r\n      \r\n      // Limpiar formatos de horarios\r\n      if (typeof data.horarioApertura === 'string') {\r\n        data.horarioApertura = data.horarioApertura.replace(/\"/g, '');\r\n      }\r\n      if (typeof data.horarioCierre === 'string') {\r\n        data.horarioCierre = data.horarioCierre.replace(/\"/g, '');\r\n      }\r\n      \r\n      // Funcin mejorada para procesar diasLaborales\r\n      const procesarDiasLaborales = (diasLaborales) => {\r\n        if (!diasLaborales) return [1, 2, 3, 4, 5, 6]; // Valor por defecto (L-S)\r\n        \r\n        // Si ya es un array de nmeros, devolverlo\r\n        if (Array.isArray(diasLaborales) && diasLaborales.every(item => typeof item === 'number')) {\r\n          return diasLaborales;\r\n        }\r\n        \r\n        // Si es un array con un string que parece JSON\r\n        if (Array.isArray(diasLaborales) && diasLaborales.length === 1 && typeof diasLaborales[0] === 'string') {\r\n          try {\r\n            // Intentar limpiar y parsear\r\n            const str = diasLaborales[0].trim();\r\n            // Verificar si es un array JSON\r\n            if (str.startsWith('[') && str.endsWith(']')) {\r\n              return JSON.parse(str).map(Number);\r\n            }\r\n            // Si no es JSON, tratar como string separado por comas\r\n            return str.split(',').map(Number).filter(n => !isNaN(n));\r\n          } catch (e) {\r\n            console.error(\"Error parseando diasLaborales:\", e);\r\n            return [1, 2, 3, 4, 5, 6]; // Valor por defecto\r\n          }\r\n        }\r\n        \r\n        // Si es un string\r\n        if (typeof diasLaborales === 'string') {\r\n          // Si es un string JSON\r\n          if (diasLaborales.startsWith('[') && diasLaborales.endsWith(']')) {\r\n            try {\r\n              return JSON.parse(diasLaborales).map(Number);\r\n            } catch (e) {\r\n              console.error(\"Error parseando diasLaborales JSON:\", e);\r\n            }\r\n          }\r\n          // Si es un string separado por comas\r\n          return diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n        }\r\n        \r\n        // Valor por defecto si no se puede procesar\r\n        return [1, 2, 3, 4, 5];\r\n      };\r\n      \r\n      data.diasLaborales = procesarDiasLaborales(data.diasLaborales);\r\n      \r\n      // Convertir diasNoLaborables si es necesario\r\n      if (typeof data.diasNoLaborables === 'string') {\r\n        try {\r\n          data.diasNoLaborables = JSON.parse(data.diasNoLaborables);\r\n        } catch (e) {\r\n          data.diasNoLaborables = data.diasNoLaborables.replace(/[\\[\\]\\s]/g, '').split(',').filter(Boolean);\r\n        }\r\n      }\r\n      \r\n      return data;\r\n    },\r\n\r\n    // 1. Obtener configuracin general\r\n    async obtenerConfigGeneral() {\r\n        const doc = await db.collection('config').doc('general').get();\r\n        return doc.exists ? doc.data() : {};\r\n    },\r\n\r\n    // Obtener todas las categoras\r\n    async obtenerCategorias() {\r\n      const snapshot = await db.collection('categorias')\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // Obtener servicios por categora\r\n    async obtenerServiciosPorCategoria(categoriaId) {\r\n      const snapshot = await db.collection('servicios')\r\n        .where('categoriaId', '==', categoriaId)\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // Obtener todos los especialistas\r\n    async obtenerEspecialistas() {\r\n      const snapshot = await db.collection('especialistas')\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 2. Obtener todos los servicios activos  \r\n    async obtenerServicios() {\r\n        const snapshot = await db.collection('servicios')\r\n            .where('activo', '==', true)\r\n            .orderBy('orden')\r\n            .get();\r\n        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 3. Obtener especialistas por categora\r\n    async obtenerEspecialistasPorCategoria(categoriaId) {\r\n      const snapshot = await db.collection('especialistas')\r\n        .where('categoriasId', 'array-contains', categoriaId)\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ \r\n        id: doc.id, \r\n        ...doc.data(),\r\n        categorias: doc.data().categoriasId // Puedes mapear esto a nombres si es necesario\r\n      }));\r\n    },\r\n\r\n    // 4. Obtener especialistas por servicio\r\n    async obtenerEspecialistasPorServicio(servicioId) {\r\n      const servicioDoc = await db.collection('servicios').doc(servicioId).get();\r\n      if (!servicioDoc.exists) return [];\r\n      \r\n      const servicioData = servicioDoc.data();\r\n      return await this.obtenerEspecialistasPorCategoria(servicioData.categoriaId);\r\n    },\r\n\r\n    // 5. Obtener turnos por ESPECIALISTA y fecha\r\n    async obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('especialistaIds', 'array-contains', especialistaId)\r\n          .where('fecha', '==', fecha)\r\n          .get();\r\n        \r\n        return snapshot.docs.map(doc => {\r\n          const data = doc.data();\r\n          return {\r\n            id: doc.id,\r\n            ...data,\r\n            // Asegurarse de que slotsPorEspecialista existe y tiene el formato correcto\r\n            slotsPorEspecialista: data.slotsPorEspecialista || {}\r\n          };\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo turnos por especialista y fecha:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    async obtenerTurnosPorEspecialistasYFecha(especialistasIds, fecha) {\r\n      const promises = especialistasIds.map(especialistaId =>\r\n        this.obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha)\r\n      );\r\n      const resultados = await Promise.all(promises);\r\n      return resultados.flat();\r\n    },\r\n\r\n    // Verificar disponibilidad para mltiples especialistas\r\n    async verificarDisponibilidadParaEspecialistas(fecha, horario, especialistasIds) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .where('horarioInicio', '==', horario)\r\n          .where('especialistaId', 'in', especialistasIds)\r\n          .limit(1)\r\n          .get();\r\n          \r\n        return snapshot.empty;\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async obtenerTurnosPorFecha(fecha) {\r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 6. Generar horarios por ESPECIALISTA y FECHA\r\n    async generarHorariosDisponiblesEspecialista(especialistaId, fecha, duracionRequerida = 0) {\r\n      try {\r\n        const [config, especialistaDoc, turnosOcupados] = await Promise.all([\r\n          this.obtenerConfiguracion(),\r\n          db.collection('especialistas').doc(especialistaId).get(),\r\n          this.obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha)\r\n        ]);\r\n\r\n        if (!especialistaDoc.exists) {\r\n          throw new Error('Especialista no encontrado');\r\n        }\r\n\r\n        const especialista = especialistaDoc.data();\r\n        if (!especialista) throw new Error('Especialista no encontrado');\r\n\r\n        // Determinar horario laboral del da\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const diaKey = dias[diaSemana];\r\n        const horarioDia = especialista.horarioLaboral?.[diaKey];\r\n        \r\n        // Usar horario del especialista o config general\r\n        const horarioApertura = horarioDia?.activo ? horarioDia.inicio : config.horarioApertura;\r\n        const horarioCierre = horarioDia?.activo ? horarioDia.fin : config.horarioCierre;\r\n\r\n        // Calcular slots ocupados - PASA el especialistaId como parmetro\r\n        const slotsOcupados = this._calcularSlotsOcupados(turnosOcupados, especialistaId);\r\n\r\n        return this._generarHorarios(\r\n            { ...config, horarioApertura, horarioCierre },\r\n            slotsOcupados,\r\n            fecha,\r\n            duracionRequerida\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error en generarHorariosDisponiblesEspecialista:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Modificar la funcin _generarHorarios para considerar la duracin:\r\n    _generarHorarios(config, slotsOcupados, fechaSeleccionada, duracionRequerida = 0) {\r\n        const horarioApertura = config.horarioApertura;\r\n        const horarioCierre = config.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const horaApertura = parseInt(horarioApertura.replace('.', ':').split(':')[0]);\r\n        const minApertura = parseInt(horarioApertura.replace('.', ':').split(':')[1] || 0);\r\n        const horaCierre = parseInt(horarioCierre.replace('.', ':').split(':')[0]);\r\n        const minCierre = parseInt(horarioCierre.replace('.', ':').split(':')[1] || 0);\r\n        \r\n        // Obtener duracin con valor por defecto si es invlida\r\n        let duracion = 30; // Valor por defecto\r\n        if (config.duracionTurno && !isNaN(parseInt(config.duracionTurno))) {\r\n            duracion = parseInt(config.duracionTurno);\r\n        } else if (config.duracionTurnoBase && !isNaN(parseInt(config.duracionTurnoBase))) {\r\n            duracion = parseInt(config.duracionTurnoBase);\r\n        }\r\n        \r\n        // Validacin de valores numricos\r\n        if (isNaN(horaApertura)) throw new Error('Horario apertura invlido');\r\n        if (isNaN(minApertura)) minApertura = 0;\r\n        if (isNaN(horaCierre)) throw new Error('Horario cierre invlido');\r\n        if (isNaN(minCierre)) minCierre = 0;\r\n        if (isNaN(duracion)) {\r\n            console.warn('Duracin turno invlida, usando valor por defecto de 30 minutos');\r\n            duracion = 30;\r\n        }\r\n\r\n        const horarios = [];\r\n        let horaActual = horaApertura;\r\n        let minActual = minApertura;\r\n\r\n        // Convertir horario de cierre a minutos para validacin\r\n        const cierreMinutos = horaCierre * 60 + minCierre;\r\n\r\n        while (true) {\r\n            const horarioStr = `${horaActual.toString().padStart(2, '0')}:${minActual.toString().padStart(2, '0')}`;\r\n            \r\n            // Verificar si este horario puede acomodar la duracin requerida\r\n            const inicioMinutos = horaActual * 60 + minActual;\r\n            const finMinutos = inicioMinutos + duracionRequerida;\r\n            \r\n            // CORRECCIN: Verificar que el horario de fin no exceda el cierre\r\n            const cabeEnJornada = finMinutos <= cierreMinutos;\r\n            \r\n            // Solo considerar horarios que estn dentro del rango laboral\r\n            if (inicioMinutos >= cierreMinutos) break;\r\n            \r\n            // Verificar si todos los slots necesarios para la duracin estn disponibles\r\n            let todosLosSlotsDisponibles = true;\r\n            for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n                const horaSlot = Math.floor(min / 60);\r\n                const minutoSlot = min % 60;\r\n                const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n                \r\n                if (slotsOcupados.includes(horarioSlot)) {\r\n                    todosLosSlotsDisponibles = false;\r\n                    break;\r\n                }\r\n            }\r\n            \r\n            const ocupado = !todosLosSlotsDisponibles;\r\n\r\n            // Solo marcar como disponible si no est ocupado y cabe en la jornada\r\n            horarios.push({\r\n                hora: horarioStr,\r\n                disponible: !ocupado && cabeEnJornada\r\n            });\r\n\r\n            // Avanzar el tiempo por la duracin base, no la requerida\r\n            minActual += duracion;\r\n            if (minActual >= 60) {\r\n                horaActual += Math.floor(minActual / 60);\r\n                minActual = minActual % 60;\r\n            }\r\n            \r\n            // Salir del loop si hemos superado el horario de cierre\r\n            if (horaActual > horaCierre || (horaActual === horaCierre && minActual > minCierre)) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Validacin mnima de resultados\r\n        if (horarios.length === 0) {\r\n            console.error('No se generaron horarios con la configuracin:', config);\r\n            throw new Error('No se pudieron generar horarios');\r\n        }\r\n\r\n        return horarios;\r\n    },\r\n\r\n    // Funcin para generar horarios bsicos sin considerar duracin\r\n    _generarHorariosBasicos(config, slotsOcupados, fechaSeleccionada) {\r\n        const horarioApertura = config.horarioApertura;\r\n        const horarioCierre = config.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const horaApertura = parseInt(horarioApertura.replace('.', ':').split(':')[0]);\r\n        const minApertura = parseInt(horarioApertura.replace('.', ':').split(':')[1] || 0);\r\n        const horaCierre = parseInt(horarioCierre.replace('.', ':').split(':')[0]);\r\n        const minCierre = parseInt(horarioCierre.replace('.', ':').split(':')[1] || 0);\r\n        \r\n        // Obtener duracin con valor por defecto si es invlida\r\n        let duracion = 30;\r\n        if (config.duracionTurno && !isNaN(parseInt(config.duracionTurno))) {\r\n            duracion = parseInt(config.duracionTurno);\r\n        } else if (config.duracionTurnoBase && !isNaN(parseInt(config.duracionTurnoBase))) {\r\n            duracion = parseInt(config.duracionTurnoBase);\r\n        }\r\n\r\n        const horarios = [];\r\n        let horaActual = horaApertura;\r\n        let minActual = minApertura;\r\n\r\n        // Convertir horario de cierre a minutos para validacin\r\n        const cierreMinutos = horaCierre * 60 + minCierre;\r\n\r\n        while (horaActual < horaCierre || (horaActual === horaCierre && minActual <= minCierre)) {\r\n            const horarioStr = `${horaActual.toString().padStart(2, '0')}:${minActual.toString().padStart(2, '0')}`;\r\n            \r\n            const ocupado = slotsOcupados.includes(horarioStr);\r\n            const dentroDeJornada = (horaActual * 60 + minActual) < cierreMinutos;\r\n\r\n            horarios.push({\r\n                hora: horarioStr,\r\n                disponible: !ocupado && dentroDeJornada\r\n            });\r\n\r\n            // Avanzar el tiempo\r\n            minActual += duracion;\r\n            if (minActual >= 60) {\r\n                horaActual += Math.floor(minActual / 60);\r\n                minActual = minActual % 60;\r\n            }\r\n        }\r\n\r\n        return horarios;\r\n    },\r\n\r\n    // Funcin para obtener horarios comunes disponibles\r\n    async obtenerHorariosComunesDisponibles(fecha, especialistasIds, duracionTotal) {\r\n      try {\r\n        // Obtener horarios para cada especialista CON la duracin total\r\n        const horariosPorEspecialista = {};\r\n        \r\n        for (const especialistaId of especialistasIds) {\r\n          const horarios = await this.generarHorariosDisponiblesEspecialista(\r\n            especialistaId, \r\n            fecha,\r\n            duracionTotal // Pasar la duracin total aqu\r\n          );\r\n          \r\n          // Filtrar solo los horarios disponibles\r\n          const horariosDisponibles = horarios\r\n            .filter(horario => horario.disponible)\r\n            .map(horario => horario.hora);\r\n          \r\n          horariosPorEspecialista[especialistaId] = horariosDisponibles;\r\n        }\r\n        \r\n        // Encontrar horarios comunes donde todos los especialistas estn disponibles\r\n        return this._encontrarHorariosComunes(horariosPorEspecialista);\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo horarios comunes:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Funcin auxiliar para verificar si un horario puede acomodar la duracin total\r\n    async _puedeAcomodarDuracion(horarioInicio, duracionTotal, especialistaId, fecha) {\r\n        try {\r\n            // Obtener datos del especialista\r\n            const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n            if (!especialistaDoc.exists) return false;\r\n            \r\n            const especialista = especialistaDoc.data();\r\n            const diaSemana = new Date(fecha).getDay();\r\n            const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n            const diaKey = dias[diaSemana];\r\n            \r\n            // Usar horario del especialista o configuracin general\r\n            const horarioLaboral = especialista.horarioLaboral?.[diaKey];\r\n            const config = await this.obtenerConfiguracion();\r\n            \r\n            const horarioCierre = horarioLaboral?.activo ? \r\n                horarioLaboral.fin : config.horarioCierre;\r\n            \r\n            // Convertir horarios a minutos para comparacin\r\n            const [horaInicioStr, minutoInicioStr] = horarioInicio.split(':');\r\n            const horaInicio = parseInt(horaInicioStr);\r\n            const minutoInicio = parseInt(minutoInicioStr);\r\n            const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n            \r\n            const [horaCierreStr, minutoCierreStr] = horarioCierre.split(':');\r\n            const horaCierre = parseInt(horaCierreStr);\r\n            const minutoCierre = parseInt(minutoCierreStr || 0);\r\n            const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n            \r\n            // Calcular horario de fin\r\n            const finMinutos = inicioMinutos + duracionTotal;\r\n            \r\n            // Verificar que el turno termine antes del cierre\r\n            return finMinutos <= cierreMinutos;\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error validando duracin:\", error);\r\n            return false;\r\n        }\r\n    },\r\n\r\n    // Funcin para encontrar horarios comunes entre especialistas\r\n    _encontrarHorariosComunes(horariosPorEspecialista) {\r\n        const especialistasIds = Object.keys(horariosPorEspecialista);\r\n        if (especialistasIds.length === 0) return [];\r\n        \r\n        // Empezar con los horarios del primer especialista\r\n        let horariosComunes = [...horariosPorEspecialista[especialistasIds[0]]];\r\n        \r\n        // Intersectar con los horarios de los dems especialistas\r\n        for (let i = 1; i < especialistasIds.length; i++) {\r\n            const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n            horariosComunes = horariosComunes.filter(hora => \r\n                horariosEspecialista.includes(hora)\r\n            );\r\n        }\r\n        \r\n        return horariosComunes;\r\n    },\r\n\r\n    // Funcin para encontrar horarios comunes que puedan acomodar la duracin\r\n    _encontrarHorariosComunesConDuracion(horariosPorEspecialista, duracionTotal) {\r\n      const especialistasIds = Object.keys(horariosPorEspecialista);\r\n      if (especialistasIds.length === 0) return [];\r\n      \r\n      // Obtener todos los horarios posibles del primer especialista\r\n      const horariosBase = horariosPorEspecialista[especialistasIds[0]];\r\n      const horariosComunes = [];\r\n      \r\n      // Para cada horario del primer especialista, verificar si los dems\r\n      // tambin tienen disponibilidad para el bloque completo\r\n      for (const horarioBase of horariosBase) {\r\n        if (!horarioBase.disponible) continue;\r\n        \r\n        let todosDisponibles = true;\r\n        const inicioMinutos = horarioBase.minutos;\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        // Verificar para cada especialista si tiene todos los slots necesarios disponibles\r\n        for (let i = 0; i < especialistasIds.length; i++) {\r\n          const especialistaId = especialistasIds[i];\r\n          const horariosEspecialista = horariosPorEspecialista[especialistaId];\r\n          \r\n          // Verificar cada slot de 30 minutos dentro de la duracin total\r\n          for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            const horarioSlotStr = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n            \r\n            // Buscar este slot en los horarios del especialista\r\n            const slotDisponible = horariosEspecialista.find(h => \r\n              h.hora === horarioSlotStr && h.disponible\r\n            );\r\n            \r\n            if (!slotDisponible) {\r\n              todosDisponibles = false;\r\n              break;\r\n            }\r\n          }\r\n          \r\n          if (!todosDisponibles) break;\r\n        }\r\n        \r\n        if (todosDisponibles) {\r\n          horariosComunes.push(horarioBase.hora);\r\n        }\r\n      }\r\n      \r\n      return horariosComunes;\r\n    },\r\n\r\n    // Funcin para filtrar horarios segn la hora actual (si es hoy)\r\n    _filtrarHorariosPorHoraActual(horarios, duracionTotal) {\r\n        const ahora = new Date();\r\n        const horaActual = ahora.getHours();\r\n        const minutoActual = ahora.getMinutes();\r\n        const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n        \r\n        return horarios.filter(horario => {\r\n            const [horaStr, minutoStr] = horario.split(':');\r\n            const horaHorario = parseInt(horaStr);\r\n            const minutoHorario = parseInt(minutoStr);\r\n            const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n            \r\n            // Considerar margen de 30 minutos para reservas + duracin total\r\n            return tiempoHorarioMinutos >= (tiempoActualMinutos + 30 + duracionTotal);\r\n        });\r\n    },\r\n\r\n    // Verificar disponibilidad bsica\r\n    async verificarDisponibilidad(fecha, horario) {\r\n          try {\r\n            const snapshot = await db.collection('turnos')\r\n                .where('fecha', '==', fecha)\r\n                .where('horarioInicio', '==', horario)\r\n                .limit(1)\r\n                .get();\r\n                \r\n            return snapshot.empty;\r\n        } catch (error) {\r\n            console.error(\"Error verificando disponibilidad:\", error);\r\n            return false;\r\n        }\r\n    },\r\n\r\n    async verificarDisponibilidadEspecialistas(fecha) {\r\n        for (const especialista of datosReserva.especialistas) {\r\n            const disponible = await verificarDisponibilidadEspecialista(especialista.id, fecha);\r\n            if (!disponible) return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    async verificarDisponibilidadEspecialista(especialistaId, fecha, horario) {\r\n      try {\r\n        // 1. Verificar si el especialista trabaja ese da\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) return false;\r\n        \r\n        const especialistaData = especialistaDoc.data();\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // Si no trabaja ese da, no est disponible\r\n        if (!especialistaData.horarioLaboral || !especialistaData.horarioLaboral[diaKey]?.activo) {\r\n          return false;\r\n        }\r\n        \r\n        // 2. Verificar si tiene bloqueos/ausencias\r\n        const tieneBloqueos = await this.verificarBloqueosEspecialista(especialistaId, fecha);\r\n        if (tieneBloqueos) return false;\r\n        \r\n        // 3. Verificar turnos existentes\r\n        const snapshot = await db.collection('turnos')\r\n          .where('especialistaId', '==', especialistaId)\r\n          .where('fecha', '==', fecha)\r\n          .where('horarioInicio', '==', horario)\r\n          .limit(1)\r\n          .get();\r\n          \r\n        return snapshot.empty;\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async verificarBloqueosEspecialista(especialistaId, fecha) {\r\n        try {\r\n            // Convertir fecha a timestamp para comparacin\r\n            const fechaTimestamp = new Date(fecha).getTime();\r\n            \r\n            // Buscar bloqueos para este especialista\r\n            const snapshot = await db.collection('bloqueos')\r\n                .where('especialistaId', '==', especialistaId)\r\n                .get();\r\n                \r\n            if (snapshot.empty) {\r\n                return false;\r\n            }\r\n            \r\n            // Verificar cada bloqueo\r\n            for (const doc of snapshot.docs) {\r\n                const bloqueo = doc.data();\r\n                const inicioBloqueo = new Date(bloqueo.fechaInicio).getTime();\r\n                const finBloqueo = new Date(bloqueo.fechaFin).getTime();\r\n                \r\n                // Si la fecha est dentro del rango de bloqueo\r\n                if (fechaTimestamp >= inicioBloqueo && fechaTimestamp <= finBloqueo) {\r\n                    return true;\r\n                }\r\n            }\r\n            \r\n            return false;\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error verificando bloqueos:\", error);\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    // Verificar solapamientos\r\n    async obtenerTurnosSolapados(fecha, horario, duracion) {\r\n      const [horaStr, minutoStr] = horario.split(':');\r\n      const horaInicio = parseInt(horaStr);\r\n      const minutoInicio = parseInt(minutoStr);\r\n      \r\n      const minutoFin = minutoInicio + duracion;\r\n      const horaFin = horaInicio + Math.floor(minutoFin / 60);\r\n      const minutoFinAjustado = minutoFin % 60;\r\n      const horarioFin = `${horaFin.toString().padStart(2, '0')}:${minutoFinAjustado.toString().padStart(2, '0')}`;\r\n      \r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .where('horarioInicio', '>=', horario)\r\n        .where('horarioInicio', '<', horarioFin)\r\n        .get();\r\n        \r\n      return snapshot.docs.map(doc => doc.data());\r\n    },\r\n\r\n    // Bloqueo temporal\r\n    async bloquearTurnoTemporal(fecha, horario, userId) {\r\n      const docRef = await db.collection('bloqueos_temporales').add({\r\n        fecha,\r\n        horario,\r\n        userId,\r\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n        expiresAt: new Date(Date.now() + 5*60*1000) // 5 minutos de expiracin\r\n      });\r\n      return docRef.id; // Devolver el ID automtico\r\n    },\r\n\r\n    async eliminarBloqueoTemporal(bloqueoId) {\r\n      await db.collection('bloqueos_temporales').doc(bloqueoId).delete();\r\n    },\r\n\r\n    async obtenerTurnosPorUsuario(userId) {\r\n      try {\r\n        const hoy = new Date();\r\n        hoy.setHours(0, 0, 0, 0);\r\n        const fechaHoy = hoy.toISOString().split('T')[0];\r\n\r\n        const snapshot = await db.collection('turnos')\r\n          .where('userId', '==', userId)\r\n          .where('fecha', '>=', fechaHoy)\r\n          .orderBy('fecha')\r\n          .orderBy('horarioInicio')\r\n          .get();\r\n\r\n        return snapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo turnos del usuario:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Guardar turno\r\n    async guardarTurno(turnoData) {\r\n      try {\r\n        // Obtener informacin detallada de los servicios\r\n        const serviciosSnapshot = await db.collection('servicios')\r\n          .where(firebase.firestore.FieldPath.documentId(), 'in', turnoData.serviciosIds)\r\n          .get();\r\n        \r\n        // Obtener servicios en el mismo orden que serviciosIds\r\n        const serviciosOrdenados = [];\r\n        for (const servicioId of turnoData.serviciosIds) {\r\n          const servicioDoc = serviciosSnapshot.docs.find(doc => doc.id === servicioId);\r\n          if (servicioDoc) {\r\n            serviciosOrdenados.push(servicioDoc);\r\n          }\r\n        }\r\n\r\n        // Obtener el mapeo de categora a especialista desde los datos del turno\r\n        const { especialistasPorCategoria } = turnoData;\r\n\r\n        // Calcular duracin total y agrupar servicios por especialista\r\n        let duracionTotal = 0;\r\n        const serviciosPorEspecialista = {};\r\n        const slotsPorEspecialista = {};\r\n        \r\n        // Primero, agrupar servicios por especialista\r\n        serviciosOrdenados.forEach(servicioDoc => {\r\n          const servicio = servicioDoc.data();\r\n          duracionTotal += servicio.duracion || 30;\r\n          \r\n          const especialistaId = especialistasPorCategoria[servicio.categoriaId];\r\n          \r\n          if (!especialistaId) {\r\n            throw new Error(`No se encontr especialista para la categora ${servicio.categoriaId}`);\r\n          }\r\n          \r\n          if (!serviciosPorEspecialista[especialistaId]) {\r\n            serviciosPorEspecialista[especialistaId] = [];\r\n            slotsPorEspecialista[especialistaId] = [];\r\n          }\r\n          \r\n          serviciosPorEspecialista[especialistaId].push({\r\n            id: servicioDoc.id,\r\n            nombre: servicio.nombre,\r\n            duracion: servicio.duracion || 30,\r\n            categoriaId: servicio.categoriaId\r\n          });\r\n        });\r\n\r\n        // Convertir horario de inicio a minutos\r\n        const [horaInicioStr, minutoInicioStr] = turnoData.horarioInicio.split(':');\r\n        const horaInicio = parseInt(horaInicioStr);\r\n        const minutoInicio = parseInt(minutoInicioStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        \r\n        // Calcular slots ocupados por especialista\r\n        let offsetGlobalMinutos = 0;\r\n        \r\n        for (const servicioDoc of serviciosOrdenados) {\r\n          const servicio = servicioDoc.data();\r\n          const especialistaId = especialistasPorCategoria[servicio.categoriaId];\r\n          \r\n          const servicioInicioMinutos = inicioMinutos + offsetGlobalMinutos;\r\n          const servicioFinMinutos = servicioInicioMinutos + servicio.duracion;\r\n          \r\n          // Calcular slots para este servicio\r\n          for (let min = servicioInicioMinutos; min < servicioFinMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n            \r\n            if (!slotsPorEspecialista[especialistaId].includes(horarioSlot)) {\r\n              slotsPorEspecialista[especialistaId].push(horarioSlot);\r\n            }\r\n          }\r\n          \r\n          offsetGlobalMinutos += servicio.duracion;\r\n        }\r\n        \r\n        // Crear un array con todos los IDs de especialistas involucrados\r\n        const especialistaIds = Object.keys(serviciosPorEspecialista);\r\n        \r\n        // CORRECCIN: Asegurar que serviciosPorEspecialista y slotsPorEspecialista tengan datos\r\n        if (Object.keys(serviciosPorEspecialista).length === 0) {\r\n          console.error(\"ERROR: serviciosPorEspecialista est vaco\");\r\n          console.log(\"Datos disponibles:\", {\r\n            serviciosOrdenados: serviciosOrdenados.length,\r\n            especialistasPorCategoria,\r\n            serviciosIds: turnoData.serviciosIds\r\n          });\r\n        }\r\n\r\n        if (Object.keys(slotsPorEspecialista).length === 0) {\r\n          console.error(\"ERROR: slotsPorEspecialista est vaco\");\r\n        }\r\n\r\n        // Guardar el turno\r\n        const docRef = await db.collection('turnos').add({\r\n          ...turnoData,\r\n          duracionTotal: duracionTotal,\r\n          serviciosPorEspecialista: serviciosPorEspecialista,\r\n          slotsPorEspecialista: slotsPorEspecialista,\r\n          especialistaIds: especialistaIds,\r\n          estado: 'pendiente',\r\n          createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n          actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n        });\r\n        \r\n        console.log(`Turno guardado exitosamente. ID: ${docRef.id}`);\r\n        return { id: docRef.id, ...turnoData };\r\n      } catch (error) {\r\n        console.error(\"Error guardando turno:\", error);\r\n        throw error;\r\n      }\r\n    },\r\n\r\n    // AGREGAR al final para compatibilidad temporal:\r\n    async generarHorariosDisponibles(fecha) {\r\n        console.warn('DEPRECATED: Usar generarHorariosDisponiblesEspecialista()');\r\n        return this.generarHorariosDisponiblesEspecialista('especialista_default', fecha);\r\n    },\r\n\r\n    _calcularSlotsOcupados(turnos, especialistaId) {\r\n      const slotsOcupados = [];\r\n      \r\n      turnos.forEach(turno => {\r\n        // Verificar si este turno involucra al especialista\r\n        if (turno.especialistaIds && turno.especialistaIds.includes(especialistaId)) {\r\n          // Usar los slots especficos para este especialista\r\n          if (turno.slotsPorEspecialista && turno.slotsPorEspecialista[especialistaId]) {\r\n            slotsOcupados.push(...turno.slotsPorEspecialista[especialistaId]);\r\n          } else {\r\n            // Fallback para turnos antiguos - calcular slots basados en horarioInicio y duracin\r\n            const [hora, minuto] = turno.horarioInicio.split(':').map(Number);\r\n            const inicioMinutos = hora * 60 + minuto;\r\n            const finMinutos = inicioMinutos + (turno.duracionTotal || 30);\r\n            \r\n            for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n              const horaSlot = Math.floor(min / 60);\r\n              const minutoSlot = min % 60;\r\n              const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n              \r\n              if (!slotsOcupados.includes(horarioSlot)) {\r\n                slotsOcupados.push(horarioSlot);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      return slotsOcupados;\r\n    }\r\n  };\r\n})();","const cacheMonitor = {\r\n    hits: 0,\r\n    misses: 0,\r\n    savings: 0,\r\n    \r\n    incrementHit: function() {\r\n        this.hits++;\r\n        this.logStats();\r\n    },\r\n    \r\n    incrementMiss: function() {\r\n        this.misses++;\r\n        this.logStats();\r\n    },\r\n    \r\n    logStats: function() {\r\n        const total = this.hits + this.misses;\r\n        const hitRate = total > 0 ? Math.round((this.hits / total) * 100) : 0;\r\n        \r\n        // Log cada 10 operaciones para no saturar la consola\r\n        if (total % 10 === 0) {\r\n            console.log(` Cache Stats: ${this.hits}h/${this.misses}m (${hitRate}%) | Ahorro: ${this.savings} lecturas`);\r\n        }\r\n    },\r\n    \r\n    addSavings: function(amount) {\r\n        this.savings += amount;\r\n    }\r\n};\r\n\r\nconst cache = {\r\n    config: null,\r\n    categorias: null,\r\n    servicios: null,\r\n    especialistas: {},\r\n    horarios: {},\r\n    horarios_multi: {}, //  AGREGAR: Cache para horarios mltiples\r\n    timestamp: {\r\n        config: 0,\r\n        categorias: 0,\r\n        servicios: 0,\r\n        especialistas: {},\r\n        horarios: {},\r\n        horarios_multi: {} //  AGREGAR: Timestamp para horarios mltiples\r\n    },\r\n    \r\n    // Tiempo de vida del cach en milisegundos (5 minutos)\r\n    ttl: 5 * 60 * 1000,\r\n    \r\n    // Verificar si el cach es vlido\r\n    esValido: function(clave, idEspecifico = null) {\r\n        try {\r\n            const timestamp = idEspecifico \r\n                ? this.timestamp[clave]?.[idEspecifico] || 0\r\n                : this.timestamp[clave] || 0;\r\n            \r\n            return (Date.now() - timestamp) < this.ttl;\r\n        } catch (error) {\r\n            console.warn('Error validando cach:', error);\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    // Guardar en cach\r\n    guardar: function(clave, datos, idEspecifico = null) {\r\n        try {\r\n            //  CORRECCIN: Validar que los datos no sean null/undefined\r\n            if (datos === null || datos === undefined) {\r\n                console.warn(` Intentando guardar datos invlidos en cach: ${clave}`, datos);\r\n                return;\r\n            }\r\n\r\n            if (idEspecifico) {\r\n                if (!this[clave]) this[clave] = {};\r\n                if (!this.timestamp[clave]) this.timestamp[clave] = {};\r\n                \r\n                this[clave][idEspecifico] = datos;\r\n                this.timestamp[clave][idEspecifico] = Date.now();\r\n            } else {\r\n                this[clave] = datos;\r\n                this.timestamp[clave] = Date.now();\r\n            }\r\n            \r\n            console.log(` Cach guardado: ${clave}${idEspecifico ? `[${idEspecifico}]` : ''}`);\r\n        } catch (error) {\r\n            console.error('Error guardando en cach:', error);\r\n        }\r\n    },\r\n    \r\n    // Obtener del cach\r\n    obtener: function(clave, idEspecifico = null) {\r\n        try {\r\n            const datos = idEspecifico \r\n                ? this[clave]?.[idEspecifico] ?? null\r\n                : this[clave] ?? null;\r\n            \r\n            if (datos !== null && this.esValido(clave, idEspecifico)) {\r\n                cacheMonitor.incrementHit();\r\n                cacheMonitor.savings += this.estimarLecturasAhorradas(clave);\r\n                return datos;\r\n            }\r\n            \r\n            cacheMonitor.incrementMiss();\r\n            return null;\r\n        } catch (error) {\r\n            console.error('Error obteniendo del cach:', error);\r\n            cacheMonitor.incrementMiss();\r\n            return null;\r\n        }\r\n    },\r\n    \r\n    estimarLecturasAhorradas: function(clave) {\r\n        // Estimacin de documentos ledos por operacin\r\n        const estimaciones = {\r\n            config: 1,\r\n            categorias: 10, // Suponiendo 10 categoras\r\n            servicios: 50,  // Suponiendo 50 servicios\r\n            especialistas: 5, // Por categora\r\n            horarios: 1,    // Por especialista por fecha\r\n            horarios_multi: 3 // Mltiples especialistas\r\n        };\r\n        return estimaciones[clave] || 1;\r\n    },\r\n\r\n    //  NUEVA FUNCIN: Limpiar cach especfico\r\n    limpiarEspecifico: function(clave, idEspecifico = null) {\r\n        try {\r\n            if (idEspecifico) {\r\n                if (this[clave] && this[clave][idEspecifico]) {\r\n                    delete this[clave][idEspecifico];\r\n                }\r\n                if (this.timestamp[clave] && this.timestamp[clave][idEspecifico]) {\r\n                    delete this.timestamp[clave][idEspecifico];\r\n                }\r\n                console.log(` Cach limpiado: ${clave}[${idEspecifico}]`);\r\n            } else {\r\n                this[clave] = null;\r\n                this.timestamp[clave] = 0;\r\n                console.log(` Cach limpiado: ${clave}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error limpiando cach especfico:', error);\r\n        }\r\n    },\r\n\r\n    //  NUEVA FUNCIN: Forzar actualizacin de cach para una categora\r\n    forzarActualizacionEspecialistas: function(categoriaId) {\r\n        this.limpiarEspecifico('especialistas', categoriaId);\r\n        console.log(` Cach forzado a actualizar para categora: ${categoriaId}`);\r\n    }\r\n};\r\n\r\n// Estrategia de precaching - Cargar datos esenciales al inicio\r\nasync function precacheDatosEsenciales() {\r\n    try {\r\n        console.log(' Precargando datos esenciales...');\r\n        \r\n        // Cargar configuracin, categoras y servicios en paralelo\r\n        await Promise.allSettled([\r\n            firestoreSeguro.obtenerConfiguracion(),\r\n            firestoreSeguro.obtenerCategorias(),\r\n            firestoreSeguro.obtenerServicios()\r\n        ]);\r\n        \r\n        console.log(' Precaching completado');\r\n    } catch (error) {\r\n        console.warn(' Precaching fall:', error);\r\n    }\r\n}\r\n\r\n// Guardar cache antes de recargar/cerrar\r\nwindow.addEventListener('beforeunload', guardarCacheEnStorage);\r\n\r\n// Cargar al iniciar\r\ndocument.addEventListener('DOMContentLoaded', cargarCacheDesdeStorage);\r\n\r\n// Funcin para limpiar cach cuando sea necesario\r\nfunction limpiarCache(clave = null) {\r\n    if (clave) {\r\n        cache[clave] = null;\r\n        cache.timestamp[clave] = 0;\r\n        console.log(` Cach de ${clave} limpiado`);\r\n    } else {\r\n        // Limpiar todo el cach\r\n        Object.keys(cache).forEach(key => {\r\n            if (key !== 'ttl' && key !== 'timestamp') {\r\n                cache[key] = key === 'especialistas' || key === 'horarios' || key === 'horarios_multi' ? {} : null;\r\n            }\r\n        });\r\n        Object.keys(cache.timestamp).forEach(key => {\r\n            cache.timestamp[key] = key === 'especialistas' || key === 'horarios' || key === 'horarios_multi' ? {} : 0;\r\n        });\r\n        console.log(' Todo el cach limpiado');\r\n    }\r\n}\r\n\r\n// Cuando cambian datos importantes, forzar actualizacin\r\nfunction actualizarCacheEspecialistas() {\r\n    limpiarCache('especialistas');\r\n    console.log(' Cache de especialistas actualizado forzadamente');\r\n}\r\n\r\n// Sistema de cach en localStorage\r\nfunction guardarCacheEnStorage() {\r\n    try {\r\n        const cacheData = {\r\n            config: cache.config,\r\n            categorias: cache.categorias,\r\n            servicios: cache.servicios,\r\n            timestamp: cache.timestamp,\r\n            fechaGuardado: Date.now()\r\n        };\r\n        localStorage.setItem('firestoreCache', JSON.stringify(cacheData));\r\n    } catch (error) {\r\n        console.warn('No se pudo guardar el cach:', error);\r\n    }\r\n}\r\n\r\nfunction cargarCacheDesdeStorage() {\r\n    try {\r\n        const cacheData = localStorage.getItem('firestoreCache');\r\n        if (cacheData) {\r\n            const parsed = JSON.parse(cacheData);\r\n            const unaHora = 60 * 60 * 1000; // 1 hora en milisegundos\r\n            \r\n            // Solo cargar si tiene menos de 1 hora\r\n            if (Date.now() - parsed.fechaGuardado < unaHora) {\r\n                cache.config = parsed.config;\r\n                cache.categorias = parsed.categorias;\r\n                cache.servicios = parsed.servicios;\r\n                cache.timestamp = parsed.timestamp;\r\n                console.log(' Cach cargado desde localStorage');\r\n            } else {\r\n                console.log(' Cach expirado, limpiando...');\r\n                localStorage.removeItem('firestoreCache');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.warn('Error cargando cach:', error);\r\n    }\r\n}\r\n\r\n//  NUEVA FUNCIN: Limpiar cach de especialistas para una categora especfica\r\nfunction limpiarCacheEspecialistasPorCategoria(categoriaId) {\r\n    cache.forzarActualizacionEspecialistas(categoriaId);\r\n}","// Variables globales de autenticacin\r\nlet usuarioActual = null;\r\n\r\n// Verificar si estamos en la pgina de admin\r\nconst esPaginaAdmin = window.location.pathname.includes('admin.html');\r\n\r\nfunction inicializarAuth() {\r\n    // Manejar el resultado de redireccin primero\r\n    manejarRedirectResult();\r\n    \r\n    // Configurar el listener de estado de autenticacin\r\n    firebase.auth().onAuthStateChanged(async (user) => {\r\n        usuarioActual = user;\r\n        \r\n        // Solo actualizar UI si no estamos en admin\r\n        if (!esPaginaAdmin) {\r\n            await actualizarUIUsuario(user);\r\n            actualizarBotonAdmin(user);\r\n            \r\n            if (user && window.cargarDatosUsuario) {\r\n                await cargarDatosUsuario(user.uid);\r\n            }\r\n        }\r\n    });\r\n\r\n    if (!esPaginaAdmin) {\r\n        configurarEventosAuth();\r\n    }\r\n}\r\n\r\nfunction configurarEventosAuth() {\r\n    // Eliminar event listeners anteriores para evitar duplicados\r\n    document.removeEventListener('click', manejarClicAuth);\r\n    \r\n    // Nuevo manejador unificado\r\n    document.addEventListener('click', manejarClicAuth);\r\n}\r\n\r\nfunction manejarClicAuth(e) {\r\n    // Verificar si el clic fue en un botn de auth\r\n    const esBotonAuthPrincipal = e.target.id === 'btn-google' || e.target.closest('#btn-google');\r\n    const esBotonAuthMenu = e.target.id === 'btn-google-menu' || e.target.closest('#btn-google-menu');\r\n    \r\n    if (esBotonAuthPrincipal || esBotonAuthMenu) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        \r\n        // Ejecutar inmediatamente, no async\r\n        iniciarSesionGoogle();\r\n        return;\r\n    }\r\n    \r\n    // Otros eventos...\r\n    if (e.target.id === 'nav-cerrar-sesion' || e.target.closest('#nav-cerrar-sesion')) {\r\n        e.preventDefault();\r\n        cerrarSesion();\r\n        return;\r\n    }\r\n    \r\n    if (e.target.id === 'nav-perfil' || e.target.closest('#nav-perfil')) {\r\n        e.preventDefault();\r\n        manejarOpcionProtegida('perfil');\r\n        return;\r\n    }\r\n    \r\n    if (e.target.id === 'nav-mis-turnos' || e.target.closest('#nav-mis-turnos')) {\r\n        e.preventDefault();\r\n        manejarOpcionProtegida('mis-turnos');\r\n        return;\r\n    }\r\n    \r\n    if (e.target.classList.contains('.btn-admin')) {\r\n        e.preventDefault();\r\n        if (usuarioActual && esUsuarioAdministrador(usuarioActual)) {\r\n            window.location.href = '/admin.html';\r\n        } else {\r\n            mostrarError('Acceso denegado. Debes ser administrador.');\r\n        }\r\n        return;\r\n    }\r\n}\r\n\r\nasync function iniciarSesionGoogle() {\r\n    // Deshabilitar botones temporalmente para evitar mltiples clics\r\n    deshabilitarBotonesAuth(true);\r\n    \r\n    try {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n        \r\n        // Configuracin adicional para el popup\r\n        provider.setCustomParameters({\r\n            prompt: 'select_account'\r\n        });\r\n        \r\n        // Intentar con popup primero\r\n        console.log('Intentando autenticacin con popup...');\r\n        const result = await firebase.auth().signInWithPopup(provider);\r\n        console.log('Autenticacin exitosa:', result.user.email);\r\n        \r\n    } catch (error) {\r\n        console.error('Error en autenticacin:', error);\r\n        \r\n        // Manejar diferentes tipos de errores\r\n        if (error.code === 'auth/popup-blocked') {\r\n            console.log('Popup bloqueado, intentando con redireccin...');\r\n            await manejarAutenticacionRedirect();\r\n        } else if (error.code === 'auth/popup-closed-by-user') {\r\n            console.log('Usuario cerr el popup');\r\n            mostrarError('Cerraste la ventana de autenticacin. Intenta nuevamente.');\r\n        } else {\r\n            mostrarErrorAuth(error);\r\n        }\r\n    } finally {\r\n        deshabilitarBotonesAuth(false);\r\n    }\r\n}\r\n\r\nasync function manejarAutenticacionRedirect() {\r\n    try {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n        provider.setCustomParameters({\r\n            prompt: 'select_account'\r\n        });\r\n        \r\n        // Guardar la URL actual para redirigir despus\r\n        sessionStorage.setItem('preAuthUrl', window.location.href);\r\n        \r\n        await firebase.auth().signInWithRedirect(provider);\r\n    } catch (redirectError) {\r\n        console.error('Error en redireccin:', redirectError);\r\n        mostrarError('No se pudo iniciar sesin. Por favor, habilita las ventanas emergentes para este sitio.');\r\n    }\r\n}\r\n\r\n// Manejar el resultado de la redireccin al cargar la pgina\r\nfunction manejarRedirectResult() {\r\n    firebase.auth().getRedirectResult().then((result) => {\r\n        if (result.user) {\r\n            console.log('Autenticacin por redireccin exitosa:', result.user.email);\r\n            // Redirigir a la URL original si existe\r\n            const preAuthUrl = sessionStorage.getItem('preAuthUrl');\r\n            if (preAuthUrl && preAuthUrl !== window.location.href) {\r\n                sessionStorage.removeItem('preAuthUrl');\r\n                window.location.href = preAuthUrl;\r\n            }\r\n        }\r\n    }).catch((error) => {\r\n        console.error('Error en resultado de redireccin:', error);\r\n    });\r\n}\r\n\r\nasync function cerrarSesion() {\r\n    try {\r\n        // signOut() siempre se resuelve exitosamente, no necesita try-catch\r\n        await firebase.auth().signOut();\r\n        \r\n        // Opcional: Redirigir a la pgina principal o recargar\r\n        setTimeout(() => {\r\n            window.location.reload(); // O window.location.href = '/';\r\n        }, 1000);\r\n        \r\n    } catch (error) {\r\n        // Este bloque casi nunca se ejecutar porque signOut() siempre tiene xito\r\n        console.warn('Advertencia inesperada al cerrar sesin:', error);\r\n        // Pero an as mostramos xito porque la sesin se cerr\r\n        mostrarMensajeExito('Sesin cerrada correctamente');\r\n    }\r\n}\r\n\r\nfunction deshabilitarBotonesAuth(deshabilitar) {\r\n    const botonesAuth = [\r\n        document.getElementById('btn-google'),\r\n        document.getElementById('btn-google-menu')\r\n    ].filter(btn => btn !== null);\r\n    \r\n    botonesAuth.forEach(boton => {\r\n        if (deshabilitar) {\r\n            boton.disabled = true;\r\n            boton.style.opacity = '0.6';\r\n            boton.innerHTML = `\r\n                <span class=\"loader-google\"></span>\r\n            `;\r\n        } else {\r\n            boton.disabled = false;\r\n            boton.style.opacity = '1';\r\n            // Restaurar contenido original\r\n            if (boton.id === 'btn-google') {\r\n                boton.innerHTML = `\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                        <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path><path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path><path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path><path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    </svg>\r\n                    <span></span>\r\n                `;\r\n            } else {\r\n                boton.innerHTML = `\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                        <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path><path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path><path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path><path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    </svg>\r\n                    <span>Iniciar sesin</span>\r\n                `;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para mostrar errores de autenticacin\r\nfunction mostrarErrorAuth(error) {\r\n    let mensaje = 'Error al autenticar';\r\n    \r\n    const erroresConocidos = {\r\n        'auth/popup-blocked': 'El navegador bloque la ventana de inicio de sesin. Por favor, permite ventanas emergentes para este sitio.',\r\n        'auth/popup-closed-by-user': 'Cerraste la ventana de inicio de sesin. Intenta nuevamente.',\r\n        'auth/cancelled-popup-request': 'Solicitud cancelada.',\r\n        'auth/operation-not-allowed': 'Esta operacin no est permitida. Contacta al administrador.',\r\n        'auth/operation-not-supported-in-this-environment': 'Este navegador no soporta la autenticacin con popup.',\r\n        'auth/unauthorized-domain': 'Este dominio no est autorizado para autenticacin.'\r\n    };\r\n    \r\n    mensaje = erroresConocidos[error.code] || error.message || 'Error desconocido al autenticar';\r\n    \r\n    // Usar tu funcin existente de mostrarError\r\n    if (typeof mostrarError === 'function') {\r\n        mostrarError(mensaje);\r\n    } else {\r\n        alert(mensaje); // Fallback\r\n    }\r\n}\r\n\r\n// Guardar datos del usuario en LocalStorage\r\nfunction guardarUsuario(user) {\r\n    localStorage.setItem('usuario', JSON.stringify({\r\n        uid: user.uid,\r\n        nombre: user.displayName,\r\n        email: user.email,\r\n        photoURL: user.photoURL\r\n    }));\r\n}\r\n\r\n// Limpiar datos del usuario\r\nfunction limpiarUsuario() {\r\n    localStorage.removeItem('usuario');\r\n}\r\n\r\n// Actualizar la UI con los datos del usuario\r\nasync function actualizarUIUsuario(user) {\r\n    const authContainer = document.getElementById('auth-container');\r\n    const menuAuthContainer = document.getElementById('menu-auth-container');\r\n    const navItemsAuth = document.querySelectorAll('.nav-item-auth');\r\n    const navItemsNoAuth = document.querySelectorAll('.nav-item-no-auth');\r\n    \r\n    if (user) {\r\n        // Usuario logueado - Actualizar contenedor principal\r\n        authContainer.innerHTML = `\r\n            <p class=\"usuario-nombre\">\r\n                <svg class=\"check-icon\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\">\r\n                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\" fill=\"#4CAF50\"/>\r\n                </svg>\r\n                ${user.displayName}\r\n            </p>\r\n        `;\r\n        \r\n        // Actualizar men hamburguesa - ocultar login, mostrar opciones protegidas\r\n        navItemsNoAuth.forEach(item => item.style.display = 'none');\r\n        navItemsAuth.forEach(item => item.style.display = 'block');\r\n        \r\n        // Guardar usuario en localStorage\r\n        guardarUsuario(user);\r\n\r\n        actualizarSubmenusDinamicos(user);\r\n        actualizarVisibilidadMenu(user);\r\n\r\n        //  OPTIMIZADO: Cargar turnos del usuario con delay inteligente\r\n        setTimeout(() => {\r\n            if (typeof cargarTurnosUsuario === 'function') {\r\n                // Solo cargar si no se ha cargado recientemente\r\n                const ahora = Date.now();\r\n                if (ahora - ultimaCargaTurnos > CACHE_DURACION) {\r\n                cargarTurnosUsuario();\r\n                }\r\n            }\r\n        }, 1000);\r\n        \r\n        // Autocompletar formulario si estamos en el paso correspondiente\r\n        if (pasoActual >= 4) {\r\n            autocompletarFormulario(user);\r\n        }\r\n        \r\n    } else {\r\n        // Usuario no logueado - Mostrar botn de login\r\n        authContainer.innerHTML = `\r\n            <button id=\"btn-google\" class=\"google-btn\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                    <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    <path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path>\r\n                    <path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path>\r\n                    <path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                </svg>\r\n                <span></span>\r\n            </button>\r\n        `;\r\n        \r\n        // Actualizar men hamburguesa - mostrar login, ocultar opciones protegidas\r\n        navItemsAuth.forEach(item => item.style.display = 'none');\r\n        navItemsNoAuth.forEach(item => item.style.display = 'block');\r\n        \r\n        // Limpiar datos de usuario\r\n        limpiarUsuario();\r\n    }\r\n    \r\n    // Re-configurar eventos despus de actualizar el DOM\r\n    setTimeout(configurarEventosAuth, 100);\r\n}\r\n\r\nasync function manejarOpcionProtegida(opcion) {\r\n    if (!usuarioActual) {\r\n        mostrarError('Debes iniciar sesin para acceder a esta funcin.');\r\n        return;\r\n    }\r\n    \r\n    switch (opcion) {\r\n        case 'perfil':\r\n            // Aqu ir la lgica para mostrar el perfil del usuario\r\n            console.log('Navegando al perfil de:', usuarioActual.displayName);\r\n            // Puedes implementar una funcin para mostrar un modal o pgina de perfil\r\n            break;\r\n            \r\n        case 'mis-turnos':\r\n            // Aqu ir la lgica para mostrar los turnos del usuario\r\n            console.log('Mostrando turnos de:', usuarioActual.displayName);\r\n            // Puedes implementar una funcin para cargar y mostrar los turnos\r\n            break;\r\n    }\r\n}\r\n\r\nfunction mostrarBotonLogin() {\r\n    const contenedor = document.querySelector('nav h1').parentElement;\r\n    if (!contenedor.querySelector('#btn-google')) {\r\n    contenedor.innerHTML += '<button id=\"btn-google\">Acceder</button>';\r\n    }\r\n}\r\n\r\nfunction autocompletarFormulario(user) {\r\n    const nombreInput = document.getElementById('nombre');\r\n    const emailInput = document.getElementById('email');\r\n    \r\n    if (nombreInput && !nombreInput.value && user.displayName) {\r\n        nombreInput.value = user.displayName;\r\n        validarNombre(); // Disparar validacin\r\n    }\r\n    \r\n    if (emailInput && !emailInput.value && user.email) {\r\n        emailInput.value = user.email;\r\n        validarEmail(); // Disparar validacin\r\n        datosReserva.email = user.email;\r\n    }\r\n    \r\n    // Guardar en localStorage para futuras visitas\r\n    if (user) {\r\n        localStorage.setItem('usuario', JSON.stringify({\r\n            uid: user.uid,\r\n            nombre: user.displayName,\r\n            email: user.email,\r\n            telefono: user.phoneNumber || ''\r\n        }));\r\n    }\r\n}\r\n\r\n// Cargar datos guardados al iniciar\r\nfunction cargarDatosGuardados() {\r\n    const usuarioGuardado = localStorage.getItem('usuario');\r\n    if (usuarioGuardado) {\r\n        const user = JSON.parse(usuarioGuardado);\r\n        document.getElementById('nombre').value = user.nombre || '';\r\n        document.getElementById('email').value = user.email || '';\r\n        document.getElementById('telefono').value = user.telefono || '';\r\n    }\r\n}\r\n\r\n// Funcin para verificar si el usuario es administrador\r\nfunction esUsuarioAdministrador(user) {\r\n    // Usamos el mismo UID que est definido en admin.js\r\n    const ADMIN_UID = 'YI2RkSy5j9W2xPVnPqNnghuif9f1';\r\n    return user && user.uid === ADMIN_UID;\r\n}\r\n\r\nfunction actualizarBotonAdmin(user) {\r\n    const botonesAdmin = document.querySelectorAll('.btn-admin');\r\n    \r\n    botonesAdmin.forEach(btn => {\r\n        if (esUsuarioAdministrador(user)) {\r\n            btn.style.display = 'block';\r\n        } else {\r\n            btn.style.display = 'none';\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para mostrar mensajes de xito\r\nfunction mostrarMensajeExito(mensaje) {\r\n    // Crear elemento de mensaje si no existe\r\n    let mensajeExito = document.getElementById('mensaje-exito');\r\n    if (!mensajeExito) {\r\n        mensajeExito = document.createElement('div');\r\n        mensajeExito.id = 'mensaje-exito';\r\n        mensajeExito.className = 'mensaje-exito';\r\n        document.body.appendChild(mensajeExito);\r\n    }\r\n    \r\n    mensajeExito.innerHTML = `\r\n        <div class=\"mensaje-contenido\">\r\n            <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n                <path fill=\"#4CAF50\" d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n            <span>${mensaje}</span>\r\n        </div>\r\n    `;\r\n    \r\n    mensajeExito.classList.add('visible');\r\n    \r\n    // Ocultar despus de 3 segundos\r\n    setTimeout(() => {\r\n        mensajeExito.classList.remove('visible');\r\n    }, 3000);\r\n}\r\n\r\n// Funciones auxiliares del men de autenticacin\r\nfunction actualizarSubmenusDinamicos(user) {\r\n    if (user) {\r\n        // Actualizar submen de perfil\r\n        const nombreUsuario = document.getElementById('usuario-nombre');\r\n        const emailUsuario = document.getElementById('usuario-email');\r\n        \r\n        if (nombreUsuario) nombreUsuario.textContent = user.displayName || 'Usuario';\r\n        if (emailUsuario) emailUsuario.textContent = user.email || 'Email no disponible';\r\n        \r\n        // Aqu puedes agregar ms actualizaciones dinmicas para otros submens\r\n    }\r\n}\r\n\r\n// Funcin para manejar el estado de autenticacin en el men\r\nfunction actualizarVisibilidadMenu(user) {\r\n    const elementosAuth = document.querySelectorAll('.nav-item-auth');\r\n    const elementosNoAuth = document.querySelectorAll('.nav-item-no-auth');\r\n    \r\n    if (user) {\r\n        elementosAuth.forEach(item => item.style.display = 'block');\r\n        elementosNoAuth.forEach(item => item.style.display = 'none');\r\n    } else {\r\n        elementosAuth.forEach(item => item.style.display = 'none');\r\n        elementosNoAuth.forEach(item => item.style.display = 'block');\r\n    }\r\n    \r\n    // Re-inicializar el acorden para los nuevos elementos\r\n    setTimeout(() => {\r\n        inicializarAcordeonMenu();\r\n    }, 100);\r\n}\r\n\r\n//  NUEVA FUNCIN: Autenticacin annima para reservas\r\nasync function iniciarAutenticacionAnonima() {\r\n    try {\r\n        console.log(' Iniciando autenticacin annima...');\r\n        \r\n        // Usar autenticacin annima de Firebase\r\n        const userCredential = await firebase.auth().signInAnonymously();\r\n        usuarioActual = userCredential.user;\r\n        \r\n        console.log(' Usuario annimo autenticado:', usuarioActual.uid);\r\n        return usuarioActual;\r\n        \r\n    } catch (error) {\r\n        console.error(' Error en autenticacin annima:', error);\r\n        throw new Error('No se pudo completar la autenticacin para la reserva');\r\n    }\r\n}","// Variables para control de actualizacin\r\nlet intervaloActualizacionTurnos = null;\r\nlet ultimaCargaTurnos = 0;\r\nconst CACHE_DURACION = 300000; // 5 minutos de cach\r\n\r\n// Funciones de UI/helpers que no afectan la lgica principal\r\nfunction mostrarError(mensaje) {\r\n    document.querySelectorAll('.modal-error, .modal-overlay').forEach(el => el.remove());\r\n    \r\n    const overlay = document.createElement('div');\r\n    overlay.className = 'modal-overlay';\r\n    \r\n    const modal = document.createElement('div');\r\n    modal.className = 'modal-error';\r\n    \r\n    let mensajePersonalizado = mensaje;\r\n    \r\n    // Detectar conflictos de horario\r\n    if (mensaje.includes('minutos') || mensaje.includes('horario')) {\r\n        const duracionTotal = calcularDuracionTotal();\r\n        const horas = Math.floor(duracionTotal / 60);\r\n        const minutos = duracionTotal % 60;\r\n        \r\n        const textoDuracion = horas > 0 \r\n            ? `${horas} hora${horas > 1 ? 's' : ''}${minutos > 0 ? ` y ${minutos} minutos` : ''}`\r\n            : `${minutos} minutos`;\r\n        \r\n        mensajePersonalizado = `\r\n            <svg viewBox=\"0 0 24 24\" width=\"48\" height=\"48\" style=\"margin-bottom: 1rem;\">\r\n                <path fill=\"#ff6b6b\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n            </svg>\r\n            <h3>Cruce de horarios!</h3>\r\n            <p>\r\n                Tu turno necesita <strong>${textoDuracion}</strong> como mnimo.\r\n                <br><br>\r\n                Por favor, eleg otro horario donde entren todos tus servicios.\r\n            </p>\r\n        `;\r\n    }\r\n    \r\n    modal.innerHTML = `\r\n        ${mensajePersonalizado}\r\n        <button id=\"cerrar-modal\">Entendido!</button>\r\n    `;\r\n    \r\n    // Agregar al DOM\r\n    document.body.appendChild(overlay);\r\n    document.body.appendChild(modal);\r\n    \r\n    // Cerrar al hacer clic\r\n    const cerrarModal = () => {\r\n        modal.style.animation = 'fadeIn 0.3s reverse';\r\n        overlay.style.animation = 'fadeIn 0.3s reverse';\r\n        setTimeout(() => {\r\n            modal.remove();\r\n            overlay.remove();\r\n        }, 300);\r\n    };\r\n    \r\n    modal.querySelector('#cerrar-modal').addEventListener('click', cerrarModal);\r\n    overlay.addEventListener('click', cerrarModal);\r\n}\r\n\r\n// Sistema simple de manejo de errores\r\nconst ErrorHandler = {\r\n    mostrar: (mensaje, tipo = 'error') => {\r\n        console.log(`[${tipo.toUpperCase()}] ${mensaje}`);\r\n        \r\n        // Usar tu funcin existente de mostrarError para errores\r\n        if (tipo === 'error' && typeof mostrarError === 'function') {\r\n            mostrarError(mensaje);\r\n        }\r\n        // Para advertencias, solo log en consola\r\n        else if (tipo === 'warning') {\r\n            console.warn(mensaje);\r\n        }\r\n    },\r\n\r\n    manejarErrorFirestore: (error, contexto) => {\r\n    console.error(`Error en ${contexto}:`, error);\r\n    \r\n    const mensajesPersonalizados = {\r\n      'permission-denied': 'No tienes permisos para acceder a estos datos',\r\n      'not-found': 'No se encontr la informacin solicitada',\r\n      'unavailable': 'Error de conexin. Verifica tu internet',\r\n      'failed-precondition': 'El servicio no est disponible en este momento'\r\n    };\r\n    \r\n    const mensaje = mensajesPersonalizados[error.code] || \r\n                   `Error al ${contexto}. Intenta nuevamente.`;\r\n    \r\n    ErrorHandler.mostrar(mensaje, 'error');\r\n    return []; // Retornar array vaco como fallback\r\n  }\r\n};\r\n\r\n// Validaciones bsicas para datos de Firestore\r\nconst Validador = {\r\n    servicio: (servicio) => {\r\n        if (!servicio || typeof servicio !== 'object') return false;\r\n        \r\n        const required = ['id', 'nombre', 'categoriaId'];\r\n        return required.every(prop => servicio.hasOwnProperty(prop) && servicio[prop] != null);\r\n    },\r\n\r\n    especialista: (especialista) => {\r\n        if (!especialista || typeof especialista !== 'object') return false;\r\n\r\n        const required = ['id', 'nombre'];\r\n        return required.every(prop => especialista.hasOwnProperty(prop) && especialista[prop] != null);\r\n    },\r\n\r\n    categoria: (categoria) => {\r\n        if (!categoria || typeof categoria !== 'object') return false;\r\n        return categoria.hasOwnProperty('id') && categoria.hasOwnProperty('nombre');\r\n    },\r\n\r\n    filtrarInvalidos: (datos, tipo) => {\r\n        if (!Array.isArray(datos)) return [];\r\n        return datos.filter(item => Validador[tipo](item));\r\n    }\r\n};\r\n\r\nfunction inicializarAcordeonMenu() {\r\n    const btnMenu = document.querySelector('.btn-menu');\r\n    const menuLateral = document.querySelector('.menu-lateral');\r\n    \r\n    if (btnMenu && menuLateral) {\r\n        btnMenu.addEventListener('click', function() {\r\n            menuLateral.classList.toggle('abierto');\r\n        });\r\n    }\r\n}\r\n\r\nfunction inicializarCierreMenuOverlay() {\r\n    // Cerrar men al hacer clic fuera\r\n    document.addEventListener('click', function(e) {\r\n        const menuLateral = document.querySelector('.menu-lateral');\r\n        const btnMenu = document.querySelector('.btn-menu');\r\n        \r\n        if (menuLateral && menuLateral.classList.contains('abierto')) {\r\n            // Si el clic fue fuera del men y fuera del botn\r\n            if (!menuLateral.contains(e.target) && !btnMenu.contains(e.target)) {\r\n                menuLateral.classList.remove('abierto');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction inicializarAcordeonesServicios() {\r\n    const headers = document.querySelectorAll('.categoria-header');\r\n\r\n    headers.forEach(header => {\r\n    header.addEventListener('click', function() {\r\n        const categoriaId = this.dataset.categoriaId;\r\n        const container = this.nextElementSibling;\r\n        const icono = this.querySelector('.acordeon-icon');\r\n        \r\n    // Cerrar todos los dems acordeones\r\n    document.querySelectorAll('.servicios-container').forEach(c => {\r\n        if (c !== container) {\r\n            c.style.display = 'none';\r\n            const otherIcon = c.previousElementSibling.querySelector('.acordeon-icon');\r\n            if (otherIcon) otherIcon.classList.remove('girado');\r\n        }\r\n    });\r\n        \r\n    // Alternar el actual\r\n    const estaAbierto = container.style.display === 'block';\r\n    container.style.display = estaAbierto ? 'none' : 'block';\r\n    \r\n    // Rotar icono\r\n    if (icono) {\r\n        icono.classList.toggle('girado', !estaAbierto);\r\n    }\r\n    });\r\n    });\r\n}\r\n\r\nfunction inicializarAcordeonesEspecialistas() {\r\n    const botonesVer = document.querySelectorAll('.btn-ver-especialistas');\r\n    \r\n    botonesVer.forEach(boton => {\r\n        boton.addEventListener('click', function(e) {\r\n            e.stopPropagation();\r\n            const categoriaSection = this.closest('.categoria-especialistas');\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const icono = this.querySelector('.acordeon-icon');\r\n            \r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherBtn = l.closest('.categoria-especialistas').querySelector('.btn-ver-especialistas');\r\n                    const otherIcon = otherBtn.querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            \r\n            // Rotar icono\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction toggleLoader(mostrar) {\r\n    const btnSiguiente = document.querySelector('.btn-siguiente');\r\n    const loader = document.getElementById('reserva-loader');\r\n    \r\n    if (mostrar) {\r\n        btnSiguiente.style.display = 'none';\r\n        loader.style.display = 'inline-block';\r\n    } else {\r\n        loader.style.display = 'none';\r\n        btnSiguiente.style.display = 'flex';\r\n    }\r\n}\r\n\r\n// ===== CDIGO ORIGINAL DEL MEN - FUNCIONA PERFECTO =====\r\n(function($) { \"use strict\";\r\n    \r\n    var app = function () {\r\n        var body = undefined;\r\n        var menu = undefined;\r\n        var menuItems = undefined;\r\n        var init = function init() {\r\n            body = document.querySelector('body');\r\n            menu = document.querySelector('.menu-icon');\r\n            if (!menu) {\r\n                console.log('Elementos del men no encontrados (probablemente en admin.html)');\r\n                return; // Salir si no estamos en una pgina con men\r\n            }\r\n            menuItems = document.querySelectorAll('.nav__list-item');\r\n            applyListeners();\r\n        };\r\n        var applyListeners = function applyListeners() {\r\n            if (!menu) return;\r\n            menu.addEventListener('click', function () {\r\n                return toggleClass(body, 'nav-active');\r\n            });\r\n        };\r\n        var toggleClass = function toggleClass(element, stringClass) {\r\n            if (element.classList.contains(stringClass)) element.classList.remove(stringClass);\r\n            else element.classList.add(stringClass);\r\n        };\r\n        init();\r\n    }();\r\n    \r\n})(jQuery);\r\n\r\n// Funcin para inicializar el acorden del men\r\n\r\nfunction inicializarAcordeonMenu() {\r\n    const menuItems = document.querySelectorAll('.nav__list-item .menu');\r\n\r\n    menuItems.forEach(menuItem => {\r\n        menuItem.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            const listItem = this.closest('.nav__list-item');\r\n            const submenu = listItem.querySelector('.submenu');\r\n            const isActive = submenu.classList.contains('active');\r\n\r\n            cerrarTodosLosSubmenus();\r\n            quitarClaseActiveNav();\r\n\r\n            if (!isActive) {\r\n                submenu.classList.add('active');\r\n                this.classList.add('active');\r\n                listItem.classList.add('active-nav');\r\n            }\r\n        });\r\n    });\r\n\r\n    // Cerrar mens solo al hacer clic FUERA del nav completo\r\n    document.addEventListener('click', function(e) {\r\n        if (!e.target.closest('.nav')) {\r\n            cerrarTodosLosSubmenus();\r\n            quitarClaseActiveNav();\r\n        }\r\n    });\r\n\r\n    // Manejar TODOS los elementos del submenu\r\n    document.querySelectorAll('.submenu *').forEach(element => {\r\n        element.addEventListener('click', function(e) {\r\n            e.stopPropagation(); // Prevenir que el clic cierre el men\r\n        });\r\n    });\r\n}\r\n\r\nfunction inicializarCierreMenuOverlay() {\r\n    document.addEventListener('click', function(e) {\r\n        const body = document.body;\r\n        if (!body.classList.contains('nav-active')) return;\r\n        \r\n        const nav = document.querySelector('.nav');\r\n        const menuIcon = document.querySelector('.menu-icon');\r\n        \r\n        // Solo cerrar si el clic fue en el overlay (fondo)\r\n        // No cerrar si fue en cualquier elemento dentro del nav\r\n        if (!nav.contains(e.target) && !menuIcon.contains(e.target)) {\r\n            // Pequeo delay para permitir que los eventos de los botones se ejecuten\r\n            setTimeout(() => {\r\n                body.classList.remove('nav-active');\r\n            }, 10);\r\n        }\r\n    });\r\n    \r\n    // NO prevenir la propagacin para elementos interactivos\r\n    // Esto permite que los botones dentro del men funcionen normalmente\r\n    const navElement = document.querySelector('.nav');\r\n    if (navElement) {\r\n        navElement.addEventListener('click', function(e) {\r\n            // Solo prevenir propagacin para elementos no interactivos\r\n            if (!e.target.closest('button') && \r\n                !e.target.closest('a') && \r\n                !e.target.closest('input')) {\r\n                e.stopPropagation();\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Cerrar con tecla ESC\r\n    document.addEventListener('keydown', function(e) {\r\n        if (e.key === 'Escape' && document.body.classList.contains('nav-active')) {\r\n            document.body.classList.remove('nav-active');\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para quitar la clase active-nav de todos los items\r\nfunction quitarClaseActiveNav() {\r\n    document.querySelectorAll('.nav__list-item').forEach(item => {\r\n        item.classList.remove('active-nav');\r\n    });\r\n}\r\n\r\n// Funcin para cerrar todos los submens\r\nfunction cerrarTodosLosSubmenus() {\r\n    document.querySelectorAll('.submenu').forEach(submenu => {\r\n        submenu.classList.remove('active');\r\n    });\r\n    \r\n    document.querySelectorAll('.menu').forEach(menu => {\r\n        menu.classList.remove('active');\r\n    });\r\n}\r\n\r\n// ===== SISTEMA DE CONTACTO DEL MEN - VERSIN ULTRA-MINIMALISTA =====\r\nconsole.log(' uiManager.js cargado - Sistema de contacto del men inicializado');\r\n\r\n// Funcin para obtener datos de contacto SIN event listeners\r\nfunction obtenerDatosContactoSeguro() {\r\n    // Intentar desde window.datosGenerales primero\r\n    if (window.datosGenerales && window.datosGenerales.empresa) {\r\n        return window.datosGenerales.empresa;\r\n    }\r\n    \r\n    // Intentar desde la variable global de app.js\r\n    if (typeof datosGenerales !== 'undefined' && datosGenerales.empresa) {\r\n        return datosGenerales.empresa;\r\n    }\r\n    \r\n    // ltimo intento: buscar en localStorage si ya los cargamos antes\r\n    const contactoCache = localStorage.getItem('contactoCache');\r\n    if (contactoCache) {\r\n        try {\r\n            return JSON.parse(contactoCache);\r\n        } catch (e) {\r\n            console.warn('Cache de contacto corrupto');\r\n        }\r\n    }\r\n    \r\n    return null;\r\n}\r\n\r\n// Optimizar actualizarMenuContacto para usar cache\r\nfunction actualizarMenuContacto(empresa) {\r\n    if (!empresa) return false;\r\n    \r\n    try {\r\n        // Guardar en cache para prximas cargas\r\n        localStorage.setItem('contactoCache', JSON.stringify(empresa));\r\n        \r\n        // Actualizar direccin\r\n        const direccionElement = document.getElementById('menu-direccion');\r\n        if (direccionElement && empresa.direccion) {\r\n            direccionElement.textContent = empresa.direccion;\r\n        }\r\n        \r\n        // Actualizar telfono\r\n        const telefonoElement = document.getElementById('menu-telefono');\r\n        if (telefonoElement && empresa.telefono) {\r\n            telefonoElement.textContent = empresa.telefono;\r\n        }\r\n        \r\n        // Actualizar email\r\n        const emailElement = document.getElementById('menu-email');\r\n        if (emailElement && empresa.email) {\r\n            emailElement.textContent = empresa.email;\r\n        }\r\n        \r\n        // Actualizar redes sociales (si existen los elementos)\r\n        const redes = empresa.redesSociales || empresa.redes;\r\n        if (redes) {\r\n            const instagramLink = document.getElementById('menu-instagram');\r\n            const equisLink = document.getElementById('menu-equis');\r\n            const whatsappLink = document.getElementById('menu-whatsapp');\r\n            \r\n            if (instagramLink && redes.instagram && redes.instagram !== '#') {\r\n                instagramLink.href = redes.instagram;\r\n                instagramLink.style.display = 'flex';\r\n            }\r\n            \r\n            if (equisLink && redes.equis && redes.equis !== '#') {\r\n                equisLink.href = redes.equis;\r\n                equisLink.style.display = 'flex';\r\n            }\r\n            \r\n            if (whatsappLink && redes.whatsapp && redes.whatsapp !== '#') {\r\n                whatsappLink.href = redes.whatsapp;\r\n                whatsappLink.style.display = 'flex';\r\n            }\r\n        }\r\n        \r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(' Error actualizando men contacto:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// SOLUCIN DEFINITIVA: Solo cargar datos peridicamente SIN NINGN EVENT LISTENER\r\nfunction inicializarMenuContactoDefinitivo() {\r\n    console.log(' Inicializando men contacto (UNA SOLA CARGA)...');\r\n    \r\n    // Cargar UNA sola vez con un delay generoso\r\n    setTimeout(() => {\r\n        const empresa = obtenerDatosContactoSeguro();\r\n        const exito = actualizarMenuContacto(empresa);\r\n        \r\n        if (exito) {\r\n            console.log(' Men contacto cargado exitosamente (carga nica)');\r\n        } else {\r\n            // Si falla, intentar una vez ms despus de 5 segundos\r\n            setTimeout(() => {\r\n                const empresa = obtenerDatosContactoSeguro();\r\n                actualizarMenuContacto(empresa);\r\n            }, 5000);\r\n        }\r\n    }, 3000);\r\n    \r\n    //  ELIMINADO: No ms setInterval para el contacto\r\n    // Los datos de contacto son estticos, no necesitan actualizacin constante\r\n}\r\n\r\n//////////////////////////\r\n//////////////////////////\r\n//////////////////////////\r\n\r\n// Funcin para formatear la fecha en espaol\r\nfunction formatearFecha(fechaStr) {\r\n  const fecha = new Date(fechaStr + 'T00:00:00');\r\n  const dias = ['Dom', 'Lun', 'Mar', 'Mi', 'Jue', 'Vie', 'Sb'];\r\n  const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];\r\n  \r\n  const diaSemana = dias[fecha.getDay()];\r\n  const diaMes = fecha.getDate();\r\n  const mes = meses[fecha.getMonth()];\r\n  \r\n  return `${diaSemana} ${diaMes} ${mes}`;\r\n}\r\n\r\n// Funcin para calcular horario de fin\r\nfunction calcularHorarioFin(horarioInicio, duracionMinutos) {\r\n  const [horas, minutos] = horarioInicio.split(':').map(Number);\r\n  const totalMinutos = horas * 60 + minutos + duracionMinutos;\r\n  \r\n  const horasFin = Math.floor(totalMinutos / 60);\r\n  const minutosFin = totalMinutos % 60;\r\n  \r\n  return `${horasFin.toString().padStart(2, '0')}:${minutosFin.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Funcin para cargar y mostrar los turnos del usuario\r\nasync function cargarTurnosUsuario() {\r\n  const usuario = firebase.auth().currentUser;\r\n  if (!usuario) return;\r\n\r\n  const submenuUl = document.querySelector('#nav-mis-turnos .submenu ul');\r\n  if (!submenuUl) return;\r\n\r\n  try {\r\n    // Actualizar timestamp de ltima carga\r\n    ultimaCargaTurnos = Date.now();\r\n\r\n    // Mostrar loading solo si no hay datos previos\r\n    if (!submenuUl.querySelector('.turno-item')) {\r\n      submenuUl.innerHTML = '<li><p>Cargando turnos...</p></li>';\r\n    }\r\n\r\n    const turnos = await window.firestoreDB.obtenerTurnosPorUsuario(usuario.uid);\r\n    \r\n    if (turnos.length === 0) {\r\n      submenuUl.innerHTML = '<li><p>No tens turnos reservados</p></li>';\r\n      return;\r\n    }\r\n\r\n    // Generar HTML de los turnos\r\n    const turnosHTML = turnos.map(turno => {\r\n      const fechaFormateada = formatearFecha(turno.fecha);\r\n      const horarioFin = calcularHorarioFin(turno.horarioInicio, turno.duracionTotal || 30);\r\n      const montoFormateado = turno.montoTotal ? `$${turno.montoTotal.toLocaleString('es-AR')}` : 'Sin sear';\r\n      \r\n      return `\r\n        <li class=\"turno-item\">\r\n          <p><strong>${fechaFormateada}</strong> de ${turno.horarioInicio} a ${horarioFin}</p>\r\n          <p style=\"margin-top: 4px; color: #4CAF50; font-weight: 500;\">${montoFormateado}</p>\r\n        </li>\r\n      `;\r\n    }).join('');\r\n\r\n    submenuUl.innerHTML = turnosHTML;\r\n\r\n  } catch (error) {\r\n    console.error('Error cargando turnos:', error);\r\n    // Solo mostrar error si no hay datos previos\r\n    if (!submenuUl.querySelector('.turno-item')) {\r\n      submenuUl.innerHTML = '<li><p>Error al cargar turnos</p></li>';\r\n    }\r\n  }\r\n}\r\n\r\n// Funcin para inicializar el sistema de turnos del usuario\r\nfunction inicializarSistemaTurnosUsuario() {\r\n  console.log(' Inicializando sistema de turnos usuario (optimizado)...');\r\n  \r\n  // Cargar turnos cuando el usuario inicie sesin\r\n  firebase.auth().onAuthStateChanged((user) => {\r\n    if (user) {\r\n      // Cargar turnos inicialmente\r\n      setTimeout(() => {\r\n        cargarTurnosUsuario();\r\n      }, 1000);\r\n      \r\n      // Configurar observador para el men\r\n      configurarObservadorMenu();\r\n    } else {\r\n      // Limpiar intervalo si existe\r\n      detenerActualizacionAutomatica();\r\n    }\r\n  });\r\n}\r\n\r\nfunction configurarObservadorMenu() {\r\n  // Observar cambios en la clase del body para detectar cuando se abre/cierra el men\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      if (mutation.attributeName === 'class') {\r\n        const body = document.body;\r\n        if (body.classList.contains('nav-active')) {\r\n          // Men abierto - cargar solo si los datos son antiguos\r\n          const ahora = Date.now();\r\n          if (ahora - ultimaCargaTurnos > CACHE_DURACION) {\r\n            cargarTurnosUsuario();\r\n          }\r\n          \r\n          // Iniciar actualizaciones lentas (solo cuando el men est abierto)\r\n          iniciarActualizacionAutomatica();\r\n        } else {\r\n          // Men cerrado - detener actualizaciones\r\n          detenerActualizacionAutomatica();\r\n        }\r\n      }\r\n    });\r\n  });\r\n  \r\n  observer.observe(document.body, { attributes: true });\r\n}\r\n\r\nfunction iniciarActualizacionAutomatica() {\r\n  // Si ya hay un intervalo activo, no crear otro\r\n  if (intervaloActualizacionTurnos) return;\r\n  \r\n  console.log(' Men abierto - iniciando actualizaciones lentas');\r\n  \r\n  // Actualizar cada 5 minutos (en lugar de 30 segundos)\r\n  intervaloActualizacionTurnos = setInterval(() => {\r\n    cargarTurnosUsuario();\r\n  }, 300000); // 5 minutos\r\n}\r\n\r\nfunction detenerActualizacionAutomatica() {\r\n  if (intervaloActualizacionTurnos) {\r\n    console.log(' Men cerrado - deteniendo actualizaciones automticas');\r\n    clearInterval(intervaloActualizacionTurnos);\r\n    intervaloActualizacionTurnos = null;\r\n  }\r\n}\r\n\r\n// Funcin para forzar recarga manual (til para despus de nuevas reservas)\r\nfunction forzarActualizacionTurnos() {\r\n  ultimaCargaTurnos = 0; // Invalidar cach\r\n  cargarTurnosUsuario();\r\n}\r\n\r\n// Inicializar SIN event listeners de ningn tipo\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    console.log(' DOM cargado - Iniciando solucin definitiva');\r\n    inicializarMenuContactoDefinitivo();\r\n    console.log(' Sistema de turnos usuario inicializado');\r\n    inicializarSistemaTurnosUsuario();\r\n});","// =============================================\r\n// 0. VERIFICACIN DE PGINA - NO EJECUTAR EN INDEX.HTML\r\n// =============================================\r\n\r\n// Verificar si estamos en la pgina correcta antes de ejecutar cualquier cosa\r\nconst esAdminPage = window.location.pathname.includes('admin.html');\r\n\r\nif (!esAdminPage) {\r\n    console.log(' admin.js: No estamos en admin.html - modo silencioso activado');\r\n    \r\n    // Sobrescribir todas las funciones principales con versiones vacas\r\n    const funcionesVacias = {\r\n        initAdmin: function() {},\r\n        inicializarGestionServicios: function() {},\r\n        inicializarGestionPersonal: function() {},\r\n        inicializarNavegacionAdmin: function() {},\r\n        inicializarNavegacionCuandoPanelListo: function() {},\r\n        handleAuthState: function() {},\r\n        signInWithGoogle: function() {},\r\n        signOut: function() {},\r\n        showAdminPanel: function() {},\r\n        showLoginScreen: function() {},\r\n        // Agregar cualquier otra funcin global que pueda ser llamada\r\n    };\r\n    \r\n    // Aplicar funciones vacas al objeto window\r\n    Object.keys(funcionesVacias).forEach(funcName => {\r\n        window[funcName] = funcionesVacias[funcName];\r\n    });\r\n    \r\n    // NO ejecutar el resto del cdigo\r\n    \r\n} else {\r\n    console.log(' admin.js: Inicializando en admin.html');\r\n    \r\n    // =============================================\r\n    // 1. CONSTANTES Y VARIABLES GLOBALES (solo para admin.html)\r\n    // =============================================\r\n    const ADMIN_UID = 'YI2RkSy5j9W2xPVnPqNnghuif9f1';\r\n    \r\n    // Funcin para obtener elementos de forma segura\r\n    function obtenerElementosAdmin() {\r\n        return {\r\n            authContainer: document.getElementById('auth-container'),\r\n            adminPanel: document.getElementById('admin-panel'),\r\n            loginBtn: document.getElementById('btn-admin-login'),\r\n            logoutBtn: document.getElementById('logout-btn'),\r\n            calendar: document.getElementById('calendar'),\r\n            turnosList: document.getElementById('turnos-list'),\r\n            fechaTitulo: document.getElementById('fecha-titulo'),\r\n            modalEditar: document.getElementById('modal-editar'),\r\n            formEditar: document.getElementById('form-editar'),\r\n            btnEliminarModal: document.getElementById('btn-eliminar-modal'),\r\n            closeModal: document.querySelector('.close-modal')\r\n        };\r\n    }\r\n    \r\n    const elements = obtenerElementosAdmin();\r\n    let calendar;\r\n    let currentTurnoId = null;\r\n    let especialistasMap = {};\r\n    let especialistasCargando = false;\r\n    let pendientesDeActualizacion = [];\r\n    let serviciosMap = {};\r\n    // let categoriasMap = {};\r\n    // let personalMap = {};\r\n\r\n    // =============================================\r\n    // 2. FUNCIONES DE INICIALIZACIN PRINCIPAL\r\n    // =============================================\r\n    async function initAdmin() {\r\n        if (!(await verificarFirestore())) return;\r\n        \r\n        if (!elements.authContainer) {\r\n            console.log(' Elementos de admin no encontrados, reintentando...');\r\n            // Reintentar obtener elementos\r\n            Object.assign(elements, obtenerElementosAdmin());\r\n            if (!elements.authContainer) return;\r\n        }\r\n\r\n        firebase.auth().onAuthStateChanged(handleAuthState);\r\n        \r\n        if (elements.loginBtn) {\r\n            elements.loginBtn.addEventListener('click', signInWithGoogle);\r\n        }\r\n        \r\n        if (elements.logoutBtn) {\r\n            elements.logoutBtn.addEventListener('click', signOut);\r\n        }\r\n\r\n        // Eventos del modal de turnos\r\n        if (elements.closeModal) {\r\n            elements.closeModal.addEventListener('click', () => {\r\n                elements.modalEditar.style.display = 'none';\r\n            });\r\n        }\r\n\r\n        if (elements.formEditar) {\r\n            elements.formEditar.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                await guardarCambiosTurno();\r\n            });\r\n        }\r\n\r\n        // Cerrar modal al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === elements.modalEditar) {\r\n                elements.modalEditar.style.display = 'none';\r\n            }\r\n            if (e.target === document.getElementById('modal-servicio')) {\r\n                document.getElementById('modal-servicio').style.display = 'none';\r\n            }\r\n        });\r\n\r\n        // Configurar eventos del modal de turnos\r\n        setupModalEvents();\r\n\r\n        // Inicializar gestin de servicios\r\n        inicializarGestionServicios();\r\n\r\n        // Inicializar gestin de personal\r\n        inicializarGestionPersonal();\r\n\r\n        // Usar la navegacin corregida\r\n        inicializarNavegacionAdmin();\r\n\r\n        // Asegurar que los eventos se reconfiguren despus de renderizar\r\n        setTimeout(() => {\r\n            setupModalEvents();\r\n        }, 1000);\r\n        \r\n        console.log(' admin.js inicializado completamente');\r\n    }\r\n\r\n    async function verificarFirestore() {\r\n        try {\r\n            const config = await obtenerConfiguracion();\r\n            \r\n            // Cargar especialistas y servicios - esperar a que termine\r\n            await cargarEspecialistas();\r\n            await cargarServicios();\r\n            \r\n            console.log(\" Firestore verificado y datos cargados\");\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error conectando con Firestore:\", error);\r\n            alert(\"Error al conectar con la base de datos. Recargando...\");\r\n            setTimeout(() => location.reload(), 3000);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // 3. FUNCIONES DE AUTENTICACIN\r\n    // =============================================\r\n    async function handleAuthState(user) {\r\n        console.log('Estado de autenticacin cambiado:', user ? user.uid : 'No user');\r\n        \r\n        if (user && user.uid === ADMIN_UID) {\r\n            console.log('Usuario es admin, mostrando panel...');\r\n            await showAdminPanel();\r\n            await initCalendar();\r\n        } else {\r\n            console.log('Usuario no es admin, mostrando login...');\r\n            showLoginScreen();\r\n        }\r\n    }\r\n\r\n    async function signInWithGoogle() {\r\n        try {\r\n            const provider = new firebase.auth.GoogleAuthProvider();\r\n            await firebase.auth().signInWithPopup(provider);\r\n        } catch (error) {\r\n            console.error(\"Error de autenticacin:\", error);\r\n            alert(\"Error al iniciar sesin: \" + error.message);\r\n        }\r\n    }\r\n\r\n    async function signOut() {\r\n        try {\r\n            await firebase.auth().signOut();\r\n        } catch (error) {\r\n            console.error(\"Error al cerrar sesin:\", error);\r\n        }\r\n    }\r\n\r\n    async function showAdminPanel() {\r\n        console.log('Ejecutando showAdminPanel');\r\n        \r\n        if (elements.authContainer) {\r\n            elements.authContainer.style.display = 'none';\r\n            console.log('Auth container oculto');\r\n        }\r\n        \r\n        if (elements.adminPanel) {\r\n            elements.adminPanel.style.display = 'block';\r\n            console.log('Admin panel mostrado');\r\n        } else {\r\n            console.error('elements.adminPanel es null o undefined');\r\n        }\r\n    }\r\n\r\n    function showLoginScreen() {\r\n        if (elements.authContainer) elements.authContainer.style.display = 'flex';\r\n        if (elements.adminPanel) elements.adminPanel.style.display = 'none';\r\n        if (calendar) calendar.destroy();\r\n    }\r\n\r\n    // =============================================\r\n    // 4. FUNCIONES DE NAVEGACIN Y UI\r\n    // =============================================\r\n    function inicializarNavegacionAdmin() {\r\n        console.log(' Inicializando navegacin del panel admin...');\r\n        \r\n        // Elementos de navegacin\r\n        const navEnlaces = document.querySelectorAll('.nav-enlace');\r\n        const overlay = document.querySelector('.nav-enlace-overlay');\r\n        \r\n        // Secciones del panel\r\n        const seccionCalendario = document.querySelector('.container-cal-tur');\r\n        const seccionServicios = document.querySelector('.admin-container_servicios');\r\n        const seccionPersonal = document.querySelector('.admin-container_personal');\r\n        \r\n        // Verificar que todos los elementos existan\r\n        if (!navEnlaces.length || !seccionCalendario || !seccionServicios || !seccionPersonal) {\r\n            console.error(' No se encontraron todos los elementos de navegacin');\r\n            return;\r\n        }\r\n        \r\n        console.log(' Elementos de navegacin encontrados:', {\r\n            enlaces: navEnlaces.length,\r\n            calendario: !!seccionCalendario,\r\n            servicios: !!seccionServicios,\r\n            personal: !!seccionPersonal\r\n        });\r\n\r\n        // Funcin para ocultar todas las secciones\r\n        function ocultarTodasLasSecciones() {\r\n            seccionCalendario.style.display = 'none';\r\n            seccionServicios.style.display = 'none';\r\n            seccionPersonal.style.display = 'none';\r\n        }\r\n\r\n        // Funcin para mostrar una seccin especfica\r\n        function mostrarSeccion(seccion) {\r\n            ocultarTodasLasSecciones();\r\n            seccion.style.display = 'flex';\r\n        }\r\n\r\n        // Funcin para actualizar el overlay de navegacin\r\n        function actualizarOverlay(enlaceActivo) {\r\n            const overlay = document.querySelector('.nav-enlace-overlay');\r\n            if (!overlay) return;\r\n            \r\n            const navAdmin = enlaceActivo.closest('.nav-admin');\r\n            const rect = enlaceActivo.getBoundingClientRect();\r\n            const navRect = navAdmin.getBoundingClientRect();\r\n            \r\n            //  CORREGIDO: Mismo clculo considerando padding\r\n            const enlaceStyles = getComputedStyle(enlaceActivo);\r\n            const paddingLeft = parseFloat(enlaceStyles.paddingLeft);\r\n            const paddingRight = parseFloat(enlaceStyles.paddingRight);\r\n            \r\n            const overlayLeft = (rect.left - navRect.left) - paddingLeft;\r\n            const overlayWidth = rect.width + paddingRight;\r\n            \r\n            overlay.style.width = `${overlayWidth}px`;\r\n            overlay.style.left = `${overlayLeft}px`;\r\n        }\r\n\r\n        // Funcin para manejar el cambio de seccin\r\n        function cambiarSeccion(enlace, seccion, textoEnlace) {\r\n            console.log(` Cambiando a seccin: ${textoEnlace}`);\r\n            \r\n            // Remover active de todos los enlaces\r\n            navEnlaces.forEach(e => e.classList.remove('active'));\r\n            \r\n            // Agregar active al enlace clickeado\r\n            enlace.classList.add('active');\r\n            \r\n            // Actualizar overlay\r\n            actualizarOverlay(enlace);\r\n            \r\n            // Mostrar la seccin correspondiente\r\n            mostrarSeccion(seccion);\r\n            \r\n            // Cargar datos especficos de la seccin si es necesario\r\n            if (textoEnlace === 'Servicios') {\r\n                cargarServiciosYMostrar();\r\n            } else if (textoEnlace === 'Personal') {\r\n                cargarPersonalYMostrar();\r\n            }\r\n            \r\n            console.log(` Seccin ${textoEnlace} activada`);\r\n        }\r\n\r\n        // Agregar event listeners a cada enlace\r\n        navEnlaces.forEach(enlace => {\r\n            enlace.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n                \r\n                const textoEnlace = this.querySelector('.nav-enlace-texto').textContent.trim();\r\n                \r\n                switch(textoEnlace) {\r\n                    case 'Calendario':\r\n                        cambiarSeccion(this, seccionCalendario, textoEnlace);\r\n                        break;\r\n                        \r\n                    case 'Servicios':\r\n                        cambiarSeccion(this, seccionServicios, textoEnlace);\r\n                        break;\r\n                        \r\n                    case 'Personal':\r\n                        cambiarSeccion(this, seccionPersonal, textoEnlace);\r\n                        break;\r\n                        \r\n                    default:\r\n                        console.warn(' Seccin no reconocida:', textoEnlace);\r\n                }\r\n            });\r\n        });\r\n\r\n        // Inicializar posicin del overlay\r\n        const enlaceActivoInicial = document.querySelector('.nav-enlace.active');\r\n        if (enlaceActivoInicial && overlay) {\r\n            actualizarOverlay(enlaceActivoInicial);\r\n        }\r\n\r\n        // Asegurar que solo la seccin activa est visible al inicio\r\n        if (enlaceActivoInicial) {\r\n            const textoEnlaceInicial = enlaceActivoInicial.querySelector('.nav-enlace-texto').textContent.trim();\r\n            switch(textoEnlaceInicial) {\r\n                case 'Calendario':\r\n                    mostrarSeccion(seccionCalendario);\r\n                    break;\r\n                case 'Servicios':\r\n                    mostrarSeccion(seccionServicios);\r\n                    cargarServiciosYMostrar();\r\n                    break;\r\n                case 'Personal':\r\n                    mostrarSeccion(seccionPersonal);\r\n                    break;\r\n            }\r\n        } else {\r\n            // Por defecto mostrar calendario\r\n            mostrarSeccion(seccionCalendario);\r\n        }\r\n\r\n        console.log(' Navegacin del panel admin inicializada correctamente');\r\n    }\r\n\r\n    function inicializarNavegacionCuandoPanelListo() {\r\n        const adminPanel = document.getElementById('admin-panel');\r\n        if (adminPanel && adminPanel.style.display !== 'none') {\r\n            inicializarNavegacionAdmin(); //  CORREGIDO: Usa el nombre correcto\r\n        } else {\r\n            setTimeout(inicializarNavegacionCuandoPanelListo, 500);\r\n        }\r\n    }\r\n\r\n    function inicializarTabBar() {\r\n      const navAdmin = document.querySelector('.nav-admin');\r\n      const enlaces = navAdmin.querySelectorAll('.nav-enlace');\r\n      const overlay = navAdmin.querySelector('.nav-enlace-overlay');\r\n      \r\n      // Funcin para activar un enlace\r\n      function activarEnlace(enlace) {\r\n        enlaces.forEach(e => e.classList.remove('active'));\r\n        enlace.classList.add('active');\r\n        \r\n        //  CORREGIDO: Considerar el padding del enlace en el clculo\r\n        const rect = enlace.getBoundingClientRect();\r\n        const navRect = navAdmin.getBoundingClientRect();\r\n        \r\n        // Obtener el padding del enlace\r\n        const enlaceStyles = getComputedStyle(enlace);\r\n        const paddingLeft = parseFloat(enlaceStyles.paddingLeft);\r\n        const paddingRight = parseFloat(enlaceStyles.paddingRight);\r\n        \r\n        // Calcular posicin y tamao CONSIDERANDO el padding\r\n        const overlayLeft = (rect.left - navRect.left) - paddingLeft;\r\n        const overlayWidth = rect.width + paddingRight;\r\n        \r\n        overlay.style.width = `${overlayWidth}px`;\r\n        overlay.style.left = `${overlayLeft}px`;\r\n      }\r\n      \r\n      // Agregar event listeners\r\n      enlaces.forEach(enlace => {\r\n        enlace.addEventListener('click', () => activarEnlace(enlace));\r\n      });\r\n      \r\n      // Inicializar posicin del overlay\r\n      const activeEnlace = navAdmin.querySelector('.nav-enlace.active');\r\n      if (activeEnlace) {\r\n        setTimeout(() => activarEnlace(activeEnlace), 100);\r\n      }\r\n\r\n      window.addEventListener('resize', () => {\r\n        const currentActive = navAdmin.querySelector('.nav-enlace.active');\r\n        if (currentActive) {\r\n          setTimeout(() => activarEnlace(currentActive), 50);\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener('DOMContentLoaded', inicializarTabBar);\r\n\r\n    // =============================================\r\n    // 5. FUNCIONES DE MENSAJES Y NOTIFICACIONES\r\n    // =============================================\r\n    function mostrarMensajeExito(mensaje) {\r\n      // Eliminar mensaje existente si hay uno\r\n      let mensajeExito = document.getElementById('mensaje-exito-admin');\r\n      if (mensajeExito) {\r\n        mensajeExito.remove();\r\n      }\r\n\r\n      // Crear nuevo elemento\r\n      mensajeExito = document.createElement('div');\r\n      mensajeExito.id = 'mensaje-exito-admin';\r\n      mensajeExito.className = 'mensaje-exito';\r\n      \r\n      mensajeExito.innerHTML = `\r\n        <div class=\"mensaje-contenido\">\r\n          <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n            <path fill=\"#4CAF50\" d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n          </svg>\r\n          <span>${mensaje}</span>\r\n          <div class=\"barra-progreso-notificacion\"></div>\r\n        </div>\r\n      `;\r\n      \r\n      document.body.appendChild(mensajeExito);\r\n      \r\n      // Mostrar con animacin\r\n      setTimeout(() => {\r\n        mensajeExito.classList.add('visible');\r\n      }, 10);\r\n      \r\n      // Eliminar despus de 5 segundos\r\n      setTimeout(() => {\r\n        mensajeExito.classList.remove('visible');\r\n        setTimeout(() => {\r\n          if (mensajeExito.parentNode) {\r\n            mensajeExito.remove();\r\n          }\r\n        }, 300);\r\n      }, 5000);\r\n    }\r\n\r\n    function mostrarMensajeError(mensaje) {\r\n      // Eliminar mensaje existente si hay uno\r\n      let mensajeError = document.getElementById('mensaje-error-admin');\r\n      if (mensajeError) {\r\n        mensajeError.remove();\r\n      }\r\n\r\n      // Crear nuevo elemento\r\n      mensajeError = document.createElement('div');\r\n      mensajeError.id = 'mensaje-error-admin';\r\n      mensajeError.className = 'mensaje-error';\r\n      \r\n      mensajeError.innerHTML = `\r\n        <div class=\"mensaje-contenido error\">\r\n          <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n            <path fill=\"#f44336\" d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n          </svg>\r\n          <span>${mensaje}</span>\r\n          <div class=\"barra-progreso-notificacion\"></div>\r\n        </div>\r\n      `;\r\n      \r\n      document.body.appendChild(mensajeError);\r\n      \r\n      // Mostrar con animacin\r\n      setTimeout(() => {\r\n        mensajeError.classList.add('visible');\r\n      }, 10);\r\n      \r\n      // Eliminar despus de 5 segundos\r\n      setTimeout(() => {\r\n        mensajeError.classList.remove('visible');\r\n        setTimeout(() => {\r\n          if (mensajeError.parentNode) {\r\n            mensajeError.remove();\r\n          }\r\n        }, 300);\r\n      }, 5000);\r\n    }\r\n\r\n    function mostrarLoading() {\r\n      const loading = document.createElement('div');\r\n      loading.className = 'loading-indicator';\r\n      loading.textContent = 'Procesando...';\r\n      document.body.appendChild(loading);\r\n      return loading;\r\n    }\r\n\r\n    // =============================================\r\n    // 6. FUNCIONES DE CARGA DE DATOS\r\n    // =============================================\r\n    async function cargarServicios() {\r\n      try {\r\n        const snapshot = await db.collection('servicios').get();\r\n        serviciosMap = {};\r\n        snapshot.forEach(doc => {\r\n          serviciosMap[doc.id] = doc.data();\r\n        });\r\n        console.log(\"Servicios cargados:\", Object.keys(serviciosMap).length);\r\n      } catch (error) {\r\n        console.error(\"Error cargando servicios:\", error);\r\n      }\r\n    }\r\n\r\n    async function cargarEspecialistas() {\r\n      try {\r\n        console.log(\" Iniciando carga de especialistas...\");\r\n        especialistasCargando = true;\r\n        \r\n        const snapshot = await db.collection('especialistas').get();\r\n        const nuevoMapa = {};\r\n        \r\n        console.log(` Encontrados ${snapshot.size} especialistas en Firestore`);\r\n        \r\n        let cargados = 0;\r\n        snapshot.forEach(doc => {\r\n          const data = doc.data();\r\n          nuevoMapa[doc.id] = data;\r\n          console.log(` Cargado: ${doc.id} -> ${data.nombre}`);\r\n          cargados++;\r\n        });\r\n        \r\n        // Actualizar el mapa de forma atmica\r\n        especialistasMap = { ...especialistasMap, ...nuevoMapa };\r\n        \r\n        console.log(\" Especialistas cargados exitosamente:\", cargados);\r\n        console.log(\" IDs en el mapa:\", Object.keys(especialistasMap));\r\n        \r\n        // Reprocesar eventos pendientes si los hay\r\n        if (pendientesDeActualizacion.length > 0) {\r\n          console.log(\" Reprocesando eventos pendientes...\");\r\n          pendientesDeActualizacion.forEach(callback => callback());\r\n          pendientesDeActualizacion = [];\r\n        }\r\n        \r\n        return cargados;\r\n      } catch (error) {\r\n        console.error(\" Error cargando especialistas:\", error);\r\n        return 0;\r\n      } finally {\r\n        especialistasCargando = false;\r\n      }\r\n    }\r\n\r\n    function obtenerNombreEspecialista(especialistaId) {\r\n      if (!especialistaId || especialistaId === 'sin-especialista') {\r\n        return 'Sin especialista asignado';\r\n      }\r\n      \r\n      // Verificar si ya tenemos el especialista en el mapa\r\n      const especialista = especialistasMap[especialistaId];\r\n      if (especialista && especialista.nombre) {\r\n        return especialista.nombre;\r\n      }\r\n      \r\n      // Si no est en el mapa, intentar cargarlo bajo demanda\r\n      if (!especialistasCargando) {\r\n        console.log(` Especialista ${especialistaId} no encontrado, cargando bajo demanda...`);\r\n        cargarEspecialistaIndividual(especialistaId);\r\n      }\r\n      \r\n      // Mientras se carga, devolver el ID formateado como fallback temporal\r\n      return formatearNombreDesdeId(especialistaId);\r\n    }\r\n\r\n    async function cargarEspecialistaIndividual(especialistaId) {\r\n      try {\r\n        const doc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (doc.exists) {\r\n          const data = doc.data();\r\n          // Actualizar el mapa\r\n          especialistasMap[especialistaId] = data;\r\n          console.log(` Especialista cargado bajo demanda: ${especialistaId} -> ${data.nombre}`);\r\n          \r\n          // Refrescar el calendario para mostrar los nombres actualizados\r\n          if (calendar) {\r\n            calendar.refetchEvents();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(` Error cargando especialista individual ${especialistaId}:`, error);\r\n      }\r\n    }\r\n\r\n    function formatearNombreDesdeId(especialistaId) {\r\n      // Remover prefijo \"esp_\" y reemplazar guiones bajos por espacios\r\n      let nombre = especialistaId.replace(/^esp_/, '');\r\n      nombre = nombre.replace(/_/g, ' ');\r\n      \r\n      // Capitalizar palabras\r\n      nombre = nombre.replace(/\\w\\S*/g, function(txt) {\r\n        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n      });\r\n      \r\n      return nombre;\r\n    }\r\n\r\n    async function recargarEspecialistasYVista() {\r\n      await cargarEspecialistas();\r\n      if (calendar) {\r\n        calendar.refetchEvents();\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 7. FUNCIONES DE CONFIGURACIN\r\n    // =============================================\r\n    async function obtenerConfiguracion() {\r\n      try {\r\n        const doc = await db.collection('config').doc('horarios').get();\r\n        if (!doc.exists) return obtenerConfiguracionPorDefecto();\r\n        \r\n        const data = doc.data();\r\n        \r\n        // Funcin robusta para normalizar das laborales\r\n        const normalizarDias = (dias) => {\r\n          if (!dias) return [1,2,3,4,5];\r\n          \r\n          // Si ya es un array de nmeros, devolverlo\r\n          if (Array.isArray(dias) && dias.every(item => typeof item === 'number')) {\r\n            return dias;\r\n          }\r\n          \r\n          // Si es un string que parece contener un array\r\n          if (typeof dias === 'string') {\r\n            try {\r\n              // Limpiar el string\r\n              const strClean = dias.trim().replace(/[\\[\\]'\"\\s]/g, '');\r\n              if (strClean === '') return [1,2,3,4,5];\r\n              \r\n              // Convertir a array de nmeros\r\n              return strClean.split(',').map(Number).filter(n => !isNaN(n) && n >= 0 && n <= 6);\r\n            } catch (e) {\r\n              console.warn(\"Error parseando das laborales:\", e);\r\n              return [1,2,3,4,5];\r\n            }\r\n          }\r\n          \r\n          // Si es un array con strings\r\n          if (Array.isArray(dias)) {\r\n            return dias.map(item => {\r\n              if (typeof item === 'number') return item;\r\n              if (typeof item === 'string') {\r\n                return parseInt(item.replace(/\\D/g, ''), 10);\r\n              }\r\n              return null;\r\n            }).filter(n => !isNaN(n) && n >= 0 && n <= 6);\r\n          }\r\n          \r\n          return [1,2,3,4,5]; // Default\r\n        };\r\n        \r\n        const diasLaborales = normalizarDias(data.diasLaborales)\r\n          .filter(n => n >= 0 && n <= 6) // Filtrar valores invlidos\r\n          .sort((a, b) => a - b); // Ordenar\r\n        \r\n        return {\r\n          horarioApertura: data.horarioApertura || \"09:00\",\r\n          horarioCierre: data.horarioCierre || \"19:00\",\r\n          duracionTurno: data.duracionTurno || 30,\r\n          diasLaborales: diasLaborales.length > 0 ? diasLaborales : [1,2,3,4,5]\r\n        };\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo configuracin:\", error);\r\n        return obtenerConfiguracionPorDefecto();\r\n      }\r\n    }\r\n\r\n    function obtenerConfiguracionPorDefecto() {\r\n      return {\r\n        horarioApertura: \"09:00\",\r\n        horarioCierre: \"19:00\",\r\n        duracionTurno: 30,\r\n        diasLaborales: [1,2,3,4,5] // Lunes a Viernes\r\n      };\r\n    }\r\n\r\n    function validarHorario(horario, config) {\r\n      // Convertir horario a minutos desde medianoche\r\n      const [horas, minutos] = horario.split(':').map(Number);\r\n      const horarioEnMinutos = horas * 60 + minutos;\r\n      \r\n      // Convertir horarios de apertura/cierre\r\n      const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n      const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n      const aperturaEnMinutos = aperturaH * 60 + aperturaM;\r\n      const cierreEnMinutos = cierreH * 60 + cierreM;\r\n      \r\n      // Validar que est dentro del horario laboral\r\n      if (horarioEnMinutos < aperturaEnMinutos || horarioEnMinutos >= cierreEnMinutos) {\r\n        return {\r\n          valido: false,\r\n          mensaje: `El horario debe estar entre ${config.horarioApertura} y ${config.horarioCierre}`\r\n        };\r\n      }\r\n      \r\n      // Validar que sea en intervalos de 30 minutos\r\n      if (minutos % config.duracionTurno !== 0) {\r\n        return {\r\n          valido: false,\r\n          mensaje: `Los turnos deben ser en intervalos de ${config.duracionTurno} minutos (ej: 09:00, 09:30, etc.)`\r\n        };\r\n      }\r\n      \r\n      return { valido: true };\r\n    }\r\n\r\n    // =============================================\r\n    // 8. FUNCIONES DEL CALENDARIO\r\n    // =============================================\r\n    async function initCalendar() {\r\n      if (!elements.calendar) return;\r\n      \r\n      calendar = new FullCalendar.Calendar(elements.calendar, {\r\n        initialView: 'dayGridMonth',\r\n        locale: 'es',\r\n        headerToolbar: {\r\n          left: 'prev,next today',\r\n          center: 'title',\r\n          right: 'dayGridMonth,timeGridWeek,timeGridDay'\r\n        },\r\n        selectable: true,\r\n        selectMirror: true,\r\n        dayMaxEvents: true,\r\n        selectOverlap: false,\r\n        \r\n        height: 'auto', // Altura automtica\r\n        contentHeight: 'auto', // Altura del contenido automtica\r\n\r\n        allDaySlot: false, // Ocultar la ranura \"todo el da\"\r\n        slotMinTime: \"09:00:00\", // Ajustar segn tu horario de apertura\r\n        slotMaxTime: \"20:00:00\", // Ajustar segn tu horario de cierre\r\n        slotDuration: \"00:30:00\", // Duracin de cada slot (30 minutos)\r\n        slotLabelInterval: \"01:00:00\", // Mostrar etiquetas cada hora\r\n        slotLabelFormat: {\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n          hour12: false\r\n        },\r\n        \r\n        // Modificar el evento dateClick en initCalendar\r\n        dateClick: async function(info) {\r\n          // Remover la clase de seleccin de todas las celdas primero\r\n          document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n            el.classList.remove('fc-daygrid-day-selected');\r\n          });\r\n          \r\n          // Aadir la clase de seleccin a la celda clickeada\r\n          info.dayEl.classList.add('fc-daygrid-day-selected');\r\n          \r\n          // Buscar el enlace \"more\" (contador) en este da\r\n          const moreLink = info.dayEl.querySelector('.fc-daygrid-more-link');\r\n          \r\n          if (moreLink) {\r\n            // Si hay contador, simular click en l para abrir el popover\r\n            moreLink.click();\r\n          } else {\r\n            // Si no hay contador, verificar si hay eventos en este da\r\n            const events = calendar.getEvents().filter(event => {\r\n              const eventStart = event.start;\r\n              return eventStart && \r\n                    eventStart.toISOString().split('T')[0] === info.dateStr &&\r\n                    !event.extendedProps.esContador; // Excluir eventos contador\r\n            });\r\n            \r\n            if (events.length > 0) {\r\n              // Si hay eventos pero no contador (menos del lmite), mostrar en el panel lateral\r\n              await loadTurnosForDate(info.dateStr);\r\n            } else {\r\n              // Si no hay eventos, tambin cargar en el panel lateral (mostrar \"No hay turnos\")\r\n              await loadTurnosForDate(info.dateStr);\r\n            }\r\n          }\r\n        },\r\n        \r\n        events: async function(fetchInfo, successCallback, failureCallback) {\r\n          try {\r\n            const snapshot = await db.collection('turnos')\r\n              .where('fecha', '>=', fetchInfo.startStr)\r\n              .where('fecha', '<=', fetchInfo.endStr)\r\n              .get();\r\n            \r\n            const events = [];\r\n\r\n            snapshot.docs.forEach(doc => {\r\n              const data = doc.data();\r\n              const clienteNombre = data.cliente?.nombre || 'Cliente no especificado';\r\n              const serviciosNombres = obtenerNombresServicios(data.serviciosIds);\r\n              \r\n              // Manejar mltiples especialistas\r\n              const especialistaIds = data.especialistaIds || [];\r\n              \r\n              if (especialistaIds.length === 0) {\r\n                // Caso sin especialistas\r\n                const horario = data.horario || data.horarioInicio || '00:00';\r\n                events.push(crearEventoTurno(doc.id, data, clienteNombre, serviciosNombres, 'sin-especialista', horario, horario));\r\n              } else if (especialistaIds.length === 1) {\r\n                // Caso con un solo especialista\r\n                const especialistaId = especialistaIds[0];\r\n                const horario = data.horario || data.horarioInicio || '00:00';\r\n                events.push(crearEventoTurno(doc.id, data, clienteNombre, serviciosNombres, especialistaId, horario, horario));\r\n              } else {\r\n                // Caso con mltiples especialistas - crear un evento por cada uno\r\n                especialistaIds.forEach(especialistaId => {\r\n                  let horarioInicio = data.horarioInicio;\r\n                  let horarioFin = data.horarioInicio;\r\n                  \r\n                  if (data.slotsPorEspecialista && data.slotsPorEspecialista[especialistaId]) {\r\n                    const slots = data.slotsPorEspecialista[especialistaId];\r\n                    if (slots.length > 0) {\r\n                      horarioInicio = slots[0];\r\n                      \r\n                      // Calcular duracin especfica para este especialista\r\n                      let duracion = 30; // Default\r\n                      if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n                        const serviciosEspecialista = data.serviciosPorEspecialista[especialistaId];\r\n                        duracion = serviciosEspecialista.reduce((total, servicio) => total + (servicio.duracion || 30), 0);\r\n                      }\r\n                      \r\n                      // Calcular horario fin preciso\r\n                      const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n                      const inicioMinutos = hora * 60 + minuto;\r\n                      const finMinutos = inicioMinutos + duracion;\r\n                      const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n                      const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n                      horarioFin = `${horaFin}:${minutoFin}`;\r\n                    }\r\n                  }\r\n                  \r\n                  // Obtener servicios especficos para este especialista\r\n                  let serviciosEspecificos = serviciosNombres;\r\n                  if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n                    const servicios = data.serviciosPorEspecialista[especialistaId];\r\n                    serviciosEspecificos = servicios.map(s => s.nombre).join(', ');\r\n                  }\r\n                  \r\n                  events.push(crearEventoTurno(\r\n                    `${doc.id}_${especialistaId}`, // ID nico por especialista\r\n                    data, \r\n                    clienteNombre, \r\n                    serviciosEspecificos, \r\n                    especialistaId, \r\n                    horarioInicio, \r\n                    horarioFin,\r\n                    true // Es mltiple\r\n                  ));\r\n                });\r\n              }\r\n            });\r\n            \r\n            successCallback(events);\r\n          } catch (error) {\r\n            console.error(\"Error cargando eventos:\", error);\r\n            successCallback([]);\r\n          }\r\n        },\r\n        \r\n        eventClick: function(info) {\r\n          abrirModalEdicion(info.event);\r\n        },\r\n        \r\n        select: function(info) {\r\n          calendar.unselect();\r\n        },\r\n        \r\n        // Configuracin especfica para cada vista\r\n        views: {\r\n          dayGridMonth: {\r\n            dayMaxEvents: 0,\r\n            dayMaxEventRows: 1, // Lmite de eventos por da en vista mensual\r\n            displayEventTime: false, // No mostrar hora en eventos de vista mensual\r\n          },\r\n          timeGridWeek: {\r\n            dayHeaderFormat: { weekday: 'short', day: 'numeric', month: 'short' },\r\n            slotEventOverlap: false, // Evitar superposicin visual de eventos\r\n            eventMinHeight: 20, // Altura mnima para eventos cortos\r\n            allDaySlot: false // Ocultar \"todo el da\" en vista semanal\r\n          },\r\n          timeGridDay: {\r\n            dayHeaderFormat: { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' },\r\n            slotEventOverlap: false,\r\n            eventMinHeight: 20,\r\n            allDaySlot: false\r\n          }\r\n        },\r\n        \r\n        // Asegurar que los eventos usen la duracin correcta\r\n        eventTimeFormat: {\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n          hour12: false\r\n        },\r\n        \r\n        // Limpiar seleccin al cambiar de vista\r\n        viewDidMount: function() {\r\n          document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n            el.classList.remove('fc-daygrid-day-selected');\r\n          });\r\n        },\r\n        \r\n        // Mejorar el tooltip para mostrar duracin\r\n        eventDidMount: function(info) {\r\n          const { event } = info;\r\n          const startTime = event.start.toLocaleTimeString('es-ES', { \r\n            hour: '2-digit', \r\n            minute: '2-digit',\r\n            hour12: false \r\n          });\r\n          \r\n          const endTime = event.end ? event.end.toLocaleTimeString('es-ES', { \r\n            hour: '2-digit', \r\n            minute: '2-digit',\r\n            hour12: false \r\n          }) : 'Fin no definido';\r\n          \r\n          const duracion = event.end ? \r\n            Math.round((event.end - event.start) / (1000 * 60)) + ' min' : \r\n            'Duracin no definida';\r\n          \r\n          const tooltipContent = `\r\n            <strong>Cliente:</strong> ${event.extendedProps.cliente}<br>\r\n            <strong>Especialista:</strong> ${event.extendedProps.especialista}<br>\r\n            <strong>Servicios:</strong> ${event.extendedProps.servicios}<br>\r\n            <strong>Horario:</strong> ${startTime} - ${endTime}<br>\r\n            <strong>Duracin:</strong> ${duracion}\r\n          `;\r\n          \r\n          info.el.setAttribute('title', tooltipContent.replace(/<br>/g, '\\n'));\r\n        }\r\n      });\r\n      \r\n      calendar.render();\r\n    }\r\n\r\n    function crearEventoTurno(id, data, clienteNombre, serviciosNombres, especialistaId, horarioInicio, horarioFin, esMultiplesEspecialistas = false) {\r\n      const especialistaNombre = obtenerNombreEspecialista(especialistaId);\r\n      const titulo = esMultiplesEspecialistas \r\n        ? `${clienteNombre} - ${especialistaNombre}`\r\n        : `${clienteNombre} - ${especialistaNombre}`;\r\n      \r\n      // Asegurar que horarioFin sea posterior a horarioInicio\r\n      let horaFinCalculada = horarioFin;\r\n      if (horarioInicio === horarioFin) {\r\n        // Si no hay horarioFin, calcularlo basado en la duracin\r\n        let duracion = 30; // Default 30 minutos\r\n        \r\n        // Buscar duracin en serviciosPorEspecialista\r\n        if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n          const servicios = data.serviciosPorEspecialista[especialistaId];\r\n          duracion = servicios.reduce((total, servicio) => total + (servicio.duracion || 30), 0);\r\n        } else if (data.duracionTotal && data.especialistaIds && data.especialistaIds.length > 0) {\r\n          // Dividir la duracin total entre especialistas como fallback\r\n          duracion = Math.round(data.duracionTotal / data.especialistaIds.length);\r\n        }\r\n        \r\n        // Calcular horarioFin\r\n        const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n        const inicioMinutos = hora * 60 + minuto;\r\n        const finMinutos = inicioMinutos + duracion;\r\n        const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n        const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n        horaFinCalculada = `${horaFin}:${minutoFin}`;\r\n      }\r\n      \r\n      //  NUEVO: Generar un color nico basado en el ID del turno padre para eventos mltiples\r\n      const turnoBaseId = esMultiplesEspecialistas ? id.split('_')[0] : null;\r\n      const colorBordeGrupo = turnoBaseId ? generarColorDesdeId(turnoBaseId) : null;\r\n      \r\n      return {\r\n        id: id,\r\n        title: titulo,\r\n        start: `${data.fecha}T${horarioInicio}`,\r\n        end: `${data.fecha}T${horaFinCalculada}`,\r\n        allDay: false,\r\n        extendedProps: {\r\n          turnoId: data.id || id.split('_')[0],\r\n          cliente: clienteNombre,\r\n          telefono: data.cliente?.telefono || 'No especificado',\r\n          email: data.cliente?.email || 'No especificado',\r\n          servicios: serviciosNombres,\r\n          especialista: especialistaNombre,\r\n          especialistaId: especialistaId,\r\n          todosLosEspecialistas: data.especialistaIds ? data.especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ') : especialistaNombre,\r\n          observaciones: data.observaciones || 'Sin observaciones',\r\n          estado: data.estado || 'pendiente',\r\n          esMultiplesEspecialistas: esMultiplesEspecialistas,\r\n          horarioInicio: horarioInicio,\r\n          horarioFin: horaFinCalculada,\r\n          duracion: calcularDuracionEnMinutos(horarioInicio, horaFinCalculada),\r\n          //  NUEVO: Guardar el ID base para agrupamiento visual\r\n          turnoBaseId: turnoBaseId,\r\n          colorBordeGrupo: colorBordeGrupo\r\n        },\r\n        className: `fc-event-${data.estado || 'pendiente'} ${esMultiplesEspecialistas ? 'fc-event-grupo-multiple' : ''}`,\r\n        borderColor: esMultiplesEspecialistas ? colorBordeGrupo : 'transparent',\r\n        backgroundColor: getEventColorBySpecialist(especialistaId),\r\n        textColor: '#ffffff'\r\n      };\r\n    }\r\n\r\n    function generarColorDesdeId(id) {\r\n      // Colores distintivos para bordes de grupos\r\n      const coloresGrupo = [\r\n        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',\r\n        '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',\r\n        '#F8C471', '#82E0AA', '#F1948A', '#D7BDE2', '#A3E4D7'\r\n      ];\r\n      \r\n      // Generar ndice basado en el ID\r\n      let hash = 0;\r\n      for (let i = 0; i < id.length; i++) {\r\n        hash = id.charCodeAt(i) + ((hash << 5) - hash);\r\n      }\r\n      const index = Math.abs(hash) % coloresGrupo.length;\r\n      \r\n      return coloresGrupo[index];\r\n    }\r\n\r\n    function getEventColorBySpecialist(especialistaId) {\r\n      // Mapa de colores fijos para especialistas conocidos\r\n      const coloresFijos = {\r\n        'esp_analia_solange': '#b285bfff',\r\n        'esp_agustin_matias': '#aaaad3ff',\r\n        'esp_blondie_flores': '#95bec3ff',\r\n        'esp_monica_flores': '#92bc8bff',\r\n        // Agregar ms especialistas segn necesites\r\n      };\r\n      \r\n      // Si tenemos un color fijo para este especialista, usarlo\r\n      if (coloresFijos[especialistaId]) {\r\n        return coloresFijos[especialistaId];\r\n      }\r\n      \r\n      // Para especialistas no mapeados, usar colores de respaldo\r\n      const coloresRespaldo = [\r\n        '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F',\r\n        '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A',\r\n        '#D7BDE2', '#A3E4D7', '#F9E79F', '#D2B4DE', '#A9CCE3'\r\n      ];\r\n      \r\n      // Generar ndice basado en el ID del especialista\r\n      let hash = 0;\r\n      for (let i = 0; i < especialistaId.length; i++) {\r\n        hash = especialistaId.charCodeAt(i) + ((hash << 5) - hash);\r\n      }\r\n      const index = Math.abs(hash) % coloresRespaldo.length;\r\n      \r\n      return coloresRespaldo[index];\r\n    }\r\n\r\n    function getEventColor(estado) {\r\n      switch(estado) {\r\n        case 'confirmado': return '#4CAF50';\r\n        case 'cancelado': return '#F44336';\r\n        case 'completado': return '#2196F3';\r\n        default: return '#FF9800';\r\n      }\r\n    }\r\n\r\n    function calcularDuracionEnMinutos(horarioInicio, horarioFin) {\r\n      const [horaInicio, minutoInicio] = horarioInicio.split(':').map(Number);\r\n      const [horaFin, minutoFin] = horarioFin.split(':').map(Number);\r\n      \r\n      const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n      const finMinutos = horaFin * 60 + minutoFin;\r\n      \r\n      return finMinutos - inicioMinutos;\r\n    }\r\n\r\n    async function recargarVistaCalendario() {\r\n      if (!calendar) return;\r\n      \r\n      try {\r\n        console.log(' Recargando vista del calendario...');\r\n        \r\n        // Obtener informacin de la vista actual\r\n        const vistaActual = calendar.view;\r\n        const tipoVista = vistaActual.type;\r\n        const fechaActual = vistaActual.currentStart;\r\n        \r\n        console.log(` Vista actual: ${tipoVista}, Fecha: ${fechaActual}`);\r\n        \r\n        // Mtodo 1: Forzar recarga cambiando temporalmente la vista\r\n        // Esto es ms efectivo que refetchEvents() solo\r\n        if (tipoVista === 'timeGridWeek' || tipoVista === 'timeGridDay') {\r\n          // Para vistas semanales y diarias, cambiar temporalmente a month y volver\r\n          calendar.changeView('dayGridMonth', fechaActual);\r\n          setTimeout(() => {\r\n            calendar.changeView(tipoVista, fechaActual);\r\n          }, 100);\r\n        } else {\r\n          // Para vista mensual, recargar directamente\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error(' Error recargando vista calendario:', error);\r\n        // Fallback: recarga bsica\r\n        if (calendar) {\r\n          calendar.refetchEvents();\r\n        }\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 9. FUNCIONES DE TURNOS (CRUD)\r\n    // =============================================\r\n    async function loadTurnosForDate(date) {\r\n      try {\r\n        console.log(' Cargando turnos para fecha:', date);\r\n        \r\n        // Corregir formato de fecha para el ttulo\r\n        const fechaObj = new Date(date);\r\n        const fechaAjustada = new Date(fechaObj.getTime() + fechaObj.getTimezoneOffset() * 60000);\r\n        \r\n        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\r\n        elements.fechaTitulo.textContent = `Turnos para ${fechaAjustada.toLocaleDateString('es-AR', options)}`;\r\n        \r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', date)\r\n          .orderBy('horario', 'asc')\r\n          .get();\r\n        \r\n        console.log(` Encontrados ${snapshot.docs.length} turnos`);\r\n        renderTurnos(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n        \r\n      } catch (error) {\r\n        console.error(\" Error cargando turnos:\", error);\r\n        elements.turnosList.innerHTML = '<p>Error al cargar los turnos. Intente nuevamente.</p>';\r\n      }\r\n    }\r\n\r\n    function renderTurnos(turnos) {\r\n      if (!elements.turnosList) return;\r\n      \r\n      if (turnos.length === 0) {\r\n        elements.turnosList.innerHTML = '<p class=\"sin-turnos\">No hay turnos para esta fecha.</p>';\r\n        return;\r\n      }\r\n      \r\n      elements.turnosList.innerHTML = turnos.map(turno => {\r\n        const especialistaIds = turno.especialistaIds || [];\r\n        const nombresEspecialistas = especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ');\r\n        \r\n        // Obtener servicios especficos por especialista\r\n        let serviciosInfo = obtenerNombresServicios(turno.serviciosIds);\r\n        if (turno.serviciosPorEspecialista) {\r\n          serviciosInfo = '';\r\n          Object.keys(turno.serviciosPorEspecialista).forEach(espId => {\r\n            const servicios = turno.serviciosPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            const nombresServicios = servicios.map(s => s.nombre).join(', ');\r\n            serviciosInfo += `<strong>${nombreEsp}:</strong> ${nombresServicios}<br>`;\r\n          });\r\n        }\r\n        \r\n        // Obtener horarios por especialista\r\n        let horariosInfo = turno.horarioInicio || 'No especificado';\r\n        if (turno.slotsPorEspecialista) {\r\n          horariosInfo = '';\r\n          Object.keys(turno.slotsPorEspecialista).forEach(espId => {\r\n            const slots = turno.slotsPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            if (slots.length > 0) {\r\n              horariosInfo += `<strong>${nombreEsp}:</strong> ${slots[0]}<br>`;\r\n            }\r\n          });\r\n        }\r\n        \r\n        return `\r\n        <div class=\"turno-card\" data-id=\"${turno.id}\">\r\n          <div class=\"turno-header\" data-id=\"${turno.id}\">\r\n            <div class=\"turno-sumario\">\r\n              <span class=\"turno-horario\">${turno.horarioInicio}</span>\r\n              <span class=\"turno-cliente\">${turno.cliente.nombre}</span>\r\n              <span class=\"turno-especialista\">${nombresEspecialistas}</span>\r\n              <span class=\"turno-estado ${turno.estado || 'pendiente'}\">${turno.estado || 'pendiente'}</span>\r\n            </div>\r\n            <span class=\"toggle-icon\"></span>\r\n          </div>\r\n          <div class=\"turno-detalles\">\r\n            <div class=\"turno-info\">\r\n              <p><strong>Servicios por especialista:</strong><br>${serviciosInfo}</p>\r\n              <p><strong>Especialistas:</strong> ${nombresEspecialistas}</p>\r\n              <p><strong>Horarios:</strong><br>${horariosInfo}</p>\r\n              <p><strong>Telfono:</strong> ${turno.cliente.telefono}</p>\r\n              <p><strong>Email:</strong> ${turno.cliente.email}</p>\r\n              ${turno.duracionTotal ? `<p><strong>Duracin total:</strong> ${turno.duracionTotal} minutos</p>` : ''}\r\n              ${turno.montoTotal ? `<p><strong>Monto total:</strong> $${turno.montoTotal}</p>` : ''}\r\n              ${turno.observaciones ? `<p><strong>Observaciones:</strong> ${turno.observaciones}</p>` : ''}\r\n            </div>\r\n            <div class=\"turno-actions\">\r\n              <button class=\"btn-editar\" data-id=\"${turno.id}\">Editar</button>\r\n              <button class=\"btn-eliminar-lista\" data-id=\"${turno.id}\">Eliminar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        `;\r\n      }).join('');\r\n      \r\n      // El resto del cdigo de event listeners se mantiene igual...\r\n      document.querySelectorAll('.turno-header').forEach(header => {\r\n        header.addEventListener('click', function(e) {\r\n          if (e.target.tagName === 'BUTTON') return;\r\n          \r\n          const card = this.closest('.turno-card');\r\n          const detalles = card.querySelector('.turno-detalles');\r\n          const icon = this.querySelector('.toggle-icon');\r\n          \r\n          card.classList.toggle('expanded');\r\n          detalles.style.display = card.classList.contains('expanded') ? 'block' : 'none';\r\n          icon.textContent = card.classList.contains('expanded') ? '' : '';\r\n        });\r\n      });\r\n      \r\n      // Configurar eventos para los botones eliminar\r\n      document.querySelectorAll('.btn-eliminar-lista').forEach(btn => {\r\n        btn.addEventListener('click', async (e) => {\r\n          e.stopPropagation();\r\n          const turnoId = e.currentTarget.getAttribute('data-id');\r\n          \r\n          if (confirm('Ests seguro de eliminar este turno?')) {\r\n            const loading = mostrarLoading();\r\n            try {\r\n              await eliminarTurno(turnoId);\r\n              const fechaActual = new Date().toISOString().split('T')[0];\r\n              await loadTurnosForDate(fechaActual);\r\n            } catch (error) {\r\n              console.error(\"Error eliminando desde lista:\", error);\r\n              alert(\"Error al eliminar el turno\");\r\n            } finally {\r\n              loading.remove();\r\n            }\r\n          }\r\n        });\r\n      });\r\n      \r\n      // Configurar eventos para los botones editar\r\n      document.querySelectorAll('.btn-editar').forEach(btn => {\r\n        btn.addEventListener('click', async (e) => {\r\n          e.stopPropagation();\r\n          const turnoId = e.currentTarget.getAttribute('data-id');\r\n          await abrirModalEdicionPorId(turnoId);\r\n        });\r\n      });\r\n    }\r\n\r\n    async function abrirModalEdicion(event) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        await generarOpcionesHorario(config);\r\n        \r\n        currentTurnoId = event.extendedProps.turnoId;\r\n        \r\n        document.getElementById('turno-id').value = currentTurnoId;\r\n        document.getElementById('edit-fecha').value = event.start.toISOString().split('T')[0];\r\n        \r\n        const hora = event.start.getHours().toString().padStart(2, '0');\r\n        const minutos = event.start.getMinutes().toString().padStart(2, '0');\r\n        document.getElementById('edit-horario').value = `${hora}:${minutos}`;\r\n        \r\n        // Mostrar informacin completa, incluyendo todos los especialistas si es mltiple\r\n        const infoHTML = event.extendedProps.esMultiplesEspecialistas \r\n          ? `\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z\" />\r\n                </svg>\r\n              </strong>\r\n              <span>${event.extendedProps.cliente}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.servicios}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.especialista}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M17.8 19.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                  <path d=\"M6.2 19.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                  <path d=\"M12 9.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.todosLosEspecialistas}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                  <path d=\"M12 12h3.5\" />\r\n                  <path d=\"M12 7v5\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.horarioInicio} - ${event.extendedProps.horarioFin}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.telefono}</span>\r\n            </p>\r\n          `\r\n          : `\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.cliente}</span>\r\n              </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.servicios}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                  <path d=\"M12 12h3.5\" />\r\n                  <path d=\"M12 7v5\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.horarioInicio} - ${event.extendedProps.horarioFin}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.especialista}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.telefono}</span>\r\n            </p>\r\n          `;\r\n        \r\n        document.getElementById('turno-info').innerHTML = infoHTML;\r\n        \r\n        elements.modalEditar.style.display = 'block';\r\n      } catch (error) {\r\n        console.error(\"Error abriendo modal de edicin:\", error);\r\n        alert(\"Error al cargar los datos del turno\");\r\n      }\r\n    }\r\n\r\n    async function abrirModalEdicionPorId(turnoId) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        await generarOpcionesHorario(config);\r\n        \r\n        const doc = await db.collection('turnos').doc(turnoId).get();\r\n        if (!doc.exists) {\r\n          alert('Turno no encontrado');\r\n          return;\r\n        }\r\n        \r\n        const turno = doc.data();\r\n        currentTurnoId = turnoId;\r\n        \r\n        // Obtener informacin completa de todos los especialistas\r\n        const especialistaIds = turno.especialistaIds || [];\r\n        const nombresEspecialistas = especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ');\r\n        \r\n        // Obtener servicios especficos por especialista\r\n        let serviciosInfo = obtenerNombresServicios(turno.serviciosIds);\r\n        if (turno.serviciosPorEspecialista) {\r\n          serviciosInfo = '';\r\n          Object.keys(turno.serviciosPorEspecialista).forEach(espId => {\r\n            const servicios = turno.serviciosPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            const nombresServicios = servicios.map(s => s.nombre).join(', ');\r\n            serviciosInfo += `<strong>${nombreEsp}:</strong> ${nombresServicios}<br>`;\r\n          });\r\n        }\r\n        \r\n        // Obtener horarios por especialista\r\n        let horariosInfo = turno.horarioInicio || 'No especificado';\r\n        if (turno.slotsPorEspecialista) {\r\n          horariosInfo = '';\r\n          Object.keys(turno.slotsPorEspecialista).forEach(espId => {\r\n            const slots = turno.slotsPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            if (slots.length > 0) {\r\n              // Calcular hora de fin aproximada\r\n              const horarioInicio = slots[0];\r\n              let duracion = 30; // Default\r\n              if (turno.serviciosPorEspecialista && turno.serviciosPorEspecialista[espId]) {\r\n                duracion = turno.serviciosPorEspecialista[espId].reduce((total, servicio) => total + servicio.duracion, 0);\r\n              }\r\n              \r\n              const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n              const inicioMinutos = hora * 60 + minuto;\r\n              const finMinutos = inicioMinutos + duracion;\r\n              const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n              const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n              const horarioFin = `${horaFin}:${minutoFin}`;\r\n              \r\n              horariosInfo += `<strong>${nombreEsp}:</strong> ${horarioInicio} - ${horarioFin}<br>`;\r\n            }\r\n          });\r\n        }\r\n        \r\n        document.getElementById('turno-id').value = turnoId;\r\n        document.getElementById('edit-fecha').value = turno.fecha;\r\n        document.getElementById('edit-horario').value = turno.horario || turno.horarioInicio;\r\n        \r\n        // Mostrar informacin completa del turno\r\n        document.getElementById('turno-info').innerHTML = `\r\n          <p><strong>Cliente:</strong> ${turno.cliente.nombre}</p>\r\n          <p><strong>Servicios por especialista:</strong><br>${serviciosInfo}</p>\r\n          <p><strong>Especialistas:</strong> ${nombresEspecialistas}</p>\r\n          <p><strong>Horarios por especialista:</strong><br>${horariosInfo}</p>\r\n          <p><strong>Telfono:</strong> ${turno.cliente.telefono}</p>\r\n          <p><strong>Estado:</strong> ${turno.estado || 'pendiente'}</p>\r\n          ${turno.duracionTotal ? `<p><strong>Duracin total:</strong> ${turno.duracionTotal} minutos</p>` : ''}\r\n          ${turno.montoTotal ? `<p><strong>Monto total:</strong> $${turno.montoTotal}</p>` : ''}\r\n          ${turno.seaAbonada ? `<p><strong>Sea abonada:</strong> $${turno.seaAbonada}</p>` : ''}\r\n        `;\r\n        \r\n        // Configurar el botn eliminar (cdigo existente)\r\n        const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n        if (btnEliminarModal) {\r\n          btnEliminarModal.onclick = async (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            \r\n            if (confirm('Ests seguro de eliminar este turno permanentemente?')) {\r\n              try {\r\n                const success = await eliminarTurno(currentTurnoId);\r\n                if (success) {\r\n                  await loadTurnosForDate(turno.fecha);\r\n                  calendar.refetchEvents();\r\n                  elements.modalEditar.style.display = 'none';\r\n                  alert('Turno eliminado correctamente');\r\n                }\r\n              } catch (error) {\r\n                console.error(\"Error al eliminar turno:\", error);\r\n                alert(\"Error al eliminar el turno: \" + error.message);\r\n              }\r\n            }\r\n          };\r\n        }\r\n        \r\n        elements.modalEditar.style.display = 'block';\r\n      } catch (error) {\r\n        console.error(\"Error abriendo modal de edicin:\", error);\r\n        alert(\"Error al cargar los datos del turno\");\r\n      }\r\n    }\r\n\r\n    function configurarModalEliminar() {\r\n      const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n      if (!btnEliminarModal) return;\r\n\r\n      // Limpiar eventos previos\r\n      btnEliminarModal.onclick = null;\r\n      \r\n      // Asignar nuevo evento\r\n      btnEliminarModal.onclick = async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        \r\n        if (!currentTurnoId) {\r\n          console.error('No hay turno seleccionado');\r\n          alert('No hay turno seleccionado para eliminar');\r\n          return;\r\n        }\r\n\r\n        if (confirm('Ests seguro de eliminar este turno permanentemente? Esta accin no se puede deshacer.')) {\r\n          const loadingIndicator = mostrarLoading();\r\n          try {\r\n            await eliminarTurno(currentTurnoId);\r\n          } catch (error) {\r\n            console.error(\"Error en eliminacin:\", error);\r\n          } finally {\r\n            loadingIndicator.remove();\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    async function generarOpcionesHorario(config) {\r\n      const selectHorario = document.getElementById('edit-horario');\r\n      selectHorario.innerHTML = '';\r\n      \r\n      // Convertir horarios de apertura/cierre a minutos\r\n      const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n      const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n      \r\n      let horaActual = aperturaH;\r\n      let minutoActual = aperturaM;\r\n      \r\n      while (horaActual < cierreH || (horaActual === cierreH && minutoActual < cierreM)) {\r\n        const horaStr = horaActual.toString().padStart(2, '0');\r\n        const minutoStr = minutoActual.toString().padStart(2, '0');\r\n        const option = document.createElement('option');\r\n        option.value = `${horaStr}:${minutoStr}`;\r\n        option.textContent = `${horaStr}:${minutoStr}`;\r\n        selectHorario.appendChild(option);\r\n        \r\n        // Avanzar el tiempo\r\n        minutoActual += config.duracionTurno;\r\n        if (minutoActual >= 60) {\r\n          horaActual += Math.floor(minutoActual / 60);\r\n          minutoActual = minutoActual % 60;\r\n        }\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidad(fecha, horario, turnoId = null) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        \r\n        // Convertir horario a minutos\r\n        const [hora, minuto] = horario.split(':').map(Number);\r\n        const inicioEnMinutos = hora * 60 + minuto;\r\n        const finEnMinutos = inicioEnMinutos + config.duracionTurno;\r\n        \r\n        // Consultar todos los turnos para la fecha\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .get();\r\n        \r\n        // Filtrar localmente los turnos que se solapan\r\n        const turnosSolapados = snapshot.docs.filter(doc => {\r\n          // Si estamos editando, excluir el turno actual\r\n          if (turnoId && doc.id === turnoId) return false;\r\n          \r\n          const turno = doc.data();\r\n          const turnoHorario = turno.horario || turno.horarioInicio;\r\n          \r\n          if (!turnoHorario) return false;\r\n          \r\n          const [turnoHora, turnoMinuto] = turnoHorario.split(':').map(Number);\r\n          const turnoInicio = turnoHora * 60 + turnoMinuto;\r\n          const turnoFin = turnoInicio + (turno.duracionTotal || config.duracionTurno);\r\n          \r\n          // Verificar solapamiento\r\n          return (inicioEnMinutos < turnoFin && finEnMinutos > turnoInicio);\r\n        });\r\n        \r\n        return {\r\n          disponible: turnosSolapados.length === 0,\r\n          mensaje: turnosSolapados.length > 0 ? \r\n            `El horario se solapa con ${turnosSolapados.length} turno(s) existente(s)` : \r\n            null\r\n        };\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad: \" + error.message\r\n        };\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidadCompletaEspecialista(especialistaId, fecha, horarioInicio, duracionTotal, turnoIdExcluir = null) {\r\n      try {\r\n        console.log(` Verificando disponibilidad completa para ${especialistaId} en ${fecha} a las ${horarioInicio}`);\r\n        \r\n        // 1. Verificar si el especialista existe y est activo\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) {\r\n          return { disponible: false, mensaje: 'Especialista no encontrado' };\r\n        }\r\n        \r\n        const especialista = especialistaDoc.data();\r\n        if (!especialista.activo) {\r\n          return { disponible: false, mensaje: 'El especialista no est activo' };\r\n        }\r\n        \r\n        // 2. Verificar da laboral del especialista (CORREGIDO)\r\n        const [year, month, day] = fecha.split('-').map(Number);\r\n        const fechaObj = new Date(year, month - 1, day);\r\n        const diaSemana = fechaObj.getDay(); // 0=Domingo, 1=Lunes, ..., 6=Sbado\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        const horarioDia = especialista.horarioLaboral?.[diaKey];\r\n        if (!horarioDia || !horarioDia.activo) {\r\n          const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n          const diasNombres = ['Domingos', 'Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbados'];\r\n          return { \r\n            disponible: false, \r\n            mensaje: `${nombreEspecialista} no trabaja los ${diasNombres[diaSemana]}` \r\n          };\r\n        }\r\n        \r\n        // 3. Verificar horario dentro de la jornada laboral (resto del cdigo igual)\r\n        const [horaInicio, minutoInicio] = horarioInicio.split(':').map(Number);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        const [horaApertura, minutoApertura] = horarioDia.inicio.split(':').map(Number);\r\n        const [horaCierre, minutoCierre] = horarioDia.fin.split(':').map(Number);\r\n        const aperturaMinutos = horaApertura * 60 + minutoApertura;\r\n        const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n        \r\n        if (inicioMinutos < aperturaMinutos) {\r\n          return { \r\n            disponible: false, \r\n            mensaje: `El horario ${horarioInicio} es antes de la apertura (${horarioDia.inicio})` \r\n          };\r\n        }\r\n        \r\n        if (finMinutos > cierreMinutos) {\r\n          return { \r\n            disponible: false, \r\n            mensaje: `El turno termina despus del cierre (${horarioDia.fin})` \r\n          };\r\n        }\r\n        \r\n        // 4. Verificar conflictos con otros turnos (resto del cdigo igual)\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .where('especialistaIds', 'array-contains', especialistaId)\r\n          .get();\r\n        \r\n        const turnosConflictivos = snapshot.docs.filter(doc => {\r\n          if (turnoIdExcluir && doc.id === turnoIdExcluir) return false;\r\n          \r\n          const turnoExistente = doc.data();\r\n          const turnoHorario = turnoExistente.horarioInicio || turnoExistente.horario;\r\n          \r\n          if (!turnoHorario) return false;\r\n          \r\n          const [existenteHora, existenteMinuto] = turnoHorario.split(':').map(Number);\r\n          const existenteInicio = existenteHora * 60 + existenteMinuto;\r\n          const existenteFin = existenteInicio + (turnoExistente.duracionTotal || 30);\r\n          \r\n          // Verificar solapamiento\r\n          const haySolapamiento = (inicioMinutos < existenteFin && finMinutos > existenteInicio);\r\n          \r\n          if (haySolapamiento) {\r\n            console.log(` Conflicto con turno ${doc.id}: ${turnoHorario} (${existenteInicio}-${existenteFin}) vs ${horarioInicio} (${inicioMinutos}-${finMinutos})`);\r\n          }\r\n          \r\n          return haySolapamiento;\r\n        });\r\n        \r\n        if (turnosConflictivos.length > 0) {\r\n          const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n          return {\r\n            disponible: false,\r\n            mensaje: `${nombreEspecialista} tiene ${turnosConflictivos.length} turno(s) conflictivo(s) en ese horario`\r\n          };\r\n        }\r\n        \r\n        return { disponible: true, mensaje: null };\r\n        \r\n      } catch (error) {\r\n        console.error(\"Error en verificacin completa especialista:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad del especialista\"\r\n        };\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidadCompleta(nuevoTurno, turnoActual, turnoIdExcluir) {\r\n      try {\r\n        // Verificar disponibilidad para cada especialista\r\n        if (nuevoTurno.slotsPorEspecialista) {\r\n          for (const [especialistaId, slots] of Object.entries(nuevoTurno.slotsPorEspecialista)) {\r\n            if (slots.length === 0) continue;\r\n            \r\n            const primerSlot = slots[0];\r\n            const duracionTotal = slots.length * 30; // 30 minutos por slot\r\n            \r\n            // Verificar disponibilidad completa del especialista\r\n            const disponibilidad = await verificarDisponibilidadCompletaEspecialista(\r\n              especialistaId, \r\n              nuevoTurno.fecha, \r\n              primerSlot, \r\n              duracionTotal, \r\n              turnoIdExcluir\r\n            );\r\n            \r\n            if (!disponibilidad.disponible) {\r\n              return disponibilidad;\r\n            }\r\n          }\r\n        } else {\r\n          // Para turnos con un solo especialista (compatibilidad con versiones anteriores)\r\n          const especialistaId = turnoActual.especialistaId || (turnoActual.especialistaIds && turnoActual.especialistaIds[0]);\r\n          if (especialistaId) {\r\n            const duracionTotal = turnoActual.duracionTotal || 30;\r\n            const disponibilidad = await verificarDisponibilidadCompletaEspecialista(\r\n              especialistaId, \r\n              nuevoTurno.fecha, \r\n              nuevoTurno.horarioInicio, \r\n              duracionTotal, \r\n              turnoIdExcluir\r\n            );\r\n            \r\n            if (!disponibilidad.disponible) {\r\n              return disponibilidad;\r\n            }\r\n          }\r\n        }\r\n        \r\n        return { disponible: true, mensaje: null };\r\n        \r\n      } catch (error) {\r\n        console.error(\"Error en verificacin completa:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad: \" + error.message\r\n        };\r\n      }\r\n    }\r\n\r\n    async function guardarCambiosTurno() {\r\n      if (!currentTurnoId) {\r\n        console.error('currentTurnoId no definido');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const user = firebase.auth().currentUser;\r\n        if (!user) {\r\n          alert('Debes iniciar sesin para realizar esta accin');\r\n          return;\r\n        }\r\n\r\n        // Verificar si el usuario es administrador\r\n        const token = await user.getIdTokenResult();\r\n        const isAdmin = token.claims.admin === true || user.uid === ADMIN_UID;\r\n        \r\n        if (!isAdmin) {\r\n          alert('No tienes permisos de administrador para realizar esta accin');\r\n          return;\r\n        }\r\n\r\n        const config = await obtenerConfiguracion();\r\n        const nuevoHorario = document.getElementById('edit-horario').value;\r\n        const nuevaFecha = document.getElementById('edit-fecha').value;\r\n        \r\n        // Validar horario\r\n        const validacionHorario = validarHorario(nuevoHorario, config);\r\n        if (!validacionHorario.valido) {\r\n          alert(validacionHorario.mensaje);\r\n          return;\r\n        }\r\n        \r\n        // Crear fecha sin problemas de zona horaria\r\n        const [year, month, day] = nuevaFecha.split('-').map(Number);\r\n        const fechaObj = new Date(year, month - 1, day);\r\n        \r\n        // Obtener da de la semana (0=Domingo, 1=Lunes, ..., 6=Sbado)\r\n        const diaSemana = fechaObj.getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // OBTENER EL TURNO ACTUAL PRIMERO\r\n        const turnoDoc = await db.collection('turnos').doc(currentTurnoId).get();\r\n        if (!turnoDoc.exists) {\r\n          alert('El turno no existe');\r\n          return;\r\n        }\r\n\r\n        const turnoActual = turnoDoc.data();\r\n\r\n        //  NUEVA VALIDACIN: VERIFICAR DISPONIBILIDAD POR ESPECIALISTA\r\n        const especialistaIds = turnoActual.especialistaIds || [];\r\n        \r\n        if (especialistaIds.length > 0) {\r\n          let algunEspecialistaDisponible = false;\r\n          let mensajesError = [];\r\n          \r\n          for (const especialistaId of especialistaIds) {\r\n            const especialista = especialistasMap[especialistaId];\r\n            if (especialista && especialista.horarioLaboral) {\r\n              const horarioDia = especialista.horarioLaboral[diaKey];\r\n              \r\n              if (horarioDia && horarioDia.activo) {\r\n                algunEspecialistaDisponible = true;\r\n                console.log(` ${especialista.nombre} trabaja los ${diaKey}s`);\r\n                break; // Al menos uno trabaja, es suficiente\r\n              } else {\r\n                const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n                mensajesError.push(`${nombreEspecialista} no trabaja los ${diaKey}s`);\r\n              }\r\n            }\r\n          }\r\n          \r\n          if (!algunEspecialistaDisponible) {\r\n            alert(`No se puede agendar el turno:\\n${mensajesError.join('\\n')}`);\r\n            return;\r\n          }\r\n        } else {\r\n          //  VALIDACIN FALLBACK: Si no hay especialistas, usar configuracin general\r\n          // Pero primero ajustar el ndice para coincidir con tu configuracin\r\n          // (Tu configuracin usa 1=Lunes, 2=Martes, etc., mientras que getDay() usa 0=Domingo)\r\n          const diaSemanaConfig = diaSemana === 0 ? 7 : diaSemana; // Ajustar domingo de 0 a 7\r\n          \r\n          if (!config.diasLaborales.includes(diaSemanaConfig)) {\r\n            const diasNombres = ['Domingo', 'Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbado'];\r\n            alert(`No se pueden agendar turnos los ${diasNombres[diaSemana]}s`);\r\n            return;\r\n          }\r\n        }\r\n        \r\n        // CALCULAR EL DESPLAZAMIENTO TEMPORAL\r\n        const [nuevaHora, nuevoMinuto] = nuevoHorario.split(':').map(Number);\r\n        const [horaOriginal, minutoOriginal] = (turnoActual.horarioInicio || turnoActual.horario).split(':').map(Number);\r\n        \r\n        const desplazamientoMinutos = (nuevaHora * 60 + nuevoMinuto) - (horaOriginal * 60 + minutoOriginal);\r\n        \r\n        console.log(' Desplazamiento calculado:', desplazamientoMinutos, 'minutos');\r\n\r\n        // PREPARAR ACTUALIZACIN\r\n        const turnoActualizado = {\r\n          fecha: nuevaFecha,\r\n          horario: nuevoHorario,\r\n          horarioInicio: nuevoHorario,\r\n          actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n        };\r\n\r\n        // MANEJAR ESPECIALISTAS MLTIPLES - CORREGIDO\r\n        if (turnoActual.slotsPorEspecialista && Object.keys(turnoActual.slotsPorEspecialista).length > 1) {\r\n          console.log(' Turno con mltiples especialistas detectado');\r\n          \r\n          const nuevosSlotsPorEspecialista = {};\r\n          const nuevosServiciosPorEspecialista = {};\r\n          let todosLosSlots = [];\r\n          let horarioInicioGlobal = null;\r\n          let horarioFinGlobal = null;\r\n          \r\n          // Primero, encontrar el horario de inicio ms temprano entre todos los especialistas\r\n          Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n            const slots = turnoActual.slotsPorEspecialista[especialistaId];\r\n            if (slots && slots.length > 0) {\r\n              const primerSlot = slots[0];\r\n              if (!horarioInicioGlobal || primerSlot < horarioInicioGlobal) {\r\n                horarioInicioGlobal = primerSlot;\r\n              }\r\n            }\r\n          });\r\n          \r\n          // Calcular el desplazamiento basado en el horario global\r\n          const [horaInicioGlobal, minutoInicioGlobal] = horarioInicioGlobal.split(':').map(Number);\r\n          const minutosInicioGlobal = horaInicioGlobal * 60 + minutoInicioGlobal;\r\n          const minutosNuevoInicio = minutosInicioGlobal + desplazamientoMinutos;\r\n          \r\n          // Procesar cada especialista manteniendo la secuencia temporal RELATIVA\r\n          Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n            const slotsOriginales = turnoActual.slotsPorEspecialista[especialistaId];\r\n            \r\n            if (slotsOriginales && slotsOriginales.length > 0) {\r\n              // Calcular el desplazamiento relativo de este especialista\r\n              const primerSlotOriginal = slotsOriginales[0];\r\n              const [horaSlot, minutoSlot] = primerSlotOriginal.split(':').map(Number);\r\n              const minutosSlotOriginal = horaSlot * 60 + minutoSlot;\r\n              const desplazamientoRelativo = minutosSlotOriginal - minutosInicioGlobal;\r\n              \r\n              // Aplicar desplazamiento global + relativo\r\n              const minutosNuevoSlot = minutosNuevoInicio + desplazamientoRelativo;\r\n              const nuevaHoraSlot = Math.floor(minutosNuevoSlot / 60);\r\n              const nuevoMinutoSlot = minutosNuevoSlot % 60;\r\n              const nuevoPrimerSlot = `${nuevaHoraSlot.toString().padStart(2, '0')}:${nuevoMinutoSlot.toString().padStart(2, '0')}`;\r\n              \r\n              // Calcular todos los slots para este especialista\r\n              const nuevosSlotsEspecialista = [];\r\n              for (let i = 0; i < slotsOriginales.length; i++) {\r\n                const slotMinutos = minutosNuevoSlot + (i * 30);\r\n                const slotHora = Math.floor(slotMinutos / 60);\r\n                const slotMinuto = slotMinutos % 60;\r\n                const nuevoSlot = `${slotHora.toString().padStart(2, '0')}:${slotMinuto.toString().padStart(2, '0')}`;\r\n                nuevosSlotsEspecialista.push(nuevoSlot);\r\n                todosLosSlots.push(nuevoSlot);\r\n                \r\n                // Actualizar horario fin global\r\n                const slotFinMinutos = slotMinutos + 30;\r\n                if (!horarioFinGlobal || slotFinMinutos > horarioFinGlobal) {\r\n                  horarioFinGlobal = slotFinMinutos;\r\n                }\r\n              }\r\n              \r\n              nuevosSlotsPorEspecialista[especialistaId] = nuevosSlotsEspecialista;\r\n              \r\n              // Preservar servicios por especialista\r\n              if (turnoActual.serviciosPorEspecialista && turnoActual.serviciosPorEspecialista[especialistaId]) {\r\n                nuevosServiciosPorEspecialista[especialistaId] = turnoActual.serviciosPorEspecialista[especialistaId];\r\n              }\r\n              \r\n              console.log(` Especialista ${especialistaId}: ${slotsOriginales[0]}  ${nuevoPrimerSlot}`);\r\n            }\r\n          });\r\n          \r\n          // Calcular nuevo horario de fin\r\n          const horaFinGlobal = Math.floor(horarioFinGlobal / 60);\r\n          const minutoFinGlobal = horarioFinGlobal % 60;\r\n          const nuevoHorarioFin = `${horaFinGlobal.toString().padStart(2, '0')}:${minutoFinGlobal.toString().padStart(2, '0')}`;\r\n          \r\n          // Eliminar duplicados y ordenar slots\r\n          todosLosSlots = [...new Set(todosLosSlots)].sort();\r\n          \r\n          turnoActualizado.slotsPorEspecialista = nuevosSlotsPorEspecialista;\r\n          turnoActualizado.slotsOcupados = todosLosSlots;\r\n          turnoActualizado.horarioFin = nuevoHorarioFin;\r\n          \r\n          if (Object.keys(nuevosServiciosPorEspecialista).length > 0) {\r\n            turnoActualizado.serviciosPorEspecialista = nuevosServiciosPorEspecialista;\r\n          }\r\n          \r\n          console.log(' Slots actualizados para mltiples especialistas:', nuevosSlotsPorEspecialista);\r\n          console.log(' Nuevo horario fin:', nuevoHorarioFin);\r\n          \r\n        } else {\r\n          // COMPORTAMIENTO ORIGINAL PARA UN SOLO ESPECIALISTA\r\n          const duracionTotal = turnoActual.duracionTotal || 30;\r\n          \r\n          // Convertir horario a minutos para calcular fin\r\n          const [hora, minuto] = nuevoHorario.split(':').map(Number);\r\n          const inicioMinutos = hora * 60 + minuto;\r\n          const finMinutos = inicioMinutos + duracionTotal;\r\n          const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n          const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n          const nuevoHorarioFin = `${horaFin}:${minutoFin}`;\r\n\r\n          // Calcular nuevos slots ocupados\r\n          const nuevosSlotsOcupados = [];\r\n          for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            nuevosSlotsOcupados.push(`${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`);\r\n          }\r\n\r\n          turnoActualizado.horarioFin = nuevoHorarioFin;\r\n          turnoActualizado.slotsOcupados = nuevosSlotsOcupados;\r\n          \r\n          // Actualizar slots por especialista si existe\r\n          if (turnoActual.slotsPorEspecialista) {\r\n            const nuevosSlotsPorEspecialista = {};\r\n            Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n              nuevosSlotsPorEspecialista[especialistaId] = nuevosSlotsOcupados;\r\n            });\r\n            turnoActualizado.slotsPorEspecialista = nuevosSlotsPorEspecialista;\r\n          }\r\n        }\r\n\r\n        // VERIFICAR DISPONIBILIDAD COMPLETA (no por slots individuales)\r\n        const disponibilidad = await verificarDisponibilidadCompleta(turnoActualizado, turnoActual, currentTurnoId);\r\n        if (!disponibilidad.disponible) {\r\n          alert(disponibilidad.mensaje);\r\n          return;\r\n        }\r\n\r\n        console.log(' Actualizando turno:', currentTurnoId, 'con:', turnoActualizado);\r\n        \r\n        // ACTUALIZAR EN FIRESTORE\r\n        await db.collection('turnos').doc(currentTurnoId).update(turnoActualizado);\r\n        console.log(' Turno actualizado en Firestore');\r\n        \r\n        // ACTUALIZAR VISTAS\r\n        await loadTurnosForDate(nuevaFecha);\r\n\r\n        if (calendar) {\r\n          //  SOLUCIN MEJORADA: Forzar recarga completa de la vista actual\r\n          await recargarVistaCalendario();\r\n        }\r\n        \r\n        if (calendar) {\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n        // Cerrar modal\r\n        elements.modalEditar.style.display = 'none';\r\n        \r\n        mostrarMensajeExito('Turno actualizado correctamente');\r\n        \r\n      } catch (error) {\r\n        console.error(\" Error actualizando turno:\", error);\r\n        alert(\"Error al actualizar el turno: \" + error.message);\r\n      }\r\n    }\r\n\r\n    async function eliminarTurno(turnoId) {\r\n      // Validacin mejorada del ID\r\n      if (!turnoId || typeof turnoId !== 'string') {\r\n        console.error('ID de turno invlido:', turnoId);\r\n        return false;\r\n      }\r\n\r\n      try {\r\n        console.log(' Iniciando eliminacin para ID:', turnoId);\r\n        \r\n        // Obtener la fecha del turno antes de eliminarlo\r\n        const doc = await db.collection('turnos').doc(turnoId).get();\r\n        if (!doc.exists) {\r\n          alert('El turno ya no existe');\r\n          return false;\r\n        }\r\n        \r\n        const turnoData = doc.data();\r\n        const fechaTurno = turnoData.fecha;\r\n        \r\n        console.log(' Datos del turno a eliminar:', turnoData);\r\n        \r\n        // Eliminar el documento\r\n        await db.collection('turnos').doc(turnoId).delete();\r\n        console.log(' Turno eliminado de Firestore');\r\n        \r\n        // Actualizar la vista del calendario\r\n        if (calendar) {\r\n          console.log(' Actualizando calendario...');\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n        // Actualizar la lista de turnos\r\n        console.log(' Actualizando lista de turnos para fecha:', fechaTurno);\r\n        await loadTurnosForDate(fechaTurno);\r\n        \r\n        // Cerrar modal si est abierto\r\n        if (elements.modalEditar && elements.modalEditar.style.display === 'block') {\r\n          elements.modalEditar.style.display = 'none';\r\n          console.log(' Modal cerrado');\r\n        }\r\n        \r\n        // Mostrar mensaje de xito\r\n        mostrarMensajeExito('Turno eliminado correctamente');\r\n        \r\n        return true;\r\n      } catch (error) {\r\n        console.error(' Error al eliminar:', error);\r\n        \r\n        // Mensajes de error ms especficos\r\n        let mensajeError = 'Error al eliminar el turno';\r\n        if (error.code === 'permission-denied') {\r\n          mensajeError = 'No tienes permisos para eliminar turnos';\r\n        } else if (error.code === 'not-found') {\r\n          mensajeError = 'El turno ya no existe';\r\n        }\r\n        \r\n        alert(mensajeError + ': ' + (error.message || 'Por favor intente nuevamente'));\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 10. FUNCIONES DE SERVICIOS Y UTILIDADES\r\n    // =============================================\r\n    function obtenerNombresServicios(serviciosIds) {\r\n      if (!Array.isArray(serviciosIds) || serviciosIds.length === 0) {\r\n        return 'Servicios no especificados';\r\n      }\r\n      \r\n      const nombres = serviciosIds.map(servicioId => {\r\n        const servicio = serviciosMap[servicioId];\r\n        return servicio ? servicio.nombre : servicioId; // Si no encuentra, muestra el ID\r\n      });\r\n      \r\n      return nombres.join(', ');\r\n    }\r\n\r\n    function setupModalEvents() {\r\n      const modal = document.getElementById('modal-editar');\r\n      const btnEliminar = document.getElementById('btn-eliminar-modal');\r\n      \r\n      if (btnEliminar) {\r\n        // Limpiar eventos previos completamente\r\n        btnEliminar.replaceWith(btnEliminar.cloneNode(true));\r\n        const newBtnEliminar = document.getElementById('btn-eliminar-modal');\r\n        \r\n        newBtnEliminar.addEventListener('click', async (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          \r\n          console.log(' Botn eliminar clickeado, currentTurnoId:', currentTurnoId);\r\n          \r\n          if (!currentTurnoId) {\r\n            console.error(' No hay turno seleccionado para eliminar');\r\n            alert('No hay turno seleccionado para eliminar');\r\n            return;\r\n          }\r\n\r\n          if (confirm('Ests seguro de eliminar este turno permanentemente? Esta accin no se puede deshacer.')) {\r\n            console.log(' Confirmacin recibida, eliminando turno:', currentTurnoId);\r\n            \r\n            const loadingIndicator = mostrarLoading();\r\n            try {\r\n              const success = await eliminarTurno(currentTurnoId);\r\n              if (success) {\r\n                console.log(' Eliminacin completada exitosamente');\r\n                // El modal se cierra dentro de eliminarTurno\r\n              } else {\r\n                console.error(' Eliminacin fall');\r\n              }\r\n            } catch (error) {\r\n              console.error(' Error en eliminacin:', error);\r\n            } finally {\r\n              loadingIndicator.remove();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 11. INICIALIZACIN DE NAVEGACIN (al final)\r\n    // =============================================\r\n    document.addEventListener('DOMContentLoaded', function() {\r\n        // Inicializar despus de un pequeo delay para asegurar que todo est cargado\r\n        setTimeout(() => {\r\n            inicializarNavegacionAdmin();\r\n        }, 100);\r\n    });\r\n\r\n    window.addEventListener('load', inicializarNavegacionCuandoPanelListo);\r\n\r\n    // =============================================\r\n    // 12. FUNCIONES DE GESTIN DE SERVICIOS\r\n    // =============================================\r\n\r\n    let categoriasMap = {};\r\n\r\n    // Inicializar gestin de servicios\r\n    function inicializarGestionServicios() {\r\n        console.log(' Inicializando gestin de servicios...');\r\n        \r\n        // Configurar evento del botn agregar servicio\r\n        const btnAgregarServicio = document.getElementById('btn-agregar-servicio');\r\n        if (btnAgregarServicio) {\r\n            btnAgregarServicio.addEventListener('click', () => {\r\n                abrirModalServicio();\r\n            });\r\n        }\r\n        \r\n        // Cargar servicios y categoras\r\n        cargarServiciosYMostrar();\r\n        \r\n        // Configurar modal de servicio\r\n        configurarModalServicio();\r\n    }\r\n\r\n    // Cargar servicios y categoras desde Firestore\r\n    async function cargarServiciosYMostrar() {\r\n        try {\r\n            console.log(' Cargando servicios y categoras...');\r\n            \r\n            // Cargar en paralelo\r\n            const [serviciosSnapshot, categoriasSnapshot] = await Promise.all([\r\n                db.collection('servicios').orderBy('orden').get(),\r\n                db.collection('categorias').orderBy('orden').get()\r\n            ]);\r\n            \r\n            // Mapear categoras\r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            // Mapear servicios - USAR EL ID DEL DOCUMENTO\r\n            serviciosMap = {};\r\n            serviciosSnapshot.forEach(doc => {\r\n                serviciosMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Cargados ${serviciosSnapshot.size} servicios y ${categoriasSnapshot.size} categoras`);\r\n            console.log(' IDs de servicios:', Object.keys(serviciosMap));\r\n            \r\n            // Mostrar en la interfaz\r\n            mostrarServiciosEnUI();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando servicios:', error);\r\n            mostrarMensajeError('Error al cargar los servicios');\r\n        }\r\n    }\r\n\r\n    // Mostrar servicios agrupados por categora en la UI\r\n    function mostrarServiciosEnUI() {\r\n        const serviciosList = document.getElementById('servicios-list');\r\n        if (!serviciosList) return;\r\n        \r\n        // Agrupar servicios por categora\r\n        const serviciosPorCategoria = {};\r\n        \r\n        Object.values(serviciosMap).forEach(servicio => {\r\n            const categoriaId = servicio.categoriaId;\r\n            if (!serviciosPorCategoria[categoriaId]) {\r\n                serviciosPorCategoria[categoriaId] = [];\r\n            }\r\n            serviciosPorCategoria[categoriaId].push(servicio);\r\n        });\r\n        \r\n        // Crear HTML\r\n        let html = '';\r\n        \r\n        Object.keys(categoriasMap).forEach(categoriaId => {\r\n            const categoria = categoriasMap[categoriaId];\r\n            const servicios = serviciosPorCategoria[categoriaId] || [];\r\n            \r\n            if (servicios.length === 0) return; // No mostrar categoras vacas\r\n            \r\n            html += `\r\n                <div class=\"categoria\">\r\n                    <h2>${categoria.nombre}</h2>\r\n                    <div class=\"servicios\">\r\n                        ${servicios.map(servicio => crearHTMLServicio(servicio)).join('')}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        });\r\n        \r\n        serviciosList.innerHTML = html || '<p class=\"sin-servicios\">No hay servicios cargados</p>';\r\n        \r\n        // Configurar eventos de los botones\r\n        configurarEventosServicios();\r\n    }\r\n\r\n    // Crear HTML para un servicio individual\r\n    function crearHTMLServicio(servicio) {\r\n        const precioFormateado = formatearPrecio(servicio.precio);\r\n        const duracionFormateada = formatearDuracionAdmin(servicio.duracion);\r\n        \r\n        return `\r\n            <div class=\"servicio\" data-servicio-id=\"${servicio.id}\">\r\n                <h3>${servicio.nombre}</h3>\r\n                \r\n                <div class=\"mediaq-servicio\">\r\n                    <p class=\"precio-servicio\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#3e843a\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2\" />\r\n                            <path d=\"M12 3v3m0 12v3\" />\r\n                        </svg>\r\n                        <span>${precioFormateado}</span>\r\n                    </p>\r\n\r\n                    <p class=\"duracion-servicio\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#667dc4\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                            <path d=\"M12 12h3.5\" />\r\n                            <path d=\"M12 7v5\" />\r\n                        </svg>\r\n                        <span>${duracionFormateada}</span>\r\n                    </p>\r\n\r\n                    <p class=\"activo-servicio\">\r\n                        <span>Activo:</span>\r\n                        ${servicio.activo ? \r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#35c522\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                                <path d=\"M9 12l2 2l4 -4\" />\r\n                            </svg>` :\r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#d71919\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M18 6l-12 12\" />\r\n                                <path d=\"M6 6l12 12\" />\r\n                            </svg>`\r\n                        }\r\n                    </p>\r\n                    \r\n                    <p class=\"promo-servicio\">\r\n                        <span>Promo:</span>\r\n                        ${servicio.promo ? \r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#9328a9ff\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1\" />\r\n                                <path d=\"M9 12l2 2l4 -4\" />\r\n                            </svg>` :\r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#d71919\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M18 6l-12 12\" />\r\n                                <path d=\"M6 6l12 12\" />\r\n                            </svg>`\r\n                        }\r\n                    </p>\r\n                </div>\r\n\r\n                <div class=\"acciones-servicio\">\r\n                    <button class=\"btn-editar-servicio\" data-servicio-id=\"${servicio.id}\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1\" />\r\n                            <path d=\"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z\" />\r\n                            <path d=\"M16 5l3 3\" />\r\n                        </svg>\r\n                    </button>\r\n\r\n                    <button class=\"btn-eliminar-servicio\" data-servicio-id=\"${servicio.id}\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M4 7l16 0\" />\r\n                            <path d=\"M10 11l0 6\" />\r\n                            <path d=\"M14 11l0 6\" />\r\n                            <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\" />\r\n                            <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\" />\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Configurar eventos para los botones de servicios\r\n    function configurarEventosServicios() {\r\n        // Botones editar\r\n        document.querySelectorAll('.btn-editar-servicio').forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                const servicioId = e.currentTarget.getAttribute('data-servicio-id');\r\n                abrirModalServicio(servicioId);\r\n            });\r\n        });\r\n        \r\n        // Botones eliminar\r\n        document.querySelectorAll('.btn-eliminar-servicio').forEach(btn => {\r\n            btn.addEventListener('click', async (e) => {\r\n                const servicioId = e.currentTarget.getAttribute('data-servicio-id');\r\n                await eliminarServicio(servicioId);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Configurar modal de servicio\r\n    function configurarModalServicio() {\r\n        const modal = document.getElementById('modal-servicio');\r\n        const form = document.getElementById('form-servicio');\r\n        const closeBtn = modal.querySelector('.close-modal');\r\n        \r\n        if (!modal || !form) return;\r\n        \r\n        // Cerrar modal\r\n        closeBtn.addEventListener('click', () => {\r\n            modal.style.display = 'none';\r\n        });\r\n        \r\n        // Cerrar al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === modal) {\r\n                modal.style.display = 'none';\r\n            }\r\n        });\r\n        \r\n        // Enviar formulario\r\n        form.addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n            await guardarServicio();\r\n        });\r\n        \r\n        // Cargar categoras en el select\r\n        cargarCategoriasEnSelect();\r\n    }\r\n\r\n    // Cargar categoras en el select del modal\r\n    async function cargarCategoriasEnSelect() {\r\n        const select = document.getElementById('servicio-categoria');\r\n        if (!select) {\r\n            console.error(' No se encontr el select de categoras');\r\n            return;\r\n        }\r\n        \r\n        // Si ya tenemos categoras cargadas, usarlas\r\n        if (Object.keys(categoriasMap).length > 0) {\r\n            console.log(' Usando categoras ya cargadas:', Object.keys(categoriasMap).length);\r\n            llenarSelectConCategorias(select);\r\n            return;\r\n        }\r\n        \r\n        // Si no hay categoras, cargarlas desde Firestore\r\n        try {\r\n            console.log(' Cargando categoras desde Firestore...');\r\n            const categoriasSnapshot = await db.collection('categorias').orderBy('orden').get();\r\n            \r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Categoras cargadas: ${categoriasSnapshot.size}`);\r\n            llenarSelectConCategorias(select);\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando categoras:', error);\r\n            select.innerHTML = '<option value=\"\">Error al cargar categoras</option>';\r\n        }\r\n    }\r\n\r\n    // Funcin auxiliar para llenar el select\r\n    function llenarSelectConCategorias(select) {\r\n        select.innerHTML = '<option value=\"\">Selecciona una categora</option>';\r\n        \r\n        Object.values(categoriasMap)\r\n            .sort((a, b) => (a.orden || 0) - (b.orden || 0))\r\n            .forEach(categoria => {\r\n                const option = document.createElement('option');\r\n                option.value = categoria.id;\r\n                option.textContent = categoria.nombre;\r\n                select.appendChild(option);\r\n            });\r\n        \r\n        console.log(` Select de categoras llenado con ${Object.keys(categoriasMap).length} opciones`);\r\n    }\r\n\r\n    // Abrir modal para crear/editar servicio\r\n    async function abrirModalServicio(servicioId = null) {\r\n        const modal = document.getElementById('modal-servicio');\r\n        const titulo = document.getElementById('modal-servicio-titulo');\r\n        const form = document.getElementById('form-servicio');\r\n        \r\n        if (!modal || !titulo || !form) return;\r\n        \r\n        // Resetear formulario PERO mantener las categoras cargadas\r\n        form.reset();\r\n        \r\n        // Asegurar que las categoras estn cargadas en el select\r\n        await cargarCategoriasEnSelect();\r\n        \r\n        if (servicioId) {\r\n            // Modo edicin\r\n            titulo.textContent = 'Editar Servicio';\r\n            document.getElementById('servicio-id').value = servicioId;\r\n            \r\n            const servicio = serviciosMap[servicioId];\r\n            if (servicio) {\r\n                document.getElementById('servicio-nombre').value = servicio.nombre || '';\r\n                document.getElementById('servicio-categoria').value = servicio.categoriaId || '';\r\n                document.getElementById('servicio-descripcion').value = servicio.descripcion || '';\r\n                document.getElementById('servicio-duracion').value = servicio.duracion || 30;\r\n                document.getElementById('servicio-precio').value = servicio.precio || '';\r\n                document.getElementById('servicio-activo').checked = servicio.activo !== false;\r\n                document.getElementById('servicio-promo').checked = servicio.promo === true; //  Campo promo\r\n                \r\n                console.log(` Campos establecidos para edicin - Promo: ${servicio.promo}`);\r\n            }\r\n        } else {\r\n            // Modo creacin\r\n            titulo.textContent = 'Crear Servicio';\r\n            document.getElementById('servicio-id').value = '';\r\n            document.getElementById('servicio-activo').checked = true;\r\n            document.getElementById('servicio-promo').checked = false; //  Promo false por defecto\r\n        }\r\n        \r\n        modal.style.display = 'block';\r\n    }\r\n\r\n    // Guardar servicio (crear o actualizar)\r\n    async function guardarServicio() {\r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            const servicioId = document.getElementById('servicio-id').value;\r\n            const servicioData = {\r\n                nombre: document.getElementById('servicio-nombre').value.trim(),\r\n                categoriaId: document.getElementById('servicio-categoria').value,\r\n                descripcion: document.getElementById('servicio-descripcion').value.trim(),\r\n                duracion: parseInt(document.getElementById('servicio-duracion').value),\r\n                precio: parseInt(document.getElementById('servicio-precio').value),\r\n                activo: document.getElementById('servicio-activo').checked,\r\n                promo: document.getElementById('servicio-promo').checked,\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            };\r\n            \r\n            // Validaciones bsicas\r\n            if (!servicioData.nombre) {\r\n                throw new Error('El nombre es obligatorio');\r\n            }\r\n            if (!servicioData.categoriaId) {\r\n                throw new Error('La categora es obligatoria');\r\n            }\r\n            if (isNaN(servicioData.duracion) || servicioData.duracion < 1) {\r\n                throw new Error('La duracin debe ser un nmero mayor a 0');\r\n            }\r\n            if (isNaN(servicioData.precio) || servicioData.precio < 0) {\r\n                throw new Error('El precio debe ser un nmero no negativo');\r\n            }\r\n            \r\n            if (servicioId) {\r\n                // Actualizar servicio existente\r\n                console.log(` Actualizando servicio: ${servicioId}`, servicioData);\r\n                await db.collection('servicios').doc(servicioId).update(servicioData);\r\n                mostrarMensajeExito('Servicio actualizado correctamente');\r\n            } else {\r\n                // Crear nuevo servicio CON ID PERSONALIZADO\r\n                const nuevoId = generarIdServicio(servicioData.nombre);\r\n                \r\n                // Verificar que el ID no exista\r\n                const idUnico = await verificarIdUnico('servicios', nuevoId);\r\n                if (!idUnico) {\r\n                    throw new Error(`Ya existe un servicio con un nombre similar. El ID \"${nuevoId}\" ya est en uso.`);\r\n                }\r\n                \r\n                servicioData.creadoEl = firebase.firestore.FieldValue.serverTimestamp();\r\n                servicioData.orden = Object.keys(serviciosMap).length + 1;\r\n                servicioData.id = nuevoId; // Tambin guardar el ID en los datos\r\n                \r\n                console.log(' Creando nuevo servicio con ID:', nuevoId, servicioData);\r\n                await db.collection('servicios').doc(nuevoId).set(servicioData);\r\n                mostrarMensajeExito('Servicio creado correctamente');\r\n            }\r\n            \r\n            // Recargar servicios\r\n            await cargarServiciosYMostrar();\r\n            \r\n            // Cerrar modal\r\n            document.getElementById('modal-servicio').style.display = 'none';\r\n            \r\n        } catch (error) {\r\n            console.error(' Error guardando servicio:', error);\r\n            mostrarMensajeError(error.message || 'Error al guardar el servicio');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Eliminar servicio\r\n    async function eliminarServicio(servicioId) {\r\n        if (!servicioId) return;\r\n        \r\n        const servicio = serviciosMap[servicioId];\r\n        if (!servicio) return;\r\n        \r\n        if (!confirm(`Ests seguro de eliminar el servicio \"${servicio.nombre}\"? Esta accin no se puede deshacer.`)) {\r\n            return;\r\n        }\r\n        \r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            await db.collection('servicios').doc(servicioId).delete();\r\n            mostrarMensajeExito('Servicio eliminado correctamente');\r\n            \r\n            // Recargar servicios\r\n            await cargarServiciosYMostrar();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error eliminando servicio:', error);\r\n            mostrarMensajeError('Error al eliminar el servicio');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Funciones de utilidad para servicios\r\n    function formatearPrecio(precio) {\r\n        // Formatear sin decimales y con separador de miles\r\n        return new Intl.NumberFormat('es-AR', {\r\n            minimumFractionDigits: 0,\r\n            maximumFractionDigits: 0\r\n        }).format(precio);\r\n    }\r\n\r\n    function formatearDuracionAdmin(minutos) {\r\n        const horas = Math.floor(minutos / 60);\r\n        const mins = minutos % 60;\r\n        \r\n        if (horas === 0) {\r\n            // Menos de 1 hora: \"30 min\"\r\n            return `${minutos} min`;\r\n        } else if (mins === 0) {\r\n            // Horas exactas: \"1 hora\", \"2 horas\"\r\n            return `${horas} ${horas === 1 ? 'hora' : 'horas'}`;\r\n        } else {\r\n            // Horas y minutos: \"1 h 30 m\", \"2 h 30 m\"\r\n            return `${horas} h ${mins} m`;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // 15. FUNCIONES DE GESTIN DE PERSONAL\r\n    // =============================================\r\n\r\n    // Variables globales para personal\r\n    let personalMap = {};\r\n\r\n    // Inicializar gestin de personal\r\n    function inicializarGestionPersonal() {\r\n        console.log(' Inicializando gestin de personal...');\r\n        \r\n        // Configurar evento del botn agregar personal\r\n        const btnAgregarPersonal = document.getElementById('btn-agregar-personal');\r\n        if (btnAgregarPersonal) {\r\n            btnAgregarPersonal.addEventListener('click', () => {\r\n                abrirModalPersonal();\r\n            });\r\n        }\r\n        \r\n        // Cargar personal\r\n        cargarPersonalYMostrar();\r\n        \r\n        // Configurar modal de personal\r\n        configurarModalPersonal();\r\n    }\r\n\r\n    // Cargar personal desde Firestore\r\n    async function cargarPersonalYMostrar() {\r\n        try {\r\n            console.log(' Cargando personal...');\r\n            \r\n            const personalSnapshot = await db.collection('especialistas')\r\n                .where('activo', '==', true)\r\n                .orderBy('orden')\r\n                .get();\r\n            \r\n            personalMap = {};\r\n            personalSnapshot.forEach(doc => {\r\n                personalMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Cargados ${personalSnapshot.size} especialistas`);\r\n            console.log(' IDs de personal:', Object.keys(personalMap));\r\n            \r\n            // Mostrar en la interfaz\r\n            mostrarPersonalEnUI();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando personal:', error);\r\n            mostrarMensajeError('Error al cargar el personal');\r\n        }\r\n    }\r\n\r\n    // Mostrar personal en la UI\r\n    function mostrarPersonalEnUI() {\r\n        const personalList = document.getElementById('personal-list');\r\n        if (!personalList) return;\r\n        \r\n        if (Object.keys(personalMap).length === 0) {\r\n            personalList.innerHTML = '<p class=\"sin-personal\">No hay personal cargado</p>';\r\n            return;\r\n        }\r\n        \r\n        let html = '';\r\n        \r\n        Object.values(personalMap).forEach(personal => {\r\n            html += crearHTMLPersonal(personal);\r\n        });\r\n        \r\n        personalList.innerHTML = html;\r\n        \r\n        // Configurar eventos de los botones\r\n        configurarEventosPersonal();\r\n    }\r\n\r\n    // Crear HTML para un miembro del personal\r\n    function crearHTMLPersonal(personal) {\r\n        const diasLaborales = obtenerDiasLaborales(personal.horarioLaboral);\r\n        \r\n        return `\r\n            <div class=\"personal\" data-personal-id=\"${personal.id}\">\r\n                <div class=\"personal-identidad\">\r\n                    <img src=\"${personal.fotoUrl || ''}\" alt=\"Imagen del Empleado\" onerror=\"this.style.display='none'\">\r\n                    <h3>${personal.nombre}</h3>\r\n                </div>\r\n\r\n                <div class=\"contenedor-datos-personal\">\r\n                    <div class=\"contenedor-centro-datos\">\r\n                        <div class=\"personal-datos\">\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                                </svg>\r\n                                <span>${personal.telefono || 'No especificado'}</span>\r\n                            </p>\r\n\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z\" />\r\n                                    <path d=\"M3 7l9 6l9 -6\" />\r\n                                </svg>\r\n                                <span>${personal.email || 'No especificado'}</span>\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div class=\"personal-disponibilidad\">\r\n                            <p>\r\n                                <span>Activo:</span>\r\n                                ${personal.activo ? \r\n                                    `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                        <path d=\"M5 12l5 5l10 -10\" />\r\n                                    </svg>` :\r\n                                    `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                        <path d=\"M18 6l-12 12\" />\r\n                                        <path d=\"M6 6l12 12\" />\r\n                                    </svg>`\r\n                                }\r\n                            </p>\r\n\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z\" />\r\n                                    <path d=\"M16 3v4\" />\r\n                                    <path d=\"M8 3v4\" />\r\n                                    <path d=\"M4 11h16\" />\r\n                                    <path d=\"M7 14h.013\" />\r\n                                    <path d=\"M10.01 14h.005\" />\r\n                                    <path d=\"M13.01 14h.005\" />\r\n                                    <path d=\"M16.015 14h.005\" />\r\n                                    <path d=\"M13.015 17h.005\" />\r\n                                    <path d=\"M7.01 17h.005\" />\r\n                                    <path d=\"M10.01 17h.005\" />\r\n                                </svg>\r\n                                <span>${diasLaborales}</span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"acciones-personal\">\r\n                        <button class=\"btn-editar-personal\" data-personal-id=\"${personal.id}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1\" />\r\n                                <path d=\"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z\" />\r\n                                <path d=\"M16 5l3 3\" />\r\n                            </svg>\r\n                        </button>\r\n    \r\n                        <button class=\"btn-eliminar-personal\" data-personal-id=\"${personal.id}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M4 7l16 0\" />\r\n                                <path d=\"M10 11l0 6\" />\r\n                                <path d=\"M14 11l0 6\" />\r\n                                <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\" />\r\n                                <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Obtener das laborales formateados\r\n    function obtenerDiasLaborales(horarioLaboral) {\r\n        if (!horarioLaboral) return 'No definido';\r\n        \r\n        const dias = {\r\n            lunes: 'L',\r\n            martes: 'M',\r\n            miercoles: 'M',\r\n            jueves: 'J',\r\n            viernes: 'V',\r\n            sabado: 'S',\r\n            domingo: 'D'\r\n        };\r\n        \r\n        const diasActivos = [];\r\n        \r\n        for (const [dia, config] of Object.entries(horarioLaboral)) {\r\n            if (config && config.activo) {\r\n                diasActivos.push(dias[dia] || dia.charAt(0).toUpperCase());\r\n            }\r\n        }\r\n        \r\n        return diasActivos.join(' - ') || 'No definido';\r\n    }\r\n\r\n    // Configurar eventos para los botones de personal\r\n    function configurarEventosPersonal() {\r\n        // Botones editar\r\n        document.querySelectorAll('.btn-editar-personal').forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                const personalId = e.currentTarget.getAttribute('data-personal-id');\r\n                abrirModalPersonal(personalId);\r\n            });\r\n        });\r\n        \r\n        // Botones eliminar\r\n        document.querySelectorAll('.btn-eliminar-personal').forEach(btn => {\r\n            btn.addEventListener('click', async (e) => {\r\n                const personalId = e.currentTarget.getAttribute('data-personal-id');\r\n                await eliminarPersonal(personalId);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Configurar modal de personal\r\n    function configurarModalPersonal() {\r\n        const modal = document.getElementById('modal-personal');\r\n        const form = document.getElementById('form-personal');\r\n        const closeBtn = modal.querySelector('.close-modal');\r\n        \r\n        if (!modal || !form) return;\r\n        \r\n        // Cerrar modal\r\n        closeBtn.addEventListener('click', () => {\r\n            modal.style.display = 'none';\r\n        });\r\n        \r\n        // Cerrar al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === modal) {\r\n                modal.style.display = 'none';\r\n            }\r\n        });\r\n        \r\n        // Enviar formulario\r\n        form.addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n            await guardarPersonal();\r\n        });\r\n        \r\n        // Cargar checkboxes de categoras\r\n        cargarCategoriasCheckboxesPersonal();\r\n        \r\n        //  CONFIGURAR UPLOADER DE IMAGEN\r\n        configurarUploaderImagen();\r\n    }\r\n\r\n    // Cargar categoras en checkboxs de personal\r\n    async function cargarCategoriasCheckboxesPersonal() {\r\n        const contenedorCheckboxes = document.getElementById('personal-categorias-checkboxes');\r\n        if (!contenedorCheckboxes) {\r\n            console.error(' No se encontr el contenedor de checkboxes de categoras');\r\n            return;\r\n        }\r\n        \r\n        // Limpiar contenedor\r\n        contenedorCheckboxes.innerHTML = '';\r\n        \r\n        // Si ya tenemos categoras cargadas, usarlas\r\n        if (Object.keys(categoriasMap).length > 0) {\r\n            llenarCheckboxesConCategorias(contenedorCheckboxes);\r\n            return;\r\n        }\r\n        \r\n        // Si no hay categoras, cargarlas desde Firestore\r\n        try {\r\n            const categoriasSnapshot = await db.collection('categorias').orderBy('orden').get();\r\n            \r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            llenarCheckboxesConCategorias(contenedorCheckboxes);\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando categoras para personal:', error);\r\n            contenedorCheckboxes.innerHTML = '<p>Error al cargar categoras</p>';\r\n        }\r\n    }\r\n\r\n    // Llenar checkboxes con categoras\r\n    function llenarCheckboxesConCategorias(contenedor) {\r\n        const categoriasOrdenadas = Object.values(categoriasMap)\r\n            .sort((a, b) => (a.orden || 0) - (b.orden || 0));\r\n        \r\n        if (categoriasOrdenadas.length === 0) {\r\n            contenedor.innerHTML = '<p>No hay categoras disponibles</p>';\r\n            return;\r\n        }\r\n        \r\n        let html = '<div class=\"categorias-checkboxes-grid\">';\r\n        \r\n        categoriasOrdenadas.forEach(categoria => {\r\n            html += `\r\n                <div class=\"checkbox-categoria-item\">\r\n                    <label class=\"checkbox-categoria-label\">\r\n                        <input type=\"checkbox\" \r\n                              name=\"personal-categorias\" \r\n                              value=\"${categoria.id}\" \r\n                              class=\"checkbox-categoria\">\r\n                        <span class=\"checkbox-custom\"></span>\r\n                        <span class=\"checkbox-text\">${categoria.nombre}</span>\r\n                    </label>\r\n                </div>\r\n            `;\r\n        });\r\n        \r\n        html += '</div>';\r\n        contenedor.innerHTML = html;\r\n        \r\n        console.log(` Checkboxes de categoras creados: ${categoriasOrdenadas.length} opciones`);\r\n    }\r\n\r\n    // Abrir modal para crear/editar personal\r\n    async function abrirModalPersonal(personalId = null) {\r\n        const modal = document.getElementById('modal-personal');\r\n        const titulo = document.getElementById('modal-personal-titulo');\r\n        const form = document.getElementById('form-personal');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const previewImg = document.getElementById('personal-foto-preview-img');\r\n        const uploadLabel = document.querySelector('.file-upload-label');\r\n        \r\n        if (!modal || !titulo || !form) return;\r\n        \r\n        // Resetear formulario\r\n        resetearFormularioPersonal();\r\n        \r\n        // Asegurar que las categoras estn cargadas en los checkboxes\r\n        await cargarCategoriasCheckboxesPersonal();\r\n        \r\n        if (personalId) {\r\n            // Modo edicin\r\n            titulo.textContent = 'Editar Personal';\r\n            document.getElementById('personal-id').value = personalId;\r\n            \r\n            const personal = personalMap[personalId];\r\n            if (personal) {\r\n                // Llenar campos bsicos\r\n                document.getElementById('personal-nombre').value = personal.nombre || '';\r\n                document.getElementById('personal-telefono').value = personal.telefono || '';\r\n                document.getElementById('personal-email').value = personal.email || '';\r\n                document.getElementById('personal-duracion').value = personal.duracionTurnoBase || 30;\r\n                document.getElementById('personal-activo').checked = personal.activo !== false;\r\n                \r\n                // Mostrar imagen existente si hay una\r\n                if (personal.fotoUrl) {\r\n                    previewImg.src = personal.fotoUrl;\r\n                    filePreview.style.display = 'block';\r\n                    uploadLabel.style.display = 'none';\r\n                    document.getElementById('personal-foto-url').value = personal.fotoUrl;\r\n                }\r\n                \r\n                // Establecer categoras\r\n                if (personal.categoriasId) {\r\n                    establecerCategoriasSeleccionadas(personal.categoriasId);\r\n                }\r\n                \r\n                // Establecer horario laboral\r\n                if (personal.horarioLaboral) {\r\n                    establecerHorarioLaboral(personal.horarioLaboral);\r\n                }\r\n            }\r\n        } else {\r\n            // Modo creacin\r\n            titulo.textContent = 'Crear Personal';\r\n            document.getElementById('personal-id').value = '';\r\n            document.getElementById('personal-activo').checked = true;\r\n            document.getElementById('personal-duracion').value = 30;\r\n            \r\n            // Limpiar checkboxes\r\n            const checkboxes = document.querySelectorAll('.checkbox-categoria');\r\n            checkboxes.forEach(checkbox => {\r\n                checkbox.checked = false;\r\n            });\r\n            \r\n            // Establecer horario laboral por defecto\r\n            const horarioPorDefecto = {\r\n                lunes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                martes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                miercoles: { inicio: '09:00', fin: '20:00', activo: true },\r\n                jueves: { inicio: '09:00', fin: '20:00', activo: true },\r\n                viernes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                sabado: { inicio: '09:00', fin: '20:00', activo: false },\r\n                domingo: { inicio: '09:00', fin: '20:00', activo: false }\r\n            };\r\n            establecerHorarioLaboral(horarioPorDefecto);\r\n        }\r\n        \r\n        modal.style.display = 'block';\r\n    }\r\n\r\n    // Establecer horario laboral en el formulario\r\n    function establecerHorarioLaboral(horarioLaboral) {\r\n        const dias = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'];\r\n        \r\n        dias.forEach(dia => {\r\n            const config = horarioLaboral[dia];\r\n            const activoCheckbox = document.getElementById(`personal-${dia}-activo`);\r\n            const inicioInput = document.getElementById(`personal-${dia}-inicio`);\r\n            const finInput = document.getElementById(`personal-${dia}-fin`);\r\n            \r\n            if (activoCheckbox && inicioInput && finInput) {\r\n                if (config && config.activo) {\r\n                    activoCheckbox.checked = true;\r\n                    inicioInput.value = config.inicio || '09:00';\r\n                    finInput.value = config.fin || '18:00';\r\n                } else {\r\n                    activoCheckbox.checked = false;\r\n                    inicioInput.value = '09:00';\r\n                    finInput.value = '18:00';\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Guardar personal (crear o actualizar)\r\n    async function guardarPersonal() {\r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            const personalId = document.getElementById('personal-id').value;\r\n            const fileInput = document.getElementById('personal-foto-file');\r\n            const archivoImagen = fileInput.files[0];\r\n            const fotoUrlExistente = document.getElementById('personal-foto-url').value;\r\n            \r\n            const personalData = {\r\n                nombre: document.getElementById('personal-nombre').value.trim(),\r\n                telefono: document.getElementById('personal-telefono').value.trim(),\r\n                email: document.getElementById('personal-email').value.trim(),\r\n                duracionTurnoBase: parseInt(document.getElementById('personal-duracion').value),\r\n                activo: document.getElementById('personal-activo').checked,\r\n                categoriasId: obtenerCategoriasSeleccionadas(),\r\n                horarioLaboral: obtenerHorarioLaboralFromForm(),\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            };\r\n            \r\n            // Validaciones bsicas\r\n            if (!personalData.nombre) {\r\n                throw new Error('El nombre es obligatorio');\r\n            }\r\n            if (personalData.duracionTurnoBase < 1) {\r\n                throw new Error('La duracin del turno debe ser mayor a 0');\r\n            }\r\n            \r\n            let nuevoId = personalId;\r\n            \r\n            if (personalId) {\r\n                // Modo edicin - manejar imagen\r\n                if (archivoImagen) {\r\n                    // Subir nueva imagen\r\n                    personalData.fotoUrl = await subirImagenPersonal(archivoImagen, personalId);\r\n                } else if (fotoUrlExistente) {\r\n                    // Mantener imagen existente\r\n                    personalData.fotoUrl = fotoUrlExistente;\r\n                } else {\r\n                    // Eliminar imagen si no hay ninguna\r\n                    personalData.fotoUrl = '';\r\n                }\r\n                \r\n                await db.collection('especialistas').doc(personalId).update(personalData);\r\n                mostrarMensajeExito('Personal actualizado correctamente');\r\n                \r\n            } else {\r\n                // Modo creacin\r\n                nuevoId = generarIdPersonal(personalData.nombre);\r\n                \r\n                // Verificar que el ID no exista\r\n                const idUnico = await verificarIdUnico('especialistas', nuevoId);\r\n                if (!idUnico) {\r\n                    throw new Error(`Ya existe un especialista con un nombre similar. El ID \"${nuevoId}\" ya est en uso.`);\r\n                }\r\n                \r\n                // Subir imagen si se proporcion\r\n                if (archivoImagen) {\r\n                    personalData.fotoUrl = await subirImagenPersonal(archivoImagen, nuevoId);\r\n                } else {\r\n                    personalData.fotoUrl = '';\r\n                }\r\n                \r\n                personalData.creadoEl = firebase.firestore.FieldValue.serverTimestamp();\r\n                personalData.orden = Object.keys(personalMap).length + 1;\r\n                personalData.id = nuevoId;\r\n                \r\n                await db.collection('especialistas').doc(nuevoId).set(personalData);\r\n                mostrarMensajeExito('Personal creado correctamente');\r\n            }\r\n            \r\n            // Recargar personal\r\n            await cargarPersonalYMostrar();\r\n            \r\n            // Cerrar modal y resetear\r\n            document.getElementById('modal-personal').style.display = 'none';\r\n            resetearFormularioPersonal();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error guardando personal:', error);\r\n            mostrarMensajeError(error.message || 'Error al guardar el personal');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Funcin para resetear el formulario de personal\r\n    function resetearFormularioPersonal() {\r\n        const form = document.getElementById('form-personal');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const uploadLabel = document.querySelector('.file-upload-label');\r\n        \r\n        form.reset();\r\n        filePreview.style.display = 'none';\r\n        uploadLabel.style.display = 'flex';\r\n        document.getElementById('personal-foto-url').value = '';\r\n    }\r\n\r\n    // Obtener categoras seleccionadas en checkboxs\r\n    function obtenerCategoriasSeleccionadas() {\r\n        const checkboxes = document.querySelectorAll('.checkbox-categoria:checked');\r\n        return Array.from(checkboxes).map(checkbox => checkbox.value);\r\n    }\r\n\r\n    // Establecer categoras seleccionadas al editar\r\n    function establecerCategoriasSeleccionadas(categoriasIds) {\r\n        if (!categoriasIds || !Array.isArray(categoriasIds)) return;\r\n        \r\n        const checkboxes = document.querySelectorAll('.checkbox-categoria');\r\n        checkboxes.forEach(checkbox => {\r\n            checkbox.checked = categoriasIds.includes(checkbox.value);\r\n        });\r\n    }\r\n\r\n    // Obtener horario laboral desde el formulario\r\n    function obtenerHorarioLaboralFromForm() {\r\n        const dias = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'];\r\n        const horarioLaboral = {};\r\n        \r\n        dias.forEach(dia => {\r\n            const activoCheckbox = document.getElementById(`personal-${dia}-activo`);\r\n            const inicioInput = document.getElementById(`personal-${dia}-inicio`);\r\n            const finInput = document.getElementById(`personal-${dia}-fin`);\r\n            \r\n            if (activoCheckbox && inicioInput && finInput) {\r\n                horarioLaboral[dia] = {\r\n                    activo: activoCheckbox.checked,\r\n                    inicio: inicioInput.value,\r\n                    fin: finInput.value\r\n                };\r\n            }\r\n        });\r\n        \r\n        return horarioLaboral;\r\n    }\r\n\r\n    // Eliminar personal (soft delete: establecer activo = false)\r\n    async function eliminarPersonal(personalId) {\r\n        if (!personalId) return;\r\n        \r\n        const personal = personalMap[personalId];\r\n        if (!personal) return;\r\n        \r\n        if (!confirm(`Ests seguro de eliminar a \"${personal.nombre}\"? Esta accin no se puede deshacer.`)) {\r\n            return;\r\n        }\r\n        \r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            // Soft delete: establecer activo = false\r\n            await db.collection('especialistas').doc(personalId).update({\r\n                activo: false,\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            });\r\n            \r\n            mostrarMensajeExito('Personal eliminado correctamente');\r\n            \r\n            // Recargar personal\r\n            await cargarPersonalYMostrar();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error eliminando personal:', error);\r\n            mostrarMensajeError('Error al eliminar el personal');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // FUNCIONES PARA GENERAR IDs PERSONALIZADOS\r\n    // =============================================\r\n\r\n    // Funcin para normalizar texto para IDs\r\n    function normalizarParaId(texto) {\r\n        return texto\r\n            .toLowerCase()\r\n            .normalize(\"NFD\") // Separar acentos\r\n            .replace(/[\\u0300-\\u036f]/g, \"\") // Eliminar acentos\r\n            .replace(/[^a-z0-9]/g, \"_\") // Reemplazar caracteres no alfanumricos con _\r\n            .replace(/_+/g, \"_\") // Reemplazar mltiples _ por uno solo\r\n            .replace(/^_|_$/g, \"\"); // Eliminar _ al inicio y final\r\n    }\r\n\r\n    // Generar ID para servicio\r\n    function generarIdServicio(nombre) {\r\n        return `serv_${normalizarParaId(nombre)}`;\r\n    }\r\n\r\n    // Generar ID para personal\r\n    function generarIdPersonal(nombre) {\r\n        return `esp_${normalizarParaId(nombre)}`;\r\n    }\r\n\r\n    // Verificar si un ID ya existe en una coleccin\r\n    async function verificarIdUnico(coleccion, id) {\r\n        try {\r\n            const doc = await db.collection(coleccion).doc(id).get();\r\n            return !doc.exists;\r\n        } catch (error) {\r\n            console.error(`Error verificando ID ${id}:`, error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // FUNCIONES PARA SUBIDA DE ARCHIVOS A STORAGE\r\n    // =============================================\r\n\r\n    // Referencia al storage\r\n    const storage = firebase.storage();\r\n\r\n    // Funcin para subir imagen a Firebase Storage\r\n    async function subirImagenPersonal(archivo, personalId) {\r\n        try {\r\n            console.log(' Iniciando subida de imagen...', archivo.name);\r\n            \r\n            // Crear referencia nica en Storage\r\n            const extension = archivo.name.split('.').pop().toLowerCase();\r\n            const nombreArchivo = `especialistas/${personalId}_${Date.now()}.${extension}`;\r\n            const storageRef = storage.ref().child(nombreArchivo);\r\n            \r\n            // Subir el archivo\r\n            const snapshot = await storageRef.put(archivo);\r\n            \r\n            // Obtener URL de descarga\r\n            const downloadURL = await snapshot.ref.getDownloadURL();\r\n            \r\n            console.log(' Imagen subida correctamente:', downloadURL);\r\n            return downloadURL;\r\n            \r\n        } catch (error) {\r\n            console.error(' Error subiendo imagen:', error);\r\n            throw new Error('Error al subir la imagen: ' + error.message);\r\n        }\r\n    }\r\n\r\n    // Configurar el uploader de archivos\r\n    function configurarUploaderImagen() {\r\n        const fileInput = document.getElementById('personal-foto-file');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const previewImg = document.getElementById('personal-foto-preview-img');\r\n        const removeBtn = document.getElementById('btn-remove-image');\r\n        const uploadContainer = document.querySelector('.file-upload-container');\r\n        const uploadLabel = uploadContainer.querySelector('.file-upload-label');\r\n        \r\n        if (!fileInput) return;\r\n        \r\n        // Manejar seleccin de archivo\r\n        fileInput.addEventListener('change', function(e) {\r\n            const archivo = e.target.files[0];\r\n            if (archivo) {\r\n                // Validar tipo de archivo\r\n                if (!archivo.type.startsWith('image/')) {\r\n                    mostrarMensajeError('Por favor selecciona un archivo de imagen vlido');\r\n                    return;\r\n                }\r\n                \r\n                // Validar tamao (2MB mximo)\r\n                if (archivo.size > 2 * 1024 * 1024) {\r\n                    mostrarMensajeError('La imagen es demasiado grande. Mximo 2MB permitido.');\r\n                    return;\r\n                }\r\n                \r\n                // Mostrar previsualizacin\r\n                const reader = new FileReader();\r\n                reader.onload = function(e) {\r\n                    previewImg.src = e.target.result;\r\n                    filePreview.style.display = 'block';\r\n                    uploadLabel.style.display = 'none';\r\n                };\r\n                reader.readAsDataURL(archivo);\r\n            }\r\n        });\r\n        \r\n        // Manejar eliminacin de imagen\r\n        removeBtn.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            \r\n            fileInput.value = '';\r\n            filePreview.style.display = 'none';\r\n            uploadLabel.style.display = 'flex';\r\n            document.getElementById('personal-foto-url').value = '';\r\n        });\r\n        \r\n        // Drag & drop functionality\r\n        uploadContainer.addEventListener('dragover', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.add('dragover');\r\n        });\r\n        \r\n        uploadContainer.addEventListener('dragleave', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.remove('dragover');\r\n        });\r\n        \r\n        uploadContainer.addEventListener('drop', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.remove('dragover');\r\n            \r\n            const archivos = e.dataTransfer.files;\r\n            if (archivos.length > 0) {\r\n                fileInput.files = archivos;\r\n                fileInput.dispatchEvent(new Event('change'));\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    document.addEventListener('DOMContentLoaded', initAdmin);\r\n}","(() => {\r\n  window.enviarEmailConfirmacion = async (datosTurno) => {\r\n    try {\r\n      const emailData = {\r\n        senderName: window.brevoConfig.senderName,\r\n        senderEmail: window.brevoConfig.senderEmail,\r\n        to: [{ email: datosTurno.email, name: datosTurno.nombre }],\r\n        subject: `Confirmacin de turno - ${datosTurno.fecha} a las ${datosTurno.horario}`,\r\n        htmlContent: `\r\n          <!DOCTYPE html>\r\n          <html>\r\n          <head>\r\n              <style>\r\n                  body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: #333; }\r\n                  .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n                  .header { background-color: #f8f1e9; padding: 20px; text-align: center; }\r\n                  .content { padding: 20px; }\r\n                  .footer { text-align: center; font-size: 12px; color: #777; margin-top: 20px; }\r\n                  .resumen { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }\r\n                  .servicio { margin-bottom: 5px; }\r\n              </style>\r\n          </head>\r\n          <body>\r\n              <div class=\"container\">\r\n                  <div class=\"header\">\r\n                      <h2>DemoPro GestionTurno</h2>\r\n                      <p>Tu turno ha sido confirmado!</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"content\">\r\n                      <p>Hola <strong>${datosTurno.nombre}</strong>,</p>\r\n                      <p>Tu turno ha sido reservado con xito. A continuacin los detalles:</p>\r\n                      \r\n                      <div class=\"resumen\">\r\n                          <h3>Resumen de tu reserva</h3>\r\n                          <p><strong>Especialista(s):</strong> ${datosTurno.especialistas.join(', ')}</p>\r\n                          <p><strong>Fecha:</strong> ${datosTurno.fecha}</p>\r\n                          <p><strong>Hora:</strong> ${datosTurno.horario}</p>\r\n                          <p><strong>Servicios:</strong></p>\r\n                          <ul>\r\n                              ${datosTurno.servicios.map(s => `<li class=\"servicio\">${s}</li>`).join('')}\r\n                          </ul>\r\n                          <p><strong>Sea abonada:</strong> $${datosTurno.reserva.toLocaleString()}</p>\r\n                          <p><strong>A abonar en local:</strong> $${(datosTurno.montoTotal).toLocaleString()}</p>\r\n                      </div>\r\n                      \r\n                      <p>Si necesitas modificar o cancelar tu turno, por favor contctanos a: contacto@gestionturno.com</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"footer\">\r\n                      <p> ${new Date().getFullYear()} DemoPro GestionTurno. Todos los derechos reservados.</p>\r\n                  </div>\r\n              </div>\r\n          </body>\r\n          </html>\r\n        `\r\n      };\r\n\r\n      // Opcional: enviar copia al admin\r\n      if (window.brevoConfig.adminEmail) {\r\n        emailData.bcc = [{ email: window.brevoConfig.adminEmail, name: 'Administrador DemoPro GestinTurno' }];\r\n      }\r\n\r\n      // Llamar a la Cloud Function\r\n      const enviarEmail = firebase.functions().httpsCallable('enviarEmailConfirmacion');\r\n      const resultado = await enviarEmail(emailData);\r\n      \r\n      return resultado.data.success;\r\n    } catch (error) {\r\n      console.error('Error en enviarEmailConfirmacion:', error);\r\n      return false;\r\n    }\r\n  };\r\n})();","\r\n// Variables globales\r\nlet pasoActual = 1;\r\nconst totalPasos = 5; // Ahora son 5 pasos antes de confirmacin\r\nlet datosReserva = {\r\n    servicios: [],\r\n    especialistas: [],\r\n    especialistaNombre: null,\r\n    categorias: [],\r\n    precios: {\r\n        \"Corte\": 15000,\r\n        \"Teido\": 40000,\r\n        \"Alisado\": 30000\r\n    },\r\n    duraciones: {\r\n        \"Corte\": 30,\r\n        \"Teido\": 30,\r\n        \"Alisado\": 30\r\n    },\r\n    reserva: 1000,\r\n    fecha: null,\r\n    horario: null,\r\n    nombre: null,\r\n    email: null,\r\n    telefono: null,\r\n    observacion: null\r\n};\r\nlet datosGenerales = {};\r\n\r\nlet mejorEspecialistaPorCategoria = {};\r\n\r\nlet fechaSeleccionada = null;\r\n\r\nlet calendarioFechaActual = new Date();\r\nlet fechasDisponiblesCalendario = [];\r\n\r\n// Variable global para almacenar coordenadas\r\nlet coordenadasLocal = null;\r\n\r\n// Elementos DOM\r\nconst elementos = {\r\n    progreso: document.getElementById('progreso'),\r\n    btnAnterior: document.querySelector('.btn-anterior'),\r\n    btnSiguiente: document.querySelector('.btn-siguiente'),\r\n    pasos: document.querySelectorAll('.paso'),\r\n    // Elementos de resumen\r\n    resumenNombre: document.getElementById('cliente-nombre'),\r\n    resumenEmail: document.getElementById('cliente-email'),\r\n    resumenTelefono: document.getElementById('cliente-telefono'),\r\n    resumenServicio: document.getElementById('servicio-seleccionado'),\r\n    resumenFecha: document.getElementById('fecha-seleccionado'), // Cambiado a fecha-seleccionado\r\n    resumenHorario: document.getElementById('horario-seleccionado'),\r\n    resumenObservacion: document.getElementById('observacion-texto'),\r\n    resumenEspecialistas: document.getElementById('especialistas-nombres'),\r\n\r\n    contenedorEspecialistas: document.querySelector('.contenedor-especialistas')\r\n};\r\n\r\nconst db = window.db || firebase.firestore();\r\n\r\n// Usar las referencias globales con validacin\r\nconst auth = window.firebaseAuth || {\r\n  onAuthStateChanged: () => console.warn('Auth no inicializado'),\r\n};\r\n\r\nif (!window.firestoreDB) {\r\n    console.error('Firestore no est disponible');\r\n  // Podras mostrar un mensaje al usuario o deshabilitar funcionalidad\r\n}\r\n\r\n// Prueba de conexin (puedes eliminar esto despus)\r\nasync function probarConexion() {\r\n    try {\r\n        // console.log(\"Probando conexin a Firestore...\");\r\n        \r\n        // 1. Obtener configuracin\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        // console.log(\"Configuracin obtenida:\", config);\r\n        \r\n        // 2. Obtener turnos de hoy\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        const turnos = await firestoreDB.obtenerTurnosPorFecha(hoy);\r\n        // console.log(`Turnos para hoy (${hoy}):`, turnos);\r\n        \r\n        // 3. Generar horarios disponibles para hoy\r\n        const horarios = await firestoreSeguro.generarHorariosDisponibles(hoy);\r\n        // console.log(\"Horarios disponibles hoy:\", horarios);\r\n    \r\n    } catch (error) {\r\n        console.error(\"Error en prueba de conexin:\", error);\r\n    }\r\n}\r\n\r\n// Inicializacin\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n  // Cargar configuracin primero\r\n  await cargarConfiguracion();\r\n\r\n  cargarDatosGenerales()\r\n\r\n  // Inicializar autenticacin\r\n  inicializarAuth();\r\n\r\n  // Verificar si hay usuario en LocalStorage\r\n  const usuarioLS = localStorage.getItem('usuario');\r\n  if (usuarioLS) {\r\n    const user = JSON.parse(usuarioLS);\r\n    // actualizarUIUsuario(user);\r\n  }\r\n\r\n  // Inicializar el acorden del men\r\n  inicializarAcordeonMenu();\r\n\r\n  // Inicializar cierre del men al hacer clic fuera (NUEVO)\r\n  inicializarCierreMenuOverlay();\r\n\r\n  if (document.querySelector('.contenedor-pasos')) {\r\n    inicializarEventos();\r\n    actualizarInterfaz();\r\n    inicializarAuth();\r\n    \r\n    // Cargar categoras y servicios con manejo de errores integrado\r\n    const [categorias, servicios] = await Promise.all([\r\n    firestoreSeguro.obtenerCategorias(),\r\n    firestoreSeguro.obtenerServicios()\r\n    ]);\r\n\r\n    // Filtrar datos invlidos\r\n    const categoriasValidas = Validador.filtrarInvalidos(categorias, 'categoria');\r\n    const serviciosValidos = Validador.filtrarInvalidos(servicios, 'servicio');\r\n\r\n    // Guardar en datosReserva solo si hay datos vlidos\r\n    if (categoriasValidas.length > 0) {\r\n    datosReserva.categorias = categoriasValidas;\r\n    } else {\r\n    ErrorHandler.mostrar(\"No se pudieron cargar las categoras vlidas\", \"warning\");\r\n    }\r\n\r\n    if (serviciosValidos.length > 0) {\r\n    datosReserva.serviciosDisponibles = serviciosValidos;\r\n    } else {\r\n    ErrorHandler.mostrar(\"No se pudieron cargar los servicios vlidos\", \"warning\");\r\n    }\r\n\r\n    // Actualizar UI con servicios organizados por categora\r\n    actualizarUIServicios(categoriasValidas, serviciosValidos);\r\n    }\r\n\r\n    datosGenerales = await firestoreSeguro.obtenerConfigGeneral();\r\n\r\n    // Observar cambios en los pasos para cargar fechas/horarios cuando sea necesario\r\n    const observer = new MutationObserver(function(mutations) {\r\n        mutations.forEach(function(mutation) {\r\n            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\r\n                const paso3 = document.querySelector('.paso-3');\r\n                if (paso3 && paso3.classList.contains('activo') && !fechaSeleccionada) {\r\n                    cargarFechasYHorarios();\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Observar el paso 3\r\n    const paso3 = document.querySelector('.paso-3');\r\n    if (paso3) {\r\n        observer.observe(paso3, { attributes: true });\r\n    }\r\n\r\n    await precacheDatosEsenciales();\r\n\r\n    if (typeof inicializarSistemaTurnosUsuario === 'function') {\r\n        inicializarSistemaTurnosUsuario();\r\n    }\r\n});\r\n\r\n// Wrap seguro para funciones de Firestore\r\nconst firestoreSeguro = {\r\n  obtenerCategorias: async () => {\r\n        try {\r\n            if (cache.esValido('categorias')) {\r\n                console.log(' Obteniendo categoras desde cach');\r\n                return cache.obtener('categorias');\r\n            }\r\n            \r\n            const categorias = await firestoreDB.obtenerCategorias();\r\n            cache.guardar('categorias', categorias);\r\n            return categorias;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'cargar categoras');\r\n        }\r\n    },\r\n  \r\n  obtenerServicios: async () => {\r\n        try {\r\n            if (cache.esValido('servicios')) {\r\n                console.log(' Obteniendo servicios desde cach');\r\n                return cache.obtener('servicios');\r\n            }\r\n            \r\n            const servicios = await firestoreDB.obtenerServicios();\r\n            cache.guardar('servicios', servicios);\r\n            return servicios;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'cargar servicios');\r\n        }\r\n    },\r\n\r\n    obtenerEspecialistasPorCategoria: async (categoriaId) => {\r\n        try {\r\n            if (cache.esValido('especialistas', categoriaId)) {\r\n                console.log(` Obteniendo especialistas para categora ${categoriaId} desde cach`);\r\n                const cached = cache.obtener('especialistas', categoriaId);\r\n                //  CORRECCIN: Verificar que el cach no sea un array vaco incorrecto\r\n                if (cached && Array.isArray(cached) && cached.length > 0) {\r\n                    return cached;\r\n                } else {\r\n                    // Si el cach est vaco o es invlido, forzar recarga\r\n                    console.log(` Cach vaco/invlido para ${categoriaId}, recargando...`);\r\n                    cache.limpiarEspecifico('especialistas', categoriaId);\r\n                }\r\n            }\r\n            \r\n            const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n            \r\n            //  CORRECCIN: Guardar en cach solo si hay especialistas reales\r\n            if (especialistas && Array.isArray(especialistas) && especialistas.length > 0) {\r\n                cache.guardar('especialistas', especialistas, categoriaId);\r\n            } else {\r\n                // No guardar arrays vacos en cach para evitar problemas\r\n                console.warn(` No se guardar cach vaco para categora ${categoriaId}`);\r\n            }\r\n            \r\n            return especialistas || [];\r\n        } catch (error) {\r\n            console.error(` Error obteniendo especialistas para categora ${categoriaId}:`, error);\r\n            //  Siempre devolver un array vaco en caso de error\r\n            return [];\r\n        }\r\n    },\r\n    \r\n  obtenerConfiguracion: async () => {\r\n        try {\r\n            if (cache.esValido('config')) {\r\n                console.log(' Obteniendo configuracin desde cach');\r\n                return cache.obtener('config');\r\n            }\r\n            \r\n            const config = await firestoreDB.obtenerConfiguracion();\r\n            cache.guardar('config', config);\r\n            return config;\r\n        } catch (error) {\r\n            ErrorHandler.manejarErrorFirestore(error, 'cargar configuracin');\r\n            // Retornar configuracin por defecto\r\n            return {\r\n                diasLaborales: [1, 2, 3, 4, 5, 6],\r\n                horarioApertura: \"09:00\",\r\n                horarioCierre: \"20:00\",\r\n                duracionTurnoBase: 30\r\n            };\r\n        }\r\n    },\r\n\r\n  verificarDisponibilidad: async (fecha, horario) => {\r\n    try {\r\n      return await firestoreDB.verificarDisponibilidad(fecha, horario);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'verificar disponibilidad');\r\n      return false; // Por defecto, no disponible si hay error\r\n    }\r\n  },\r\n\r\n  generarHorariosDisponibles: async (fecha) => {\r\n    try {\r\n      return await firestoreDB.generarHorariosDisponibles(fecha);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'generar horarios');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  generarHorariosDisponiblesEspecialista: async (especialistaId, fecha) => {\r\n        try {\r\n            const cacheKey = `${especialistaId}_${fecha}`;\r\n            \r\n            // Verificar si ya tenemos los horarios de este especialista\r\n            const horariosCache = cache.obtener('horarios', cacheKey);\r\n            if (horariosCache) {\r\n                cacheMonitor.incrementHit();\r\n                return horariosCache;\r\n            }\r\n            \r\n            cacheMonitor.incrementMiss();\r\n            \r\n            // OPTIMIZACIN: Si ya consultamos este especialista hoy, reutilizar lgica\r\n            const horarios = await firestoreDB.generarHorariosDisponiblesEspecialista(especialistaId, fecha);\r\n            cache.guardar('horarios', horarios, cacheKey);\r\n            return horarios;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'generar horarios de especialista');\r\n        }\r\n    },\r\n\r\n    generarHorariosMultiplesEspecialistas: async (especialistasIds, fecha) => {\r\n        try {\r\n            const cacheKey = `multi_${especialistasIds.sort().join('_')}_${fecha}`;\r\n            \r\n            // Intentar obtener del cache primero\r\n            const horariosCache = cache.obtener('horarios_multi', cacheKey);\r\n            if (horariosCache) {\r\n                return horariosCache;\r\n            }\r\n            \r\n            // Obtener horarios para todos los especialistas en paralelo\r\n            const promises = especialistasIds.map(id => \r\n                this.generarHorariosDisponiblesEspecialista(id, fecha)\r\n            );\r\n            \r\n            const resultados = await Promise.allSettled(promises);\r\n            const horariosPorEspecialista = {};\r\n            \r\n            resultados.forEach((result, index) => {\r\n                if (result.status === 'fulfilled') {\r\n                    horariosPorEspecialista[especialistasIds[index]] = result.value;\r\n                }\r\n            });\r\n            \r\n            cache.guardar('horarios_multi', horariosPorEspecialista, cacheKey);\r\n            return horariosPorEspecialista;\r\n            \r\n        } catch (error) {\r\n            console.error('Error generando horarios mltiples:', error);\r\n            return {};\r\n        }\r\n    },\r\n\r\n  obtenerHorariosComunesDisponibles: async (fecha, especialistasIds, duracionTotal) => {\r\n    try {\r\n        return await firestoreDB.obtenerHorariosComunesDisponibles(fecha, especialistasIds, duracionTotal);\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'obtener horarios comunes');\r\n        return [];\r\n    }\r\n  },\r\n\r\n  obtenerTurnosPorFecha: async (fecha) => {\r\n    try {\r\n      return await firestoreDB.obtenerTurnosPorFecha(fecha);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'obtener turnos por fecha');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  obtenerTurnosSolapados: async (fecha, horario, duracion) => {\r\n    try {\r\n      return await firestoreDB.obtenerTurnosSolapados(fecha, horario, duracion);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'obtener turnos solapados');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  obtenerConfigGeneral: async () => {\r\n    try {\r\n        return await firestoreDB.obtenerConfigGeneral();\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'cargar configuracin general');\r\n        return {};\r\n    }\r\n  },\r\n\r\n  //  NUEVA FUNCIN: Autenticacin para reservas\r\n  autenticarParaReserva: async () => {\r\n    try {\r\n      if (!usuarioActual) {\r\n        console.log(' Iniciando autenticacin annima para reserva...');\r\n        const userCredential = await firebase.auth().signInAnonymously();\r\n        usuarioActual = userCredential.user;\r\n        console.log(' Usuario annimo autenticado:', usuarioActual.uid);\r\n      }\r\n      return usuarioActual;\r\n    } catch (error) {\r\n      console.error('Error en autenticacin para reserva:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n    guardarTurno: async (turnoData) => {\r\n    try {\r\n        //  Asegurar autenticacin antes de guardar\r\n        await firestoreSeguro.autenticarParaReserva();\r\n        \r\n        return await firestoreDB.guardarTurno(turnoData);\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'guardar turno');\r\n        throw error;\r\n    }\r\n    },\r\n\r\n  bloquearTurnoTemporal: async (fecha, horario, usuarioId) => {\r\n    try {\r\n      return await firestoreDB.bloquearTurnoTemporal(fecha, horario, usuarioId);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'bloquear turno temporal');\r\n      return null;\r\n    }\r\n  },\r\n\r\n  eliminarBloqueoTemporal: async (bloqueoId) => {\r\n    try {\r\n      return await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'eliminar bloqueo temporal');\r\n      // No hacemos nada, es una operacin de limpieza\r\n    }\r\n  }\r\n};\r\n\r\n// Funciones principales\r\nasync function inicializarEventos() {\r\n    // Navegacin\r\n    elementos.btnAnterior.addEventListener('click', retrocederPaso);\r\n    elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    \r\n    // Seleccin de servicios (manejo delegado)\r\n    document.querySelectorAll('.flotante.servicio').forEach(servicio => {\r\n        servicio.addEventListener('click', function() {\r\n            this.classList.toggle('seleccionado');\r\n            actualizarServiciosSeleccionados();\r\n        });\r\n    });\r\n    \r\n    // Fechas y horarios\r\n    document.querySelectorAll('.flotante.fecha').forEach(fecha => {\r\n        fecha.addEventListener('click', function() {\r\n            seleccionarElemento(this, 'fecha');\r\n        });\r\n    });\r\n    \r\n    document.querySelectorAll('.flotante.horario').forEach(horario => {\r\n        horario.addEventListener('click', async function() {\r\n            if (!this.classList.contains('ocupado')) {\r\n                const horarioSeleccionado = this.querySelector('.p1').textContent;\r\n                const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n                \r\n                // Verificar disponibilidad solo para los especialistas seleccionados\r\n                const validacion = await validarDisponibilidadCompleta(\r\n                    datosReserva.fecha, \r\n                    horarioSeleccionado,\r\n                    calcularDuracionTotal(),\r\n                    especialistasIds\r\n                );\r\n                \r\n                if (validacion.disponible && validacion.turnosSolapados.length === 0) {\r\n                    seleccionarElemento(this, 'horario');\r\n                } else {\r\n                    mostrarError(validacion.mensaje || \"Horario no disponible\");\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Validacin en tiempo real\r\n    document.getElementById('nombre')?.addEventListener('input', validarNombre);\r\n    document.getElementById('email')?.addEventListener('input', validarEmail);\r\n    document.getElementById('telefono')?.addEventListener('input', validarTelefono);\r\n\r\n    document.addEventListener('click', async function(e) {\r\n        if (e.target.closest('.flotante.especialista')) {\r\n            const especialistaEl = e.target.closest('.flotante.especialista');\r\n            const especialistaId = especialistaEl.dataset.id;\r\n            const categoriaId = especialistaEl.dataset.categoriaId;\r\n            \r\n            // Buscar el especialista en los datos disponibles\r\n            const categoriaSection = especialistaEl.closest('.categoria-especialistas');\r\n            if (categoriaSection) {\r\n                const especialistasContainer = categoriaSection.querySelector('.especialistas-container');\r\n                const especialistaElement = especialistasContainer.querySelector(`[data-id=\"${especialistaId}\"]`);\r\n                \r\n                if (especialistaElement) {\r\n                    // Crear objeto especialista con los datos mnimos necesarios\r\n                    const especialista = {\r\n                        id: especialistaId,\r\n                        nombre: especialistaElement.querySelector('.p1')?.textContent || 'Especialista',\r\n                        categoriaId: categoriaId\r\n                    };\r\n                    \r\n                    seleccionarEspecialista(especialistaEl, especialista, categoriaId);\r\n                }\r\n            }\r\n\r\n            setTimeout(() => {\r\n                if (pasoActual >= 2) {\r\n                    actualizarResumenEspecialistas();\r\n                }\r\n            }, 100);\r\n        }\r\n        \r\n        // Solo manejar clic en .seleccion-predeterminada para abrir/cerrar la lista\r\n        if (e.target.closest('.seleccion-predeterminada') && !e.target.closest('.botones-especialista')) {\r\n            const seleccionPredeterminada = e.target.closest('.seleccion-predeterminada');\r\n            const categoriaSection = seleccionPredeterminada.closest('.categoria-especialistas');\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n            const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n            \r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas primero\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherBtn = l.closest('.categoria-especialistas').querySelector('.btn-ver-especialistas');\r\n                    const otherIcon = otherBtn.querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            \r\n            // Alternar la rotacin del icono en lugar de cambiar el texto\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction calcularSubtotal() {\r\n    const subtotal = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n    \r\n    // Calcular ahorro total por promociones\r\n    const ahorroTotal = datosReserva.servicios.reduce((total, servicio) => {\r\n        return servicio.promo ? total + (servicio.precioOriginal - servicio.precio) : total;\r\n    }, 0);\r\n    \r\n    // Mostrar ahorro si hay promociones\r\n    if (ahorroTotal > 0) {\r\n        console.log(` Ahorro total por promociones: $${ahorroTotal.toLocaleString()}`);\r\n        // Puedes mostrar esto en la UI si quieres\r\n        const elementoAhorro = document.getElementById('ahorro-total');\r\n        if (elementoAhorro) {\r\n            elementoAhorro.textContent = `-$${ahorroTotal.toLocaleString()}`;\r\n            elementoAhorro.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    return subtotal;\r\n}\r\n\r\nfunction actualizarServiciosSeleccionados() {\r\n    try {\r\n        console.log(' actualizarServiciosSeleccionados llamado');\r\n        \r\n        const serviciosSeleccionados = document.querySelectorAll('.flotante.servicio.seleccionado');\r\n        \r\n        if (!datosReserva.servicios || !Array.isArray(datosReserva.servicios)) {\r\n            datosReserva.servicios = [];\r\n        }\r\n        \r\n        console.log('Servicios seleccionados en DOM:', serviciosSeleccionados.length);\r\n        \r\n        if (!serviciosSeleccionados || serviciosSeleccionados.length === 0) {\r\n            console.log('No hay servicios seleccionados, limpiando datos');\r\n            datosReserva.servicios = [];\r\n            \r\n            const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n            if (contenedorEspecialistas) {\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            }\r\n            \r\n            actualizarContadoresCategoria();\r\n            calcularSubtotal();\r\n            return;\r\n        }\r\n        \r\n        const serviciosProcesados = Array.from(serviciosSeleccionados).map(serv => {\r\n            try {\r\n                const servicioId = serv.getAttribute('data-servicio-id');\r\n                const servicioNombre = serv.getAttribute('data-servicio');\r\n                const categoriaId = serv.getAttribute('data-categoria-id');\r\n                \r\n                if (!servicioId || !categoriaId) {\r\n                    console.warn(\"Servicio sin ID o categora ID:\", serv);\r\n                    return null;\r\n                }\r\n                \r\n                const servicioCompleto = datosReserva.serviciosDisponibles?.find(s => s && s.id === servicioId);\r\n                \r\n                // CALCULAR PRECIO CON DESCUENTO SI APLICA\r\n                const precioOriginal = servicioCompleto ? servicioCompleto.precio : (datosReserva.precios[servicioNombre] || 0);\r\n                const tienePromo = servicioCompleto ? servicioCompleto.promo : false;\r\n                const precioFinal = tienePromo ? Math.round(precioOriginal * 0.75) : precioOriginal;\r\n                \r\n                return {\r\n                    id: servicioId,\r\n                    nombre: servicioNombre || (servicioCompleto ? servicioCompleto.nombre : 'Servicio'),\r\n                    precio: precioFinal, // Guardamos el precio con descuento aplicado\r\n                    precioOriginal: precioOriginal, // Guardamos el precio original para referencia\r\n                    promo: tienePromo, // Guardamos si tiene promocin\r\n                    duracion: servicioCompleto ? servicioCompleto.duracion : (datosReserva.duraciones[servicioNombre] || 30),\r\n                    categoriaId: categoriaId\r\n                };\r\n            } catch (error) {\r\n                console.error('Error procesando servicio:', error);\r\n                return null;\r\n            }\r\n        }).filter(servicio => servicio !== null);\r\n\r\n        datosReserva.servicios = serviciosProcesados;\r\n        console.log('Servicios procesados:', datosReserva.servicios);\r\n\r\n        if (!Array.isArray(datosReserva.servicios)) {\r\n            console.error('datosReserva.servicios no es un array, forzando a array vaco');\r\n            datosReserva.servicios = [];\r\n        }\r\n\r\n        datosReserva.reserva = calcularSenia();\r\n\r\n        actualizarContadoresCategoria();\r\n        \r\n        if (datosReserva.servicios.length > 0) {\r\n            document.getElementById('error-servicio').classList.remove('visible');\r\n        }\r\n        \r\n        console.log('Debe mostrar especialistas?', datosReserva.servicios.length > 0);\r\n        \r\n        if (datosReserva.servicios.length > 0) {\r\n            const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            console.log(\"Categoras con servicios:\", categoriasIds);\r\n            mostrarEspecialistas(categoriasIds);\r\n        } else {\r\n            console.log('Limpiando especialistas porque no hay servicios');\r\n            const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n            if (contenedorEspecialistas) {\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            }\r\n        }\r\n        \r\n        calcularSubtotal();\r\n\r\n        if (pasoActual >= 2) {\r\n            actualizarResumenServicios();\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error en actualizarServiciosSeleccionados:\", error);\r\n    }\r\n}\r\n\r\nasync function cargarEspecialistas() {\r\n    try {\r\n        // Obtener categoras nicas de los servicios seleccionados\r\n        const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n        \r\n        if (categoriasIds.length === 0) {\r\n            console.warn(\"No hay categoras para cargar especialistas\");\r\n            return;\r\n        }\r\n        \r\n        // Obtener especialistas para cada categora\r\n        const especialistasPromises = categoriasIds.map(catId => \r\n            firestoreSeguro.obtenerEspecialistasPorCategoria(catId)\r\n        );\r\n        \r\n        const resultados = await Promise.allSettled(especialistasPromises);\r\n        \r\n        // Procesar resultados\r\n        const especialistasPorCategoria = {};\r\n        resultados.forEach((result, index) => {\r\n            if (result.status === 'fulfilled') {\r\n                especialistasPorCategoria[categoriasIds[index]] = result.value;\r\n            } else {\r\n                console.error(`Error cargando especialistas para categora ${categoriasIds[index]}:`, result.reason);\r\n                especialistasPorCategoria[categoriasIds[index]] = [];\r\n            }\r\n        });\r\n        \r\n        // Mostrar especialistas en la UI\r\n        mostrarEspecialistas(categoriasIds, especialistasPorCategoria);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando especialistas:\", error);\r\n        mostrarError(\"Error al cargar los especialistas. Intenta nuevamente.\");\r\n    }\r\n}\r\n\r\nfunction seleccionarEspecialista(elemento, especialista, categoriaId) {\r\n    // Verificar si ya est seleccionado\r\n    const yaSeleccionado = elemento.classList.contains('seleccionado');\r\n    \r\n    if (yaSeleccionado) {\r\n        // Deseleccionar\r\n        elemento.classList.remove('seleccionado');\r\n        datosReserva.especialistas = datosReserva.especialistas.filter(esp => \r\n            !(esp.id === especialista.id && esp.categoriaId === categoriaId)\r\n        );\r\n    } else {\r\n        // Verificar si ya hay un especialista seleccionado para esta categora\r\n        const especialistaExistenteIndex = datosReserva.especialistas.findIndex(esp => \r\n            esp.categoriaId === categoriaId\r\n        );\r\n        \r\n        if (especialistaExistenteIndex !== -1) {\r\n            // Deseleccionar el especialista anterior de esta categora\r\n            const elementoAnterior = document.querySelector(`.flotante.especialista[data-id=\"${datosReserva.especialistas[especialistaExistenteIndex].id}\"]`);\r\n            if (elementoAnterior) {\r\n                elementoAnterior.classList.remove('seleccionado');\r\n            }\r\n            datosReserva.especialistas.splice(especialistaExistenteIndex, 1);\r\n        }\r\n        \r\n        // Seleccionar el nuevo\r\n        elemento.classList.add('seleccionado');\r\n        datosReserva.especialistas.push({\r\n            ...especialista,\r\n            categoriaId: categoriaId\r\n        });\r\n    }\r\n    \r\n    console.log(\"Especialistas seleccionados:\", datosReserva.especialistas);\r\n}\r\n\r\nasync function cargarFechasYHorarios() {\r\n    try {\r\n        await cargarFechasDisponibles();\r\n        if (datosReserva.fecha) {\r\n            await cargarHorariosDisponibles(datosReserva.fecha);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas y horarios:\", error);\r\n        mostrarError(\"Error al cargar disponibilidad. Intenta nuevamente.\");\r\n    }\r\n}\r\n\r\nasync function cargarFechasDisponibles() {\r\n    const contenedorFechas = document.querySelector('.contenedor-fechas');\r\n    if (!contenedorFechas) return;\r\n    \r\n    contenedorFechas.innerHTML = '<p>Cargando fechas disponibles...</p>';\r\n    \r\n    try {\r\n        // Obtener configuracin para das laborales\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        const diasLaborales = config?.diasLaborales || [1, 2, 3, 4, 5, 6]; // Lunes a Sbado por defecto\r\n        \r\n        // Generar prximas 4 semanas\r\n        const hoy = new Date();\r\n        const fechasDisponibles = [];\r\n        \r\n        for (let i = 0; i < 28; i++) { // 4 semanas\r\n            const fecha = new Date(hoy);\r\n            fecha.setDate(hoy.getDate() + i);\r\n            \r\n            // Verificar si es da laboral\r\n            if (diasLaborales.includes(fecha.getDay())) {\r\n                fechasDisponibles.push(fecha.toISOString().split('T')[0]);\r\n            }\r\n        }\r\n        \r\n        // Actualizar UI\r\n        contenedorFechas.innerHTML = '';\r\n        fechasDisponibles.forEach(fechaStr => {\r\n            const fecha = new Date(fechaStr);\r\n            const fechaElement = document.createElement('div');\r\n            fechaElement.className = 'flotante fecha';\r\n            fechaElement.dataset.fecha = fechaStr;\r\n            \r\n            const opciones = { weekday: 'long', day: 'numeric', month: 'long' };\r\n            const fechaFormateada = fecha.toLocaleDateString('es-ES', opciones);\r\n            fechaElement.innerHTML = `\r\n                <p class=\"p1\">${fechaFormateada.charAt(0).toUpperCase() + fechaFormateada.slice(1)}</p>\r\n            `;\r\n            \r\n            fechaElement.addEventListener('click', function() {\r\n                seleccionarElemento(this, 'fecha');\r\n                cargarHorariosDisponibles(fechaStr);\r\n            });\r\n            \r\n            contenedorFechas.appendChild(fechaElement);\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        contenedorFechas.innerHTML = '<p>Error al cargar fechas</p>';\r\n    }\r\n}\r\n\r\nasync function cargarHorariosDisponibles(fecha) {\r\n    const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n    if (!contenedorHorarios) return;\r\n    \r\n    contenedorHorarios.innerHTML = '<p>Cargando horarios...</p>';\r\n    \r\n    try {\r\n        // Calcular duracin total\r\n        const duracionTotal = calcularDuracionTotal();\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n        \r\n        // Obtener horarios disponibles\r\n        let horariosDisponibles = [];\r\n        \r\n        if (especialistasIds.length > 0) {\r\n            // Usar la funcin optimizada para mltiples especialistas\r\n            horariosDisponibles = await firestoreSeguro.obtenerHorariosComunesDisponibles(\r\n                fecha, \r\n                especialistasIds, \r\n                duracionTotal\r\n            );\r\n        } else {\r\n            // Fallback: horarios generales (sin especialista especfico)\r\n            horariosDisponibles = await firestoreSeguro.generarHorariosDisponibles(fecha);\r\n        }\r\n        \r\n        // Actualizar UI\r\n        contenedorHorarios.innerHTML = '';\r\n        \r\n        if (horariosDisponibles.length === 0) {\r\n            contenedorHorarios.innerHTML = '<p>No hay horarios disponibles para esta fecha</p>';\r\n            return;\r\n        }\r\n        \r\n        horariosDisponibles.forEach(horario => {\r\n            const horarioElement = document.createElement('div');\r\n            horarioElement.className = 'flotante horario disponible';\r\n            horarioElement.innerHTML = `\r\n                <p class=\"p1\">${horario}</p>\r\n            `;\r\n            \r\n            horarioElement.addEventListener('click', async function() {\r\n                if (!this.classList.contains('ocupado')) {\r\n                    // Verificar disponibilidad antes de seleccionar\r\n                    const validacion = await validarDisponibilidadCompleta(\r\n                        fecha, \r\n                        horario,\r\n                        duracionTotal,\r\n                        especialistasIds\r\n                    );\r\n                    \r\n                    if (validacion.disponible && validacion.turnosSolapados.length === 0) {\r\n                        seleccionarElemento(this, 'horario');\r\n                    } else {\r\n                        mostrarError(validacion.mensaje || \"Horario no disponible\");\r\n                    }\r\n                }\r\n            });\r\n            \r\n            contenedorHorarios.appendChild(horarioElement);\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando horarios:\", error);\r\n        contenedorHorarios.innerHTML = '<p>Error al cargar horarios</p>';\r\n    }\r\n}\r\n\r\nasync function validarDisponibilidadCompleta(fecha, horario, duracion, especialistasIds) {\r\n    try {\r\n        // Verificar disponibilidad general primero\r\n        const disponible = await firestoreSeguro.verificarDisponibilidad(fecha, horario);\r\n        if (!disponible) {\r\n            return {\r\n                disponible: false,\r\n                mensaje: \"Este horario ya no est disponible\"\r\n            };\r\n        }\r\n        \r\n        // Verificar turnos solapados\r\n        const turnosSolapados = await firestoreSeguro.obtenerTurnosSolapados(fecha, horario, duracion);\r\n        \r\n        if (turnosSolapados.length > 0) {\r\n            return {\r\n                disponible: false,\r\n                turnosSolapados: turnosSolapados,\r\n                mensaje: `El horario seleccionado se cruza con ${turnosSolapados.length} turno(s) existente(s)`\r\n            };\r\n        }\r\n        \r\n        // Si hay especialistas especficos, verificar su disponibilidad\r\n        if (especialistasIds.length > 0) {\r\n            for (const especialistaId of especialistasIds) {\r\n                const horariosEspecialista = await firestoreSeguro.generarHorariosDisponiblesEspecialista(especialistaId, fecha);\r\n                if (!horariosEspecialista.includes(horario)) {\r\n                    return {\r\n                        disponible: false,\r\n                        mensaje: `El especialista no est disponible en este horario`\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        \r\n        return {\r\n            disponible: true,\r\n            turnosSolapados: []\r\n        };\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error validando disponibilidad:\", error);\r\n        return {\r\n            disponible: false,\r\n            mensaje: \"Error al verificar disponibilidad\"\r\n        };\r\n    }\r\n}\r\n\r\nfunction validarDatosContacto() {\r\n    const nombre = document.getElementById('nombre').value.trim();\r\n    const email = document.getElementById('email').value.trim();\r\n    const telefono = document.getElementById('telefono').value.trim();\r\n    \r\n    // Validar nombre\r\n    if (nombre.length < 2) {\r\n        mostrarError('Ingresa tu nombre completo');\r\n        return false;\r\n    }\r\n    \r\n    // Validar email\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(email)) {\r\n        mostrarError('Ingresa un email vlido');\r\n        return false;\r\n    }\r\n    \r\n    // Validar telfono (mnimo 8 dgitos)\r\n    const telefonoRegex = /^\\d{8,}$/;\r\n    if (!telefonoRegex.test(telefono.replace(/\\D/g, ''))) {\r\n        mostrarError('Ingresa un telfono vlido (mnimo 8 dgitos)');\r\n        return false;\r\n    }\r\n    \r\n    // Guardar datos\r\n    datosReserva.nombre = nombre;\r\n    datosReserva.email = email;\r\n    datosReserva.telefono = telefono;\r\n    datosReserva.observacion = document.getElementById('observacion').value.trim();\r\n    \r\n    return true;\r\n}\r\n\r\nfunction actualizarResumenServicios() {\r\n    const resumenServicios = document.getElementById('servicio-seleccionado');\r\n    if (resumenServicios) {\r\n        const serviciosHTML = datosReserva.servicios.map(servicio => {\r\n            const precioMostrado = servicio.promo ? \r\n                `<span class=\"precio-con-descuento\">$${servicio.precio.toLocaleString()}</span>\r\n                <span class=\"precio-original\">$${servicio.precioOriginal.toLocaleString()}</span>` :\r\n                `$${servicio.precio.toLocaleString()}`;\r\n            \r\n            const badgePromo = servicio.promo ? '<span class=\"badge-promo-resumen\">-25%</span>' : '';\r\n            \r\n            return `<li>${servicio.nombre} ${badgePromo} - ${precioMostrado}</li>`;\r\n        }).join('');\r\n        resumenServicios.innerHTML = serviciosHTML;\r\n    }\r\n}\r\n\r\nfunction obtenerNombreCategoria(categoriaId) {\r\n    const categoria = datosReserva.categorias.find(cat => cat.id === categoriaId);\r\n    return categoria ? categoria.nombre : 'General';\r\n}\r\n\r\nasync function confirmarReserva() {\r\n    if (!validarDatosContacto()) {\r\n        return;\r\n    }\r\n    \r\n    // Mostrar loading\r\n    elementos.btnSiguiente.innerHTML = '<div class=\"spinner\"></div> Confirmando...';\r\n    elementos.btnSiguiente.disabled = true;\r\n    \r\n    try {\r\n        // Verificar disponibilidad final\r\n        const validacion = await validarDisponibilidadCompleta(\r\n            datosReserva.fecha,\r\n            datosReserva.horario,\r\n            calcularDuracionTotal(),\r\n            datosReserva.especialistas.map(esp => esp.id)\r\n        );\r\n        \r\n        if (!validacion.disponible) {\r\n            mostrarError(validacion.mensaje || \"El horario ya no est disponible\");\r\n            elementos.btnSiguiente.innerHTML = 'Confirmar Reserva';\r\n            elementos.btnSiguiente.disabled = false;\r\n            return;\r\n        }\r\n        \r\n        // Crear objeto de turno\r\n        const turnoData = {\r\n            servicios: datosReserva.servicios,\r\n            especialistas: datosReserva.especialistas,\r\n            fecha: datosReserva.fecha,\r\n            horario: datosReserva.horario,\r\n            duracion: calcularDuracionTotal(),\r\n            cliente: {\r\n                nombre: datosReserva.nombre,\r\n                email: datosReserva.email,\r\n                telefono: datosReserva.telefono\r\n            },\r\n            observaciones: datosReserva.observacion,\r\n            estado: 'pendiente',\r\n            fechaCreacion: new Date().toISOString(),\r\n            senia: datosReserva.reserva,\r\n            total: calcularSubtotal()\r\n        };\r\n        \r\n        // Guardar en Firestore\r\n        const resultado = await firestoreSeguro.guardarTurno(turnoData);\r\n        \r\n        if (resultado) {\r\n            // Mostrar confirmacin\r\n            mostrarConfirmacion(turnoData);\r\n            \r\n            // Reiniciar formulario\r\n            reiniciarFormulario();\r\n        } else {\r\n            throw new Error('Error al guardar el turno');\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error confirmando reserva:\", error);\r\n        mostrarError(\"Error al confirmar la reserva. Intenta nuevamente.\");\r\n    } finally {\r\n        elementos.btnSiguiente.innerHTML = 'Confirmar Reserva';\r\n        elementos.btnSiguiente.disabled = false;\r\n    }\r\n}\r\n\r\nfunction reiniciarFormulario() {\r\n    // Reiniciar datos\r\n    datosReserva = {\r\n        servicios: [],\r\n        especialistas: [],\r\n        fecha: null,\r\n        horario: null,\r\n        nombre: null,\r\n        email: null,\r\n        telefono: null,\r\n        observacion: null,\r\n        reserva: 1000\r\n    };\r\n    \r\n    // Reiniciar UI\r\n    pasoActual = 1;\r\n    actualizarInterfaz();\r\n    \r\n    // Limpiar selecciones\r\n    document.querySelectorAll('.flotante.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Limpiar formulario\r\n    document.getElementById('nombre').value = '';\r\n    document.getElementById('email').value = '';\r\n    document.getElementById('telefono').value = '';\r\n    document.getElementById('observacion').value = '';\r\n}\r\n\r\n// Sistema de autenticacin\r\n\r\nasync function cargarDatosUsuario(uid) {\r\n    try {\r\n        const userDoc = await db.collection('usuarios').doc(uid).get();\r\n        if (userDoc.exists) {\r\n            const userData = userDoc.data();\r\n            // Prellenar formulario si est disponible\r\n            if (document.getElementById('nombre') && userData.nombre) {\r\n                document.getElementById('nombre').value = userData.nombre;\r\n            }\r\n            if (document.getElementById('telefono') && userData.telefono) {\r\n                document.getElementById('telefono').value = userData.telefono;\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error cargando datos usuario:\", error);\r\n    }\r\n}\r\n\r\n// Logout\r\nasync function logout() {\r\n    try {\r\n        await auth.signOut();\r\n        localStorage.removeItem('usuario');\r\n    } catch (error) {\r\n        console.error(\"Error en logout:\", error);\r\n    }\r\n}\r\n\r\n// Cargar configuracin general\r\nasync function cargarConfiguracion() {\r\n    try {\r\n        const config = await firestoreSeguro.obtenerConfigGeneral();\r\n        datosGenerales = config;\r\n        \r\n        // Actualizar UI con configuracin si es necesario\r\n        if (config.nombreLocal) {\r\n            document.querySelectorAll('.nombre-local').forEach(el => {\r\n                el.textContent = config.nombreLocal;\r\n            });\r\n        }\r\n        \r\n        if (config.logoUrl) {\r\n            document.querySelectorAll('.logo').forEach(logo => {\r\n                logo.src = config.logoUrl;\r\n                logo.alt = config.nombreLocal;\r\n            });\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando configuracin:\", error);\r\n    }\r\n}\r\n\r\n// Funcin para abrir WhatsApp con mensaje predefinido\r\nfunction contactarPorWhatsApp() {\r\n    const telefono = datosGenerales.telefono || '5491112345678'; // Nmero por defecto\r\n    const mensaje = `Hola! Me gustara hacer una reserva en ${datosGenerales.nombreLocal || 'su local'}`;\r\n    const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;\r\n    window.open(url, '_blank');\r\n}\r\n\r\n// Funcin para abrir Google Maps con la ubicacin\r\nfunction abrirUbicacion() {\r\n    if (coordenadasLocal) {\r\n        const { lat, lng } = coordenadasLocal;\r\n        const url = `https://www.google.com/maps?q=${lat},${lng}`;\r\n        window.open(url, '_blank');\r\n    } else if (datosGenerales.direccion) {\r\n        const url = `https://www.google.com/maps?q=${encodeURIComponent(datosGenerales.direccion)}`;\r\n        window.open(url, '_blank');\r\n    } else {\r\n        mostrarError('No hay informacin de ubicacin disponible');\r\n    }\r\n}\r\n\r\nfunction actualizarUIServicios(categorias, servicios) {\r\n    \r\n  // Validacin adicional para asegurar que tenemos datos\r\n  if (!categorias || !servicios) {\r\n    ErrorHandler.mostrar(\"Datos de categoras o servicios no definidos\", \"error\");\r\n    return;\r\n  }\r\n  \r\n  const contenedorServicios = document.querySelector('.contenedor-servicios');\r\n  if (!contenedorServicios) {\r\n    console.error(\"No se encontr el contenedor de servicios\");\r\n    return;\r\n  }\r\n  \r\n  console.log(\"Actualizando UI con:\", categorias.length, \"categoras y\", servicios.length, \"servicios\");\r\n  \r\n  // Limpiar contenedor\r\n  contenedorServicios.innerHTML = '';\r\n  \r\n  // Si no hay categoras, mostrar mensaje\r\n  if (categorias.length === 0) {\r\n    contenedorServicios.innerHTML = '<p class=\"sin-servicios\">No cargaron las categoras disponibles.</p>';\r\n    return;\r\n  }\r\n  \r\n  // Organizar servicios por categora\r\n  const serviciosPorCategoria = {};\r\n  categorias.forEach(categoria => {\r\n    serviciosPorCategoria[categoria.id] = servicios.filter(s => s.categoriaId === categoria.id);\r\n  });\r\n  \r\n  // Crear HTML para cada categora (mostrar TODAS las categoras)\r\n  categorias.forEach(categoria => {\r\n    let serviciosCategoria = serviciosPorCategoria[categoria.id] || [];\r\n    \r\n    // NUEVO: Verificar si esta categora tiene servicios con promocin\r\n    const tienePromociones = serviciosCategoria.some(servicio => servicio.promo === true);\r\n    \r\n    // NUEVO: Ordenar servicios - los con promo primero\r\n    serviciosCategoria = serviciosCategoria.sort((a, b) => {\r\n      // Si a tiene promo y b no, a va primero\r\n      if (a.promo && !b.promo) return -1;\r\n      // Si b tiene promo y a no, b va primero\r\n      if (!a.promo && b.promo) return 1;\r\n      // Si ambos tienen promo o no, mantener orden original\r\n      return 0;\r\n    });\r\n    \r\n    // Crear elemento de categora (acorden) - SIEMPRE se crea, incluso si no hay servicios\r\n    const categoriaEl = document.createElement('div');\r\n    categoriaEl.className = 'categoria-acordeon';\r\n    categoriaEl.dataset.categoriaId = categoria.id;\r\n    \r\n    // SVG de promocin (solo si la categora tiene promociones)\r\n    const svgPromo = tienePromociones ? `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#9328a9ff\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n        <path d=\"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1\" />\r\n        <path d=\"M9 12l2 2l4 -4\" />\r\n      </svg>\r\n    ` : '';\r\n    \r\n    // Crear encabezado de categora\r\n    const header = document.createElement('div');\r\n    header.className = 'categoria-header';\r\n    if (tienePromociones) {\r\n      header.classList.add('con-promociones');\r\n    }\r\n    header.dataset.categoriaId = categoria.id;\r\n    header.innerHTML = `\r\n      <div class=\"categoria-info\">\r\n        <h3>${categoria.nombre} ${svgPromo}</h3>\r\n        <span class=\"contador-seleccionados-categoria\"></span>\r\n      </div>\r\n        <svg\r\n        class=\"acordeon-icon\" \r\n        width=\"18\"\r\n        height=\"18\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M18 6l-12 12\" />\r\n        <path d=\"M6 6l12 12\" />\r\n        </svg>\r\n    `;\r\n    \r\n    // Crear contenedor de servicios (inicialmente oculto)\r\n    const serviciosContainer = document.createElement('div');\r\n    serviciosContainer.className = 'servicios-container';\r\n    serviciosContainer.style.display = 'none';\r\n    \r\n    // Solo agregar servicios si existen\r\n    if (serviciosCategoria.length > 0) {\r\n      serviciosCategoria.forEach(servicio => {\r\n        const servicioEl = document.createElement('div');\r\n        servicioEl.className = 'flotante servicio';\r\n        if (servicio.promo) {\r\n            servicioEl.classList.add('descuento');\r\n        }\r\n        servicioEl.dataset.servicioId = servicio.id;\r\n        servicioEl.dataset.categoriaId = servicio.categoriaId;\r\n        servicioEl.dataset.servicio = servicio.nombre;\r\n        \r\n        // Calcular precio mostrado (con descuento si aplica)\r\n        const precioMostrado = servicio.promo ? \r\n            Math.round(servicio.precio * 0.75) : servicio.precio;\r\n        \r\n        servicioEl.innerHTML = `\r\n            <p class=\"p1\">${servicio.nombre}</p>\r\n            <p class=\"detalles-servicio\">\r\n                <span class=\"${servicio.promo ? 'precio-con-descuento' : ''}\">\r\n                    ${precioMostrado.toLocaleString()}\r\n                    ${servicio.promo ? \r\n                        `<span class=\"precio-original\">${servicio.precio.toLocaleString()}</span>` : \r\n                        ''\r\n                    }\r\n                    <svg\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"18\"\r\n                    height=\"18\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    fill=\"none\"\r\n                    stroke=\"#000000\"\r\n                    stroke-width=\"1\"\r\n                    stroke-linecap=\"round\"\r\n                    stroke-linejoin=\"round\"\r\n                    >\r\n                    <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                    <path d=\"M14.8 9a2 2 0 0 0 -1.8 -1h-2a2 2 0 1 0 0 4h2a2 2 0 1 1 0 4h-2a2 2 0 0 1 -1.8 -1\" />\r\n                    <path d=\"M12 7v10\" />\r\n                    </svg>\r\n                </span>\r\n                <span>${servicio.duracion} min\r\n                    <svg\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"18\"\r\n                    height=\"18\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    fill=\"none\"\r\n                    stroke=\"#000000\"\r\n                    stroke-width=\"1\"\r\n                    stroke-linecap=\"round\"\r\n                    stroke-linejoin=\"round\"\r\n                    >\r\n                    <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                    <path d=\"M12 12l3 -2\" />\r\n                    <path d=\"M12 7v5\" />\r\n                    </svg>\r\n                </span>\r\n            </p>\r\n            ${servicio.promo ? '<div class=\"badge-promo\">-25%</div>' : ''}\r\n            <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n        `;\r\n        \r\n        servicioEl.addEventListener('click', function(e) {\r\n          e.stopPropagation();\r\n          this.classList.toggle('seleccionado');\r\n          actualizarServiciosSeleccionados();\r\n        });\r\n        \r\n        serviciosContainer.appendChild(servicioEl);\r\n      });\r\n    } else {\r\n      // Mostrar mensaje cuando no hay servicios en la categora\r\n      serviciosContainer.innerHTML = '<p class=\"sin-servicios-categoria\">No hay servicios disponibles en esta categora</p>';\r\n      serviciosContainer.classList.add('sin-servicios');\r\n    }\r\n    \r\n    // Evento para expandir/colapsar la categora (toggle individual)\r\n    header.addEventListener('click', function() {\r\n    // Si no hay servicios, no hacer nada al hacer clic\r\n    if (serviciosCategoria.length === 0) return;\r\n    \r\n    const estaAbierto = serviciosContainer.classList.contains('activo');\r\n    \r\n    // Cerrar todas las dems categoras primero\r\n    document.querySelectorAll('.categoria-acordeon .servicios-container.activo').forEach(container => {\r\n        if (container !== serviciosContainer) {\r\n        container.classList.remove('activo');\r\n        container.closest('.categoria-acordeon').querySelector('.categoria-header').classList.remove('activo');\r\n        }\r\n    });\r\n    \r\n    // Alternar esta categora\r\n    serviciosContainer.classList.toggle('activo', !estaAbierto);\r\n    this.classList.toggle('activo', !estaAbierto);\r\n    });\r\n    \r\n    // Si no hay servicios, deshabilitar el header\r\n    if (serviciosCategoria.length === 0) {\r\n      header.classList.add('sin-servicios');\r\n      header.style.cursor = 'default';\r\n      header.querySelector('.acordeon-icon').style.display = 'none';\r\n    }\r\n    \r\n    // Ensamblar la categora\r\n    categoriaEl.appendChild(header);\r\n    categoriaEl.appendChild(serviciosContainer);\r\n    contenedorServicios.appendChild(categoriaEl);\r\n  });\r\n}\r\n\r\nfunction actualizarContadoresCategoria() {\r\n  // Ocultar todos los contadores primero\r\n  document.querySelectorAll('.contador-seleccionados-categoria').forEach(contador => {\r\n    contador.textContent = '';\r\n    contador.classList.remove('mostrar');\r\n  });\r\n  \r\n  // Contar servicios por categora\r\n  const serviciosPorCategoria = {};\r\n  \r\n  datosReserva.servicios.forEach(servicio => {\r\n    if (servicio.categoriaId) {\r\n      if (!serviciosPorCategoria[servicio.categoriaId]) {\r\n        serviciosPorCategoria[servicio.categoriaId] = 0;\r\n      }\r\n      serviciosPorCategoria[servicio.categoriaId]++;\r\n    }\r\n  });\r\n  \r\n  // Actualizar contadores\r\n  Object.keys(serviciosPorCategoria).forEach(categoriaId => {\r\n    const contador = document.querySelector(\r\n      `.categoria-header[data-categoria-id=\"${categoriaId}\"] .contador-seleccionados-categoria`\r\n    );\r\n    \r\n    if (contador && serviciosPorCategoria[categoriaId] > 0) {\r\n      contador.textContent = serviciosPorCategoria[categoriaId];\r\n      // Pequeo retraso para permitir que el DOM se actualice antes de la animacin\r\n      setTimeout(() => {\r\n        contador.classList.add('mostrar');\r\n      }, 10);\r\n    }\r\n  });\r\n}\r\n\r\nfunction debugServicios() {\r\n    console.log(\"=== DEBUG SERVICIOS ===\");\r\n    console.log(\"Servicios disponibles:\", datosReserva.serviciosDisponibles);\r\n    console.log(\"Servicios seleccionados:\", datosReserva.servicios);\r\n    \r\n    // Verificar elementos en el DOM\r\n    const serviciosDOM = document.querySelectorAll('.flotante.servicio');\r\n    serviciosDOM.forEach(serv => {\r\n        console.log(\"Elemento DOM:\", {\r\n            id: serv.getAttribute('data-servicio-id'),\r\n            nombre: serv.getAttribute('data-servicio'),\r\n            categoria: serv.getAttribute('data-categoria-id'),\r\n            texto: serv.textContent\r\n        });\r\n    });\r\n}\r\n\r\nfunction calcularDuracionTotal() {\r\n    return datosReserva.servicios.reduce((total, servicio) => total + servicio.duracion, 0);\r\n}\r\n\r\nasync function avanzarPaso() {\r\n    if (pasoActual >= totalPasos) return;\r\n  \r\n    try {\r\n        toggleLoader(true);\r\n\r\n        // Si estamos avanzando al paso 3, verificar si hay selecciones automticas\r\n        if (pasoActual === 2) {\r\n            const tieneAutomaticos = datosReserva.especialistas.some(esp => esp.id === 'auto');\r\n            \r\n            if (tieneAutomaticos) {\r\n                const success = await buscarEspecialistasAutomaticos();\r\n                if (!success) {\r\n                    toggleLoader(false);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        \r\n        const pasoValido = await validarPaso(pasoActual);\r\n        \r\n        if (!pasoValido) {\r\n            toggleLoader(false);\r\n            return;\r\n        }\r\n\r\n        pasoActual++;\r\n        actualizarInterfaz();\r\n        actualizarResumenContinuo(pasoActual);\r\n        \r\n        // Acciones especficas por paso\r\n        if (pasoActual === 4 && usuarioActual) {\r\n            autocompletarFormulario(usuarioActual);\r\n        }\r\n        \r\n        if (pasoActual === 5) {\r\n            try {\r\n                guardarDatosFormulario();\r\n                actualizarResumen();\r\n                cargarDatosGenerales();\r\n            } catch (error) {\r\n                console.error('Error actualizando resumen:', error);\r\n                mostrarError('Error al generar el resumen. Por favor, recarga la pgina.');\r\n                // Retroceder al paso anterior si hay error\r\n                pasoActual--;\r\n                actualizarInterfaz();\r\n            }\r\n        }\r\n        \r\n        if (pasoActual === 6) {\r\n            // Aqu va la lgica de confirmacin\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al avanzar paso:', error);\r\n        mostrarError('Ocurri un error al procesar la solicitud');\r\n    } finally {\r\n        toggleLoader(false);\r\n    }\r\n}\r\n\r\nfunction retrocederPaso() {\r\n    if (pasoActual > 1) {\r\n        switch (pasoActual) {\r\n            case 2: // Si retrocedemos a servicios\r\n                // Limpiar especialistas y forzar recarga\r\n                datosReserva.especialistas = [];\r\n                // Limpiar selecciones visuales\r\n                document.querySelectorAll('.flotante.especialista.seleccionado').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                });\r\n                document.querySelectorAll('.seleccion-predeterminada.seleccionado').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                    // Restaurar texto predeterminado\r\n                    const infoEspecialista = el.querySelector('.info-especialista');\r\n                    if (infoEspecialista) {\r\n                        infoEspecialista.innerHTML = '<span class=\"texto-predeterminado\">Selecciona un especialista</span>';\r\n                    }\r\n                });\r\n                break;\r\n                \r\n            case 3: // Si retrocedemos a fechas desde horarios\r\n                limpiarSeleccion('horario');\r\n                datosReserva.horario = null;\r\n                break;\r\n                \r\n            case 4: // Si retrocedemos a datos desde resumen\r\n                break;\r\n        }\r\n        \r\n        pasoActual--;\r\n        actualizarInterfaz();\r\n        actualizarResumenContinuo(pasoActual);\r\n        \r\n        // FORZAR RECARGA si volvemos al paso 2 (especialistas)\r\n        if (pasoActual === 2) {\r\n            // Recargar especialistas basado en servicios actuales\r\n            const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            mostrarEspecialistas(categoriasIds);\r\n        }\r\n    }\r\n}\r\n\r\nfunction limpiarSeleccion(tipo) {\r\n    document.querySelectorAll(`.flotante.${tipo}.seleccionado`).forEach(elemento => {\r\n        elemento.classList.remove('seleccionado');\r\n    });\r\n    \r\n    const errorElement = document.getElementById(`error-${tipo}`);\r\n    if (errorElement) {\r\n        errorElement.classList.remove('visible');\r\n    }\r\n}\r\n\r\nfunction actualizarInterfaz() {\r\n    actualizarPasos();\r\n    actualizarBotones();\r\n    actualizarResumenContinuo(pasoActual);\r\n}\r\n\r\nasync function simularReserva() {\r\n  if (pasoActual === totalPasos) {\r\n    const loader = document.getElementById('reserva-loader');\r\n    const btnSiguiente = document.querySelector('.btn-siguiente');\r\n    const errorReserva = document.getElementById('error-reserva');\r\n    const duracionTotal = calcularDuracionTotal();\r\n\r\n    // Ocultar cualquier error previo\r\n    if (errorReserva) errorReserva.style.display = 'none';\r\n    \r\n    btnSiguiente.classList.add('hidden');\r\n    setTimeout(() => {\r\n      loader.style.display = 'inline-block';\r\n    }, 200);\r\n    \r\n    try {\r\n      //  VERIFICAR Y AUTENTICAR USUARIO PRIMERO\r\n      if (!usuarioActual) {\r\n        console.log(' Iniciando autenticacin annima para reserva...');\r\n        await iniciarAutenticacionAnonima();\r\n      }\r\n\r\n      // Validacin completa\r\n      const validacion = await validarDisponibilidadCompleta(\r\n        datosReserva.fecha, \r\n        datosReserva.horario,\r\n        duracionTotal\r\n      );\r\n    \r\n      if (!validacion.disponible) {\r\n        requestAnimationFrame(() => {\r\n          loader.style.display = 'none';\r\n          btnSiguiente.style.display = 'flex';\r\n        });\r\n          \r\n        console.error('Validacin fallida:', validacion);\r\n        \r\n        // Mostrar error en el elemento integrado\r\n        if (errorReserva) {\r\n          errorReserva.textContent = validacion.mensaje || \"El horario ya no est disponible\";\r\n          errorReserva.style.display = 'block';\r\n        }\r\n        return;\r\n      }\r\n\r\n      // DEBUG: Verificar la estructura de datosReserva.especialistas\r\n      console.log('Especialistas en datosReserva:', datosReserva.especialistas);\r\n\r\n      const especialistasPorCategoria = {};\r\n        datosReserva.especialistas.forEach(esp => {\r\n        especialistasPorCategoria[esp.categoriaId] = esp.id;\r\n        });\r\n\r\n      const serviciosIds = datosReserva.servicios.map(s => s.id);\r\n      \r\n      const turnoData = {\r\n        cliente: {\r\n            nombre: datosReserva.nombre,\r\n            email: datosReserva.email,\r\n            telefono: datosReserva.telefono\r\n        },\r\n        serviciosIds: datosReserva.servicios.map(s => s.id), //  Asegurar que esto sea un array de IDs\r\n        fecha: datosReserva.fecha,\r\n        horarioInicio: datosReserva.horario,\r\n        duracionTotal: duracionTotal,\r\n        montoTotal: calcularSubtotal(),\r\n        seaAbonada: datosReserva.reserva,\r\n        observaciones: datosReserva.observacion || '',\r\n        userId: usuarioActual?.uid || null,\r\n        estado: 'pendiente',\r\n        especialistasPorCategoria: especialistasPorCategoria,\r\n        especialistaIds: datosReserva.especialistas.map(esp => esp.id)\r\n        };\r\n\r\n      // DEBUG: Verificar el objeto turnoData antes de guardar\r\n      console.log('Datos del turno a guardar:', turnoData);\r\n      console.log('Usuario actual:', usuarioActual);\r\n\r\n      // Guardar en Firestore\r\n      const turnoGuardado = await firestoreSeguro.guardarTurno(turnoData);\r\n\r\n      if (turnoGuardado) {\r\n        try {\r\n            await window.enviarEmailConfirmacion({\r\n                nombre: datosReserva.nombre,\r\n                email: datosReserva.email,\r\n                fecha: datosReserva.fecha,\r\n                horario: datosReserva.horario,\r\n                servicios: datosReserva.servicios.map(s => s.nombre),\r\n                especialistas: datosReserva.especialistas.map(e => e.nombre),\r\n                reserva: datosReserva.reserva,\r\n                montoTotal: calcularSubtotal()\r\n            });\r\n        } catch (error) {\r\n            console.error('Error al enviar email:', error);\r\n            // No impedir la reserva aunque falle el email\r\n        }\r\n      }\r\n\r\n      // Ocultar loader despues de reserva exitosa\r\n      loader.style.display = 'none';\r\n      \r\n      // Mostrar confirmacin de xito\r\n      mostrarConfirmacion(true);\r\n      \r\n    } catch (error) {\r\n      console.error('Error al reservar:', error);\r\n      // Restaurar UI si hay error\r\n      requestAnimationFrame(() => {\r\n        loader.style.display = 'none';\r\n        btnSiguiente.style.display = 'flex';\r\n      });\r\n      \r\n      // Mostrar error en el elemento integrado\r\n      if (errorReserva) {\r\n        errorReserva.textContent = 'Ocurri un error al procesar la reserva. Por favor, intenta nuevamente.';\r\n        errorReserva.style.display = 'block';\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function completarReserva() {\r\n  let bloqueoId = null;\r\n  \r\n  try {\r\n    // 1. Crear bloqueo (con ID automtico)\r\n    bloqueoId = await firestoreSeguro.bloquearTurnoTemporal(\r\n      datosReserva.fecha,\r\n      datosReserva.horario,\r\n      usuarioActual?.uid || 'anonimo'\r\n    );\r\n\r\n    // 2. Validacin final\r\n    const config = await firestoreSeguro.obtenerConfiguracion();\r\n    const [disponible, turnosSolapados] = await Promise.all([\r\n    firestoreSeguro.verificarDisponibilidad(datosReserva.fecha, datosReserva.horario),\r\n    firestoreSeguro.obtenerTurnosSolapados(\r\n        datosReserva.fecha, \r\n        datosReserva.horario,\r\n        config.duracionTurno\r\n    )\r\n    ]);\r\n\r\n    if (!disponible || turnosSolapados.length > 0) {\r\n      await firestoreSeguro.eliminarBloqueoTemporal(bloqueoId);\r\n      mostrarError(turnosSolapados.length > 0 \r\n        ? `El horario se solapa con un turno existente (${turnosSolapados[0].servicios.join(', ')})`\r\n        : \"El horario ya fue reservado\");\r\n      return;\r\n    }\r\n\r\n    // 3. Guardar turno\r\n    const turnoData = { /* ... tus datos de turno ... */ };\r\n    await firestoreDB.guardarTurno(turnoData);\r\n\r\n    // 4. Limpiar bloqueo\r\n    await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n\r\n    mostrarConfirmacion(true);\r\n  } catch (error) {\r\n    console.error(\"Error en reserva:\", error);\r\n    if (bloqueoId) {\r\n      await firestoreDB.eliminarBloqueoTemporal(bloqueoId).catch(e => console.error(\"Error limpiando bloqueo:\", e));\r\n    }\r\n    mostrarConfirmacion(false);\r\n  }\r\n}\r\n\r\n// Simular disponibilidad de turnos\r\nasync function inicializarDisponibilidad() {\r\n  try {\r\n    const config = await firestoreSeguro.obtenerConfiguracion();\r\n    // console.log(\"Configuracin procesada:\", {\r\n    //   apertura: config.horarioApertura,\r\n    //   cierre: config.horarioCierre,\r\n    //   diasLaborales: config.diasLaborales,\r\n    //   diasNoLaborables: config.diasNoLaborables\r\n    // });\r\n\r\n    const fechasDisponibles = generarFechasDisponibles(config);\r\n    // console.log(\"Fechas generadas:\", fechasDisponibles);\r\n    \r\n    actualizarUIFechas(fechasDisponibles);\r\n  } catch (error) {\r\n    console.error(\"Error inicializando disponibilidad:\", error);\r\n    mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n  }\r\n}\r\n\r\nasync function validarDisponibilidadCompleta(fecha, horario, duracion) {\r\n    try {\r\n        // Agregar validacin para horario\r\n        if (!horario) {\r\n            return {\r\n                disponible: false,\r\n                turnosSolapados: [],\r\n                slotsOcupados: [],\r\n                mensaje: \"Horario no seleccionado\"\r\n            };\r\n        }\r\n\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n        \r\n        // Convertir horario de inicio a minutos\r\n        const [horaStr, minutoStr] = horario.split(':');\r\n        const horaInicio = parseInt(horaStr);\r\n        const minutoInicio = parseInt(minutoStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        const finMinutos = inicioMinutos + duracion;\r\n        \r\n        // Obtener todos los turnos del da para los especialistas seleccionados\r\n        const turnosDelDia = await firestoreDB.obtenerTurnosPorEspecialistasYFecha(especialistasIds, fecha);\r\n        \r\n        // Verificar solapamientos solo para los especialistas seleccionados\r\n        const turnosSolapados = turnosDelDia.filter(turno => {\r\n            const [turnoHora, turnoMinuto] = turno.horarioInicio.split(':').map(Number);\r\n            const turnoInicioMin = turnoHora * 60 + turnoMinuto;\r\n            const turnoFinMin = turnoInicioMin + (turno.duracionTotal || 30);\r\n            \r\n            // Verificar solapamiento\r\n            return !(finMinutos <= turnoInicioMin || inicioMinutos >= turnoFinMin);\r\n        });\r\n        \r\n        // Verificar disponibilidad de cada slot individual para los especialistas seleccionados\r\n        const slotsOcupados = [];\r\n        for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const hora = Math.floor(min / 60);\r\n            const minuto = min % 60;\r\n            const horarioSlot = `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n            \r\n            // Verificar disponibilidad para los especialistas seleccionados\r\n            const disponible = await firestoreDB.verificarDisponibilidadParaEspecialistas(\r\n                fecha, \r\n                horarioSlot, \r\n                especialistasIds\r\n            );\r\n            \r\n            if (!disponible) {\r\n                slotsOcupados.push(horarioSlot);\r\n            }\r\n        }\r\n        \r\n        const disponible = turnosSolapados.length === 0 && slotsOcupados.length === 0;\r\n        \r\n        let mensaje = '';\r\n        if (!disponible) {\r\n            const horas = Math.floor(duracion / 60);\r\n            const minutos = duracion % 60;\r\n            \r\n            mensaje = `Tu turno necesita ${horas > 0 ? horas + ' hora' + (horas > 1 ? 's' : '') + ' y ' : ''}${minutos} minutos continuos.`;\r\n        }\r\n        \r\n        return {\r\n            disponible,\r\n            turnosSolapados,\r\n            slotsOcupados,\r\n            mensaje\r\n        };\r\n    } catch (error) {\r\n        console.error(\"Error en validacin:\", error);\r\n        return {\r\n            disponible: false,\r\n            turnosSolapados: [],\r\n            slotsOcupados: [],\r\n            mensaje: \"Error al verificar disponibilidad. Por favor, intenta nuevamente.\"\r\n        };\r\n    }\r\n}\r\n\r\nasync function cargarFechasDisponibles() {\r\n    if (!datosReserva.especialistas.length) return;\r\n    \r\n    try {\r\n        // Obtener fechas disponibles considerando TODOS los especialistas\r\n        const fechasComunes = await obtenerFechasComunesDisponibles();\r\n        actualizarUIFechas(fechasComunes);\r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n    }\r\n}\r\n\r\nasync function obtenerFechasComunesDisponibles() {\r\n    const config = await firestoreSeguro.obtenerConfiguracion();\r\n    const todasLasFechas = generarFechasDisponibles(config);\r\n    \r\n    // Filtrar fechas donde TODOS los especialistas estn disponibles\r\n    const fechasValidas = [];\r\n    \r\n    for (const fecha of todasLasFechas) {\r\n        const todosDisponibles = await verificarDisponibilidadEspecialistas(fecha);\r\n        if (todosDisponibles) {\r\n            fechasValidas.push(fecha);\r\n        }\r\n    }\r\n    \r\n    return fechasValidas;\r\n}\r\n\r\n// Nueva funcin para generar fechas disponibles\r\nfunction generarFechasDisponibles(config) {\r\n    // Obtener fecha y hora actual en Argentina (UTC-3)\r\n    const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n    const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n    \r\n    // Verificar si ya pas el horario de cierre (usando hora Argentina)\r\n    const [horaCierre, minCierre] = config.horarioCierre.split(':').map(Number);\r\n    const empezarDesdeManana = ahoraArg.getHours() > horaCierre || (ahoraArg.getHours() === horaCierre && ahoraArg.getMinutes() >= minCierre);\r\n\r\n    const fechasDisponibles = [];\r\n    const DIAS_A_MOSTRAR = 7;\r\n    \r\n    // Comenzar desde hoy o maana segn horario\r\n    const diaInicial = empezarDesdeManana ? 1 : 0;\r\n    \r\n    for (let i = diaInicial; i < DIAS_A_MOSTRAR + diaInicial; i++) {\r\n        const fecha = new Date(hoyArg);\r\n        fecha.setDate(hoyArg.getDate() + i);\r\n        \r\n        // Verificar da laboral (usando fecha Argentina)\r\n        if (!esDiaLaboral(fecha, config)) {\r\n            // console.log(`Saltando ${fecha.toDateString()} - No es da laboral`);\r\n            continue;\r\n        }\r\n        \r\n        const fechaStr = fecha.toISOString().split('T')[0];\r\n        \r\n        // Verificar das no laborables\r\n        if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n            // console.log(`Saltando ${fechaStr} - Da no laborable configurado`);\r\n            continue;\r\n        }\r\n        \r\n        // No agregar hoy si ya pas el horario de cierre\r\n        if (i === 0 && empezarDesdeManana) continue;\r\n        \r\n        fechasDisponibles.push({\r\n            fecha: fechaStr,\r\n            display: formatearFechaDisplay(fecha)\r\n        });\r\n    }\r\n    \r\n    // console.log(\"Fechas disponibles generadas:\", fechasDisponibles);\r\n    return fechasDisponibles;\r\n}\r\n\r\nfunction esDiaLaboral(fecha, config) {\r\n  const diaSemana = fecha.getDay(); // 0=Domingo, 1=Lunes, etc.\r\n  \r\n  // Asegurarnos que diasLaborales es un array de nmeros vlidos\r\n  let diasLaborales = [];\r\n  \r\n  try {\r\n    if (Array.isArray(config.diasLaborales)) {\r\n      diasLaborales = config.diasLaborales.map(Number).filter(n => !isNaN(n));\r\n    } else if (typeof config.diasLaborales === 'string') {\r\n      diasLaborales = config.diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n    }\r\n  } catch (e) {\r\n    console.error(\"Error procesando das laborales:\", e);\r\n    diasLaborales = [1,2,3,4,5]; // Valor por defecto: Lunes a Viernes\r\n  }\r\n  \r\n  // Si no hay das definidos, usar valor por defecto\r\n  if (diasLaborales.length === 0) {\r\n    diasLaborales = [1,2,3,4,5];\r\n  }\r\n  \r\n  return diasLaborales.includes(diaSemana);\r\n}\r\n\r\nfunction obtenerFechaSeleccionada() {\r\n  // Asume que la fecha est en formato \"Lunes 9/01\" o similar\r\n  // Necesitas convertir esto a un formato que coincida con tu DB (YYYY-MM-DD)\r\n  if (!datosReserva.fecha) return new Date().toISOString().split('T')[0];\r\n  \r\n  // Implementacin bsica - ajusta segn tu formato de fecha\r\n  const partes = datosReserva.fecha.split(' ');\r\n  const [dia, mes] = partes[1].split('/');\r\n  const ao = new Date().getFullYear();\r\n  \r\n  return `${ao}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;\r\n}\r\n\r\nasync function actualizarUIFechas(fechasDisponibles) {\r\n    console.log(\"Actualizando UI con fechas:\", fechasDisponibles);\r\n    \r\n    // Guardar las fechas disponibles para el calendario\r\n    fechasDisponiblesCalendario = fechasDisponibles || [];\r\n    \r\n    // Ocultar mensaje de carga\r\n    const cargandoFechas = document.querySelector('.cargando-fechas');\r\n    const contenedorCalendario = document.querySelector('.contenedor-calendario');\r\n    const sinFechas = document.querySelector('.sin-fechas');\r\n    \r\n    if (cargandoFechas) cargandoFechas.style.display = 'none';\r\n    \r\n    if (!fechasDisponibles || fechasDisponibles.length === 0) {\r\n        console.log(\"No hay fechas disponibles\");\r\n        if (sinFechas) {\r\n            sinFechas.style.display = 'block';\r\n            sinFechas.textContent = 'No hay fechas disponibles en este momento';\r\n        }\r\n        if (contenedorCalendario) {\r\n            contenedorCalendario.style.display = 'none';\r\n        }\r\n        return;\r\n    }\r\n    \r\n    // Mostrar el calendario\r\n    if (contenedorCalendario) {\r\n        contenedorCalendario.style.display = 'block';\r\n    }\r\n    if (sinFechas) {\r\n        sinFechas.style.display = 'none';\r\n    }\r\n    \r\n    // NUEVA LGICA: Buscar la primera fecha disponible de los especialistas seleccionados\r\n    const primeraFechaDisponible = await obtenerPrimeraFechaDisponibleEspecialistas();\r\n    \r\n    if (primeraFechaDisponible) {\r\n        // Cambiar el calendario al mes de la primera fecha disponible\r\n        const fechaPrimera = new Date(primeraFechaDisponible + 'T03:00:00');\r\n        calendarioFechaActual = new Date(fechaPrimera.getFullYear(), fechaPrimera.getMonth(), 1);\r\n    } else {\r\n        // Fallback: usar la primera fecha disponible de la lista\r\n        calendarioFechaActual = new Date();\r\n    }\r\n    \r\n    // Renderizar el calendario\r\n    renderizarCalendario();\r\n    debugVisualizacionFechas();\r\n    \r\n    // Seleccionar automticamente la primera fecha disponible\r\n    if (primeraFechaDisponible) {\r\n        seleccionarFechaAutomaticamente(primeraFechaDisponible);\r\n    } else if (fechasDisponibles.length > 0) {\r\n        // Fallback: seleccionar la primera fecha de la lista\r\n        seleccionarFechaAutomaticamente(fechasDisponibles[0].fecha);\r\n    }\r\n}\r\n\r\nasync function obtenerPrimeraFechaDisponibleEspecialistas() {\r\n    try {\r\n        if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n            return null;\r\n        }\r\n        \r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        const hoy = new Date();\r\n        const hoyArg = new Date(hoy.toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n        \r\n        // Buscar en los prximos 60 das\r\n        for (let i = 0; i < 60; i++) {\r\n            const fecha = new Date(hoyArg);\r\n            fecha.setDate(hoyArg.getDate() + i);\r\n            const fechaStr = fecha.toISOString().split('T')[0];\r\n            \r\n            // Verificar si es da laboral segn configuracin general\r\n            if (!esDiaLaboral(fecha, config)) {\r\n                continue;\r\n            }\r\n            \r\n            // Verificar das no laborables\r\n            if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n                continue;\r\n            }\r\n            \r\n            // Verificar disponibilidad de TODOS los especialistas seleccionados\r\n            const todosDisponibles = await verificarDisponibilidadEspecialistas(fechaStr);\r\n            \r\n            if (todosDisponibles) {\r\n                console.log(` Primera fecha disponible encontrada: ${fechaStr}`);\r\n                return fechaStr;\r\n            }\r\n        }\r\n        \r\n        console.log(\" No se encontr fecha disponible en los prximos 60 das\");\r\n        return null;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error obteniendo primera fecha disponible:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Inicializar el calendario cuando se cargue la pgina\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    inicializarCalendario();\r\n});\r\n\r\n// Funcin para cargar horarios para una fecha especfica\r\nasync function cargarHorariosParaFecha(fecha) {\r\n    try {\r\n        // Mostrar loader\r\n        const cargandoHorarios = document.querySelector('.cargando-horarios');\r\n        const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n        const sinHorarios = document.querySelector('.sin-horarios');\r\n        \r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'block';\r\n        if (contenedorHorarios) contenedorHorarios.innerHTML = '';\r\n        if (sinHorarios) sinHorarios.style.display = 'none';\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(e => e.id);\r\n        const duracionTotal = calcularDuracionTotal();\r\n        \r\n        console.log(`Buscando horarios para ${fecha} con duracin: ${duracionTotal} minutos`);\r\n        \r\n        // Obtener horarios disponibles considerando todos los especialistas y la duracin\r\n        const horariosDisponibles = await firestoreDB.obtenerHorariosComunesDisponibles(\r\n            fecha, \r\n            especialistasIds, \r\n            duracionTotal\r\n        );\r\n        \r\n        console.log(`Horarios disponibles encontrados: ${horariosDisponibles.length}`);\r\n        \r\n        // Si es hoy, filtrar horarios que ya pasaron\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        let horariosFiltrados = horariosDisponibles;\r\n        \r\n        if (fecha === hoy) {\r\n            // CORRECCIN: Solo filtrar por hora actual, la duracin ya se consider en Firestore\r\n            horariosFiltrados = filtrarHorariosPorHoraActual(horariosDisponibles, duracionTotal);\r\n            console.log(`Horarios despus de filtrar por hora actual: ${horariosFiltrados.length}`);\r\n        }\r\n\r\n        // Ocultar loader\r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'none';\r\n        \r\n        // Actualizar UI\r\n        actualizarUIHorarios(horariosFiltrados);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando horarios:\", error);\r\n        mostrarError(\"No se pudieron cargar los horarios disponibles\");\r\n        \r\n        // Ocultar loader en caso de error\r\n        const cargandoHorarios = document.querySelector('.cargando-horarios');\r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'none';\r\n    }\r\n}\r\n\r\n// Funcin para filtrar horarios por hora actual\r\nfunction filtrarHorariosPorHoraActual(horarios, duracionTotal) {\r\n    const ahora = new Date();\r\n    const horaActual = ahora.getHours();\r\n    const minutoActual = ahora.getMinutes();\r\n    const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n    \r\n    console.log(`Filtrando horarios para hoy - Hora actual: ${horaActual}:${minutoActual}`);\r\n    console.log(`Se requieren horarios despus de: ${tiempoActualMinutos + 30} minutos (${Math.floor((tiempoActualMinutos + 30) / 60)}:${(tiempoActualMinutos + 30) % 60})`);\r\n    \r\n    const horariosFiltrados = horarios.filter(horario => {\r\n        const [horaStr, minutoStr] = horario.split(':');\r\n        const horaHorario = parseInt(horaStr);\r\n        const minutoHorario = parseInt(minutoStr);\r\n        const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n        \r\n        // Solo considerar el buffer de 30 minutos\r\n        return tiempoHorarioMinutos >= (tiempoActualMinutos + 30);\r\n    });\r\n    \r\n    console.log(`Horarios despus de filtrar: ${horariosFiltrados.length}`);\r\n    return horariosFiltrados;\r\n}\r\n\r\nfunction encontrarHorariosComunes(horariosPorEspecialista) {\r\n    const especialistasIds = Object.keys(horariosPorEspecialista);\r\n    if (especialistasIds.length === 0) return [];\r\n    \r\n    // Empezar con los horarios del primer especialista\r\n    let horariosComunes = horariosPorEspecialista[especialistasIds[0]];\r\n    \r\n    // Intersectar con los horarios de los dems especialistas\r\n    for (let i = 1; i < especialistasIds.length; i++) {\r\n        const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n        horariosComunes = horariosComunes.filter(hora => \r\n            horariosEspecialista.includes(hora)\r\n        );\r\n    }\r\n    \r\n    return horariosComunes;\r\n}\r\n\r\nasync function generarHorariosDisponibles(fecha) {\r\n  const [config, turnosOcupados] = await Promise.all([\r\n    this.obtenerConfiguracion(),\r\n    this.obtenerTurnosPorFecha(fecha)\r\n  ]);\r\n  \r\n  const horariosOcupados = turnosOcupados.map(t => t.horario);\r\n  const horarios = this._generarHorarios(config, horariosOcupados, fecha);\r\n  \r\n  // console.log(\"Horarios generados para\", fecha, \":\", horarios);\r\n  return horarios;\r\n}\r\n\r\n// Funcin para actualizar la UI de horarios\r\nfunction actualizarUIHorarios(horariosDisponibles) {\r\n    const contenedor = document.querySelector('.contenedor-horarios');\r\n    const sinHorarios = document.querySelector('.sin-horarios');\r\n    \r\n    if (!contenedor) return;\r\n    \r\n    // Limpiar contenedor\r\n    contenedor.innerHTML = '';\r\n    \r\n    // Mostrar mensaje si no hay horarios\r\n    if (!horariosDisponibles || horariosDisponibles.length === 0) {\r\n        if (sinHorarios) {\r\n            sinHorarios.style.display = 'block';\r\n            sinHorarios.textContent = 'No hay horarios disponibles para esta fecha';\r\n        }\r\n        return;\r\n    }\r\n    \r\n    // Ocultar mensaje de no horarios\r\n    if (sinHorarios) sinHorarios.style.display = 'none';\r\n    \r\n    // Crear elementos de horarios\r\n    horariosDisponibles.forEach(horario => {\r\n        const elemento = document.createElement('div');\r\n        elemento.className = 'flotante horario';\r\n        elemento.dataset.horario = horario;\r\n        \r\n        elemento.innerHTML = `\r\n            <p class=\"p1\">${horario}</p>\r\n            <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n        `;\r\n        \r\n        elemento.addEventListener('click', function() {\r\n            seleccionarHorario(this, horario);\r\n        });\r\n        \r\n        contenedor.appendChild(elemento);\r\n    });\r\n}\r\n\r\nasync function verificarDisponibilidadEnTiempoReal(fecha, horario) {\r\n  try {\r\n    const disponible = await firestoreSeguro.verificarDisponibilidad(fecha, horario);\r\n    if (!disponible) {\r\n      mostrarError('Este horario ya no est disponible. Por favor selecciona otro.');\r\n      // Remover el horario ocupado de la UI\r\n      document.querySelectorAll('.flotante.horario').forEach(el => {\r\n        if (el.textContent.trim() === horario) {\r\n          el.classList.add('ocupado');\r\n          el.removeEventListener('click', manejarClickHorario);\r\n        }\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error verificando disponibilidad:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Funcin auxiliar para crear el contenedor si no existe\r\nfunction crearContenedorHorarios(paso3) {\r\n  const contenedor = document.createElement('div');\r\n  contenedor.className = 'contenedor-horarios';\r\n  paso3.appendChild(contenedor);\r\n  return contenedor;\r\n}\r\n\r\n// Funciones de apoyo\r\nfunction actualizarPasos() {\r\n    elementos.pasos.forEach((paso, index) => {\r\n        paso.classList.toggle('activo', index + 1 === pasoActual);\r\n    });\r\n}\r\n\r\nfunction actualizarBotones() {\r\n    // Ocultar spinner al cambiar de paso\r\n    const loader = document.getElementById('reserva-loader');\r\n    if (loader) loader.style.display = 'none';\r\n\r\n    // Botn anterior\r\n    if (pasoActual === 1) {\r\n        elementos.btnAnterior.classList.remove('activo');\r\n    } else {\r\n        elementos.btnAnterior.classList.add('activo');\r\n    }\r\n    \r\n    // Limpiar eventos previos del botn siguiente\r\n    elementos.btnSiguiente.replaceWith(elementos.btnSiguiente.cloneNode(true));\r\n    elementos.btnSiguiente = document.querySelector('.btn-siguiente');\r\n    \r\n    // Configurar botn siguiente segn el paso actual\r\n    if (pasoActual === totalPasos) {\r\n        elementos.btnSiguiente.classList.add('btn-reserva');\r\n        elementos.btnSiguiente.innerHTML = `\r\n            <span class=\"circulo\" aria-hidden=\"true\">\r\n                <span class=\"icono-flecha flecha\"></span>\r\n            </span>\r\n            <span class=\"texto-reserva\">Reservar</span>\r\n        `;\r\n        elementos.btnSiguiente.addEventListener('click', async () => {\r\n            await simularReserva();\r\n        });\r\n    } else {\r\n        elementos.btnSiguiente.classList.remove('btn-reserva');\r\n        elementos.btnSiguiente.innerHTML = `\r\n            <svg class=\"flecha\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n                <path d=\"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z\" fill=\"ffffff\"/>\r\n            </svg>\r\n        `;\r\n        elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    }\r\n}\r\n\r\nfunction seleccionarElemento(elemento, tipo) {\r\n    // Si ya est seleccionado y es servicio, deseleccionar\r\n    if (elemento.classList.contains('seleccionado') && tipo === 'servicio') {\r\n        elemento.classList.remove('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n        return;\r\n    }\r\n\r\n    // Para servicios (seleccin mltiple)\r\n    if (tipo === 'servicio') {\r\n        elemento.classList.add('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n    } \r\n    // Para fechas/horarios (seleccin nica)\r\n    else {\r\n        document.querySelectorAll(`.flotante.${tipo}`).forEach(el => {\r\n            el.classList.remove('seleccionado');\r\n        });\r\n        elemento.classList.add('seleccionado');\r\n        datosReserva[tipo] = elemento.querySelector('.p1').textContent;\r\n        \r\n        // Remover mensaje de error si se selecciona\r\n        if (tipo === 'fecha') {\r\n            document.getElementById('error-fecha').classList.remove('visible');\r\n        } else if (tipo === 'horario') {\r\n            document.getElementById('error-horario').classList.remove('visible');\r\n        }\r\n    }\r\n}\r\n\r\nasync function validarPaso(paso) {\r\n    const pasoElement = document.querySelector(`.paso-${paso}`);\r\n    if (!pasoElement) {\r\n        console.error(`Elemento del paso ${paso} no encontrado`);\r\n        return false;\r\n    }\r\n\r\n    // Ocultar todos los mensajes de error primero\r\n    const errores = pasoElement.querySelectorAll('.error-mensaje');\r\n    if (errores) {\r\n        errores.forEach(msg => msg.classList.remove('visible'));\r\n    }\r\n\r\n    switch (paso) {\r\n        case 1: \r\n        const errorServicio = pasoElement.querySelector('#error-servicio');\r\n        if (datosReserva.servicios.length === 0) {\r\n            if (errorServicio) {\r\n                errorServicio.classList.add('visible');\r\n                errorServicio.style.animation = 'shake 0.5s';\r\n                setTimeout(() => errorServicio.style.animation = '', 500);\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n            \r\n        case 2: // Validacin especialistas\r\n            const errorEspecialista = document.getElementById('error-especialista');\r\n            \r\n            // Verificar que tenemos un especialista para cada categora de servicios seleccionados\r\n            const categoriasServicios = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            const categoriasConEspecialista = [...new Set(datosReserva.especialistas.map(e => e.categoriaId))];\r\n            \r\n            const todasCategoriasCubiertas = categoriasServicios.every(categoriaId => \r\n                categoriasConEspecialista.includes(categoriaId)\r\n            );\r\n            \r\n            if (!todasCategoriasCubiertas) {\r\n                if (errorEspecialista) {\r\n                    errorEspecialista.textContent = 'Selecciona un especialista para cada categora de servicios!';\r\n                    errorEspecialista.classList.add('visible');\r\n                }\r\n                return false;\r\n            }\r\n            return true;\r\n            \r\n        case 3: // Fechas y Horarios\r\n            const errorFecha = document.getElementById('error-fecha');\r\n            const errorHorario = document.getElementById('error-horario');\r\n            \r\n            // DEBUG: Verificar los valores actuales\r\n            console.log('Validando paso 3 - fecha:', datosReserva.fecha, 'horario:', datosReserva.horario);\r\n            \r\n            if (!datosReserva.fecha) {\r\n                if (errorFecha) errorFecha.classList.add('visible');\r\n                return false;\r\n            }\r\n            \r\n            if (!datosReserva.horario) {\r\n                if (errorHorario) errorHorario.classList.add('visible');\r\n                return false;\r\n            }\r\n            \r\n            // Validar disponibilidad en tiempo real\r\n            toggleLoader(true);\r\n            try {\r\n                const duracionTotal = calcularDuracionTotal();\r\n                const validacion = await validarDisponibilidadCompleta(\r\n                    datosReserva.fecha, \r\n                    datosReserva.horario,\r\n                    duracionTotal\r\n                );\r\n                \r\n                if (!validacion.disponible || validacion.turnosSolapados.length > 0) {\r\n                    mostrarError(validacion.mensaje || 'El horario ya no est disponible para la duracin requerida');\r\n                    return false;\r\n                }\r\n                return true;\r\n            } finally {\r\n                toggleLoader(false);\r\n            }\r\n            \r\n        case 4:\r\n            // Validacin de campos del formulario\r\n            const formularioValido = validarFormulario();\r\n            \r\n            if (!formularioValido) {\r\n                // Mostrar mensaje general de error\r\n                const errorGeneral = document.createElement('div');\r\n                errorGeneral.className = 'error-general visible';\r\n                errorGeneral.innerHTML = `\r\n                    <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\">\r\n                        <path fill=\"#ff6b6b\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n                    </svg>\r\n                    <span>Completa todos los campos correctamente para continuar</span>\r\n                `;\r\n                \r\n                return false;\r\n            }\r\n            \r\n            // Si el formulario es vlido, quitar cualquier error general\r\n            const errorGeneralExistente = document.querySelector('.error-general');\r\n            if (errorGeneralExistente) {\r\n                errorGeneralExistente.remove();\r\n            }\r\n            \r\n            return true;\r\n            \r\n        case 5:\r\n            return validarFormulario();\r\n            \r\n        default:\r\n            return true;\r\n    }\r\n}\r\n\r\nfunction validarFormulario() {\r\n    let valido = true;\r\n    \r\n    // Ocultar todos los mensajes de error primero\r\n    document.querySelectorAll('.error-mensaje').forEach(msg => {\r\n        msg.classList.remove('visible');\r\n    });\r\n    \r\n    // Validar cada campo\r\n    const nombreValido = validarNombre();\r\n    const emailValido = validarEmail();\r\n    const telefonoValido = validarTelefono();\r\n    \r\n    // Mostrar errores generales si los campos estn vacos\r\n    if (!document.getElementById('nombre').value.trim()) {\r\n        document.getElementById('error-nombre').textContent = 'El nombre es obligatorio';\r\n        document.getElementById('error-nombre').classList.add('visible');\r\n        document.getElementById('nombre').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    if (!document.getElementById('email').value.trim()) {\r\n        document.getElementById('error-email').textContent = 'El email es obligatorio';\r\n        document.getElementById('error-email').classList.add('visible');\r\n        document.getElementById('email').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    if (!document.getElementById('telefono').value) {\r\n        document.getElementById('error-telefono').textContent = 'El telfono es obligatorio';\r\n        document.getElementById('error-telefono').classList.add('visible');\r\n        document.getElementById('telefono').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    // Si hay valores pero son invlidos\r\n    if (!nombreValido && document.getElementById('nombre').value.trim()) {\r\n        valido = false;\r\n    }\r\n    \r\n    if (!emailValido && document.getElementById('email').value.trim()) {\r\n        valido = false;\r\n    }\r\n    \r\n    if (!telefonoValido && document.getElementById('telefono').value) {\r\n        valido = false;\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction guardarDatosFormulario() {\r\n    datosReserva.nombre = document.getElementById('nombre').value.trim();\r\n    datosReserva.email = document.getElementById('email').value.trim();\r\n    datosReserva.telefono = document.getElementById('telefono').value.trim();\r\n    datosReserva.observacion = document.getElementById('observacion').value.trim() || 'Sin observaciones';\r\n}\r\n\r\nfunction actualizarResumen() {\r\n    guardarDatosFormulario();\r\n\r\n    // 1. Datos del cliente\r\n    elementos.resumenNombre.textContent = datosReserva.nombre || \"[No ingresado]\";\r\n    elementos.resumenEmail.textContent = datosReserva.email || \"[No ingresado]\";\r\n    elementos.resumenTelefono.textContent = datosReserva.telefono || \"[No ingresado]\";\r\n}\r\n\r\n// Funcin para calcular la sea basada en la duracin\r\nfunction calcularSenia() {\r\n    const duracionTotal = calcularDuracionTotal();\r\n    // $1.000 por cada 30 minutos, redondeando hacia arriba\r\n    const multiplicador = Math.ceil(duracionTotal / 30);\r\n    return multiplicador * 1000;\r\n}\r\n\r\nfunction validarNombre() {\r\n    const input = document.getElementById('nombre');\r\n    const errorMsg = document.getElementById('error-nombre');\r\n    const valor = input.value.trim();\r\n    \r\n    // Validar que tenga al menos 2 palabras con mnimo 2 caracteres cada una\r\n    const palabras = valor.split(' ').filter(word => word.length > 1);\r\n    const valido = palabras.length >= 1 && valor.length >= 5;\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'Debe tener al menos 5 caracteres';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction validarTelefono() {\r\n    const input = document.getElementById('telefono');\r\n    const errorMsg = document.getElementById('error-telefono');\r\n    const valor = input.value.replace(/\\D/g, ''); // Solo nmeros\r\n    const valido = valor.length === 10; // 10 dgitos para Argentina\r\n    \r\n    // Actualizar el valor solo con nmeros\r\n    input.value = valor;\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'El telfono debe tener 10 nmeros';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\n// Nueva funcin para validar email\r\nfunction validarEmail() {\r\n    const input = document.getElementById('email');\r\n    const errorMsg = document.getElementById('error-email');\r\n    const valor = input.value.trim();\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    const valido = emailRegex.test(valor);\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'Ingresa un email vlido';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction mostrarConfirmacion() {\r\n    // Ocultar todos los pasos\r\n    document.querySelectorAll('.paso').forEach(paso => {\r\n        paso.classList.remove('activo');\r\n    });\r\n    \r\n    // Ocultar resumen continuo\r\n    const resumenContinuo = document.querySelector('.resumen-continuo');\r\n    if (resumenContinuo) {\r\n        resumenContinuo.style.display = 'none';\r\n    }\r\n    \r\n    // Mostrar paso 6\r\n    const paso6 = document.querySelector('.paso-6');\r\n    paso6.classList.add('activo');\r\n    \r\n    // SVG para xito (usando tu SVG actual)\r\n    const successSVG = `\r\n    <div class=\"check-icon\">\r\n        <span class=\"icon-line line-tip\"></span>\r\n        <span class=\"icon-line line-long\"></span>\r\n        <div class=\"icon-circle\"></div>\r\n        <div class=\"icon-fix\"></div>\r\n    </div>\r\n    `;\r\n    \r\n    // Botn SVG (usando tu SVG actual)\r\n    const buttonSVG = `\r\n        <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"20\"\r\n        height=\"20\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"1.5\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M15 4.55a8 8 0 0 0 -6 14.9m0 -4.45v5h-5\" />\r\n        <path d=\"M18.37 7.16l0 .01\" />\r\n        <path d=\"M13 19.94l0 .01\" />\r\n        <path d=\"M16.84 18.37l0 .01\" />\r\n        <path d=\"M19.37 15.1l0 .01\" />\r\n        <path d=\"M19.94 11l0 .01\" />\r\n        </svg>\r\n    `;\r\n\r\n    // Mostrar solo el estado de xito\r\n    const exitoContainer = document.querySelector('.paso-6 .exito');\r\n    exitoContainer.innerHTML = `\r\n        ${successSVG}\r\n        <h2>Turno reservado!</h2>\r\n        <p>Buensimo <span>${datosReserva.nombre || 'cliente'}</span>, recibirs un email de confirmacin con los datos de tu reserva.</p>\r\n        <p class=\"nos-vemos\">Nos vemos en el local!</p>\r\n    `;\r\n    \r\n    document.querySelector('.paso-6 .exito').classList.add('visible');\r\n    \r\n    // Ocultar controles de navegacin\r\n    elementos.btnAnterior.style.display = 'none';\r\n    elementos.btnSiguiente.style.display = 'none';\r\n    \r\n    // Botn para nueva reserva\r\n    if (!document.getElementById('nueva-reserva')) {\r\n        const botonNuevaReserva = `\r\n            <button id=\"nueva-reserva\" class=\"btn-reserva\">\r\n                ${buttonSVG}\r\n                Volver\r\n            </button>\r\n        `;\r\n        paso6.insertAdjacentHTML('beforeend', botonNuevaReserva);\r\n        \r\n        document.getElementById('nueva-reserva').addEventListener('click', () => {\r\n            location.reload();\r\n        });\r\n    }\r\n}\r\n\r\n// Funcin para probar el paso 6 sin hacer una reserva real\r\nfunction demoPaso6() {\r\n    // Simular datos de reserva\r\n    const datosDemo = {\r\n        servicios: [\r\n            { nombre: 'Corte de pelo', precio: 15000, duracion: 30 },\r\n            { nombre: 'Teido', precio: 40000, duracion: 60 }\r\n        ],\r\n        fecha: '2025-01-20',\r\n        horario: '10:00',\r\n        nombre: 'Cliente Demo',\r\n        email: 'demo@email.com',\r\n        telefono: '1234567890',\r\n        reserva: 1000,\r\n        especialistas: [\r\n            { id: 'esp_1', nombre: 'Especialista Demo', categoriaId: 'cat_1' }\r\n        ]\r\n    };\r\n    \r\n    // Guardar datos de demo\r\n    datosReserva = { ...datosReserva, ...datosDemo };\r\n    \r\n    // Ocultar todos los pasos\r\n    document.querySelectorAll('.paso').forEach(paso => {\r\n        paso.classList.remove('activo');\r\n    });\r\n    \r\n    // Mostrar paso 6\r\n    const paso6 = document.querySelector('.paso-6');\r\n    paso6.classList.add('activo');\r\n    \r\n    // Mostrar confirmacin\r\n    mostrarConfirmacion();\r\n    \r\n    // Ocultar botones de navegacin\r\n    elementos.btnAnterior.style.display = 'none';\r\n    elementos.btnSiguiente.style.display = 'none';\r\n}\r\n\r\n// Hacer la funcin accesible globalmente para probar desde la consola\r\nwindow.demoPaso6 = demoPaso6;\r\n\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n\r\nfunction seleccionarEspecialista(elemento, especialista, categoriaId) {\r\n    // Validar parmetros\r\n    if (!especialista || !categoriaId) {\r\n        console.error('Parmetros invlidos en seleccionarEspecialista:', { elemento, especialista, categoriaId });\r\n        return;\r\n    }\r\n    \r\n    // Obtener el contenedor de la categora\r\n    const categoriaSection = document.querySelector(`.categoria-especialistas[data-categoria-id=\"${categoriaId}\"]`);\r\n    if (!categoriaSection) return;\r\n    \r\n    const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n    const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n    const infoEspecialista = seleccionPredeterminada.querySelector('.info-especialista');\r\n    \r\n    // Verificar si ya est seleccionado para esta categora\r\n    const especialistaExistenteIndex = datosReserva.especialistas.findIndex(\r\n        e => e.categoriaId === categoriaId\r\n    );\r\n    \r\n    // Si ya hay un especialista para esta categora, eliminarlo\r\n    if (especialistaExistenteIndex !== -1) {\r\n        datosReserva.especialistas.splice(especialistaExistenteIndex, 1);\r\n    }\r\n    \r\n    //  MEJORAR: Obtener la foto del especialista\r\n    let fotoUrl = 'img/avatar-default.png';\r\n    if (especialista.fotoUrl) {\r\n        fotoUrl = especialista.fotoUrl;\r\n    } else if (elemento) {\r\n        const img = elemento.querySelector('.avatar-especialista');\r\n        if (img) fotoUrl = img.src;\r\n    }\r\n    \r\n    // Guardar datos\r\n    datosReserva.especialistas.push({\r\n        id: especialista.id,\r\n        nombre: especialista.nombre,\r\n        categoriaId: categoriaId,\r\n        fotoUrl: fotoUrl //  GUARDAR LA FOTO CONSISTENTEMENTE\r\n    });\r\n    \r\n    // Remover error si existe\r\n    const errorEspecialista = document.getElementById('error-especialista');\r\n    if (errorEspecialista) errorEspecialista.classList.remove('visible');\r\n    \r\n    // Actualizar la UI\r\n    \r\n    // 1. Deseleccionar todos los especialistas en esta categora\r\n    especialistasContainer.querySelectorAll('.flotante.especialista').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // 2. Seleccionar el elemento clickeado\r\n    if (elemento) {\r\n        elemento.classList.add('seleccionado');\r\n    }\r\n    \r\n    // 3. Actualizar la seleccin predeterminada\r\n    seleccionPredeterminada.classList.add('seleccionado');\r\n    \r\n    // Actualizar solo el contenido de info-especialista, no todo el HTML\r\n    if (especialista.id === 'auto') {\r\n        infoEspecialista.innerHTML = `\r\n            <span class=\"texto-predeterminado\">Con quien tenga disponibilidad</span>\r\n        `;\r\n    } else {\r\n        // Buscar el especialista en la lista para obtener ms datos (como la foto)\r\n        const especialistaCompleto = Array.from(especialistasContainer.querySelectorAll('.flotante.especialista'))\r\n            .find(el => el.dataset.id === especialista.id);\r\n        \r\n        let avatarUrl = 'img/avatar-default.png';\r\n        if (especialistaCompleto) {\r\n            const img = especialistaCompleto.querySelector('.avatar-especialista');\r\n            if (img) avatarUrl = img.src;\r\n        }\r\n        \r\n        infoEspecialista.innerHTML = `\r\n            <img src=\"${avatarUrl}\" alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n            <div>\r\n                <span class=\"nombre-especialista\">${especialista.nombre}</span>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    // El botn con el SVG ya existe, no necesitamos recrearlo\r\n    // Solo necesitamos asegurarnos de que el evento est configurado\r\n    \r\n    // Configurar el evento del botn si no est configurado\r\n    const btnVerEspecialistas = seleccionPredeterminada.querySelector('.btn-ver-especialistas');\r\n    if (btnVerEspecialistas && !btnVerEspecialistas.hasEventListener) {\r\n        btnVerEspecialistas.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas primero\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        });\r\n        \r\n        // Marcar que este botn ya tiene el event listener\r\n        btnVerEspecialistas.hasEventListener = true;\r\n    }\r\n    \r\n    if (pasoActual >= 2) {\r\n        actualizarResumenEspecialistas();\r\n    }\r\n\r\n    // FORZAR RECARGA de fechas cuando cambia la seleccin\r\n    limpiarFechasYHorarios();\r\n    \r\n    console.log(\"Especialistas seleccionados:\", datosReserva.especialistas);\r\n}\r\n\r\nasync function mostrarEspecialistas(categoriasIds) {\r\n    try {\r\n        console.log(' mostrarEspecialistas llamado con:', categoriasIds);\r\n        console.log(' Estado de datosReserva:', {\r\n            servicios: datosReserva.servicios,\r\n            serviciosLength: datosReserva.servicios ? datosReserva.servicios.length : 'null',\r\n            categorias: datosReserva.categorias ? datosReserva.categorias.length : 'null'\r\n        });\r\n        \r\n        const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n        \r\n        // VALIDACIN CRTICA: Verificar que el contenedor existe\r\n        if (!contenedorEspecialistas) {\r\n            console.error(\" No se encontr el contenedor de especialistas\");\r\n            return;\r\n        }\r\n\r\n        // VALIDACIN CRTICA: Verificar que categoriasIds es vlido\r\n        if (!categoriasIds || !Array.isArray(categoriasIds)) {\r\n            console.warn(\" categoriasIds no es un array vlido:\", categoriasIds);\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Error al cargar especialistas</p>';\r\n            return;\r\n        }\r\n\r\n        // VALIDACIN CRTICA: Verificar que tenemos datos de categoras\r\n        if (!datosReserva.categorias || !Array.isArray(datosReserva.categorias)) {\r\n            console.warn(\" No hay categoras cargadas en datosReserva\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Cargando categoras...</p>';\r\n            \r\n            // Intentar cargar categoras si no estn disponibles\r\n            try {\r\n                datosReserva.categorias = await firestoreSeguro.obtenerCategorias();\r\n                console.log(' Categoras cargadas:', datosReserva.categorias.length);\r\n            } catch (error) {\r\n                console.error(\" Error cargando categoras:\", error);\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Error al cargar categoras</p>';\r\n                return;\r\n            }\r\n        }\r\n\r\n        contenedorEspecialistas.innerHTML = '';\r\n        \r\n        // LIMPIAR COMPLETAMENTE las selecciones anteriores\r\n        datosReserva.especialistas = [];\r\n        \r\n        //  VALIDACIN CRTICA: Verificar que datosReserva.servicios existe y es un array\r\n        if (!datosReserva.servicios) {\r\n            console.warn(\" datosReserva.servicios es null/undefined, inicializando a array vaco\");\r\n            datosReserva.servicios = [];\r\n        }\r\n        \r\n        if (!Array.isArray(datosReserva.servicios)) {\r\n            console.warn(\" datosReserva.servicios no es un array:\", datosReserva.servicios);\r\n            datosReserva.servicios = [];\r\n        }\r\n\r\n        //  VALIDACIN ADICIONAL: Verificar que el array no est vaco\r\n        if (datosReserva.servicios.length === 0) {\r\n            console.warn(\" datosReserva.servicios est vaco\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            return;\r\n        }\r\n        \r\n        console.log(' datosReserva.servicios es vlido:', datosReserva.servicios.length, 'servicios');\r\n        \r\n        // Agrupar servicios por categora CON VALIDACIN\r\n        const serviciosPorCategoria = {};\r\n        \r\n        console.log(' Procesando servicios...');\r\n        //  CDIGO SEGURO: Ahora sabemos que datosReserva.servicios es un array vlido\r\n        datosReserva.servicios.forEach((servicio, index) => {\r\n            console.log(` Procesando servicio ${index}:`, servicio);\r\n            \r\n            //  VALIDACIN EXTRA PARA CADA SERVICIO\r\n            if (!servicio) {\r\n                console.warn(` Servicio ${index} es null/undefined, omitiendo`);\r\n                return;\r\n            }\r\n            \r\n            if (servicio.categoriaId && servicio.nombre) {\r\n                if (!serviciosPorCategoria[servicio.categoriaId]) {\r\n                    serviciosPorCategoria[servicio.categoriaId] = [];\r\n                }\r\n                if (!serviciosPorCategoria[servicio.categoriaId].includes(servicio.nombre)) {\r\n                    serviciosPorCategoria[servicio.categoriaId].push(servicio.nombre);\r\n                }\r\n            } else {\r\n                console.warn(` Servicio ${index} no tiene categoriaId o nombre:`, servicio);\r\n            }\r\n        });\r\n\r\n        console.log(' Servicios por categora:', serviciosPorCategoria);\r\n\r\n        if (Object.keys(serviciosPorCategoria).length === 0) {\r\n            console.warn(\" No se encontraron servicios vlidos agrupados por categora\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios vlidos primero</p>';\r\n            return;\r\n        }\r\n\r\n        console.log(' Creando UI para especialistas...');\r\n\r\n        // Para cada categora con servicios seleccionados, mostrar sus especialistas\r\n        for (const categoriaId of Object.keys(serviciosPorCategoria)) {\r\n            const serviciosEnCategoria = serviciosPorCategoria[categoriaId];\r\n            if (!serviciosEnCategoria || serviciosEnCategoria.length === 0) {\r\n                console.warn(` Categora ${categoriaId} no tiene servicios, omitiendo`);\r\n                continue;\r\n            }\r\n            \r\n            const categoria = datosReserva.categorias.find(c => c.id === categoriaId);\r\n            if (!categoria) {\r\n                console.warn(` No se encontr categora con id ${categoriaId}`);\r\n                continue;\r\n            }\r\n            \r\n            console.log(` Procesando categora: ${categoria.nombre}`);\r\n            \r\n            // Formatear nombres de servicios para esta categora\r\n            let serviciosTexto = '';\r\n            if (serviciosEnCategoria.length === 1) {\r\n                serviciosTexto = serviciosEnCategoria[0];\r\n            } else if (serviciosEnCategoria.length === 2) {\r\n                serviciosTexto = serviciosEnCategoria.join(' + ');\r\n            } else if (serviciosEnCategoria.length > 2) {\r\n                serviciosTexto = serviciosEnCategoria[0] + ' + ' + (serviciosEnCategoria.length - 1) + ' servicios ms';\r\n            }\r\n            \r\n            // Crear seccin para esta categora\r\n            const categoriaSection = document.createElement('div');\r\n            categoriaSection.className = 'categoria-especialistas';\r\n            categoriaSection.dataset.categoriaId = categoriaId;\r\n            \r\n            categoriaSection.innerHTML = `\r\n                <h3><span>${serviciosTexto}</span> con:</h3>\r\n                <div class=\"seleccion-predeterminada\" data-categoria-id=\"${categoriaId}\">\r\n                    <div class=\"info-especialista\">\r\n                        <span class=\"texto-predeterminado\">Selecciona un especialista</span>\r\n                    </div>\r\n                    <div class=\"botones-especialista\">\r\n                        <button class=\"btn-ver-especialistas\">\r\n                            <svg\r\n                            class=\"acordeon-icon\" \r\n                            width=\"18\"\r\n                            height=\"18\"\r\n                            viewBox=\"0 0 24 24\"\r\n                            fill=\"none\"\r\n                            stroke=\"currentColor\"\r\n                            stroke-width=\"2\"\r\n                            stroke-linecap=\"round\"\r\n                            stroke-linejoin=\"round\"\r\n                            >\r\n                            <path d=\"M18 6l-12 12\" />\r\n                            <path d=\"M6 6l12 12\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"especialistas-lista\" data-categoria-id=\"${categoriaId}\">\r\n                    <!-- Los especialistas se agregarn aqu -->\r\n                </div>\r\n            `;\r\n            \r\n            // Obtener especialistas para esta categora\r\n            console.log(` Obteniendo especialistas para categora: ${categoriaId}`);\r\n            let especialistas = await firestoreSeguro.obtenerEspecialistasPorCategoria(categoriaId);\r\n            \r\n            //  CORRECCIN CRTICA: Asegurar que especialistas siempre sea un array\r\n            if (!especialistas) {\r\n                console.warn(` especialistas es null para categora ${categoriaId}, forzando a array vaco`);\r\n                especialistas = [];\r\n            } else if (!Array.isArray(especialistas)) {\r\n                console.warn(` especialistas no es un array para categora ${categoriaId}:`, especialistas);\r\n                especialistas = [];\r\n            }\r\n            \r\n            console.log(` Especialistas obtenidos: ${especialistas.length} para ${categoriaId}`);\r\n            \r\n            if (especialistas.length === 0) {\r\n                categoriaSection.querySelector('.especialistas-lista').innerHTML = \r\n                    '<p class=\"sin-especialistas\">No hay especialistas disponibles</p>';\r\n            } else {\r\n                const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n                const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n                const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n                \r\n                // Agregar opcin \"Con quien tenga disponibilidad\"\r\n                const opcionDisponibilidad = document.createElement('div');\r\n                opcionDisponibilidad.className = 'flotante especialista opcion-disponibilidad';\r\n                opcionDisponibilidad.dataset.id = 'auto';\r\n                opcionDisponibilidad.dataset.categoriaId = categoriaId;\r\n                opcionDisponibilidad.innerHTML = `\r\n                    <div class=\"info-especialista\">\r\n                        <p class=\"p1\">Con quien tenga disponibilidad</p>\r\n                        <p class=\"detalles-especialista\">Seleccionaremos el especialista con mejor disponibilidad</p>\r\n                    </div>\r\n                    <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                        <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n                    </svg>\r\n                `;\r\n                \r\n                opcionDisponibilidad.addEventListener('click', (e) => {\r\n                    e.stopPropagation();\r\n                    seleccionarEspecialista(opcionDisponibilidad, {id: 'auto', nombre: 'Con quien tenga disponibilidad'}, categoriaId);\r\n                });\r\n                \r\n                especialistasContainer.appendChild(opcionDisponibilidad);\r\n                \r\n                // Crear elementos para cada especialista\r\n                especialistas.forEach(especialista => {\r\n                    const elemento = document.createElement('div');\r\n                    elemento.className = 'flotante especialista';\r\n                    elemento.dataset.id = especialista.id;\r\n                    elemento.dataset.categoriaId = categoriaId;\r\n                    \r\n                    // Informacin adicional para el especialista\r\n                    const infoAdicional = especialista.descripcion ? \r\n                        `<div class=\"especialista-info-adicional\">${especialista.descripcion}</div>` : '';\r\n                    \r\n                    const calificacion = especialista.calificacion ? \r\n                        `<div class=\"especialista-calificacion\">\r\n                            <span class=\"estrella\"></span>\r\n                            <span>${especialista.calificacion}</span>\r\n                        </div>` : '';\r\n                    \r\n                    elemento.innerHTML = `\r\n                        <img src=\"${especialista.fotoUrl || 'img/avatar-default.png'}\" \r\n                             alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n                        <div class=\"info-especialista\">\r\n                            <p class=\"p1\">${especialista.nombre}</p>\r\n                            ${infoAdicional}\r\n                            ${calificacion}\r\n                        </div>\r\n                        <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                            <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n                        </svg>\r\n                    `;\r\n                    \r\n                    elemento.addEventListener('click', (e) => {\r\n                        e.stopPropagation();\r\n                        seleccionarEspecialista(elemento, especialista, categoriaId);\r\n                    });\r\n                    \r\n                    especialistasContainer.appendChild(elemento);\r\n                });\r\n                \r\n                // Agregar evento al botn para mostrar/ocultar especialistas\r\n                btnVerEspecialistas.addEventListener('click', (e) => {\r\n                    e.stopPropagation();\r\n                    const lista = categoriaSection.querySelector('.especialistas-lista');\r\n                    const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n                    const estaAbierto = lista.classList.contains('abierto');\r\n                    \r\n                    // Cerrar todas las dems listas primero\r\n                    document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                        if (l !== lista) {\r\n                            l.classList.remove('abierto');\r\n                            const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                            if (otherIcon) otherIcon.classList.remove('girado');\r\n                        }\r\n                    });\r\n                    \r\n                    // Alternar esta lista\r\n                    lista.classList.toggle('abierto', !estaAbierto);\r\n                    icono.classList.toggle('girado', !estaAbierto);\r\n                });\r\n            }\r\n            \r\n            contenedorEspecialistas.appendChild(categoriaSection);\r\n        }\r\n        \r\n        console.log(' mostrarEspecialistas completado exitosamente');\r\n        \r\n    } catch (error) {\r\n        console.error(\" Error crtico en mostrarEspecialistas:\", error);\r\n        console.error(\" Stack trace:\", error.stack);\r\n        const contenedor = document.querySelector('.contenedor-especialistas');\r\n        if (contenedor) {\r\n            contenedor.innerHTML = '<p class=\"sin-especialistas\">Error al cargar especialistas. Intenta nuevamente.</p>';\r\n        }\r\n    }\r\n}\r\n\r\nfunction actualizarUIEspecialistas(especialistas) {\r\n    const paso2 = document.querySelector('.paso-2');\r\n    if (!paso2) return;\r\n    \r\n    const contenedor = paso2.querySelector('.contenedor-especialistas');\r\n    const plantilla = paso2.querySelector('.flotante.especialista');\r\n    const sinEspecialistas = paso2.querySelector('.sin-especialistas');\r\n    \r\n    // Limpiar contenedor\r\n    contenedor.innerHTML = '';\r\n    \r\n    if (especialistas.length === 0) {\r\n        if (sinEspecialistas) sinEspecialistas.style.display = 'block';\r\n        return;\r\n    }\r\n    \r\n    // Crear elementos de especialistas\r\n    especialistas.forEach(especialista => {\r\n        const elemento = plantilla.cloneNode(true);\r\n        elemento.style.display = 'flex';\r\n        elemento.dataset.id = especialista.id;\r\n        \r\n        elemento.querySelector('.p1').textContent = especialista.nombre;\r\n        elemento.querySelector('.p2').textContent = especialista.categorias.join(', ');\r\n        \r\n        elemento.addEventListener('click', () => {\r\n            seleccionarEspecialista(elemento, especialista);\r\n        });\r\n        \r\n        contenedor.appendChild(elemento);\r\n    });\r\n}\r\n\r\nasync function buscarEspecialistasAutomaticos() {\r\n    try {\r\n        const especialistasAutomaticos = datosReserva.especialistas.filter(esp => esp.id === 'auto');\r\n        \r\n        for (const espAuto of especialistasAutomaticos) {\r\n            const mejorEspecialista = await obtenerEspecialistaConMejorDisponibilidad(espAuto.categoriaId);\r\n            \r\n            if (mejorEspecialista) {\r\n                // Reemplazar la seleccin automtica con el especialista real\r\n                const index = datosReserva.especialistas.findIndex(esp => \r\n                    esp.id === 'auto' && esp.categoriaId === espAuto.categoriaId\r\n                );\r\n                \r\n                if (index !== -1) {\r\n                    datosReserva.especialistas[index] = {\r\n                        id: mejorEspecialista.id,\r\n                        nombre: mejorEspecialista.nombre,\r\n                        categoriaId: espAuto.categoriaId,\r\n                        fotoUrl: mejorEspecialista.fotoUrl || 'img/avatar-default.png' //  AGREGAR LA FOTO\r\n                    };\r\n                    \r\n                    console.log(` Especialista automtico reemplazado: ${mejorEspecialista.nombre}`, mejorEspecialista.fotoUrl);\r\n                }\r\n            } else {\r\n                throw new Error(`No se encontr especialista disponible para la categora ${espAuto.categoriaId}`);\r\n            }\r\n        }\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error(\"Error buscando especialistas automticos:\", error);\r\n        mostrarError(\"No se pudo encontrar especialistas disponibles. Por favor, selecciona manualmente.\");\r\n        return false;\r\n    }\r\n}\r\n\r\nasync function obtenerEspecialistaConMejorDisponibilidad(categoriaId) {\r\n    try {\r\n        console.log(\"Buscando mejor especialista para categora:\", categoriaId);\r\n        \r\n        const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n        \r\n        // Si no hay especialistas, retornar null\r\n        if (!especialistas || especialistas.length === 0) {\r\n            console.log(\"No hay especialistas para esta categora\");\r\n            return null;\r\n        }\r\n        \r\n        // Si solo hay un especialista, retornarlo\r\n        if (especialistas.length === 1) {\r\n            console.log(\"Solo hay un especialista, retornando:\", especialistas[0].nombre);\r\n            return especialistas[0]; //  Esto ya incluye fotoUrl\r\n        }\r\n        \r\n        // Obtener la duracin total de los servicios seleccionados para esta categora\r\n        const serviciosCategoria = datosReserva.servicios.filter(s => s.categoriaId === categoriaId);\r\n        const duracionTotal = serviciosCategoria.reduce((total, servicio) => total + servicio.duracion, 0);\r\n        \r\n        console.log(\"Duracin total necesaria:\", duracionTotal, \"minutos\");\r\n        \r\n        // Obtener fecha y hora actual en Argentina (UTC-3)\r\n        const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n        \r\n        // Calcular disponibilidad para cada especialista\r\n        const disponibilidadEspecialistas = [];\r\n        \r\n        for (const especialista of especialistas) {\r\n            console.log(\"Evaluando especialista:\", especialista.nombre);\r\n            \r\n            let puntuacionDisponibilidad = 0;\r\n            let diasEvaluados = 0;\r\n            \r\n            // Evaluar solo los prximos 3 das (para mejorar rendimiento)\r\n            for (let i = 0; i < 3; i++) {\r\n                const fechaEvaluar = new Date(ahoraArg);\r\n                fechaEvaluar.setDate(ahoraArg.getDate() + i);\r\n                const fechaStr = fechaEvaluar.toISOString().split('T')[0];\r\n                \r\n                // Saltar fines de semana\r\n                if (fechaEvaluar.getDay() === 0 || fechaEvaluar.getDay() === 6) {\r\n                    continue;\r\n                }\r\n                \r\n                try {\r\n                    // Obtener horarios disponibles para este especialista en esta fecha\r\n                    const horariosDisponibles = await firestoreDB.generarHorariosDisponiblesEspecialista(\r\n                        especialista.id, \r\n                        fechaStr\r\n                    );\r\n                    \r\n                    // CORRECCIN: Usar let en lugar de const para poder reasignar\r\n                    let horariosDisponiblesFiltrados = horariosDisponibles.filter(h => h.disponible);\r\n                    \r\n                    // Filtrar horarios que sean posteriores a la hora actual si es hoy\r\n                    if (i === 0) {\r\n                        const horaActual = ahoraArg.getHours();\r\n                        const minutoActual = ahoraArg.getMinutes();\r\n                        const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n                        \r\n                        horariosDisponiblesFiltrados = horariosDisponiblesFiltrados.filter(horario => {\r\n                            const [horaStr, minutoStr] = horario.hora.split(':');\r\n                            const horaHorario = parseInt(horaStr);\r\n                            const minutoHorario = parseInt(minutoStr);\r\n                            const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n                            \r\n                            // Considerar margen de 30 minutos para reservas\r\n                            return tiempoHorarioMinutos >= (tiempoActualMinutos + 30);\r\n                        });\r\n                    }\r\n                    \r\n                    // Contar bloques de tiempo disponibles que puedan acomodar la duracin total\r\n                    const bloquesDisponibles = encontrarBloquesDisponibles(horariosDisponiblesFiltrados, duracionTotal);\r\n                    puntuacionDisponibilidad += bloquesDisponibles.length;\r\n                    diasEvaluados++;\r\n                    \r\n                    console.log(`Especialista ${especialista.nombre} - ${fechaStr}: ${bloquesDisponibles.length} bloques disponibles`);\r\n                    \r\n                } catch (error) {\r\n                    console.warn(`Error obteniendo horarios para ${especialista.nombre} en ${fechaStr}:`, error);\r\n                }\r\n            }\r\n            \r\n            // Calcular promedio\r\n            const disponibilidadPromedio = diasEvaluados > 0 ? puntuacionDisponibilidad / diasEvaluados : 0;\r\n            \r\n            console.log(`Especialista ${especialista.nombre} - Puntuacin: ${disponibilidadPromedio}`);\r\n            \r\n            disponibilidadEspecialistas.push({\r\n                especialista,\r\n                puntuacion: disponibilidadPromedio\r\n            });\r\n        }\r\n        \r\n        // Ordenar por puntuacin (mayor a menor)\r\n        disponibilidadEspecialistas.sort((a, b) => b.puntuacion - a.puntuacion);\r\n        \r\n        console.log(\"Ranking de especialistas:\", disponibilidadEspecialistas.map(e => \r\n            `${e.especialista.nombre}: ${e.puntuacion}`\r\n        ));\r\n        \r\n        // Retornar el especialista con mejor puntuacin\r\n        const mejorEspecialista = disponibilidadEspecialistas[0].puntuacion > 0 \r\n            ? disponibilidadEspecialistas[0].especialista \r\n            : especialistas[0];\r\n            \r\n        console.log(\"Mejor especialista encontrado:\", mejorEspecialista.nombre, \"Foto:\", mejorEspecialista.fotoUrl);\r\n        \r\n        // Guardar informacin sobre el mejor especialista\r\n        mejorEspecialistaPorCategoria[categoriaId] = mejorEspecialista;\r\n\r\n        return mejorEspecialista; //  Esto incluye todos los datos del especialista, incluida fotoUrl\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error calculando disponibilidad:\", error);\r\n        // En caso de error, retornar el primer especialista de la lista\r\n        try {\r\n            const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n            return especialistas.length > 0 ? especialistas[0] : null;\r\n        } catch (fallbackError) {\r\n            console.error(\"Error de fallback:\", fallbackError);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\n// Funcin auxiliar para encontrar bloques de tiempo disponibles\r\nfunction encontrarBloquesDisponibles(horarios, duracionMinutos) {\r\n    const bloques = [];\r\n    const intervalo = 30; // Intervalo entre horarios en minutos\r\n    const slotsNecesarios = Math.ceil(duracionMinutos / intervalo);\r\n    \r\n    // Si no hay suficientes horarios, retornar array vaco\r\n    if (horarios.length < slotsNecesarios) {\r\n        return bloques;\r\n    }\r\n    \r\n    for (let i = 0; i <= horarios.length - slotsNecesarios; i++) {\r\n        let bloqueValido = true;\r\n        \r\n        // Verificar que todos los slots necesarios estn disponibles\r\n        for (let j = 0; j < slotsNecesarios; j++) {\r\n            if (!horarios[i + j] || !horarios[i + j].disponible) {\r\n                bloqueValido = false;\r\n                break;\r\n            }\r\n        }\r\n        \r\n        if (bloqueValido) {\r\n            bloques.push({\r\n                inicio: horarios[i].hora,\r\n                fin: calcularHoraFin(horarios[i].hora, duracionMinutos)\r\n            });\r\n        }\r\n    }\r\n    \r\n    return bloques;\r\n}\r\n\r\n// Funcin auxiliar para calcular la hora final\r\nfunction calcularHoraFin(horaInicio, duracionMinutos) {\r\n    const [horaStr, minutoStr] = horaInicio.split(':');\r\n    let hora = parseInt(horaStr);\r\n    let minuto = parseInt(minutoStr);\r\n    \r\n    minuto += duracionMinutos;\r\n    hora += Math.floor(minuto / 60);\r\n    minuto = minuto % 60;\r\n    \r\n    return `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n}\r\n\r\nfunction agregarEventosBotones(categoriaSection, categoriaId) {\r\n    const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n    const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n    const btnBuscarDisponibilidad = categoriaSection.querySelector('.btn-buscar-disponibilidad');\r\n    const lista = categoriaSection.querySelector('.especialistas-lista');\r\n    const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n    \r\n    // Funcin para alternar la visibilidad de la lista\r\n    const toggleLista = () => {\r\n        const estaAbierto = lista.classList.contains('abierto');\r\n        \r\n        // Cerrar todas las dems listas primero\r\n        document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n            if (l !== lista) {\r\n                l.classList.remove('abierto');\r\n                const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                if (otherIcon) otherIcon.classList.remove('girado');\r\n            }\r\n        });\r\n        \r\n        // Alternar esta lista\r\n        lista.classList.toggle('abierto', !estaAbierto);\r\n        if (icono) {\r\n            icono.classList.toggle('girado', !estaAbierto);\r\n        }\r\n    };\r\n\r\n    // Evento para botn ver especialistas\r\n    btnVerEspecialistas.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        toggleLista();\r\n    });\r\n    \r\n    // Evento para el contenedor seleccion-predeterminada (excepto cuando se hace clic en botones)\r\n    seleccionPredeterminada.addEventListener('click', (e) => {\r\n        // Si el clic fue en un botn, no hacer nada (ya tiene su propio evento)\r\n        if (e.target.closest('.botones-especialista')) {\r\n            return;\r\n        }\r\n        toggleLista();\r\n    });\r\n    \r\n    // Evento para botn buscar disponibilidad\r\n    btnBuscarDisponibilidad.addEventListener('click', async (e) => {\r\n        e.stopPropagation();\r\n        \r\n        const infoEspecialista = seleccionPredeterminada.querySelector('.info-especialista');\r\n        const botonesEspecialista = seleccionPredeterminada.querySelector('.botones-especialista');\r\n        const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n        \r\n        // Guardar los botones antes de modificar el contenido\r\n        const botonesHTML = botonesEspecialista.innerHTML;\r\n        \r\n        // Mostrar loading - solo modificar el info-especialista\r\n        infoEspecialista.innerHTML = `\r\n            <span class=\"texto-predeterminado\">Buscando mejor disponibilidad...</span>\r\n        `;\r\n        \r\n        try {\r\n            const especialista = await obtenerEspecialistaConMejorDisponibilidad(categoriaId);\r\n            if (especialista) {\r\n                // Deseleccionar todos los especialistas de esta categora\r\n                especialistasContainer.querySelectorAll('.flotante.especialista').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                });\r\n                \r\n                // Seleccionar el nuevo especialista en la lista\r\n                const especialistaElement = especialistasContainer.querySelector(`[data-id=\"${especialista.id}\"]`);\r\n                if (especialistaElement) {\r\n                    especialistaElement.classList.add('seleccionado');\r\n                }\r\n                \r\n                // Actualizar la seleccin predeterminada\r\n                seleccionPredeterminada.classList.add('seleccionado');\r\n                \r\n                // Actualizar solo el contenido de info-especialista, mantener los botones\r\n                infoEspecialista.innerHTML = `\r\n                    <span class=\"badge-recomendado\">Recomendado</span>\r\n                    <img src=\"${especialista.fotoUrl || 'img/avatar-default.png'}\" \r\n                        alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n                    <div>\r\n                        <span class=\"nombre-especialista\">${especialista.nombre}</span>\r\n                        <div class=\"info-disponibilidad\">\r\n                            <span class=\"icono-disponibilidad\"></span>\r\n                            Mejor disponibilidad esta semana\r\n                        </div>\r\n                    </div>\r\n                `;\r\n                \r\n                // Los botones se mantienen intactos, no necesitamos recrearlos\r\n                seleccionarEspecialista(null, especialista, categoriaId);\r\n            } else {\r\n                infoEspecialista.innerHTML = `\r\n                    <span class=\"texto-predeterminado\">No disponible</span>\r\n                `;\r\n                // Restaurar los botones\r\n                botonesEspecialista.innerHTML = botonesHTML;\r\n                // Volver a agregar eventos a los botones restaurados\r\n                agregarEventosBotones(categoriaSection, categoriaId);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error al obtener especialista:\", error);\r\n            infoEspecialista.innerHTML = `\r\n                <span class=\"texto-predeterminado\">Error, intenta nuevamente</span>\r\n            `;\r\n            // Restaurar los botones\r\n            botonesEspecialista.innerHTML = botonesHTML;\r\n            // Volver a agregar eventos a los botones restaurados\r\n            agregarEventosBotones(categoriaSection, categoriaId);\r\n        }\r\n    });\r\n}\r\n\r\n/////////////////////////////////\r\n////////////// fechas y horarios\r\n/////////////////////////////////\r\n\r\nfunction esDuracionValida(horario, duracionTotal, horarioCierre) {\r\n    const [hora, minuto] = horario.split(':').map(Number);\r\n    const totalMinutos = hora * 60 + minuto + duracionTotal;\r\n    const cierreMinutos = parseInt(horarioCierre.split(':')[0]) * 60 + parseInt(horarioCierre.split(':')[1]);\r\n    \r\n    return totalMinutos <= cierreMinutos;\r\n}\r\n\r\nfunction mostrarErrorDisponibilidad(especialistasNoDisponibles) {\r\n    const nombres = especialistasNoDisponibles.map(e => e.nombre).join(', ');\r\n    mostrarError(`Los siguientes especialistas no estn disponibles: ${nombres}`);\r\n}\r\n\r\n// Funcin principal para cargar fechas y horarios\r\nasync function cargarFechasYHorarios() {\r\n    console.log(\"=== CARGANDO FECHAS ===\");\r\n    console.log(\"Especialistas actuales:\", datosReserva.especialistas.map(e => e.nombre));\r\n    \r\n    try {\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        \r\n        // Ocultar calendario y mostrar carga\r\n        const contenedorCalendario = document.querySelector('.contenedor-calendario');\r\n        const cargandoFechas = document.querySelector('.cargando-fechas');\r\n        const sinFechas = document.querySelector('.sin-fechas');\r\n        \r\n        if (contenedorCalendario) contenedorCalendario.style.display = 'none';\r\n        if (cargandoFechas) cargandoFechas.style.display = 'block';\r\n        if (sinFechas) sinFechas.style.display = 'none';\r\n        \r\n        // Obtener fechas disponibles considerando los das laborales de cada especialista\r\n        const fechasComunes = await generarFechasDisponiblesConEspecialistas(config);\r\n        \r\n        console.log(\" Fechas disponibles despus del filtrado:\", fechasComunes.map(f => f.fecha));\r\n        \r\n        // Actualizar UI con las fechas disponibles\r\n        actualizarUIFechas(fechasComunes);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n        \r\n        // Ocultar loader en caso de error\r\n        const cargandoFechas = document.querySelector('.cargando-fechas');\r\n        if (cargandoFechas) cargandoFechas.style.display = 'none';\r\n    }\r\n}\r\n\r\nasync function generarFechasDisponiblesConEspecialistas(config) {\r\n    // Obtener fecha y hora actual en Argentina (UTC-3)\r\n    const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n    const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n    \r\n    const fechasDisponibles = [];\r\n    const DIAS_A_MOSTRAR = 14; // Mostrar hasta 14 das en el futuro\r\n    \r\n    for (let i = 0; i < DIAS_A_MOSTRAR; i++) {\r\n        const fecha = new Date(hoyArg);\r\n        fecha.setDate(hoyArg.getDate() + i);\r\n        \r\n        const fechaStr = fecha.toISOString().split('T')[0];\r\n        \r\n        // Verificar das no laborables generales\r\n        if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n            console.log(`Saltando ${fechaStr} - Da no laborable configurado`);\r\n            continue;\r\n        }\r\n        \r\n        // Verificar disponibilidad para TODOS los especialistas seleccionados\r\n        const todosDisponibles = await verificarDisponibilidadEspecialistas(fechaStr);\r\n        \r\n        if (todosDisponibles) {\r\n            fechasDisponibles.push({\r\n                fecha: fechaStr,\r\n                display: formatearFechaDisplay(fecha)\r\n            });\r\n        }\r\n    }\r\n    \r\n    console.log(\"Fechas disponibles despus de verificar especialistas:\", fechasDisponibles);\r\n    return fechasDisponibles;\r\n}\r\n\r\nfunction seleccionarFechaAutomaticamente(fecha) {\r\n    // Actualizar los datos de reserva\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // Encontrar el elemento del calendario correspondiente a esta fecha\r\n    const todosLosDias = document.querySelectorAll('.dia-calendario');\r\n    \r\n    todosLosDias.forEach(diaElement => {\r\n        // Solo considerar los das que tienen data-fecha (no los fuera-de-mes)\r\n        if (diaElement.dataset.fecha) {\r\n            if (diaElement.dataset.fecha === fecha) {\r\n                // Seleccionar este da\r\n                diaElement.classList.add('seleccionado');\r\n                \r\n                // Remover mensaje de error si existe\r\n                const errorFecha = document.getElementById('error-fecha');\r\n                if (errorFecha) errorFecha.classList.remove('visible');\r\n                \r\n                // Cargar los horarios para esta fecha\r\n                cargarHorariosParaFecha(fecha);\r\n            } else {\r\n                // Deseleccionar otros das\r\n                diaElement.classList.remove('seleccionado');\r\n            }\r\n        }\r\n    });\r\n\r\n    // Actualizar el subttulo de horarios\r\n    actualizarSubtituloHorarios(fecha);\r\n    \r\n    console.log(\"Fecha seleccionada automticamente:\", fecha);\r\n}\r\n\r\n// Funcin para obtener horarios comunes disponibles\r\nasync function obtenerHorariosComunes(fecha) {\r\n    if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n        return [];\r\n    }\r\n    \r\n    const horariosPorEspecialista = {};\r\n    const duracionTotal = calcularDuracionTotal();\r\n    \r\n    for (const especialista of datosReserva.especialistas) {\r\n        try {\r\n            const horarios = await firestoreSeguro.generarHorariosDisponiblesEspecialista(\r\n                especialista.id,\r\n                fecha,\r\n                duracionTotal // Pasar la duracin total\r\n            );\r\n            \r\n            // Filtrar solo los horarios disponibles\r\n            const horariosFiltrados = horarios\r\n                .filter(horario => horario.disponible)\r\n                .map(horario => horario.hora);\r\n            \r\n            horariosPorEspecialista[especialista.id] = horariosFiltrados;\r\n            \r\n        } catch (error) {\r\n            console.error(`Error obteniendo horarios para ${especialista.nombre}:`, error);\r\n            horariosPorEspecialista[especialista.id] = [];\r\n        }\r\n    }\r\n    \r\n    return encontrarHorariosComunes(horariosPorEspecialista);\r\n}\r\n\r\n// Funcin para verificar si un horario puede acomodar la duracin total\r\nasync function puedeAcomodarDuracion(horarioInicio, duracionTotal, especialistaId, fecha) {\r\n    try {\r\n        // Obtener configuracin REAL del especialista\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) return false;\r\n        \r\n        const especialista = especialistaDoc.data();\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // Usar horario del especialista o configuracin general\r\n        let horarioCierre = especialista.horarioLaboral?.[diaKey]?.fin || datosReserva.configuracion.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const [horaCierreStr, minutoCierreStr] = horarioCierre.replace('.', ':').split(':');\r\n        const horaCierre = parseInt(horaCierreStr);\r\n        const minutoCierre = parseInt(minutoCierreStr || 0);\r\n        const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n        \r\n        // Convertir horario de inicio a minutos\r\n        const [horaInicioStr, minutoInicioStr] = horarioInicio.split(':');\r\n        const horaInicio = parseInt(horaInicioStr);\r\n        const minutoInicio = parseInt(minutoInicioStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        \r\n        // Calcular horario de fin\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        // Verificar que el turno termine antes del cierre\r\n        return finMinutos <= cierreMinutos;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error validando horario:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para encontrar horarios comunes entre todos los especialistas\r\nfunction encontrarHorariosComunes(horariosPorEspecialista) {\r\n    const especialistasIds = Object.keys(horariosPorEspecialista);\r\n    if (especialistasIds.length === 0) return [];\r\n    \r\n    // Empezar con los horarios del primer especialista\r\n    let horariosComunes = [...horariosPorEspecialista[especialistasIds[0]]];\r\n    \r\n    // Intersectar con los horarios de los dems especialistas\r\n    for (let i = 1; i < especialistasIds.length; i++) {\r\n        const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n        horariosComunes = horariosComunes.filter(hora => \r\n            horariosEspecialista.includes(hora)\r\n        );\r\n    }\r\n    \r\n    return horariosComunes;\r\n}\r\n\r\n// Funcin para seleccionar un horario\r\nfunction seleccionarHorario(elemento, horario) {\r\n    // Deseleccionar todos los horarios\r\n    document.querySelectorAll('.flotante.horario').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar el horario clickeado\r\n    elemento.classList.add('seleccionado');\r\n    datosReserva.horario = horario;\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorHorario = document.getElementById('error-horario');\r\n    if (errorHorario) errorHorario.classList.remove('visible');\r\n    \r\n    // DEBUG: Verificar que se estableci correctamente\r\n    console.log('Horario seleccionado:', datosReserva.horario);\r\n}\r\n\r\n// Funcin para seleccionar una fecha\r\nfunction seleccionarFecha(elemento, fecha) {\r\n    // Deseleccionar todas las fechas\r\n    document.querySelectorAll('.flotante.fecha').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar la fecha clickeada\r\n    elemento.classList.add('seleccionado');\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // Cargar horarios para la fecha seleccionada\r\n    cargarHorariosParaFecha(fecha);\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorFecha = document.getElementById('error-fecha');\r\n    if (errorFecha) errorFecha.classList.remove('visible');\r\n}\r\n\r\n// Funcin para verificar disponibilidad de todos los especialistas en una fecha\r\nasync function verificarDisponibilidadEspecialistas(fecha) {\r\n    console.log(` Verificando fecha ${fecha} para especialistas:`, \r\n        datosReserva.especialistas.map(e => e.nombre));\r\n    \r\n    try {\r\n        if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n            console.log(\"No hay especialistas seleccionados\");\r\n            return false;\r\n        }\r\n        \r\n        for (const especialista of datosReserva.especialistas) {\r\n            const disponible = await verificarDisponibilidadEspecialista(especialista.id, fecha);\r\n            console.log(` Especialista ${especialista.nombre} en ${fecha}: ${disponible ? 'DISPONIBLE' : 'NO DISPONIBLE'}`);\r\n            \r\n            if (!disponible) {\r\n                return false;\r\n            }\r\n        }\r\n        \r\n        console.log(` Todos los especialistas disponibles el ${fecha}`);\r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction formatearFechaParaDebug(fechaStr) {\r\n    const fecha = new Date(fechaStr + 'T03:00:00');\r\n    return fecha.toLocaleDateString('es-AR', { \r\n        weekday: 'long', \r\n        year: 'numeric', \r\n        month: 'long', \r\n        day: 'numeric' \r\n    });\r\n}\r\n\r\n// Funcin para verificar disponibilidad de un especialista especfico\r\nasync function verificarDisponibilidadEspecialista(especialistaId, fecha) {\r\n    try {\r\n        // 1. Obtener datos del especialista\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) {\r\n            return false;\r\n        }\r\n        \r\n        const especialistaData = especialistaDoc.data();\r\n        \r\n        // 2. CORRECCIN: Ajustar la fecha a la zona horaria de Argentina\r\n        const fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n        const diaSemana = fechaObj.getUTCDay(); // Usar getUTCDay() para consistencia\r\n        \r\n        // Mapeo de das\r\n        const diasMap = {\r\n            0: 'domingo',\r\n            1: 'lunes', \r\n            2: 'martes',\r\n            3: 'miercoles',\r\n            4: 'jueves',\r\n            5: 'viernes',\r\n            6: 'sabado'\r\n        };\r\n        \r\n        const diaKey = diasMap[diaSemana];\r\n        \r\n        console.log(`Verificando ${diaKey} (${diaSemana}) para ${especialistaData.nombre}`);\r\n        \r\n        // Si no trabaja ese da, no est disponible\r\n        if (!especialistaData.horarioLaboral || !especialistaData.horarioLaboral[diaKey]?.activo) {\r\n            console.log(`-> ${especialistaData.nombre} NO trabaja los ${diaKey}`);\r\n            return false;\r\n        }\r\n        \r\n        // 3. Verificar si tiene bloqueos/ausencias para esa fecha\r\n        const tieneBloqueos = await verificarBloqueosEspecialista(especialistaId, fecha);\r\n        if (tieneBloqueos) {\r\n            console.log(`-> ${especialistaData.nombre} tiene bloqueos para ${fecha}`);\r\n            return false;\r\n        }\r\n        \r\n        console.log(`-> ${especialistaData.nombre} S trabaja los ${diaKey}`);\r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando disponibilidad del especialista:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para verificar bloqueos del especialista\r\nasync function verificarBloqueosEspecialista(especialistaId, fecha) {\r\n    try {\r\n        // Convertir fecha a timestamp para comparacin\r\n        const fechaTimestamp = new Date(fecha).getTime();\r\n        \r\n        // Buscar bloqueos para este especialista\r\n        const snapshot = await db.collection('bloqueos')\r\n            .where('especialistaId', '==', especialistaId)\r\n            .get();\r\n            \r\n        if (snapshot.empty) {\r\n            return false;\r\n        }\r\n        \r\n        // Verificar cada bloqueo\r\n        for (const doc of snapshot.docs) {\r\n            const bloqueo = doc.data();\r\n            const inicioBloqueo = new Date(bloqueo.fechaInicio).getTime();\r\n            const finBloqueo = new Date(bloqueo.fechaFin).getTime();\r\n            \r\n            // Si la fecha est dentro del rango de bloqueo\r\n            if (fechaTimestamp >= inicioBloqueo && fechaTimestamp <= finBloqueo) {\r\n                return true;\r\n            }\r\n        }\r\n        \r\n        return false;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando bloqueos:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para formatear fecha para display\r\nfunction formatearFechaDisplay(fecha) {\r\n  // Asegurarnos de que tenemos un objeto Date vlido\r\n  let fechaObj;\r\n  \r\n  if (typeof fecha === 'string') {\r\n    // Si es una cadena en formato YYYY-MM-DD, convertirla a Date\r\n    fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n  } else if (fecha instanceof Date) {\r\n    fechaObj = fecha;\r\n  } else {\r\n    return \"Fecha invlida\";\r\n  }\r\n  \r\n  return fechaObj.toLocaleDateString('es-AR', {\r\n    weekday: 'long',\r\n    day: 'numeric',\r\n    month: 'short'\r\n  });\r\n}\r\n\r\n// En la funcin donde obtienes la configuracin\r\nasync function cargarConfiguracion() {\r\n    try {\r\n        datosReserva.configuracion = await firestoreSeguro.obtenerConfiguracion();\r\n        return datosReserva.configuracion;\r\n    } catch (error) {\r\n        console.error(\"Error cargando configuracin:\", error);\r\n        // Configuracin por defecto\r\n        datosReserva.configuracion = {\r\n            horarioApertura: \"09:00\",\r\n            horarioCierre: \"20:00\",\r\n            diasLaborales: [1, 2, 3, 4, 5, 6],\r\n            duracionTurnoBase: 30\r\n        };\r\n        return datosReserva.configuracion;\r\n    }\r\n}\r\n\r\nfunction limpiarFechasYHorarios() {\r\n    datosReserva.fecha = null;\r\n    datosReserva.horario = null;\r\n    fechaSeleccionada = null;\r\n    \r\n    const contenedorFechas = document.querySelector('.contenedor-fechas');\r\n    const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n    \r\n    if (contenedorFechas) contenedorFechas.innerHTML = '';\r\n    if (contenedorHorarios) contenedorHorarios.innerHTML = '';\r\n    \r\n    // Limpiar selecciones visuales\r\n    document.querySelectorAll('.flotante.fecha.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    document.querySelectorAll('.flotante.horario.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Ocultar mensajes\r\n    document.querySelectorAll('.sin-fechas, .sin-horarios, .cargando-fechas, .cargando-horarios')\r\n        .forEach(el => el.style.display = 'none');\r\n}\r\n\r\n///////////////////////\r\n//////////// Resumen\r\n///////////////////////\r\n\r\n// Funcin para calcular horario de finalizacin\r\nfunction calcularHorarioFin(horarioInicio, duracionMinutos) {\r\n    const [horaStr, minutoStr] = horarioInicio.split(':');\r\n    let hora = parseInt(horaStr);\r\n    let minuto = parseInt(minutoStr);\r\n    \r\n    minuto += duracionMinutos;\r\n    hora += Math.floor(minuto / 60);\r\n    minuto = minuto % 60;\r\n    \r\n    return `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Funcin para formatear duracin en texto legible\r\nfunction formatearDuracion(minutos) {\r\n    const horas = Math.floor(minutos / 60);\r\n    const mins = minutos % 60;\r\n    \r\n    if (horas > 0 && mins > 0) {\r\n        return `${horas}h ${mins}min`;\r\n    } else if (horas > 0) {\r\n        return `${horas} hora${horas > 1 ? 's' : ''}`;\r\n    } else {\r\n        return `${mins} minutos`;\r\n    }\r\n}\r\n\r\n///////////////////////\r\n//////////// cache y demas\r\n///////////////////////\r\n\r\n// Sistema de debouncing para reducir lecturas durante interaccin\r\nconst debounce = (func, wait) => {\r\n    let timeout;\r\n    return function executedFunction(...args) {\r\n        const later = () => {\r\n            clearTimeout(timeout);\r\n            func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n    };\r\n};\r\n\r\n// Aplicar debouncing a funciones que generan muchas lecturas\r\nconst debouncedCargarHorarios = debounce(async (fecha) => {\r\n    try {\r\n        const horarios = await obtenerHorariosComunes(fecha);\r\n        actualizarUIHorarios(horarios);\r\n    } catch (error) {\r\n        console.error('Error cargando horarios:', error);\r\n    }\r\n}, 300); // 300ms de delay\r\n\r\n////////////////////////\r\n///////////// Calendario\r\n////////////////////////\r\n\r\n// Funcin para inicializar el calendario\r\nfunction inicializarCalendario() {\r\n    const btnPrev = document.querySelector('.btn-calendario-prev');\r\n    const btnNext = document.querySelector('.btn-calendario-next');\r\n    \r\n    // Establecer la fecha actual correctamente\r\n    calendarioFechaActual = new Date();\r\n    \r\n    if (btnPrev && btnNext) {\r\n        btnPrev.addEventListener('click', () => {\r\n            calendarioFechaActual.setMonth(calendarioFechaActual.getMonth() - 1);\r\n            console.log(\"Navegando a mes anterior:\", calendarioFechaActual.getMonth() + 1);\r\n            renderizarCalendario();\r\n            debugVisualizacionFechas();\r\n        });\r\n        \r\n        btnNext.addEventListener('click', () => {\r\n            calendarioFechaActual.setMonth(calendarioFechaActual.getMonth() + 1);\r\n            console.log(\"Navegando a mes siguiente:\", calendarioFechaActual.getMonth() + 1);\r\n            renderizarCalendario();\r\n            debugVisualizacionFechas();\r\n        });\r\n    }\r\n    \r\n    console.log(\"Calendario inicializado\");\r\n}\r\n\r\n// Funcin para renderizar el calendario\r\nfunction renderizarCalendario() {\r\n    const mesAnioElement = document.querySelector('.calendario-mes');\r\n    const diasContainer = document.querySelector('.calendario-dias');\r\n    \r\n    if (!mesAnioElement || !diasContainer) {\r\n        console.error(\"Elementos del calendario no encontrados\");\r\n        return;\r\n    }\r\n    \r\n    // Obtener mes y ao\r\n    const mes = calendarioFechaActual.getMonth();\r\n    const anio = calendarioFechaActual.getFullYear();\r\n    \r\n    // Nombres de los meses\r\n    const nombresMeses = [\r\n        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',\r\n        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'\r\n    ];\r\n    \r\n    // Actualizar el encabezado\r\n    mesAnioElement.innerHTML = `${nombresMeses[mes]} <span>${anio}</span>`;\r\n    \r\n    // Obtener el primer da del mes y la cantidad de das\r\n    const primerDia = new Date(anio, mes, 1);\r\n    const ultimoDia = new Date(anio, mes + 1, 0);\r\n    const diasEnMes = ultimoDia.getDate();\r\n    \r\n    // Obtener el da de la semana del primer da (0 = Domingo, 1 = Lunes, etc.)\r\n    const diaInicio = primerDia.getDay();\r\n    \r\n    // Limpiar el contenedor de das\r\n    diasContainer.innerHTML = '';\r\n    \r\n    // Agregar das vacos para alinear el primer da\r\n    for (let i = 0; i < diaInicio; i++) {\r\n        const diaVacio = document.createElement('div');\r\n        diaVacio.className = 'dia-calendario fuera-de-mes';\r\n        diasContainer.appendChild(diaVacio);\r\n    }\r\n    \r\n    // Obtener la fecha actual para resaltar el da de hoy\r\n    const hoy = new Date();\r\n    const hoyFormateado = hoy.toISOString().split('T')[0];\r\n    \r\n    console.log(\"Fechas disponibles para calendario:\", fechasDisponiblesCalendario);\r\n    \r\n    // Agregar los das del mes\r\n    for (let dia = 1; dia <= diasEnMes; dia++) {\r\n        const diaElement = document.createElement('div');\r\n        diaElement.className = 'dia-calendario';\r\n        diaElement.textContent = dia;\r\n        \r\n        // Formatear la fecha para comparacin (YYYY-MM-DD)\r\n        const fechaFormateada = `${anio}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;\r\n        const fechaObj = new Date(fechaFormateada + 'T03:00:00'); // UTC-3 para Argentina\r\n        const fechaLocal = fechaObj.toISOString().split('T')[0];\r\n        \r\n        // Agregar data-atributo con la fecha\r\n        diaElement.dataset.fecha = fechaLocal;\r\n        \r\n        // Verificar si es hoy\r\n        const hoy = new Date();\r\n        const hoyFormateado = hoy.toISOString().split('T')[0];\r\n        \r\n        if (fechaLocal === hoyFormateado) {\r\n            diaElement.classList.add('hoy');\r\n        }\r\n        \r\n        // Verificar si la fecha est disponible\r\n        const disponible = fechasDisponiblesCalendario.some(f => f.fecha === fechaLocal);\r\n        \r\n        if (disponible) {\r\n            diaElement.classList.add('disponible');\r\n            diaElement.addEventListener('click', () => seleccionarFechaCalendario(fechaLocal, diaElement));\r\n        } else {\r\n            diaElement.classList.add('no-disponible');\r\n        }\r\n        \r\n        diasContainer.appendChild(diaElement);\r\n    }\r\n}\r\n\r\n// Funcin para seleccionar una fecha en el calendario\r\nfunction seleccionarFechaCalendario(fecha, elemento) {\r\n    // Deseleccionar cualquier fecha previamente seleccionada\r\n    document.querySelectorAll('.dia-calendario.seleccionado').forEach(dia => {\r\n        dia.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar la nueva fecha\r\n    elemento.classList.add('seleccionado');\r\n    \r\n    // Actualizar los datos de reserva\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // DEBUG: Verificar que se estableci correctamente\r\n    console.log('Fecha seleccionada:', datosReserva.fecha);\r\n    \r\n    // Cargar horarios para la fecha seleccionada\r\n    cargarHorariosParaFecha(fecha);\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorFecha = document.getElementById('error-fecha');\r\n    if (errorFecha) errorFecha.classList.remove('visible');\r\n\r\n    // Actualizar el subttulo de horarios\r\n    actualizarSubtituloHorarios(fecha);\r\n}\r\n\r\n// Funcin para debuggear la visualizacin\r\nfunction debugVisualizacionFechas() {\r\n    console.log(\"=== DEBUG VISUALIZACIN ===\");\r\n    console.log(\"Fecha actual del calendario:\", calendarioFechaActual);\r\n    console.log(\"Fechas disponibles:\", fechasDisponiblesCalendario);\r\n    console.log(\"Datos reserva fecha:\", datosReserva.fecha);\r\n    \r\n    // Verificar qu das deberan mostrarse como disponibles\r\n    const mes = calendarioFechaActual.getMonth();\r\n    const anio = calendarioFechaActual.getFullYear();\r\n    \r\n    const primerDia = new Date(anio, mes, 1);\r\n    const ultimoDia = new Date(anio, mes + 1, 0);\r\n    const diasEnMes = ultimoDia.getDate();\r\n    \r\n    for (let dia = 1; dia <= diasEnMes; dia++) {\r\n        // CORRECCIN: Usar el mismo formato que en renderizarCalendario\r\n        const fechaFormateada = `${anio}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;\r\n        const fechaObj = new Date(fechaFormateada + 'T03:00:00'); // UTC-3 para Argentina\r\n        const fechaLocal = fechaObj.toISOString().split('T')[0];\r\n        \r\n        const disponible = fechasDisponiblesCalendario.some(f => f.fecha === fechaLocal);\r\n        \r\n        if (disponible) {\r\n            console.log(`Da ${dia} (${fechaLocal}) debera estar DISPONIBLE`);\r\n        }\r\n    }\r\n}\r\n// Llama a esta funcin despus de renderizar el calendario\r\ndebugVisualizacionFechas();\r\n\r\nfunction actualizarSubtituloHorarios(fecha) {\r\n    const subtitulo = document.querySelector('.seccion-horarios .subtitulo');\r\n    if (!subtitulo) return;\r\n    \r\n    // Formatear la fecha para mostrar\r\n    const fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n    const opciones = { weekday: 'long', day: 'numeric' };\r\n    const fechaFormateada = fechaObj.toLocaleDateString('es-AR', opciones);\r\n    \r\n    // Separar el da de la semana y el nmero del da\r\n    const partes = fechaFormateada.split(' ');\r\n    const diaSemana = partes[0];\r\n    const diaNumero = partes[1];\r\n    \r\n    // Actualizar el HTML del subttulo\r\n    subtitulo.innerHTML = `${diaSemana} <span>${diaNumero}</span>`;\r\n}\r\n\r\n// Funcin para actualizar el resumen continuo\r\nfunction actualizarResumenContinuo(paso) {\r\n  const resumenContinuo = document.querySelector('.resumen-continuo');\r\n  const resumenEspecialistas = document.querySelector('.resumen-especialistas');\r\n  const resumenFechaHora = document.querySelector('.resumen-fecha-hora');\r\n  const resumenCliente = document.querySelector('.resumen-cliente');\r\n  // const resumenActions = document.querySelector('.resumen-actions');\r\n  \r\n  // Mostrar/ocultar segn el paso\r\n  if (paso >= 2) {\r\n    resumenContinuo.style.display = 'block';\r\n    actualizarResumenServicios();\r\n    \r\n    if (paso >= 3) {\r\n      if (resumenEspecialistas) {\r\n        resumenEspecialistas.style.display = 'block';\r\n      }\r\n      actualizarResumenEspecialistas();\r\n      \r\n      if (paso >= 4) {\r\n        resumenFechaHora.style.display = 'block';\r\n        actualizarResumenFechaHora();\r\n        \r\n        if (paso >= 5) {\r\n          resumenCliente.style.display = 'block';\r\n          // resumenActions.style.display = 'block';\r\n          actualizarResumenCliente();\r\n        } else {\r\n          resumenCliente.style.display = 'none';\r\n          // resumenActions.style.display = 'none';\r\n        }\r\n      } else {\r\n        resumenFechaHora.style.display = 'none';\r\n        resumenCliente.style.display = 'none';\r\n        // resumenActions.style.display = 'none';\r\n      }\r\n    } else {\r\n      resumenEspecialistas.style.display = 'none';\r\n      resumenFechaHora.style.display = 'none';\r\n      resumenCliente.style.display = 'none';\r\n      // resumenActions.style.display = 'none';\r\n    }\r\n  } else {\r\n    resumenContinuo.style.display = 'none';\r\n  }\r\n}\r\n\r\n// Actualizar seccin de servicios en el resumen\r\nfunction actualizarResumenServicios() {\r\n  const serviciosLista = document.querySelector('.servicios-lista');\r\n  const duracionTotal = document.getElementById('resumen-duracion');\r\n  const precioTotal = document.getElementById('resumen-precio');\r\n  const precioSenia = document.getElementById('resumen-senia');\r\n  \r\n  if (datosReserva.servicios && datosReserva.servicios.length > 0) {\r\n    // Lista de servicios\r\n    serviciosLista.innerHTML = datosReserva.servicios.map(servicio => \r\n      `<div class=\"servicio-item\">\r\n        <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"18\"\r\n        height=\"18\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"#000000\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"1\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M17.286 21.09q -1.69 .001 -5.288 -2.615q -3.596 2.617 -5.288 2.616q -2.726 0 -.495 -6.8q -9.389 -6.775 2.135 -6.775h.076q 1.785 -5.516 3.574 -5.516q 1.785 0 3.574 5.516h.076q 11.525 0 2.133 6.774q 2.23 6.802 -.497 6.8\" />\r\n        </svg>\r\n      ${servicio.nombre}\r\n      </div>`\r\n    ).join('');\r\n    \r\n    // Totales\r\n    const totalDuracion = calcularDuracionTotal();\r\n    const totalPrecio = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n    const totalSenia = calcularSenia();\r\n    \r\n    duracionTotal.textContent = `${totalDuracion} min`;\r\n    precioTotal.textContent = `${totalPrecio.toLocaleString()}`;\r\n    precioSenia.textContent = `${totalSenia.toLocaleString()}`;\r\n  } else {\r\n    serviciosLista.innerHTML = '<p class=\"sin-datos\">No hay servicios seleccionados</p>';\r\n    duracionTotal.textContent = '0 min';\r\n    precioTotal.textContent = '$0';\r\n    precioSenia.textContent = '$0';\r\n  }\r\n}\r\n\r\n// Actualizar seccin de especialistas en el resumen\r\n// Actualizar seccin de especialistas en el resumen\r\nfunction actualizarResumenEspecialistas() {\r\n  const especialistasLista = document.querySelector('.resumen-especialistas .especialistas-resumen');\r\n  \r\n  if (!especialistasLista) {\r\n    console.error(\"Elemento .especialistas-resumen no encontrado\");\r\n    return;\r\n  }\r\n  \r\n  console.log(\"Actualizando resumen de especialistas:\", datosReserva.especialistas);\r\n  \r\n  if (datosReserva.especialistas && datosReserva.especialistas.length > 0) {\r\n    especialistasLista.innerHTML = datosReserva.especialistas.map(especialista => {\r\n      //  MEJORAR: Asegurarnos de que tenemos una URL de avatar vlida\r\n      let avatarUrl = 'img/avatar-default.png';\r\n      \r\n      if (especialista.fotoUrl) {\r\n        avatarUrl = especialista.fotoUrl;\r\n      } else if (especialista.id !== 'auto') {\r\n        // Si no tiene fotoUrl pero es un especialista real, intentar obtenerla del DOM\r\n        const especialistaElement = document.querySelector(`.flotante.especialista[data-id=\"${especialista.id}\"]`);\r\n        if (especialistaElement) {\r\n          const img = especialistaElement.querySelector('.avatar-especialista');\r\n          if (img) avatarUrl = img.src;\r\n        }\r\n      }\r\n      \r\n      const nombre = especialista.nombre || 'Especialista';\r\n      \r\n      console.log(` Mostrando especialista ${nombre} con avatar: ${avatarUrl}`);\r\n      \r\n      return `<div class=\"especialista-item\">\r\n        <img src=\"${avatarUrl}\" alt=\"${nombre}\" class=\"avatar-especialista\" \r\n             onerror=\"this.src='img/avatar-default.png'\">\r\n        <span>${nombre}</span>\r\n      </div>`;\r\n    }).join('');\r\n  } else {\r\n    especialistasLista.innerHTML = '<p class=\"sin-datos\">No hay especialistas seleccionados</p>';\r\n    console.warn(\"No hay especialistas en datosReserva.especialistas\");\r\n  }\r\n}\r\n\r\n// Actualizar seccin de fecha y hora en el resumen\r\nfunction actualizarResumenFechaHora() {\r\n  const resumenFecha = document.getElementById('resumen-fecha');\r\n  const resumenHora = document.getElementById('resumen-hora');\r\n\r\n  const svgFecha = `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n      <path d=\"M11.5 21h-5.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v6\" />\r\n      <path d=\"M16 3v4\" />\r\n      <path d=\"M8 3v4\" />\r\n      <path d=\"M4 11h16\" />\r\n      <path d=\"M15 19l2 2l4 -4\" />\r\n    </svg>\r\n  `;\r\n\r\n  const svgHora = `\r\n    <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width=\"18\"\r\n    height=\"18\"\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"none\"\r\n    stroke=\"#000000\"\r\n    stroke-width=\"1.5\"\r\n    stroke-linecap=\"round\"\r\n    stroke-linejoin=\"round\"\r\n    >\r\n    <path d=\"M20.942 13.021a9 9 0 1 0 -9.407 7.967\" />\r\n    <path d=\"M12 7v5l3 3\" />\r\n    <path d=\"M15 19l2 2l4 -4\" />\r\n    </svg>\r\n  `;\r\n  \r\n  if (datosReserva.fecha) {\r\n    resumenFecha.innerHTML = `${svgFecha} ${formatearFechaDisplay(datosReserva.fecha)}`;\r\n  } else {\r\n    resumenFecha.innerHTML = `${svgFecha} Fecha no seleccionada`;\r\n  }\r\n  \r\n  if (datosReserva.horario) {\r\n    const duracionTotal = calcularDuracionTotal();\r\n    const horaFin = calcularHorarioFin(datosReserva.horario, duracionTotal);\r\n    \r\n    resumenHora.innerHTML = `${svgHora} ${datosReserva.horario} a ${horaFin}`;\r\n  } else {\r\n    resumenHora.innerHTML = `${svgHora} Horario no seleccionado`;\r\n  }\r\n}\r\n\r\n// Actualizar seccin de datos del cliente en el resumen\r\nfunction actualizarResumenCliente() {\r\n}\r\n\r\nasync function cargarDatosGenerales() {\r\n    try {\r\n        \r\n        if (Object.keys(datosGenerales).length === 0) {\r\n            datosGenerales = await firestoreSeguro.obtenerConfigGeneral();\r\n        }\r\n        \r\n        // Si no hay datos, usar valores por defecto\r\n        if (!datosGenerales || Object.keys(datosGenerales).length === 0) {\r\n            document.getElementById('local-direccion').textContent = \"Direccin no disponible\";\r\n            document.getElementById('local-telefono').textContent = \"Telfono no disponible\";\r\n            document.getElementById('local-email').textContent = \"Email no disponible\";\r\n            document.getElementById('local-atencion').textContent = \"Horarios no disponibles\";\r\n            return;\r\n        }\r\n        \r\n        // Acceder a los datos dentro de empresa\r\n        const empresa = datosGenerales.empresa || {};\r\n        \r\n        // Actualizar direccin\r\n        const direccionElement = document.getElementById('local-direccion');\r\n        if (direccionElement && empresa.direccion) {\r\n            direccionElement.textContent = empresa.direccion;\r\n        } else if (direccionElement) {\r\n            direccionElement.textContent = \"Direccin no disponible\";\r\n        }\r\n        \r\n        // Actualizar telfono\r\n        const telefonoElement = document.getElementById('local-telefono');\r\n        if (telefonoElement && empresa.telefono) {\r\n            telefonoElement.textContent = empresa.telefono;\r\n        } else if (telefonoElement) {\r\n            telefonoElement.textContent = \"Telfono no disponible\";\r\n        }\r\n        \r\n        // Actualizar email\r\n        const emailElement = document.getElementById('local-email');\r\n        if (emailElement && empresa.email) {\r\n            emailElement.textContent = empresa.email;\r\n        } else if (emailElement) {\r\n            emailElement.textContent = \"Email no disponible\";\r\n        }\r\n        \r\n        // Actualizar horarios de atencin (NUEVO)\r\n        const atencionElement = document.getElementById('local-atencion');\r\n        if (atencionElement && empresa.horariosAtencion) {\r\n            atencionElement.textContent = empresa.horariosAtencion;\r\n        } else if (atencionElement) {\r\n            atencionElement.textContent = \"Horarios no disponibles\";\r\n        }\r\n        \r\n        // Actualizar redes sociales (si existen en empresa)\r\n        if (empresa.redesSociales) {\r\n            const instagramLink = document.getElementById('instagram');\r\n            const twitterLink = document.getElementById('equis');\r\n            const whatsappLink = document.getElementById('whatsapp');\r\n            \r\n            if (instagramLink && empresa.redesSociales.instagram) {\r\n                instagramLink.href = empresa.redesSociales.instagram;\r\n            }\r\n            \r\n            if (twitterLink && empresa.redesSociales.twitter) {\r\n                twitterLink.href = empresa.redesSociales.twitter;\r\n            }\r\n            \r\n            if (whatsappLink && empresa.redesSociales.whatsapp) {\r\n                whatsappLink.href = empresa.redesSociales.whatsapp;\r\n            }\r\n        }\r\n        \r\n        // Inicializar mapas despus de cargar los datos\r\n        setTimeout(() => {\r\n            inicializarMapasEnDirecciones();\r\n        }, 100);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando datos del local:\", error);\r\n        // Establecer valores por defecto en caso de error\r\n        document.getElementById('local-direccion').textContent = \"Direccin no disponible\";\r\n        document.getElementById('local-telefono').textContent = \"Telfono no disponible\";\r\n        document.getElementById('local-email').textContent = \"Email no disponible\";\r\n        const atencionElement = document.getElementById('local-atencion');\r\n        if (atencionElement) {\r\n            atencionElement.textContent = \"Horarios no disponibles\";\r\n        }\r\n    }\r\n}\r\n\r\nfunction escucharCambiosConfigGeneral() {\r\n    db.collection('config').doc('general')\r\n        .onSnapshot((doc) => {\r\n            if (doc.exists) {\r\n                datosGenerales = doc.data();\r\n                cargarDatosGenerales();\r\n            }\r\n        }, (error) => {\r\n            console.error(\"Error escuchando cambios:\", error);\r\n        });\r\n}\r\n\r\n//////////////////////////\r\n//////////////////// Mapas\r\n//////////////////////////\r\n\r\n// Funcin para inicializar los mapas\r\nfunction inicializarMapas() {\r\n    console.log(\"API de Google Maps cargada\");\r\n    // No hacemos nada aqu, la inicializacin se har despus de cargar los datos\r\n}\r\n\r\n// Funcin para geocodificar una direccin\r\nfunction geocodificarDireccion(direccion, callback) {\r\n    if (typeof google === 'undefined' || !google.maps || !google.maps.Geocoder) {\r\n        console.error(\"API de Google Maps no est disponible\");\r\n        callback(\"API de Google Maps no est disponible\", null);\r\n        return;\r\n    }\r\n\r\n    const geocoder = new google.maps.Geocoder();\r\n    geocoder.geocode({ address: direccion }, (results, status) => {\r\n        if (status === 'OK') {\r\n            const location = results[0].geometry.location;\r\n            callback(null, { lat: location.lat(), lng: location.lng() });\r\n        } else {\r\n            callback('Error en geocodificacin: ' + status, null);\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para inicializar los mapas en las direcciones\r\nfunction inicializarMapasEnDirecciones() {\r\n    const elementoDireccion = document.getElementById('local-direccion');\r\n    if (!elementoDireccion) return;\r\n\r\n    const direccion = elementoDireccion.textContent;\r\n    if (!direccion || direccion === \"Direccin no disponible\") return;\r\n\r\n    // Obtener coordenadas desde datosGenerales\r\n    const empresa = datosGenerales.empresa || {};\r\n    const coordenadas = empresa.coordenadas;\r\n\r\n    // Crear el popup si no existe\r\n    let popup = elementoDireccion.querySelector('.mapa-popup');\r\n    if (!popup) {\r\n        popup = document.createElement('div');\r\n        popup.className = 'mapa-popup';\r\n        elementoDireccion.appendChild(popup);\r\n    }\r\n\r\n    // Usar las coordenadas de la base de datos si estn disponibles\r\n    if (coordenadas && coordenadas.lat && coordenadas.lng) {\r\n        coordenadasLocal = coordenadas;\r\n\r\n        // Construir URL de mapa esttico (reemplaza con tu API key real)\r\n        const apiKey = 'AIzaSyCAO4m-WpFO7Hc9rf8Iy1-gyDMlSLDFong'; //  Reemplaza con tu clave API\r\n        const urlMapaEstatico = `https://maps.googleapis.com/maps/api/staticmap?center=${coordenadas.lat},${coordenadas.lng}&zoom=16&size=300x200&markers=color:red%7C${coordenadas.lat},${coordenadas.lng}&key=${apiKey}`;\r\n\r\n        // Crear imagen del mapa\r\n        const imgMapa = document.createElement('img');\r\n        imgMapa.src = urlMapaEstatico;\r\n        imgMapa.alt = 'Mapa del local';\r\n        imgMapa.style.width = '100%';\r\n        imgMapa.style.height = '100%';\r\n        imgMapa.onload = function() {\r\n            console.log('Mapa cargado correctamente');\r\n        };\r\n        imgMapa.onerror = function() {\r\n            console.error('Error al cargar la imagen del mapa');\r\n            popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Error al cargar el mapa</div>';\r\n        };\r\n        \r\n        popup.innerHTML = '';\r\n        popup.appendChild(imgMapa);\r\n    } else {\r\n        // Fallback: geocodificacin si no hay coordenadas en la base de datos\r\n        popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Cargando mapa...</div>';\r\n\r\n        geocodificarDireccion(direccion, (error, coordenadasGeocodificadas) => {\r\n            if (error) {\r\n                console.error('Error en geocodificacin:', error);\r\n                popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Error al cargar el mapa</div>';\r\n                return;\r\n            }\r\n\r\n            coordenadasLocal = coordenadasGeocodificadas;\r\n            const apiKey = 'TU_API_KEY_REAL'; //  Reemplaza con tu clave API\r\n            const urlMapaEstatico = `https://maps.googleapis.com/maps/api/staticmap?center=${coordenadasGeocodificadas.lat},${coordenadasGeocodificadas.lng}&zoom=16&size=300x200&markers=color:red%7C${coordenadasGeocodificadas.lat},${coordenadasGeocodificadas.lng}&key=${apiKey}`;\r\n\r\n            const imgMapa = document.createElement('img');\r\n            imgMapa.src = urlMapaEstatico;\r\n            imgMapa.alt = 'Mapa del local';\r\n            imgMapa.style.width = '100%';\r\n            imgMapa.style.height = '100%';\r\n            popup.innerHTML = '';\r\n            popup.appendChild(imgMapa);\r\n        });\r\n    }\r\n\r\n    // Al hacer clic, abrir Google Maps en una nueva pestaa\r\n    elementoDireccion.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        if (coordenadasLocal) {\r\n            const urlMaps = `https://www.google.com/maps/search/?api=1&query=${coordenadasLocal.lat},${coordenadasLocal.lng}`;\r\n            window.open(urlMaps, '_blank');\r\n        } else {\r\n            // Fallback: buscar por direccin si no hay coordenadas\r\n            const urlMaps = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(direccion)}`;\r\n            window.open(urlMaps, '_blank');\r\n        }\r\n    });\r\n}"]}