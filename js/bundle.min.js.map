{"version":3,"sources":["firebaseConfig.js","global.js","firestore.js","cacheManager.js","authManager.js","uiManager.js","admin.js","email.js","app.js"],"names":["firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","window","brevoConfig","senderEmail","senderName","adminEmail","appConfig","version","environment","features","multiSpecialist","categories","realTimeValidation","firebase","apps","length","initializeApp","firebaseAuth","auth","db","firestore","handleFirebaseError","error","console","unavailable","code","message","googleProvider","GoogleAuthProvider","addScope","Error","firestoreDB","obtenerConfiguracion","doc","collection","get","exists","data","horarioApertura","replace","horarioCierre","diasLaborales","Array","isArray","every","item","str","trim","startsWith","endsWith","JSON","parse","map","Number","split","filter","n","isNaN","e","procesarDiasLaborales","diasNoLaborables","Boolean","obtenerConfigGeneral","async","orderBy","docs","id","categoriaId","where","categorias","categoriasId","obtenerEspecialistasPorServicio","servicioId","servicioDoc","servicioData","this","obtenerEspecialistasPorCategoria","obtenerTurnosPorEspecialistaYFecha","especialistaId","fecha","slotsPorEspecialista","obtenerTurnosPorEspecialistasYFecha","especialistasIds","promises","Promise","all","flat","verificarDisponibilidadParaEspecialistas","horario","limit","empty","generarHorariosDisponiblesEspecialista","duracionRequerida","config","especialistaDoc","turnosOcupados","especialista","diaKey","Date","getDay","horarioDia","horarioLaboral","activo","inicio","fin","slotsOcupados","_calcularSlotsOcupados","_generarHorarios","fechaSeleccionada","horaApertura","parseInt","minApertura","horaCierre","minCierre","duracion","duracionTurno","duracionTurnoBase","warn","horarios","horaActual","minActual","cierreMinutos","horarioStr","toString","padStart","inicioMinutos","finMinutos","cabeEnJornada","todosLosSlotsDisponibles","min","minutoSlot","horarioSlot","Math","floor","includes","ocupado","push","hora","disponible","_generarHorariosBasicos","dentroDeJornada","obtenerHorariosComunesDisponibles","duracionTotal","horariosPorEspecialista","horariosDisponibles","_encontrarHorariosComunes","_puedeAcomodarDuracion","horarioInicio","diaSemana","horaInicioStr","minutoInicioStr","horaInicio","horaCierreStr","minutoCierreStr","minutoCierre","Object","keys","horariosComunes","i","horariosEspecialista","_encontrarHorariosComunesConDuracion","horariosBase","horarioBase","todosDisponibles","minutos","horarioSlotStr","find","h","_filtrarHorariosPorHoraActual","ahora","tiempoActualMinutos","getHours","getMinutes","horaStr","minutoStr","verificarDisponibilidad","verificarDisponibilidadEspecialistas","datosReserva","especialistas","verificarDisponibilidadEspecialista","especialistaData","verificarBloqueosEspecialista","fechaTimestamp","getTime","snapshot","bloqueo","inicioBloqueo","fechaInicio","finBloqueo","fechaFin","obtenerTurnosSolapados","minutoFin","minutoFinAjustado","horarioFin","userId","add","timestamp","FieldValue","serverTimestamp","expiresAt","now","eliminarBloqueoTemporal","bloqueoId","delete","obtenerTurnosPorUsuario","hoy","setHours","fechaHoy","toISOString","guardarTurno","turnoData","serviciosSnapshot","FieldPath","documentId","serviciosIds","serviciosOrdenados","especialistasPorCategoria","serviciosPorEspecialista","forEach","servicio","nombre","offsetGlobalMinutos","servicioInicioMinutos","servicioFinMinutos","horaSlot","especialistaIds","log","docRef","estado","createdAt","actualizadoEl","generarHorariosDisponibles","turnos","turno","minuto","cacheMonitor","hits","misses","savings","incrementHit","logStats","incrementMiss","total","hitRate","round","addSavings","amount","cache","servicios","horarios_multi","ttl","esValido","clave","idEspecifico","guardar","datos","obtener","estimarLecturasAhorradas","limpiarEspecifico","forzarActualizacionEspecialistas","precacheDatosEsenciales","allSettled","firestoreSeguro","obtenerCategorias","obtenerServicios","limpiarCache","key","actualizarCacheEspecialistas","guardarCacheEnStorage","cacheData","fechaGuardado","localStorage","setItem","stringify","cargarCacheDesdeStorage","getItem","parsed","unaHora","removeItem","limpiarCacheEspecialistasPorCategoria","addEventListener","document","usuarioActual","esPaginaAdmin","location","pathname","inicializarAuth","manejarRedirectResult","onAuthStateChanged","user","actualizarUIUsuario","actualizarBotonAdmin","cargarDatosUsuario","uid","configurarEventosAuth","removeEventListener","manejarClicAuth","esBotonAuthPrincipal","target","closest","esBotonAuthMenu","preventDefault","stopPropagation","iniciarSesionGoogle","cerrarSesion","manejarOpcionProtegida","classList","contains","esUsuarioAdministrador","href","mostrarError","deshabilitarBotonesAuth","provider","setCustomParameters","prompt","result","signInWithPopup","email","manejarAutenticacionRedirect","mostrarErrorAuth","sessionStorage","signInWithRedirect","redirectError","getRedirectResult","then","preAuthUrl","catch","signOut","setTimeout","reload","mostrarMensajeExito","deshabilitar","getElementById","btn","boton","disabled","style","opacity","innerHTML","mensaje","alert","guardarUsuario","displayName","photoURL","limpiarUsuario","authContainer","navItemsAuth","querySelectorAll","navItemsNoAuth","isAnonymous","display","actualizarSubmenusDinamicos","actualizarVisibilidadMenu","cargarTurnosUsuario","ultimaCargaTurnos","CACHE_DURACION","pasoActual","autocompletarFormulario","opcion","mostrarBotonLogin","contenedor","querySelector","parentElement","nombreInput","emailInput","value","validarNombre","validarEmail","telefono","phoneNumber","cargarDatosGuardados","usuarioGuardado","mensajeExito","createElement","className","body","appendChild","remove","nombreUsuario","emailUsuario","textContent","elementosAuth","elementosNoAuth","inicializarAcordeonMenu","intervaloActualizacionTurnos","el","overlay","modal","mensajePersonalizado","calcularDuracionTotal","horas","cerrarModal","animation","ErrorHandler","mostrar","tipo","toUpperCase","manejarErrorFirestore","contexto","Validador","prop","hasOwnProperty","categoria","filtrarInvalidos","btnMenu","menuLateral","toggle","inicializarCierreMenuOverlay","inicializarAcordeonesServicios","header","dataset","container","nextElementSibling","icono","c","otherIcon","previousElementSibling","estaAbierto","inicializarAcordeonesEspecialistas","lista","l","toggleLoader","btnSiguiente","loader","menuItem","listItem","submenu","isActive","cerrarTodosLosSubmenus","quitarClaseActiveNav","element","nav","menuIcon","navElement","menu","obtenerDatosContactoSeguro","datosGenerales","empresa","contactoCache","actualizarMenuContacto","direccionElement","direccion","telefonoElement","emailElement","redes","redesSociales","instagramLink","equisLink","whatsappLink","instagram","equis","whatsapp","inicializarMenuContactoDefinitivo","formatearFecha","fechaStr","getDate","getMonth","calcularHorarioFin","duracionMinutos","totalMinutos","minutosFin","usuario","currentUser","submenuUl","turnosHTML","fechaFormateada","montoFormateado","montoTotal","toLocaleString","join","inicializarSistemaTurnosUsuario","configurarObservadorMenu","detenerActualizacionAutomatica","MutationObserver","mutations","mutation","attributeName","iniciarActualizacionAutomatica","observe","attributes","setInterval","clearInterval","forzarActualizacionTurnos","applyListeners","toggleClass","undefined","stringClass","jQuery","esAdminPage","ADMIN_UID","obtenerElementosAdmin","adminPanel","loginBtn","logoutBtn","calendar","turnosList","fechaTitulo","modalEditar","formEditar","btnEliminarModal","closeModal","elements","currentTurnoId","especialistasMap","especialistasCargando","pendientesDeActualizacion","serviciosMap","initAdmin","verificarFirestore","assign","handleAuthState","signInWithGoogle","guardarCambiosTurno","setupModalEvents","inicializarGestionServicios","inicializarGestionPersonal","inicializarNavegacionAdmin","cargarEspecialistas","cargarServicios","showAdminPanel","initCalendar","showLoginScreen","destroy","navEnlaces","seccionCalendario","seccionServicios","seccionPersonal","mostrarSeccion","seccion","actualizarOverlay","enlaceActivo","navAdmin","rect","getBoundingClientRect","navRect","enlaceStyles","getComputedStyle","paddingLeft","parseFloat","paddingRight","overlayLeft","left","overlayWidth","width","cambiarSeccion","enlace","textoEnlace","cargarServiciosYMostrar","cargarPersonalYMostrar","enlaces","calendario","personal","enlaceActivoInicial","inicializarNavegacionCuandoPanelListo","inicializarTabBar","activarEnlace","activeEnlace","currentActive","parentNode","mostrarMensajeError","mensajeError","mostrarLoading","loading","nuevoMapa","size","cargados","callback","obtenerNombreEspecialista","cargarEspecialistaIndividual","formatearNombreDesdeId","refetchEvents","txt","charAt","substr","toLowerCase","recargarEspecialistasYVista","obtenerConfiguracionPorDefecto","dias","strClean","normalizarDias","sort","a","b","validarHorario","horarioEnMinutos","aperturaH","aperturaM","cierreH","cierreM","valido","FullCalendar","Calendar","initialView","locale","headerToolbar","center","right","selectable","selectMirror","dayMaxEvents","selectOverlap","height","contentHeight","allDaySlot","slotMinTime","slotMaxTime","slotDuration","slotLabelInterval","slotLabelFormat","hour","minute","hour12","dateClick","info","dayEl","moreLink","click","getEvents","event","eventStart","start","dateStr","extendedProps","esContador","loadTurnosForDate","events","fetchInfo","successCallback","failureCallback","startStr","endStr","clienteNombre","cliente","serviciosNombres","obtenerNombresServicios","crearEventoTurno","slots","reduce","serviciosEspecificos","s","eventClick","abrirModalEdicion","select","unselect","views","dayGridMonth","dayMaxEventRows","displayEventTime","timeGridWeek","dayHeaderFormat","weekday","day","month","slotEventOverlap","eventMinHeight","timeGridDay","year","eventTimeFormat","viewDidMount","eventDidMount","startTime","toLocaleTimeString","endTime","end","tooltipContent","setAttribute","render","esMultiplesEspecialistas","especialistaNombre","titulo","horaFinCalculada","turnoBaseId","colorBordeGrupo","generarColorDesdeId","title","allDay","turnoId","todosLosEspecialistas","observaciones","calcularDuracionEnMinutos","borderColor","backgroundColor","getEventColorBySpecialist","textColor","coloresGrupo","hash","charCodeAt","abs","coloresFijos","esp_analia_solange","esp_agustin_matias","esp_blondie_flores","esp_monica_flores","coloresRespaldo","getEventColor","minutoInicio","horaFin","recargarVistaCalendario","vistaActual","view","tipoVista","type","fechaActual","currentStart","changeView","date","fechaObj","fechaAjustada","getTimezoneOffset","options","toLocaleDateString","renderTurnos","nombresEspecialistas","serviciosInfo","espId","nombreEsp","nombresServicios","horariosInfo","tagName","card","detalles","icon","currentTarget","getAttribute","confirm","eliminarTurno","abrirModalEdicionPorId","generarOpcionesHorario","infoHTML","onclick","configurarModalEliminar","loadingIndicator","selectHorario","minutoActual","option","inicioEnMinutos","finEnMinutos","turnosSolapados","turnoHorario","turnoHora","turnoMinuto","turnoInicio","turnoFin","verificarDisponibilidadCompletaEspecialista","turnoIdExcluir","nombreEspecialista","minutoApertura","turnosConflictivos","turnoExistente","existenteHora","existenteMinuto","existenteInicio","existenteFin","haySolapamiento","verificarDisponibilidadCompleta","nuevoTurno","turnoActual","entries","primerSlot","disponibilidad","token","getIdTokenResult","claims","admin","nuevoHorario","nuevaFecha","validacionHorario","turnoDoc","algunEspecialistaDisponible","mensajesError","diaSemanaConfig","nuevaHora","nuevoMinuto","horaOriginal","minutoOriginal","desplazamientoMinutos","turnoActualizado","nuevosSlotsPorEspecialista","nuevosServiciosPorEspecialista","todosLosSlots","horarioInicioGlobal","horarioFinGlobal","horaInicioGlobal","minutoInicioGlobal","minutosInicioGlobal","minutosNuevoInicio","slotsOriginales","primerSlotOriginal","minutosNuevoSlot","nuevoMinutoSlot","nuevoPrimerSlot","nuevosSlotsEspecialista","slotMinutos","slotMinuto","nuevoSlot","slotFinMinutos","horaFinGlobal","minutoFinGlobal","nuevoHorarioFin","Set","nuevosSlotsOcupados","update","fechaTurno","btnEliminar","replaceWith","cloneNode","categoriasMap","btnAgregarServicio","abrirModalServicio","configurarModalServicio","categoriasSnapshot","mostrarServiciosEnUI","serviciosList","serviciosPorCategoria","values","html","crearHTMLServicio","configurarEventosServicios","precioFormateado","formatearPrecio","precio","duracionFormateada","formatearDuracionAdmin","promo","eliminarServicio","form","closeBtn","guardarServicio","cargarCategoriasEnSelect","llenarSelectConCategorias","orden","reset","descripcion","checked","nuevoId","generarIdServicio","verificarIdUnico","creadoEl","set","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","mins","personalMap","btnAgregarPersonal","abrirModalPersonal","configurarModalPersonal","personalSnapshot","mostrarPersonalEnUI","personalList","crearHTMLPersonal","configurarEventosPersonal","obtenerDiasLaborales","fotoUrl","lunes","martes","miercoles","jueves","viernes","sabado","domingo","diasActivos","dia","personalId","eliminarPersonal","guardarPersonal","cargarCategoriasCheckboxesPersonal","configurarUploaderImagen","contenedorCheckboxes","llenarCheckboxesConCategorias","categoriasOrdenadas","filePreview","previewImg","uploadLabel","resetearFormularioPersonal","src","establecerCategoriasSeleccionadas","establecerHorarioLaboral","checkbox","activoCheckbox","inicioInput","finInput","archivoImagen","files","fotoUrlExistente","personalData","obtenerCategoriasSeleccionadas","obtenerHorarioLaboralFromForm","subirImagenPersonal","generarIdPersonal","checkboxes","from","categoriasIds","normalizarParaId","texto","normalize","coleccion","storage","archivo","name","extension","pop","nombreArchivo","storageRef","ref","child","put","downloadURL","getDownloadURL","fileInput","removeBtn","uploadContainer","reader","FileReader","onload","readAsDataURL","archivos","dataTransfer","dispatchEvent","Event","funcionesVacias","funcName","enviarEmailConfirmacion","datosTurno","emailData","to","subject","htmlContent","reserva","getFullYear","bcc","enviarEmail","functions","httpsCallable","success","totalPasos","precios","Corte","Alisado","duraciones","observacion","mejorEspecialistaPorCategoria","calendarioFechaActual","fechasDisponiblesCalendario","coordenadasLocal","elementos","progreso","btnAnterior","pasos","resumenNombre","resumenEmail","resumenTelefono","resumenServicio","resumenFecha","resumenHorario","resumenObservacion","resumenEspecialistas","contenedorEspecialistas","probarConexion","obtenerTurnosPorFecha","cargarConfiguracion","cargarDatosGenerales","usuarioLS","inicializarEventos","actualizarInterfaz","categoriasValidas","serviciosValidos","serviciosDisponibles","actualizarUIServicios","observer","paso3","cargarFechasYHorarios","cached","cacheKey","horariosCache","generarHorariosMultiplesEspecialistas","resultados","index","status","autenticarParaReserva","userCredential","signInAnonymously","bloquearTurnoTemporal","usuarioId","retrocederPaso","avanzarPaso","actualizarServiciosSeleccionados","seleccionarElemento","horarioSeleccionado","esp","validacion","validarDisponibilidadCompleta","validarTelefono","especialistaEl","categoriaSection","especialistaElement","seleccionarEspecialista","actualizarResumenEspecialistas","calcularSubtotal","subtotal","ahorroTotal","precioOriginal","elementoAhorro","serviciosSeleccionados","actualizarContadoresCategoria","serviciosProcesados","serv","servicioNombre","servicioCompleto","tienePromo","precioFinal","calcularSenia","mostrarEspecialistas","actualizarResumenServicios","especialistasPromises","catId","reason","elemento","especialistaExistenteIndex","findIndex","elementoAnterior","splice","cargarFechasDisponibles","cargarHorariosDisponibles","contenedorFechas","fechasDisponibles","setDate","fechaElement","slice","contenedorHorarios","horarioElement","validarDatosContacto","test","resumenServicios","serviciosHTML","precioMostrado","badgePromo","obtenerNombreCategoria","cat","confirmarReserva","fechaCreacion","senia","mostrarConfirmacion","reiniciarFormulario","userDoc","userData","logout","nombreLocal","logoUrl","logo","alt","contactarPorWhatsApp","url","encodeURIComponent","open","abrirUbicacion","lat","lng","contenedorServicios","serviciosCategoria","tienePromociones","some","categoriaEl","svgPromo","serviciosContainer","servicioEl","cursor","contador","debugServicios","buscarEspecialistasAutomaticos","validarPaso","actualizarResumenContinuo","scrollAlInicio","guardarDatosFormulario","actualizarResumen","infoEspecialista","limpiarSeleccion","errorElement","actualizarPasos","actualizarBotones","contenedorMaqueta","scrollTo","top","behavior","simularReserva","errorReserva","requestAnimationFrame","completarReserva","userIdParaBloqueo","inicializarDisponibilidad","actualizarUIFechas","generarFechasDisponibles","turnoInicioMin","turnoFinMin","obtenerFechasComunesDisponibles","todasLasFechas","fechasValidas","ahoraArg","timeZone","hoyArg","empezarDesdeManana","diaInicial","esDiaLaboral","formatearFechaDisplay","obtenerFechaSeleccionada","partes","mes","cargandoFechas","contenedorCalendario","sinFechas","primeraFechaDisponible","obtenerPrimeraFechaDisponibleEspecialistas","fechaPrimera","renderizarCalendario","debugVisualizacionFechas","seleccionarFechaAutomaticamente","cargarHorariosParaFecha","cargandoHorarios","sinHorarios","horariosFiltrados","filtrarHorariosPorHoraActual","actualizarUIHorarios","encontrarHorariosComunes","horariosOcupados","t","seleccionarHorario","verificarDisponibilidadEnTiempoReal","manejarClickHorario","crearContenedorHorarios","paso","pasoElement","errores","msg","errorServicio","errorEspecialista","categoriasServicios","categoriasConEspecialista","errorFecha","errorHorario","validarFormulario","errorGeneral","errorGeneralExistente","nombreValido","emailValido","telefonoValido","ceil","input","errorMsg","valor","word","resumenContinuo","paso6","botonNuevaReserva","insertAdjacentHTML","demoPaso6","seleccionPredeterminada","especialistasContainer","img","especialistaCompleto","avatarUrl","btnVerEspecialistas","hasEventListener","limpiarFechasYHorarios","serviciosLength","serviciosEnCategoria","serviciosTexto","opcionDisponibilidad","infoAdicional","calificacion","stack","actualizarUIEspecialistas","paso2","plantilla","sinEspecialistas","especialistasAutomaticos","espAuto","mejorEspecialista","obtenerEspecialistaConMejorDisponibilidad","disponibilidadEspecialistas","puntuacionDisponibilidad","diasEvaluados","fechaEvaluar","horariosDisponiblesFiltrados","bloquesDisponibles","encontrarBloquesDisponibles","disponibilidadPromedio","puntuacion","fallbackError","bloques","slotsNecesarios","bloqueValido","j","calcularHoraFin","agregarEventosBotones","btnBuscarDisponibilidad","toggleLista","botonesEspecialista","botonesHTML","esDuracionValida","mostrarErrorDisponibilidad","especialistasNoDisponibles","fechasComunes","generarFechasDisponiblesConEspecialistas","f","diaElement","actualizarSubtituloHorarios","obtenerHorariosComunes","puedeAcomodarDuracion","configuracion","seleccionarFecha","formatearFechaParaDebug","getUTCDay","formatearDuracion","inicializarCalendario","debounce","func","wait","timeout","args","clearTimeout","debouncedCargarHorarios","btnPrev","btnNext","setMonth","mesAnioElement","diasContainer","anio","primerDia","diasEnMes","diaInicio","diaVacio","String","fechaLocal","hoyFormateado","seleccionarFechaCalendario","subtitulo","diaNumero","resumenFechaHora","resumenCliente","actualizarResumenFechaHora","actualizarResumenCliente","serviciosLista","precioTotal","precioSenia","totalDuracion","totalPrecio","totalSenia","especialistasLista","resumenHora","svgFecha","svgHora","atencionElement","horariosAtencion","twitterLink","twitter","inicializarMapasEnDirecciones","escucharCambiosConfigGeneral","onSnapshot","inicializarMapas","geocodificarDireccion","google","maps","Geocoder","geocode","address","results","geometry","elementoDireccion","coordenadas","popup","urlMapaEstatico","imgMapa","onerror","coordenadasGeocodificadas","urlMaps","actualizarAnioFooter","yearElement","currentYear"],"mappings":"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","file":"bundle.min.js","sourcesContent":["// firebaseConfig.js - Versin completa\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAlrmioVjkpD9tVgq3ZQZTJyPn4TkfMkFk\",\r\n  authDomain: \"peluqueria-completa.firebaseapp.com\",\r\n  projectId: \"peluqueria-completa\",\r\n  storageBucket: \"peluqueria-completa.firebasestorage.app\",\r\n  messagingSenderId: \"48556844588\",\r\n  appId: \"1:48556844588:web:7ff13754150b12b69d9389\",\r\n  measurementId: \"G-Z5GX6CDV9R\"\r\n};\r\n\r\n// Configuracin Brevo\r\nwindow.brevoConfig = {\r\n  senderEmail: \"no-reply@gestionturno.com\",\r\n  senderName: \"DemoPro GestinTurno\",\r\n  adminEmail: \"agustinmatiasf@gmail.com\"\r\n};\r\n\r\n// Configuracin Especfica de la App\r\nwindow.appConfig = {\r\n  version: \"2.0\",\r\n  environment: \"production\",\r\n  features: {\r\n    multiSpecialist: true,  \r\n    categories: true,       \r\n    realTimeValidation: true\r\n  }\r\n};\r\n\r\n// Inicializar Firebase\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\n\r\n// Exportar las instancias necesarias\r\nwindow.firebaseAuth = firebase.auth();\r\nwindow.db = firebase.firestore();\r\n\r\nwindow.handleFirebaseError = (error) => {\r\n  console.error('Firebase Error:', error);\r\n  \r\n  const errorMap = {\r\n    'permission-denied': 'No tienes permisos para esta accin',\r\n    'unavailable': 'Error de conexin. Intenta nuevamente',\r\n    'not-found': 'Recurso no encontrado'\r\n  };\r\n  \r\n  return errorMap[error.code] || error.message;\r\n};","window.googleProvider = new firebase.auth.GoogleAuthProvider();\r\nwindow.googleProvider.addScope('profile');\r\nwindow.googleProvider.addScope('email');","(() => {\r\n  if (!firebase.apps.length) {\r\n    throw new Error('Firebase no est inicializado');\r\n  }\r\n\r\n  const { db } = window;\r\n\r\n  window.firestoreDB = {\r\n    // Obtener configuracin\r\n    async obtenerConfiguracion() {\r\n      const doc = await db.collection('config').doc('horarios').get();\r\n      if (!doc.exists) throw new Error(\"No se encontr configuracin\");\r\n      \r\n      const data = doc.data();\r\n      \r\n      // Limpiar formatos de horarios\r\n      if (typeof data.horarioApertura === 'string') {\r\n        data.horarioApertura = data.horarioApertura.replace(/\"/g, '');\r\n      }\r\n      if (typeof data.horarioCierre === 'string') {\r\n        data.horarioCierre = data.horarioCierre.replace(/\"/g, '');\r\n      }\r\n      \r\n      // Funcin mejorada para procesar diasLaborales\r\n      const procesarDiasLaborales = (diasLaborales) => {\r\n        if (!diasLaborales) return [1, 2, 3, 4, 5, 6]; // Valor por defecto (L-S)\r\n        \r\n        // Si ya es un array de nmeros, devolverlo\r\n        if (Array.isArray(diasLaborales) && diasLaborales.every(item => typeof item === 'number')) {\r\n          return diasLaborales;\r\n        }\r\n        \r\n        // Si es un array con un string que parece JSON\r\n        if (Array.isArray(diasLaborales) && diasLaborales.length === 1 && typeof diasLaborales[0] === 'string') {\r\n          try {\r\n            // Intentar limpiar y parsear\r\n            const str = diasLaborales[0].trim();\r\n            // Verificar si es un array JSON\r\n            if (str.startsWith('[') && str.endsWith(']')) {\r\n              return JSON.parse(str).map(Number);\r\n            }\r\n            // Si no es JSON, tratar como string separado por comas\r\n            return str.split(',').map(Number).filter(n => !isNaN(n));\r\n          } catch (e) {\r\n            console.error(\"Error parseando diasLaborales:\", e);\r\n            return [1, 2, 3, 4, 5, 6]; // Valor por defecto\r\n          }\r\n        }\r\n        \r\n        // Si es un string\r\n        if (typeof diasLaborales === 'string') {\r\n          // Si es un string JSON\r\n          if (diasLaborales.startsWith('[') && diasLaborales.endsWith(']')) {\r\n            try {\r\n              return JSON.parse(diasLaborales).map(Number);\r\n            } catch (e) {\r\n              console.error(\"Error parseando diasLaborales JSON:\", e);\r\n            }\r\n          }\r\n          // Si es un string separado por comas\r\n          return diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n        }\r\n        \r\n        // Valor por defecto si no se puede procesar\r\n        return [1, 2, 3, 4, 5];\r\n      };\r\n      \r\n      data.diasLaborales = procesarDiasLaborales(data.diasLaborales);\r\n      \r\n      // Convertir diasNoLaborables si es necesario\r\n      if (typeof data.diasNoLaborables === 'string') {\r\n        try {\r\n          data.diasNoLaborables = JSON.parse(data.diasNoLaborables);\r\n        } catch (e) {\r\n          data.diasNoLaborables = data.diasNoLaborables.replace(/[\\[\\]\\s]/g, '').split(',').filter(Boolean);\r\n        }\r\n      }\r\n      \r\n      return data;\r\n    },\r\n\r\n    // 1. Obtener configuracin general\r\n    async obtenerConfigGeneral() {\r\n        const doc = await db.collection('config').doc('general').get();\r\n        return doc.exists ? doc.data() : {};\r\n    },\r\n\r\n    // Obtener todas las categoras\r\n    async obtenerCategorias() {\r\n      const snapshot = await db.collection('categorias')\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // Obtener servicios por categora\r\n    async obtenerServiciosPorCategoria(categoriaId) {\r\n      const snapshot = await db.collection('servicios')\r\n        .where('categoriaId', '==', categoriaId)\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // Obtener todos los especialistas\r\n    async obtenerEspecialistas() {\r\n      const snapshot = await db.collection('especialistas')\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 2. Obtener todos los servicios activos  \r\n    async obtenerServicios() {\r\n        const snapshot = await db.collection('servicios')\r\n            .where('activo', '==', true)\r\n            .orderBy('orden')\r\n            .get();\r\n        return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 3. Obtener especialistas por categora\r\n    async obtenerEspecialistasPorCategoria(categoriaId) {\r\n      const snapshot = await db.collection('especialistas')\r\n        .where('categoriasId', 'array-contains', categoriaId)\r\n        .where('activo', '==', true)\r\n        .orderBy('orden')\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ \r\n        id: doc.id, \r\n        ...doc.data(),\r\n        categorias: doc.data().categoriasId // Puedes mapear esto a nombres si es necesario\r\n      }));\r\n    },\r\n\r\n    // 4. Obtener especialistas por servicio\r\n    async obtenerEspecialistasPorServicio(servicioId) {\r\n      const servicioDoc = await db.collection('servicios').doc(servicioId).get();\r\n      if (!servicioDoc.exists) return [];\r\n      \r\n      const servicioData = servicioDoc.data();\r\n      return await this.obtenerEspecialistasPorCategoria(servicioData.categoriaId);\r\n    },\r\n\r\n    // 5. Obtener turnos por ESPECIALISTA y fecha\r\n    async obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('especialistaIds', 'array-contains', especialistaId)\r\n          .where('fecha', '==', fecha)\r\n          .get();\r\n        \r\n        return snapshot.docs.map(doc => {\r\n          const data = doc.data();\r\n          return {\r\n            id: doc.id,\r\n            ...data,\r\n            // Asegurarse de que slotsPorEspecialista existe y tiene el formato correcto\r\n            slotsPorEspecialista: data.slotsPorEspecialista || {}\r\n          };\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo turnos por especialista y fecha:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    async obtenerTurnosPorEspecialistasYFecha(especialistasIds, fecha) {\r\n      const promises = especialistasIds.map(especialistaId =>\r\n        this.obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha)\r\n      );\r\n      const resultados = await Promise.all(promises);\r\n      return resultados.flat();\r\n    },\r\n\r\n    // Verificar disponibilidad para mltiples especialistas\r\n    async verificarDisponibilidadParaEspecialistas(fecha, horario, especialistasIds) {\r\n      try {\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .where('horarioInicio', '==', horario)\r\n          .where('especialistaId', 'in', especialistasIds)\r\n          .limit(1)\r\n          .get();\r\n          \r\n        return snapshot.empty;\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async obtenerTurnosPorFecha(fecha) {\r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .get();\r\n      return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n    },\r\n\r\n    // 6. Generar horarios por ESPECIALISTA y FECHA\r\n    async generarHorariosDisponiblesEspecialista(especialistaId, fecha, duracionRequerida = 0) {\r\n      try {\r\n        const [config, especialistaDoc, turnosOcupados] = await Promise.all([\r\n          this.obtenerConfiguracion(),\r\n          db.collection('especialistas').doc(especialistaId).get(),\r\n          this.obtenerTurnosPorEspecialistaYFecha(especialistaId, fecha)\r\n        ]);\r\n\r\n        if (!especialistaDoc.exists) {\r\n          throw new Error('Especialista no encontrado');\r\n        }\r\n\r\n        const especialista = especialistaDoc.data();\r\n        if (!especialista) throw new Error('Especialista no encontrado');\r\n\r\n        // Determinar horario laboral del da\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const diaKey = dias[diaSemana];\r\n        const horarioDia = especialista.horarioLaboral?.[diaKey];\r\n        \r\n        // Usar horario del especialista o config general\r\n        const horarioApertura = horarioDia?.activo ? horarioDia.inicio : config.horarioApertura;\r\n        const horarioCierre = horarioDia?.activo ? horarioDia.fin : config.horarioCierre;\r\n\r\n        // Calcular slots ocupados - PASA el especialistaId como parmetro\r\n        const slotsOcupados = this._calcularSlotsOcupados(turnosOcupados, especialistaId);\r\n\r\n        return this._generarHorarios(\r\n            { ...config, horarioApertura, horarioCierre },\r\n            slotsOcupados,\r\n            fecha,\r\n            duracionRequerida\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Error en generarHorariosDisponiblesEspecialista:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Modificar la funcin _generarHorarios para considerar la duracin:\r\n    _generarHorarios(config, slotsOcupados, fechaSeleccionada, duracionRequerida = 0) {\r\n        const horarioApertura = config.horarioApertura;\r\n        const horarioCierre = config.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const horaApertura = parseInt(horarioApertura.replace('.', ':').split(':')[0]);\r\n        const minApertura = parseInt(horarioApertura.replace('.', ':').split(':')[1] || 0);\r\n        const horaCierre = parseInt(horarioCierre.replace('.', ':').split(':')[0]);\r\n        const minCierre = parseInt(horarioCierre.replace('.', ':').split(':')[1] || 0);\r\n        \r\n        // Obtener duracin con valor por defecto si es invlida\r\n        let duracion = 30; // Valor por defecto\r\n        if (config.duracionTurno && !isNaN(parseInt(config.duracionTurno))) {\r\n            duracion = parseInt(config.duracionTurno);\r\n        } else if (config.duracionTurnoBase && !isNaN(parseInt(config.duracionTurnoBase))) {\r\n            duracion = parseInt(config.duracionTurnoBase);\r\n        }\r\n        \r\n        // Validacin de valores numricos\r\n        if (isNaN(horaApertura)) throw new Error('Horario apertura invlido');\r\n        if (isNaN(minApertura)) minApertura = 0;\r\n        if (isNaN(horaCierre)) throw new Error('Horario cierre invlido');\r\n        if (isNaN(minCierre)) minCierre = 0;\r\n        if (isNaN(duracion)) {\r\n            console.warn('Duracin turno invlida, usando valor por defecto de 30 minutos');\r\n            duracion = 30;\r\n        }\r\n\r\n        const horarios = [];\r\n        let horaActual = horaApertura;\r\n        let minActual = minApertura;\r\n\r\n        // Convertir horario de cierre a minutos para validacin\r\n        const cierreMinutos = horaCierre * 60 + minCierre;\r\n\r\n        while (true) {\r\n            const horarioStr = `${horaActual.toString().padStart(2, '0')}:${minActual.toString().padStart(2, '0')}`;\r\n            \r\n            // Verificar si este horario puede acomodar la duracin requerida\r\n            const inicioMinutos = horaActual * 60 + minActual;\r\n            const finMinutos = inicioMinutos + duracionRequerida;\r\n            \r\n            // CORRECCIN: Verificar que el horario de fin no exceda el cierre\r\n            const cabeEnJornada = finMinutos <= cierreMinutos;\r\n            \r\n            // Solo considerar horarios que estn dentro del rango laboral\r\n            if (inicioMinutos >= cierreMinutos) break;\r\n            \r\n            // Verificar si todos los slots necesarios para la duracin estn disponibles\r\n            let todosLosSlotsDisponibles = true;\r\n            for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n                const horaSlot = Math.floor(min / 60);\r\n                const minutoSlot = min % 60;\r\n                const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n                \r\n                if (slotsOcupados.includes(horarioSlot)) {\r\n                    todosLosSlotsDisponibles = false;\r\n                    break;\r\n                }\r\n            }\r\n            \r\n            const ocupado = !todosLosSlotsDisponibles;\r\n\r\n            // Solo marcar como disponible si no est ocupado y cabe en la jornada\r\n            horarios.push({\r\n                hora: horarioStr,\r\n                disponible: !ocupado && cabeEnJornada\r\n            });\r\n\r\n            // Avanzar el tiempo por la duracin base, no la requerida\r\n            minActual += duracion;\r\n            if (minActual >= 60) {\r\n                horaActual += Math.floor(minActual / 60);\r\n                minActual = minActual % 60;\r\n            }\r\n            \r\n            // Salir del loop si hemos superado el horario de cierre\r\n            if (horaActual > horaCierre || (horaActual === horaCierre && minActual > minCierre)) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Validacin mnima de resultados\r\n        if (horarios.length === 0) {\r\n            console.error('No se generaron horarios con la configuracin:', config);\r\n            throw new Error('No se pudieron generar horarios');\r\n        }\r\n\r\n        return horarios;\r\n    },\r\n\r\n    // Funcin para generar horarios bsicos sin considerar duracin\r\n    _generarHorariosBasicos(config, slotsOcupados, fechaSeleccionada) {\r\n        const horarioApertura = config.horarioApertura;\r\n        const horarioCierre = config.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const horaApertura = parseInt(horarioApertura.replace('.', ':').split(':')[0]);\r\n        const minApertura = parseInt(horarioApertura.replace('.', ':').split(':')[1] || 0);\r\n        const horaCierre = parseInt(horarioCierre.replace('.', ':').split(':')[0]);\r\n        const minCierre = parseInt(horarioCierre.replace('.', ':').split(':')[1] || 0);\r\n        \r\n        // Obtener duracin con valor por defecto si es invlida\r\n        let duracion = 30;\r\n        if (config.duracionTurno && !isNaN(parseInt(config.duracionTurno))) {\r\n            duracion = parseInt(config.duracionTurno);\r\n        } else if (config.duracionTurnoBase && !isNaN(parseInt(config.duracionTurnoBase))) {\r\n            duracion = parseInt(config.duracionTurnoBase);\r\n        }\r\n\r\n        const horarios = [];\r\n        let horaActual = horaApertura;\r\n        let minActual = minApertura;\r\n\r\n        // Convertir horario de cierre a minutos para validacin\r\n        const cierreMinutos = horaCierre * 60 + minCierre;\r\n\r\n        while (horaActual < horaCierre || (horaActual === horaCierre && minActual <= minCierre)) {\r\n            const horarioStr = `${horaActual.toString().padStart(2, '0')}:${minActual.toString().padStart(2, '0')}`;\r\n            \r\n            const ocupado = slotsOcupados.includes(horarioStr);\r\n            const dentroDeJornada = (horaActual * 60 + minActual) < cierreMinutos;\r\n\r\n            horarios.push({\r\n                hora: horarioStr,\r\n                disponible: !ocupado && dentroDeJornada\r\n            });\r\n\r\n            // Avanzar el tiempo\r\n            minActual += duracion;\r\n            if (minActual >= 60) {\r\n                horaActual += Math.floor(minActual / 60);\r\n                minActual = minActual % 60;\r\n            }\r\n        }\r\n\r\n        return horarios;\r\n    },\r\n\r\n    // Funcin para obtener horarios comunes disponibles\r\n    async obtenerHorariosComunesDisponibles(fecha, especialistasIds, duracionTotal) {\r\n      try {\r\n        // Obtener horarios para cada especialista CON la duracin total\r\n        const horariosPorEspecialista = {};\r\n        \r\n        for (const especialistaId of especialistasIds) {\r\n          const horarios = await this.generarHorariosDisponiblesEspecialista(\r\n            especialistaId, \r\n            fecha,\r\n            duracionTotal // Pasar la duracin total aqu\r\n          );\r\n          \r\n          // Filtrar solo los horarios disponibles\r\n          const horariosDisponibles = horarios\r\n            .filter(horario => horario.disponible)\r\n            .map(horario => horario.hora);\r\n          \r\n          horariosPorEspecialista[especialistaId] = horariosDisponibles;\r\n        }\r\n        \r\n        // Encontrar horarios comunes donde todos los especialistas estn disponibles\r\n        return this._encontrarHorariosComunes(horariosPorEspecialista);\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo horarios comunes:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Funcin auxiliar para verificar si un horario puede acomodar la duracin total\r\n    async _puedeAcomodarDuracion(horarioInicio, duracionTotal, especialistaId, fecha) {\r\n        try {\r\n            // Obtener datos del especialista\r\n            const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n            if (!especialistaDoc.exists) return false;\r\n            \r\n            const especialista = especialistaDoc.data();\r\n            const diaSemana = new Date(fecha).getDay();\r\n            const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n            const diaKey = dias[diaSemana];\r\n            \r\n            // Usar horario del especialista o configuracin general\r\n            const horarioLaboral = especialista.horarioLaboral?.[diaKey];\r\n            const config = await this.obtenerConfiguracion();\r\n            \r\n            const horarioCierre = horarioLaboral?.activo ? \r\n                horarioLaboral.fin : config.horarioCierre;\r\n            \r\n            // Convertir horarios a minutos para comparacin\r\n            const [horaInicioStr, minutoInicioStr] = horarioInicio.split(':');\r\n            const horaInicio = parseInt(horaInicioStr);\r\n            const minutoInicio = parseInt(minutoInicioStr);\r\n            const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n            \r\n            const [horaCierreStr, minutoCierreStr] = horarioCierre.split(':');\r\n            const horaCierre = parseInt(horaCierreStr);\r\n            const minutoCierre = parseInt(minutoCierreStr || 0);\r\n            const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n            \r\n            // Calcular horario de fin\r\n            const finMinutos = inicioMinutos + duracionTotal;\r\n            \r\n            // Verificar que el turno termine antes del cierre\r\n            return finMinutos <= cierreMinutos;\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error validando duracin:\", error);\r\n            return false;\r\n        }\r\n    },\r\n\r\n    // Funcin para encontrar horarios comunes entre especialistas\r\n    _encontrarHorariosComunes(horariosPorEspecialista) {\r\n        const especialistasIds = Object.keys(horariosPorEspecialista);\r\n        if (especialistasIds.length === 0) return [];\r\n        \r\n        // Empezar con los horarios del primer especialista\r\n        let horariosComunes = [...horariosPorEspecialista[especialistasIds[0]]];\r\n        \r\n        // Intersectar con los horarios de los dems especialistas\r\n        for (let i = 1; i < especialistasIds.length; i++) {\r\n            const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n            horariosComunes = horariosComunes.filter(hora => \r\n                horariosEspecialista.includes(hora)\r\n            );\r\n        }\r\n        \r\n        return horariosComunes;\r\n    },\r\n\r\n    // Funcin para encontrar horarios comunes que puedan acomodar la duracin\r\n    _encontrarHorariosComunesConDuracion(horariosPorEspecialista, duracionTotal) {\r\n      const especialistasIds = Object.keys(horariosPorEspecialista);\r\n      if (especialistasIds.length === 0) return [];\r\n      \r\n      // Obtener todos los horarios posibles del primer especialista\r\n      const horariosBase = horariosPorEspecialista[especialistasIds[0]];\r\n      const horariosComunes = [];\r\n      \r\n      // Para cada horario del primer especialista, verificar si los dems\r\n      // tambin tienen disponibilidad para el bloque completo\r\n      for (const horarioBase of horariosBase) {\r\n        if (!horarioBase.disponible) continue;\r\n        \r\n        let todosDisponibles = true;\r\n        const inicioMinutos = horarioBase.minutos;\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        // Verificar para cada especialista si tiene todos los slots necesarios disponibles\r\n        for (let i = 0; i < especialistasIds.length; i++) {\r\n          const especialistaId = especialistasIds[i];\r\n          const horariosEspecialista = horariosPorEspecialista[especialistaId];\r\n          \r\n          // Verificar cada slot de 30 minutos dentro de la duracin total\r\n          for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            const horarioSlotStr = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n            \r\n            // Buscar este slot en los horarios del especialista\r\n            const slotDisponible = horariosEspecialista.find(h => \r\n              h.hora === horarioSlotStr && h.disponible\r\n            );\r\n            \r\n            if (!slotDisponible) {\r\n              todosDisponibles = false;\r\n              break;\r\n            }\r\n          }\r\n          \r\n          if (!todosDisponibles) break;\r\n        }\r\n        \r\n        if (todosDisponibles) {\r\n          horariosComunes.push(horarioBase.hora);\r\n        }\r\n      }\r\n      \r\n      return horariosComunes;\r\n    },\r\n\r\n    // Funcin para filtrar horarios segn la hora actual (si es hoy)\r\n    _filtrarHorariosPorHoraActual(horarios, duracionTotal) {\r\n        const ahora = new Date();\r\n        const horaActual = ahora.getHours();\r\n        const minutoActual = ahora.getMinutes();\r\n        const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n        \r\n        return horarios.filter(horario => {\r\n            const [horaStr, minutoStr] = horario.split(':');\r\n            const horaHorario = parseInt(horaStr);\r\n            const minutoHorario = parseInt(minutoStr);\r\n            const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n            \r\n            // Considerar margen de 30 minutos para reservas + duracin total\r\n            return tiempoHorarioMinutos >= (tiempoActualMinutos + 30 + duracionTotal);\r\n        });\r\n    },\r\n\r\n    // Verificar disponibilidad bsica\r\n    async verificarDisponibilidad(fecha, horario) {\r\n          try {\r\n            const snapshot = await db.collection('turnos')\r\n                .where('fecha', '==', fecha)\r\n                .where('horarioInicio', '==', horario)\r\n                .limit(1)\r\n                .get();\r\n                \r\n            return snapshot.empty;\r\n        } catch (error) {\r\n            console.error(\"Error verificando disponibilidad:\", error);\r\n            return false;\r\n        }\r\n    },\r\n\r\n    async verificarDisponibilidadEspecialistas(fecha) {\r\n        for (const especialista of datosReserva.especialistas) {\r\n            const disponible = await verificarDisponibilidadEspecialista(especialista.id, fecha);\r\n            if (!disponible) return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    async verificarDisponibilidadEspecialista(especialistaId, fecha, horario) {\r\n      try {\r\n        // 1. Verificar si el especialista trabaja ese da\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) return false;\r\n        \r\n        const especialistaData = especialistaDoc.data();\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // Si no trabaja ese da, no est disponible\r\n        if (!especialistaData.horarioLaboral || !especialistaData.horarioLaboral[diaKey]?.activo) {\r\n          return false;\r\n        }\r\n        \r\n        // 2. Verificar si tiene bloqueos/ausencias\r\n        const tieneBloqueos = await this.verificarBloqueosEspecialista(especialistaId, fecha);\r\n        if (tieneBloqueos) return false;\r\n        \r\n        // 3. Verificar turnos existentes\r\n        const snapshot = await db.collection('turnos')\r\n          .where('especialistaId', '==', especialistaId)\r\n          .where('fecha', '==', fecha)\r\n          .where('horarioInicio', '==', horario)\r\n          .limit(1)\r\n          .get();\r\n          \r\n        return snapshot.empty;\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async verificarBloqueosEspecialista(especialistaId, fecha) {\r\n        try {\r\n            // Convertir fecha a timestamp para comparacin\r\n            const fechaTimestamp = new Date(fecha).getTime();\r\n            \r\n            // Buscar bloqueos para este especialista\r\n            const snapshot = await db.collection('bloqueos')\r\n                .where('especialistaId', '==', especialistaId)\r\n                .get();\r\n                \r\n            if (snapshot.empty) {\r\n                return false;\r\n            }\r\n            \r\n            // Verificar cada bloqueo\r\n            for (const doc of snapshot.docs) {\r\n                const bloqueo = doc.data();\r\n                const inicioBloqueo = new Date(bloqueo.fechaInicio).getTime();\r\n                const finBloqueo = new Date(bloqueo.fechaFin).getTime();\r\n                \r\n                // Si la fecha est dentro del rango de bloqueo\r\n                if (fechaTimestamp >= inicioBloqueo && fechaTimestamp <= finBloqueo) {\r\n                    return true;\r\n                }\r\n            }\r\n            \r\n            return false;\r\n            \r\n        } catch (error) {\r\n            console.error(\"Error verificando bloqueos:\", error);\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    // Verificar solapamientos\r\n    async obtenerTurnosSolapados(fecha, horario, duracion) {\r\n      const [horaStr, minutoStr] = horario.split(':');\r\n      const horaInicio = parseInt(horaStr);\r\n      const minutoInicio = parseInt(minutoStr);\r\n      \r\n      const minutoFin = minutoInicio + duracion;\r\n      const horaFin = horaInicio + Math.floor(minutoFin / 60);\r\n      const minutoFinAjustado = minutoFin % 60;\r\n      const horarioFin = `${horaFin.toString().padStart(2, '0')}:${minutoFinAjustado.toString().padStart(2, '0')}`;\r\n      \r\n      const snapshot = await db.collection('turnos')\r\n        .where('fecha', '==', fecha)\r\n        .where('horarioInicio', '>=', horario)\r\n        .where('horarioInicio', '<', horarioFin)\r\n        .get();\r\n        \r\n      return snapshot.docs.map(doc => doc.data());\r\n    },\r\n\r\n    // Bloqueo temporal\r\n    async bloquearTurnoTemporal(fecha, horario, userId) {\r\n      const docRef = await db.collection('bloqueos_temporales').add({\r\n        fecha,\r\n        horario,\r\n        userId,\r\n        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n        expiresAt: new Date(Date.now() + 5*60*1000) // 5 minutos de expiracin\r\n      });\r\n      return docRef.id; // Devolver el ID automtico\r\n    },\r\n\r\n    async eliminarBloqueoTemporal(bloqueoId) {\r\n      await db.collection('bloqueos_temporales').doc(bloqueoId).delete();\r\n    },\r\n\r\n    async obtenerTurnosPorUsuario(userId) {\r\n      try {\r\n        const hoy = new Date();\r\n        hoy.setHours(0, 0, 0, 0);\r\n        const fechaHoy = hoy.toISOString().split('T')[0];\r\n\r\n        const snapshot = await db.collection('turnos')\r\n          .where('userId', '==', userId)\r\n          .where('fecha', '>=', fechaHoy)\r\n          .orderBy('fecha')\r\n          .orderBy('horarioInicio')\r\n          .get();\r\n\r\n        return snapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        }));\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo turnos del usuario:\", error);\r\n        return [];\r\n      }\r\n    },\r\n\r\n    // Guardar turno\r\n    async guardarTurno(turnoData) {\r\n      try {\r\n        // Obtener informacin detallada de los servicios\r\n        const serviciosSnapshot = await db.collection('servicios')\r\n          .where(firebase.firestore.FieldPath.documentId(), 'in', turnoData.serviciosIds)\r\n          .get();\r\n        \r\n        // Obtener servicios en el mismo orden que serviciosIds\r\n        const serviciosOrdenados = [];\r\n        for (const servicioId of turnoData.serviciosIds) {\r\n          const servicioDoc = serviciosSnapshot.docs.find(doc => doc.id === servicioId);\r\n          if (servicioDoc) {\r\n            serviciosOrdenados.push(servicioDoc);\r\n          }\r\n        }\r\n\r\n        // Obtener el mapeo de categora a especialista desde los datos del turno\r\n        const { especialistasPorCategoria } = turnoData;\r\n\r\n        // Calcular duracin total y agrupar servicios por especialista\r\n        let duracionTotal = 0;\r\n        const serviciosPorEspecialista = {};\r\n        const slotsPorEspecialista = {};\r\n        \r\n        // Primero, agrupar servicios por especialista\r\n        serviciosOrdenados.forEach(servicioDoc => {\r\n          const servicio = servicioDoc.data();\r\n          duracionTotal += servicio.duracion || 30;\r\n          \r\n          const especialistaId = especialistasPorCategoria[servicio.categoriaId];\r\n          \r\n          if (!especialistaId) {\r\n            throw new Error(`No se encontr especialista para la categora ${servicio.categoriaId}`);\r\n          }\r\n          \r\n          if (!serviciosPorEspecialista[especialistaId]) {\r\n            serviciosPorEspecialista[especialistaId] = [];\r\n            slotsPorEspecialista[especialistaId] = [];\r\n          }\r\n          \r\n          serviciosPorEspecialista[especialistaId].push({\r\n            id: servicioDoc.id,\r\n            nombre: servicio.nombre,\r\n            duracion: servicio.duracion || 30,\r\n            categoriaId: servicio.categoriaId\r\n          });\r\n        });\r\n\r\n        // Convertir horario de inicio a minutos\r\n        const [horaInicioStr, minutoInicioStr] = turnoData.horarioInicio.split(':');\r\n        const horaInicio = parseInt(horaInicioStr);\r\n        const minutoInicio = parseInt(minutoInicioStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        \r\n        // Calcular slots ocupados por especialista\r\n        let offsetGlobalMinutos = 0;\r\n        \r\n        for (const servicioDoc of serviciosOrdenados) {\r\n          const servicio = servicioDoc.data();\r\n          const especialistaId = especialistasPorCategoria[servicio.categoriaId];\r\n          \r\n          const servicioInicioMinutos = inicioMinutos + offsetGlobalMinutos;\r\n          const servicioFinMinutos = servicioInicioMinutos + servicio.duracion;\r\n          \r\n          // Calcular slots para este servicio\r\n          for (let min = servicioInicioMinutos; min < servicioFinMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n            \r\n            if (!slotsPorEspecialista[especialistaId].includes(horarioSlot)) {\r\n              slotsPorEspecialista[especialistaId].push(horarioSlot);\r\n            }\r\n          }\r\n          \r\n          offsetGlobalMinutos += servicio.duracion;\r\n        }\r\n        \r\n        // Crear un array con todos los IDs de especialistas involucrados\r\n        const especialistaIds = Object.keys(serviciosPorEspecialista);\r\n        \r\n        // CORRECCIN: Asegurar que serviciosPorEspecialista y slotsPorEspecialista tengan datos\r\n        if (Object.keys(serviciosPorEspecialista).length === 0) {\r\n          console.error(\"ERROR: serviciosPorEspecialista est vaco\");\r\n          console.log(\"Datos disponibles:\", {\r\n            serviciosOrdenados: serviciosOrdenados.length,\r\n            especialistasPorCategoria,\r\n            serviciosIds: turnoData.serviciosIds\r\n          });\r\n        }\r\n\r\n        if (Object.keys(slotsPorEspecialista).length === 0) {\r\n          console.error(\"ERROR: slotsPorEspecialista est vaco\");\r\n        }\r\n\r\n        // Guardar el turno\r\n        const docRef = await db.collection('turnos').add({\r\n          ...turnoData,\r\n          duracionTotal: duracionTotal,\r\n          serviciosPorEspecialista: serviciosPorEspecialista,\r\n          slotsPorEspecialista: slotsPorEspecialista,\r\n          especialistaIds: especialistaIds,\r\n          estado: 'pendiente',\r\n          createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n          actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n        });\r\n        \r\n        console.log(`Turno guardado exitosamente. ID: ${docRef.id}`);\r\n        return { id: docRef.id, ...turnoData };\r\n      } catch (error) {\r\n        console.error(\"Error guardando turno:\", error);\r\n        throw error;\r\n      }\r\n    },\r\n\r\n    // AGREGAR al final para compatibilidad temporal:\r\n    async generarHorariosDisponibles(fecha) {\r\n        console.warn('DEPRECATED: Usar generarHorariosDisponiblesEspecialista()');\r\n        return this.generarHorariosDisponiblesEspecialista('especialista_default', fecha);\r\n    },\r\n\r\n    _calcularSlotsOcupados(turnos, especialistaId) {\r\n      const slotsOcupados = [];\r\n      \r\n      turnos.forEach(turno => {\r\n        // Verificar si este turno involucra al especialista\r\n        if (turno.especialistaIds && turno.especialistaIds.includes(especialistaId)) {\r\n          // Usar los slots especficos para este especialista\r\n          if (turno.slotsPorEspecialista && turno.slotsPorEspecialista[especialistaId]) {\r\n            slotsOcupados.push(...turno.slotsPorEspecialista[especialistaId]);\r\n          } else {\r\n            // Fallback para turnos antiguos - calcular slots basados en horarioInicio y duracin\r\n            const [hora, minuto] = turno.horarioInicio.split(':').map(Number);\r\n            const inicioMinutos = hora * 60 + minuto;\r\n            const finMinutos = inicioMinutos + (turno.duracionTotal || 30);\r\n            \r\n            for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n              const horaSlot = Math.floor(min / 60);\r\n              const minutoSlot = min % 60;\r\n              const horarioSlot = `${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`;\r\n              \r\n              if (!slotsOcupados.includes(horarioSlot)) {\r\n                slotsOcupados.push(horarioSlot);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      return slotsOcupados;\r\n    }\r\n  };\r\n})();","const cacheMonitor = {\r\n    hits: 0,\r\n    misses: 0,\r\n    savings: 0,\r\n    \r\n    incrementHit: function() {\r\n        this.hits++;\r\n        this.logStats();\r\n    },\r\n    \r\n    incrementMiss: function() {\r\n        this.misses++;\r\n        this.logStats();\r\n    },\r\n    \r\n    logStats: function() {\r\n        const total = this.hits + this.misses;\r\n        const hitRate = total > 0 ? Math.round((this.hits / total) * 100) : 0;\r\n        \r\n        // Log cada 10 operaciones para no saturar la consola\r\n        if (total % 10 === 0) {\r\n            console.log(` Cache Stats: ${this.hits}h/${this.misses}m (${hitRate}%) | Ahorro: ${this.savings} lecturas`);\r\n        }\r\n    },\r\n    \r\n    addSavings: function(amount) {\r\n        this.savings += amount;\r\n    }\r\n};\r\n\r\nconst cache = {\r\n    config: null,\r\n    categorias: null,\r\n    servicios: null,\r\n    especialistas: {},\r\n    horarios: {},\r\n    horarios_multi: {}, //  AGREGAR: Cache para horarios mltiples\r\n    timestamp: {\r\n        config: 0,\r\n        categorias: 0,\r\n        servicios: 0,\r\n        especialistas: {},\r\n        horarios: {},\r\n        horarios_multi: {} //  AGREGAR: Timestamp para horarios mltiples\r\n    },\r\n    \r\n    // Tiempo de vida del cach en milisegundos (5 minutos)\r\n    ttl: 5 * 60 * 1000,\r\n    \r\n    // Verificar si el cach es vlido\r\n    esValido: function(clave, idEspecifico = null) {\r\n        try {\r\n            const timestamp = idEspecifico \r\n                ? this.timestamp[clave]?.[idEspecifico] || 0\r\n                : this.timestamp[clave] || 0;\r\n            \r\n            return (Date.now() - timestamp) < this.ttl;\r\n        } catch (error) {\r\n            console.warn('Error validando cach:', error);\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    // Guardar en cach\r\n    guardar: function(clave, datos, idEspecifico = null) {\r\n        try {\r\n            //  CORRECCIN: Validar que los datos no sean null/undefined\r\n            if (datos === null || datos === undefined) {\r\n                console.warn(` Intentando guardar datos invlidos en cach: ${clave}`, datos);\r\n                return;\r\n            }\r\n\r\n            if (idEspecifico) {\r\n                if (!this[clave]) this[clave] = {};\r\n                if (!this.timestamp[clave]) this.timestamp[clave] = {};\r\n                \r\n                this[clave][idEspecifico] = datos;\r\n                this.timestamp[clave][idEspecifico] = Date.now();\r\n            } else {\r\n                this[clave] = datos;\r\n                this.timestamp[clave] = Date.now();\r\n            }\r\n            \r\n            console.log(` Cach guardado: ${clave}${idEspecifico ? `[${idEspecifico}]` : ''}`);\r\n        } catch (error) {\r\n            console.error('Error guardando en cach:', error);\r\n        }\r\n    },\r\n    \r\n    // Obtener del cach\r\n    obtener: function(clave, idEspecifico = null) {\r\n        try {\r\n            const datos = idEspecifico \r\n                ? this[clave]?.[idEspecifico] ?? null\r\n                : this[clave] ?? null;\r\n            \r\n            if (datos !== null && this.esValido(clave, idEspecifico)) {\r\n                cacheMonitor.incrementHit();\r\n                cacheMonitor.savings += this.estimarLecturasAhorradas(clave);\r\n                return datos;\r\n            }\r\n            \r\n            cacheMonitor.incrementMiss();\r\n            return null;\r\n        } catch (error) {\r\n            console.error('Error obteniendo del cach:', error);\r\n            cacheMonitor.incrementMiss();\r\n            return null;\r\n        }\r\n    },\r\n    \r\n    estimarLecturasAhorradas: function(clave) {\r\n        // Estimacin de documentos ledos por operacin\r\n        const estimaciones = {\r\n            config: 1,\r\n            categorias: 10, // Suponiendo 10 categoras\r\n            servicios: 50,  // Suponiendo 50 servicios\r\n            especialistas: 5, // Por categora\r\n            horarios: 1,    // Por especialista por fecha\r\n            horarios_multi: 3 // Mltiples especialistas\r\n        };\r\n        return estimaciones[clave] || 1;\r\n    },\r\n\r\n    //  NUEVA FUNCIN: Limpiar cach especfico\r\n    limpiarEspecifico: function(clave, idEspecifico = null) {\r\n        try {\r\n            if (idEspecifico) {\r\n                if (this[clave] && this[clave][idEspecifico]) {\r\n                    delete this[clave][idEspecifico];\r\n                }\r\n                if (this.timestamp[clave] && this.timestamp[clave][idEspecifico]) {\r\n                    delete this.timestamp[clave][idEspecifico];\r\n                }\r\n                console.log(` Cach limpiado: ${clave}[${idEspecifico}]`);\r\n            } else {\r\n                this[clave] = null;\r\n                this.timestamp[clave] = 0;\r\n                console.log(` Cach limpiado: ${clave}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error limpiando cach especfico:', error);\r\n        }\r\n    },\r\n\r\n    //  NUEVA FUNCIN: Forzar actualizacin de cach para una categora\r\n    forzarActualizacionEspecialistas: function(categoriaId) {\r\n        this.limpiarEspecifico('especialistas', categoriaId);\r\n        console.log(` Cach forzado a actualizar para categora: ${categoriaId}`);\r\n    }\r\n};\r\n\r\n// Estrategia de precaching - Cargar datos esenciales al inicio\r\nasync function precacheDatosEsenciales() {\r\n    try {\r\n        console.log(' Precargando datos esenciales...');\r\n        \r\n        // Cargar configuracin, categoras y servicios en paralelo\r\n        await Promise.allSettled([\r\n            firestoreSeguro.obtenerConfiguracion(),\r\n            firestoreSeguro.obtenerCategorias(),\r\n            firestoreSeguro.obtenerServicios()\r\n        ]);\r\n        \r\n        console.log(' Precaching completado');\r\n    } catch (error) {\r\n        console.warn(' Precaching fall:', error);\r\n    }\r\n}\r\n\r\n// Guardar cache antes de recargar/cerrar\r\nwindow.addEventListener('beforeunload', guardarCacheEnStorage);\r\n\r\n// Cargar al iniciar\r\ndocument.addEventListener('DOMContentLoaded', cargarCacheDesdeStorage);\r\n\r\n// Funcin para limpiar cach cuando sea necesario\r\nfunction limpiarCache(clave = null) {\r\n    if (clave) {\r\n        cache[clave] = null;\r\n        cache.timestamp[clave] = 0;\r\n        console.log(` Cach de ${clave} limpiado`);\r\n    } else {\r\n        // Limpiar todo el cach\r\n        Object.keys(cache).forEach(key => {\r\n            if (key !== 'ttl' && key !== 'timestamp') {\r\n                cache[key] = key === 'especialistas' || key === 'horarios' || key === 'horarios_multi' ? {} : null;\r\n            }\r\n        });\r\n        Object.keys(cache.timestamp).forEach(key => {\r\n            cache.timestamp[key] = key === 'especialistas' || key === 'horarios' || key === 'horarios_multi' ? {} : 0;\r\n        });\r\n        console.log(' Todo el cach limpiado');\r\n    }\r\n}\r\n\r\n// Cuando cambian datos importantes, forzar actualizacin\r\nfunction actualizarCacheEspecialistas() {\r\n    limpiarCache('especialistas');\r\n    console.log(' Cache de especialistas actualizado forzadamente');\r\n}\r\n\r\n// Sistema de cach en localStorage\r\nfunction guardarCacheEnStorage() {\r\n    try {\r\n        const cacheData = {\r\n            config: cache.config,\r\n            categorias: cache.categorias,\r\n            servicios: cache.servicios,\r\n            timestamp: cache.timestamp,\r\n            fechaGuardado: Date.now()\r\n        };\r\n        localStorage.setItem('firestoreCache', JSON.stringify(cacheData));\r\n    } catch (error) {\r\n        console.warn('No se pudo guardar el cach:', error);\r\n    }\r\n}\r\n\r\nfunction cargarCacheDesdeStorage() {\r\n    try {\r\n        const cacheData = localStorage.getItem('firestoreCache');\r\n        if (cacheData) {\r\n            const parsed = JSON.parse(cacheData);\r\n            const unaHora = 60 * 60 * 1000; // 1 hora en milisegundos\r\n            \r\n            // Solo cargar si tiene menos de 1 hora\r\n            if (Date.now() - parsed.fechaGuardado < unaHora) {\r\n                cache.config = parsed.config;\r\n                cache.categorias = parsed.categorias;\r\n                cache.servicios = parsed.servicios;\r\n                cache.timestamp = parsed.timestamp;\r\n                console.log(' Cach cargado desde localStorage');\r\n            } else {\r\n                console.log(' Cach expirado, limpiando...');\r\n                localStorage.removeItem('firestoreCache');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.warn('Error cargando cach:', error);\r\n    }\r\n}\r\n\r\n//  NUEVA FUNCIN: Limpiar cach de especialistas para una categora especfica\r\nfunction limpiarCacheEspecialistasPorCategoria(categoriaId) {\r\n    cache.forzarActualizacionEspecialistas(categoriaId);\r\n}","// Variables globales de autenticacin\r\nlet usuarioActual = null;\r\n\r\n// Verificar si estamos en la pgina de admin\r\nconst esPaginaAdmin = window.location.pathname.includes('admin.html');\r\n\r\nfunction inicializarAuth() {\r\n    // Manejar el resultado de redireccin primero\r\n    manejarRedirectResult();\r\n    \r\n    // Configurar el listener de estado de autenticacin\r\n    firebase.auth().onAuthStateChanged(async (user) => {\r\n        usuarioActual = user;\r\n        \r\n        // Solo actualizar UI si no estamos en admin\r\n        if (!esPaginaAdmin) {\r\n            await actualizarUIUsuario(user);\r\n            actualizarBotonAdmin(user);\r\n            \r\n            if (user && window.cargarDatosUsuario) {\r\n                await cargarDatosUsuario(user.uid);\r\n            }\r\n        }\r\n    });\r\n\r\n    if (!esPaginaAdmin) {\r\n        configurarEventosAuth();\r\n    }\r\n}\r\n\r\nfunction configurarEventosAuth() {\r\n    // Eliminar event listeners anteriores para evitar duplicados\r\n    document.removeEventListener('click', manejarClicAuth);\r\n    \r\n    // Nuevo manejador unificado\r\n    document.addEventListener('click', manejarClicAuth);\r\n}\r\n\r\nfunction manejarClicAuth(e) {\r\n    // Verificar si el clic fue en un botn de auth\r\n    const esBotonAuthPrincipal = e.target.id === 'btn-google' || e.target.closest('#btn-google');\r\n    const esBotonAuthMenu = e.target.id === 'btn-google-menu' || e.target.closest('#btn-google-menu');\r\n    \r\n    if (esBotonAuthPrincipal || esBotonAuthMenu) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        \r\n        // Ejecutar inmediatamente, no async\r\n        iniciarSesionGoogle();\r\n        return;\r\n    }\r\n    \r\n    // Otros eventos...\r\n    if (e.target.id === 'nav-cerrar-sesion' || e.target.closest('#nav-cerrar-sesion')) {\r\n        e.preventDefault();\r\n        cerrarSesion();\r\n        return;\r\n    }\r\n    \r\n    if (e.target.id === 'nav-perfil' || e.target.closest('#nav-perfil')) {\r\n        e.preventDefault();\r\n        manejarOpcionProtegida('perfil');\r\n        return;\r\n    }\r\n    \r\n    if (e.target.id === 'nav-mis-turnos' || e.target.closest('#nav-mis-turnos')) {\r\n        e.preventDefault();\r\n        manejarOpcionProtegida('mis-turnos');\r\n        return;\r\n    }\r\n    \r\n    if (e.target.classList.contains('.btn-admin')) {\r\n        e.preventDefault();\r\n        if (usuarioActual && esUsuarioAdministrador(usuarioActual)) {\r\n            window.location.href = '/admin.html';\r\n        } else {\r\n            mostrarError('Acceso denegado. Debes ser administrador.');\r\n        }\r\n        return;\r\n    }\r\n}\r\n\r\nasync function iniciarSesionGoogle() {\r\n    // Deshabilitar botones temporalmente para evitar mltiples clics\r\n    deshabilitarBotonesAuth(true);\r\n    \r\n    try {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n        \r\n        // Configuracin adicional para el popup\r\n        provider.setCustomParameters({\r\n            prompt: 'select_account'\r\n        });\r\n        \r\n        // Intentar con popup primero\r\n        console.log('Intentando autenticacin con popup...');\r\n        const result = await firebase.auth().signInWithPopup(provider);\r\n        console.log('Autenticacin exitosa:', result.user.email);\r\n        \r\n    } catch (error) {\r\n        console.error('Error en autenticacin:', error);\r\n        \r\n        // Manejar diferentes tipos de errores\r\n        if (error.code === 'auth/popup-blocked') {\r\n            console.log('Popup bloqueado, intentando con redireccin...');\r\n            await manejarAutenticacionRedirect();\r\n        } else if (error.code === 'auth/popup-closed-by-user') {\r\n            console.log('Usuario cerr el popup');\r\n            mostrarError('Cerraste la ventana de autenticacin. Intenta nuevamente.');\r\n        } else {\r\n            mostrarErrorAuth(error);\r\n        }\r\n    } finally {\r\n        deshabilitarBotonesAuth(false);\r\n    }\r\n}\r\n\r\nasync function manejarAutenticacionRedirect() {\r\n    try {\r\n        const provider = new firebase.auth.GoogleAuthProvider();\r\n        provider.setCustomParameters({\r\n            prompt: 'select_account'\r\n        });\r\n        \r\n        // Guardar la URL actual para redirigir despus\r\n        sessionStorage.setItem('preAuthUrl', window.location.href);\r\n        \r\n        await firebase.auth().signInWithRedirect(provider);\r\n    } catch (redirectError) {\r\n        console.error('Error en redireccin:', redirectError);\r\n        mostrarError('No se pudo iniciar sesin. Por favor, habilita las ventanas emergentes para este sitio.');\r\n    }\r\n}\r\n\r\n// Manejar el resultado de la redireccin al cargar la pgina\r\nfunction manejarRedirectResult() {\r\n    firebase.auth().getRedirectResult().then((result) => {\r\n        if (result.user) {\r\n            console.log('Autenticacin por redireccin exitosa:', result.user.email);\r\n            // Redirigir a la URL original si existe\r\n            const preAuthUrl = sessionStorage.getItem('preAuthUrl');\r\n            if (preAuthUrl && preAuthUrl !== window.location.href) {\r\n                sessionStorage.removeItem('preAuthUrl');\r\n                window.location.href = preAuthUrl;\r\n            }\r\n        }\r\n    }).catch((error) => {\r\n        console.error('Error en resultado de redireccin:', error);\r\n    });\r\n}\r\n\r\nasync function cerrarSesion() {\r\n    try {\r\n        // signOut() siempre se resuelve exitosamente, no necesita try-catch\r\n        await firebase.auth().signOut();\r\n        \r\n        // Opcional: Redirigir a la pgina principal o recargar\r\n        setTimeout(() => {\r\n            window.location.reload(); // O window.location.href = '/';\r\n        }, 1000);\r\n        \r\n    } catch (error) {\r\n        // Este bloque casi nunca se ejecutar porque signOut() siempre tiene xito\r\n        console.warn('Advertencia inesperada al cerrar sesin:', error);\r\n        // Pero an as mostramos xito porque la sesin se cerr\r\n        mostrarMensajeExito('Sesin cerrada correctamente');\r\n    }\r\n}\r\n\r\nfunction deshabilitarBotonesAuth(deshabilitar) {\r\n    const botonesAuth = [\r\n        document.getElementById('btn-google'),\r\n        document.getElementById('btn-google-menu')\r\n    ].filter(btn => btn !== null);\r\n    \r\n    botonesAuth.forEach(boton => {\r\n        if (deshabilitar) {\r\n            boton.disabled = true;\r\n            boton.style.opacity = '0.6';\r\n            boton.innerHTML = `\r\n                <span class=\"loader-google\"></span>\r\n            `;\r\n        } else {\r\n            boton.disabled = false;\r\n            boton.style.opacity = '1';\r\n            // Restaurar contenido original\r\n            if (boton.id === 'btn-google') {\r\n                boton.innerHTML = `\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                        <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path><path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path><path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path><path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    </svg>\r\n                    <span></span>\r\n                `;\r\n            } else {\r\n                boton.innerHTML = `\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                        <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path><path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path><path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path><path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    </svg>\r\n                    <span>Iniciar sesin</span>\r\n                `;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para mostrar errores de autenticacin\r\nfunction mostrarErrorAuth(error) {\r\n    let mensaje = 'Error al autenticar';\r\n    \r\n    const erroresConocidos = {\r\n        'auth/popup-blocked': 'El navegador bloque la ventana de inicio de sesin. Por favor, permite ventanas emergentes para este sitio.',\r\n        'auth/popup-closed-by-user': 'Cerraste la ventana de inicio de sesin. Intenta nuevamente.',\r\n        'auth/cancelled-popup-request': 'Solicitud cancelada.',\r\n        'auth/operation-not-allowed': 'Esta operacin no est permitida. Contacta al administrador.',\r\n        'auth/operation-not-supported-in-this-environment': 'Este navegador no soporta la autenticacin con popup.',\r\n        'auth/unauthorized-domain': 'Este dominio no est autorizado para autenticacin.'\r\n    };\r\n    \r\n    mensaje = erroresConocidos[error.code] || error.message || 'Error desconocido al autenticar';\r\n    \r\n    // Usar tu funcin existente de mostrarError\r\n    if (typeof mostrarError === 'function') {\r\n        mostrarError(mensaje);\r\n    } else {\r\n        alert(mensaje); // Fallback\r\n    }\r\n}\r\n\r\n// Guardar datos del usuario en LocalStorage\r\nfunction guardarUsuario(user) {\r\n    localStorage.setItem('usuario', JSON.stringify({\r\n        uid: user.uid,\r\n        nombre: user.displayName,\r\n        email: user.email,\r\n        photoURL: user.photoURL\r\n    }));\r\n}\r\n\r\n// Limpiar datos del usuario\r\nfunction limpiarUsuario() {\r\n    localStorage.removeItem('usuario');\r\n}\r\n\r\n// Actualizar la UI con los datos del usuario\r\nasync function actualizarUIUsuario(user) {\r\n    const authContainer = document.getElementById('auth-container');\r\n    const menuAuthContainer = document.getElementById('menu-auth-container');\r\n    const navItemsAuth = document.querySelectorAll('.nav-item-auth');\r\n    const navItemsNoAuth = document.querySelectorAll('.nav-item-no-auth');\r\n    \r\n    if (user && !user.isAnonymous) {\r\n        // Usuario logueado - Actualizar contenedor principal\r\n        authContainer.innerHTML = `\r\n            <p class=\"usuario-nombre\">\r\n                <svg class=\"check-icon\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\">\r\n                    <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\" fill=\"#4CAF50\"/>\r\n                </svg>\r\n                ${user.displayName}\r\n            </p>\r\n        `;\r\n        \r\n        // Actualizar men hamburguesa - ocultar login, mostrar opciones protegidas\r\n        navItemsNoAuth.forEach(item => item.style.display = 'none');\r\n        navItemsAuth.forEach(item => item.style.display = 'block');\r\n        \r\n        // Guardar usuario en localStorage\r\n        guardarUsuario(user);\r\n\r\n        actualizarSubmenusDinamicos(user);\r\n        actualizarVisibilidadMenu(user);\r\n\r\n        //  OPTIMIZADO: Cargar turnos del usuario con delay inteligente\r\n        setTimeout(() => {\r\n            if (typeof cargarTurnosUsuario === 'function') {\r\n                // Solo cargar si no se ha cargado recientemente\r\n                const ahora = Date.now();\r\n                if (ahora - ultimaCargaTurnos > CACHE_DURACION) {\r\n                cargarTurnosUsuario();\r\n                }\r\n            }\r\n        }, 1000);\r\n        \r\n        // Autocompletar formulario si estamos en el paso correspondiente\r\n        if (pasoActual >= 4) {\r\n            autocompletarFormulario(user);\r\n        }\r\n        \r\n    } else {\r\n        // Usuario no logueado - Mostrar botn de login\r\n        authContainer.innerHTML = `\r\n            <button id=\"btn-google\" class=\"google-btn\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" x=\"0px\" y=\"0px\" width=\"22\" height=\"22\" viewBox=\"0 0 48 48\">\r\n                    <path fill=\"#fbc02d\" d=\"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\ts5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20\ts20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                    <path fill=\"#e53935\" d=\"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039\tl5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z\"></path>\r\n                    <path fill=\"#4caf50\" d=\"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\tc-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z\"></path>\r\n                    <path fill=\"#1565c0\" d=\"M43.611,20.083L43.595,20L42,20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\tc0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z\"></path>\r\n                </svg>\r\n                <span></span>\r\n            </button>\r\n        `;\r\n        \r\n        // Actualizar men hamburguesa - mostrar login, ocultar opciones protegidas\r\n        navItemsAuth.forEach(item => item.style.display = 'none');\r\n        navItemsNoAuth.forEach(item => item.style.display = 'block');\r\n        \r\n        // Limpiar datos de usuario\r\n        limpiarUsuario();\r\n    }\r\n    \r\n    // Re-configurar eventos despus de actualizar el DOM\r\n    setTimeout(configurarEventosAuth, 100);\r\n}\r\n\r\nasync function manejarOpcionProtegida(opcion) {\r\n    if (!usuarioActual) {\r\n        mostrarError('Debes iniciar sesin para acceder a esta funcin.');\r\n        return;\r\n    }\r\n    \r\n    switch (opcion) {\r\n        case 'perfil':\r\n            // Aqu ir la lgica para mostrar el perfil del usuario\r\n            console.log('Navegando al perfil de:', usuarioActual.displayName);\r\n            // Puedes implementar una funcin para mostrar un modal o pgina de perfil\r\n            break;\r\n            \r\n        case 'mis-turnos':\r\n            // Aqu ir la lgica para mostrar los turnos del usuario\r\n            console.log('Mostrando turnos de:', usuarioActual.displayName);\r\n            // Puedes implementar una funcin para cargar y mostrar los turnos\r\n            break;\r\n    }\r\n}\r\n\r\nfunction mostrarBotonLogin() {\r\n    const contenedor = document.querySelector('nav h1').parentElement;\r\n    if (!contenedor.querySelector('#btn-google')) {\r\n    contenedor.innerHTML += '<button id=\"btn-google\">Acceder</button>';\r\n    }\r\n}\r\n\r\nfunction autocompletarFormulario(user) {\r\n    const nombreInput = document.getElementById('nombre');\r\n    const emailInput = document.getElementById('email');\r\n    \r\n    if (nombreInput && !nombreInput.value && user.displayName) {\r\n        nombreInput.value = user.displayName;\r\n        validarNombre(); // Disparar validacin\r\n    }\r\n    \r\n    if (emailInput && !emailInput.value && user.email) {\r\n        emailInput.value = user.email;\r\n        validarEmail(); // Disparar validacin\r\n        datosReserva.email = user.email;\r\n    }\r\n    \r\n    // Guardar en localStorage para futuras visitas\r\n    if (user) {\r\n        localStorage.setItem('usuario', JSON.stringify({\r\n            uid: user.uid,\r\n            nombre: user.displayName,\r\n            email: user.email,\r\n            telefono: user.phoneNumber || ''\r\n        }));\r\n    }\r\n}\r\n\r\n// Cargar datos guardados al iniciar\r\nfunction cargarDatosGuardados() {\r\n    const usuarioGuardado = localStorage.getItem('usuario');\r\n    if (usuarioGuardado) {\r\n        const user = JSON.parse(usuarioGuardado);\r\n        document.getElementById('nombre').value = user.nombre || '';\r\n        document.getElementById('email').value = user.email || '';\r\n        document.getElementById('telefono').value = user.telefono || '';\r\n    }\r\n}\r\n\r\n// Funcin para verificar si el usuario es administrador\r\nfunction esUsuarioAdministrador(user) {\r\n    // Usamos el mismo UID que est definido en admin.js\r\n    const ADMIN_UID = 'YI2RkSy5j9W2xPVnPqNnghuif9f1';\r\n    return user && user.uid === ADMIN_UID;\r\n}\r\n\r\nfunction actualizarBotonAdmin(user) {\r\n    const botonesAdmin = document.querySelectorAll('.btn-admin');\r\n    \r\n    botonesAdmin.forEach(btn => {\r\n        if (esUsuarioAdministrador(user)) {\r\n            btn.style.display = 'block';\r\n        } else {\r\n            btn.style.display = 'none';\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para mostrar mensajes de xito\r\nfunction mostrarMensajeExito(mensaje) {\r\n    // Crear elemento de mensaje si no existe\r\n    let mensajeExito = document.getElementById('mensaje-exito');\r\n    if (!mensajeExito) {\r\n        mensajeExito = document.createElement('div');\r\n        mensajeExito.id = 'mensaje-exito';\r\n        mensajeExito.className = 'mensaje-exito';\r\n        document.body.appendChild(mensajeExito);\r\n    }\r\n    \r\n    mensajeExito.innerHTML = `\r\n        <div class=\"mensaje-contenido\">\r\n            <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n                <path fill=\"#4CAF50\" d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n            <span>${mensaje}</span>\r\n        </div>\r\n    `;\r\n    \r\n    mensajeExito.classList.add('visible');\r\n    \r\n    // Ocultar despus de 3 segundos\r\n    setTimeout(() => {\r\n        mensajeExito.classList.remove('visible');\r\n    }, 3000);\r\n}\r\n\r\n// Funciones auxiliares del men de autenticacin\r\nfunction actualizarSubmenusDinamicos(user) {\r\n    if (user) {\r\n        // Actualizar submen de perfil\r\n        const nombreUsuario = document.getElementById('usuario-nombre');\r\n        const emailUsuario = document.getElementById('usuario-email');\r\n        \r\n        if (nombreUsuario) nombreUsuario.textContent = user.displayName || 'Usuario';\r\n        if (emailUsuario) emailUsuario.textContent = user.email || 'Email no disponible';\r\n        \r\n        // Aqu puedes agregar ms actualizaciones dinmicas para otros submens\r\n    }\r\n}\r\n\r\n// Funcin para manejar el estado de autenticacin en el men\r\nfunction actualizarVisibilidadMenu(user) {\r\n    const elementosAuth = document.querySelectorAll('.nav-item-auth');\r\n    const elementosNoAuth = document.querySelectorAll('.nav-item-no-auth');\r\n    \r\n    if (user) {\r\n        elementosAuth.forEach(item => item.style.display = 'block');\r\n        elementosNoAuth.forEach(item => item.style.display = 'none');\r\n    } else {\r\n        elementosAuth.forEach(item => item.style.display = 'none');\r\n        elementosNoAuth.forEach(item => item.style.display = 'block');\r\n    }\r\n    \r\n    // Re-inicializar el acorden para los nuevos elementos\r\n    setTimeout(() => {\r\n        inicializarAcordeonMenu();\r\n    }, 100);\r\n}\r\n\r\n//  NUEVA FUNCIN: Autenticacin annima para reservas\r\n// async function iniciarAutenticacionAnonima() {\r\n//     try {\r\n//         console.log(' Iniciando autenticacin annima...');\r\n        \r\n//         // Usar autenticacin annima de Firebase\r\n//         const userCredential = await firebase.auth().signInAnonymously();\r\n//         usuarioActual = userCredential.user;\r\n        \r\n//         console.log(' Usuario annimo autenticado:', usuarioActual.uid);\r\n//         return usuarioActual;\r\n        \r\n//     } catch (error) {\r\n//         console.error(' Error en autenticacin annima:', error);\r\n//         throw new Error('No se pudo completar la autenticacin para la reserva');\r\n//     }\r\n// }","// Variables para control de actualizacin\r\nlet intervaloActualizacionTurnos = null;\r\nlet ultimaCargaTurnos = 0;\r\nconst CACHE_DURACION = 300000; // 5 minutos de cach\r\n\r\n// Funciones de UI/helpers que no afectan la lgica principal\r\nfunction mostrarError(mensaje) {\r\n    document.querySelectorAll('.modal-error, .modal-overlay').forEach(el => el.remove());\r\n    \r\n    const overlay = document.createElement('div');\r\n    overlay.className = 'modal-overlay';\r\n    \r\n    const modal = document.createElement('div');\r\n    modal.className = 'modal-error';\r\n    \r\n    let mensajePersonalizado = mensaje;\r\n    \r\n    // Detectar conflictos de horario\r\n    if (mensaje.includes('minutos') || mensaje.includes('horario')) {\r\n        const duracionTotal = calcularDuracionTotal();\r\n        const horas = Math.floor(duracionTotal / 60);\r\n        const minutos = duracionTotal % 60;\r\n        \r\n        const textoDuracion = horas > 0 \r\n            ? `${horas} hora${horas > 1 ? 's' : ''}${minutos > 0 ? ` y ${minutos} minutos` : ''}`\r\n            : `${minutos} minutos`;\r\n        \r\n        mensajePersonalizado = `\r\n            <svg viewBox=\"0 0 24 24\" width=\"48\" height=\"48\" style=\"margin-bottom: 1rem;\">\r\n                <path fill=\"#ff6b6b\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n            </svg>\r\n            <h3>Cruce de horarios!</h3>\r\n            <p>\r\n                Tu turno necesita <strong>${textoDuracion}</strong> como mnimo.\r\n                <br><br>\r\n                Por favor, eleg otro horario donde entren todos tus servicios.\r\n            </p>\r\n        `;\r\n    }\r\n    \r\n    modal.innerHTML = `\r\n        ${mensajePersonalizado}\r\n        <button id=\"cerrar-modal\">Entendido!</button>\r\n    `;\r\n    \r\n    // Agregar al DOM\r\n    document.body.appendChild(overlay);\r\n    document.body.appendChild(modal);\r\n    \r\n    // Cerrar al hacer clic\r\n    const cerrarModal = () => {\r\n        modal.style.animation = 'fadeIn 0.3s reverse';\r\n        overlay.style.animation = 'fadeIn 0.3s reverse';\r\n        setTimeout(() => {\r\n            modal.remove();\r\n            overlay.remove();\r\n        }, 300);\r\n    };\r\n    \r\n    modal.querySelector('#cerrar-modal').addEventListener('click', cerrarModal);\r\n    overlay.addEventListener('click', cerrarModal);\r\n}\r\n\r\n// Sistema simple de manejo de errores\r\nconst ErrorHandler = {\r\n    mostrar: (mensaje, tipo = 'error') => {\r\n        console.log(`[${tipo.toUpperCase()}] ${mensaje}`);\r\n        \r\n        // Usar tu funcin existente de mostrarError para errores\r\n        if (tipo === 'error' && typeof mostrarError === 'function') {\r\n            mostrarError(mensaje);\r\n        }\r\n        // Para advertencias, solo log en consola\r\n        else if (tipo === 'warning') {\r\n            console.warn(mensaje);\r\n        }\r\n    },\r\n\r\n    manejarErrorFirestore: (error, contexto) => {\r\n    console.error(`Error en ${contexto}:`, error);\r\n    \r\n    const mensajesPersonalizados = {\r\n      'permission-denied': 'No tienes permisos para acceder a estos datos',\r\n      'not-found': 'No se encontr la informacin solicitada',\r\n      'unavailable': 'Error de conexin. Verifica tu internet',\r\n      'failed-precondition': 'El servicio no est disponible en este momento'\r\n    };\r\n    \r\n    const mensaje = mensajesPersonalizados[error.code] || \r\n                   `Error al ${contexto}. Intenta nuevamente.`;\r\n    \r\n    ErrorHandler.mostrar(mensaje, 'error');\r\n    return []; // Retornar array vaco como fallback\r\n  }\r\n};\r\n\r\n// Validaciones bsicas para datos de Firestore\r\nconst Validador = {\r\n    servicio: (servicio) => {\r\n        if (!servicio || typeof servicio !== 'object') return false;\r\n        \r\n        const required = ['id', 'nombre', 'categoriaId'];\r\n        return required.every(prop => servicio.hasOwnProperty(prop) && servicio[prop] != null);\r\n    },\r\n\r\n    especialista: (especialista) => {\r\n        if (!especialista || typeof especialista !== 'object') return false;\r\n\r\n        const required = ['id', 'nombre'];\r\n        return required.every(prop => especialista.hasOwnProperty(prop) && especialista[prop] != null);\r\n    },\r\n\r\n    categoria: (categoria) => {\r\n        if (!categoria || typeof categoria !== 'object') return false;\r\n        return categoria.hasOwnProperty('id') && categoria.hasOwnProperty('nombre');\r\n    },\r\n\r\n    filtrarInvalidos: (datos, tipo) => {\r\n        if (!Array.isArray(datos)) return [];\r\n        return datos.filter(item => Validador[tipo](item));\r\n    }\r\n};\r\n\r\nfunction inicializarAcordeonMenu() {\r\n    const btnMenu = document.querySelector('.btn-menu');\r\n    const menuLateral = document.querySelector('.menu-lateral');\r\n    \r\n    if (btnMenu && menuLateral) {\r\n        btnMenu.addEventListener('click', function() {\r\n            menuLateral.classList.toggle('abierto');\r\n        });\r\n    }\r\n}\r\n\r\nfunction inicializarCierreMenuOverlay() {\r\n    // Cerrar men al hacer clic fuera\r\n    document.addEventListener('click', function(e) {\r\n        const menuLateral = document.querySelector('.menu-lateral');\r\n        const btnMenu = document.querySelector('.btn-menu');\r\n        \r\n        if (menuLateral && menuLateral.classList.contains('abierto')) {\r\n            // Si el clic fue fuera del men y fuera del botn\r\n            if (!menuLateral.contains(e.target) && !btnMenu.contains(e.target)) {\r\n                menuLateral.classList.remove('abierto');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction inicializarAcordeonesServicios() {\r\n    const headers = document.querySelectorAll('.categoria-header');\r\n\r\n    headers.forEach(header => {\r\n    header.addEventListener('click', function() {\r\n        const categoriaId = this.dataset.categoriaId;\r\n        const container = this.nextElementSibling;\r\n        const icono = this.querySelector('.acordeon-icon');\r\n        \r\n    // Cerrar todos los dems acordeones\r\n    document.querySelectorAll('.servicios-container').forEach(c => {\r\n        if (c !== container) {\r\n            c.style.display = 'none';\r\n            const otherIcon = c.previousElementSibling.querySelector('.acordeon-icon');\r\n            if (otherIcon) otherIcon.classList.remove('girado');\r\n        }\r\n    });\r\n        \r\n    // Alternar el actual\r\n    const estaAbierto = container.style.display === 'block';\r\n    container.style.display = estaAbierto ? 'none' : 'block';\r\n    \r\n    // Rotar icono\r\n    if (icono) {\r\n        icono.classList.toggle('girado', !estaAbierto);\r\n    }\r\n    });\r\n    });\r\n}\r\n\r\nfunction inicializarAcordeonesEspecialistas() {\r\n    const botonesVer = document.querySelectorAll('.btn-ver-especialistas');\r\n    \r\n    botonesVer.forEach(boton => {\r\n        boton.addEventListener('click', function(e) {\r\n            e.stopPropagation();\r\n            const categoriaSection = this.closest('.categoria-especialistas');\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const icono = this.querySelector('.acordeon-icon');\r\n            \r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherBtn = l.closest('.categoria-especialistas').querySelector('.btn-ver-especialistas');\r\n                    const otherIcon = otherBtn.querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            \r\n            // Rotar icono\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction toggleLoader(mostrar) {\r\n    const btnSiguiente = document.querySelector('.btn-siguiente');\r\n    const loader = document.getElementById('reserva-loader');\r\n    \r\n    if (mostrar) {\r\n        btnSiguiente.style.display = 'none';\r\n        loader.style.display = 'inline-block';\r\n    } else {\r\n        loader.style.display = 'none';\r\n        btnSiguiente.style.display = 'flex';\r\n    }\r\n}\r\n\r\n// ===== CDIGO ORIGINAL DEL MEN - FUNCIONA PERFECTO =====\r\n(function($) { \"use strict\";\r\n    \r\n    var app = function () {\r\n        var body = undefined;\r\n        var menu = undefined;\r\n        var menuItems = undefined;\r\n        var init = function init() {\r\n            body = document.querySelector('body');\r\n            menu = document.querySelector('.menu-icon');\r\n            if (!menu) {\r\n                console.log('Elementos del men no encontrados (probablemente en admin.html)');\r\n                return; // Salir si no estamos en una pgina con men\r\n            }\r\n            menuItems = document.querySelectorAll('.nav__list-item');\r\n            applyListeners();\r\n        };\r\n        var applyListeners = function applyListeners() {\r\n            if (!menu) return;\r\n            menu.addEventListener('click', function () {\r\n                return toggleClass(body, 'nav-active');\r\n            });\r\n        };\r\n        var toggleClass = function toggleClass(element, stringClass) {\r\n            if (element.classList.contains(stringClass)) element.classList.remove(stringClass);\r\n            else element.classList.add(stringClass);\r\n        };\r\n        init();\r\n    }();\r\n    \r\n})(jQuery);\r\n\r\n// Funcin para inicializar el acorden del men\r\n\r\nfunction inicializarAcordeonMenu() {\r\n    const menuItems = document.querySelectorAll('.nav__list-item .menu');\r\n\r\n    menuItems.forEach(menuItem => {\r\n        menuItem.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            const listItem = this.closest('.nav__list-item');\r\n            const submenu = listItem.querySelector('.submenu');\r\n            const isActive = submenu.classList.contains('active');\r\n\r\n            cerrarTodosLosSubmenus();\r\n            quitarClaseActiveNav();\r\n\r\n            if (!isActive) {\r\n                submenu.classList.add('active');\r\n                this.classList.add('active');\r\n                listItem.classList.add('active-nav');\r\n            }\r\n        });\r\n    });\r\n\r\n    // Cerrar mens solo al hacer clic FUERA del nav completo\r\n    document.addEventListener('click', function(e) {\r\n        if (!e.target.closest('.nav')) {\r\n            cerrarTodosLosSubmenus();\r\n            quitarClaseActiveNav();\r\n        }\r\n    });\r\n\r\n    // Manejar TODOS los elementos del submenu\r\n    document.querySelectorAll('.submenu *').forEach(element => {\r\n        element.addEventListener('click', function(e) {\r\n            e.stopPropagation(); // Prevenir que el clic cierre el men\r\n        });\r\n    });\r\n}\r\n\r\nfunction inicializarCierreMenuOverlay() {\r\n    document.addEventListener('click', function(e) {\r\n        const body = document.body;\r\n        if (!body.classList.contains('nav-active')) return;\r\n        \r\n        const nav = document.querySelector('.nav');\r\n        const menuIcon = document.querySelector('.menu-icon');\r\n        \r\n        // Solo cerrar si el clic fue en el overlay (fondo)\r\n        // No cerrar si fue en cualquier elemento dentro del nav\r\n        if (!nav.contains(e.target) && !menuIcon.contains(e.target)) {\r\n            // Pequeo delay para permitir que los eventos de los botones se ejecuten\r\n            setTimeout(() => {\r\n                body.classList.remove('nav-active');\r\n            }, 10);\r\n        }\r\n    });\r\n    \r\n    // NO prevenir la propagacin para elementos interactivos\r\n    // Esto permite que los botones dentro del men funcionen normalmente\r\n    const navElement = document.querySelector('.nav');\r\n    if (navElement) {\r\n        navElement.addEventListener('click', function(e) {\r\n            // Solo prevenir propagacin para elementos no interactivos\r\n            if (!e.target.closest('button') && \r\n                !e.target.closest('a') && \r\n                !e.target.closest('input')) {\r\n                e.stopPropagation();\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Cerrar con tecla ESC\r\n    document.addEventListener('keydown', function(e) {\r\n        if (e.key === 'Escape' && document.body.classList.contains('nav-active')) {\r\n            document.body.classList.remove('nav-active');\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para quitar la clase active-nav de todos los items\r\nfunction quitarClaseActiveNav() {\r\n    document.querySelectorAll('.nav__list-item').forEach(item => {\r\n        item.classList.remove('active-nav');\r\n    });\r\n}\r\n\r\n// Funcin para cerrar todos los submens\r\nfunction cerrarTodosLosSubmenus() {\r\n    document.querySelectorAll('.submenu').forEach(submenu => {\r\n        submenu.classList.remove('active');\r\n    });\r\n    \r\n    document.querySelectorAll('.menu').forEach(menu => {\r\n        menu.classList.remove('active');\r\n    });\r\n}\r\n\r\n// ===== SISTEMA DE CONTACTO DEL MEN - VERSIN ULTRA-MINIMALISTA =====\r\nconsole.log(' uiManager.js cargado - Sistema de contacto del men inicializado');\r\n\r\n// Funcin para obtener datos de contacto SIN event listeners\r\nfunction obtenerDatosContactoSeguro() {\r\n    // Intentar desde window.datosGenerales primero\r\n    if (window.datosGenerales && window.datosGenerales.empresa) {\r\n        return window.datosGenerales.empresa;\r\n    }\r\n    \r\n    // Intentar desde la variable global de app.js\r\n    if (typeof datosGenerales !== 'undefined' && datosGenerales.empresa) {\r\n        return datosGenerales.empresa;\r\n    }\r\n    \r\n    // ltimo intento: buscar en localStorage si ya los cargamos antes\r\n    const contactoCache = localStorage.getItem('contactoCache');\r\n    if (contactoCache) {\r\n        try {\r\n            return JSON.parse(contactoCache);\r\n        } catch (e) {\r\n            console.warn('Cache de contacto corrupto');\r\n        }\r\n    }\r\n    \r\n    return null;\r\n}\r\n\r\n// Optimizar actualizarMenuContacto para usar cache\r\nfunction actualizarMenuContacto(empresa) {\r\n    if (!empresa) return false;\r\n    \r\n    try {\r\n        // Guardar en cache para prximas cargas\r\n        localStorage.setItem('contactoCache', JSON.stringify(empresa));\r\n        \r\n        // Actualizar direccin\r\n        const direccionElement = document.getElementById('menu-direccion');\r\n        if (direccionElement && empresa.direccion) {\r\n            direccionElement.textContent = empresa.direccion;\r\n        }\r\n        \r\n        // Actualizar telfono\r\n        const telefonoElement = document.getElementById('menu-telefono');\r\n        if (telefonoElement && empresa.telefono) {\r\n            telefonoElement.textContent = empresa.telefono;\r\n        }\r\n        \r\n        // Actualizar email\r\n        const emailElement = document.getElementById('menu-email');\r\n        if (emailElement && empresa.email) {\r\n            emailElement.textContent = empresa.email;\r\n        }\r\n        \r\n        // Actualizar redes sociales (si existen los elementos)\r\n        const redes = empresa.redesSociales || empresa.redes;\r\n        if (redes) {\r\n            const instagramLink = document.getElementById('menu-instagram');\r\n            const equisLink = document.getElementById('menu-equis');\r\n            const whatsappLink = document.getElementById('menu-whatsapp');\r\n            \r\n            if (instagramLink && redes.instagram && redes.instagram !== '#') {\r\n                instagramLink.href = redes.instagram;\r\n                instagramLink.style.display = 'flex';\r\n            }\r\n            \r\n            if (equisLink && redes.equis && redes.equis !== '#') {\r\n                equisLink.href = redes.equis;\r\n                equisLink.style.display = 'flex';\r\n            }\r\n            \r\n            if (whatsappLink && redes.whatsapp && redes.whatsapp !== '#') {\r\n                whatsappLink.href = redes.whatsapp;\r\n                whatsappLink.style.display = 'flex';\r\n            }\r\n        }\r\n        \r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(' Error actualizando men contacto:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// SOLUCIN DEFINITIVA: Solo cargar datos peridicamente SIN NINGN EVENT LISTENER\r\nfunction inicializarMenuContactoDefinitivo() {\r\n    console.log(' Inicializando men contacto (UNA SOLA CARGA)...');\r\n    \r\n    // Cargar UNA sola vez con un delay generoso\r\n    setTimeout(() => {\r\n        const empresa = obtenerDatosContactoSeguro();\r\n        const exito = actualizarMenuContacto(empresa);\r\n        \r\n        if (exito) {\r\n            console.log(' Men contacto cargado exitosamente (carga nica)');\r\n        } else {\r\n            // Si falla, intentar una vez ms despus de 5 segundos\r\n            setTimeout(() => {\r\n                const empresa = obtenerDatosContactoSeguro();\r\n                actualizarMenuContacto(empresa);\r\n            }, 5000);\r\n        }\r\n    }, 3000);\r\n    \r\n    //  ELIMINADO: No ms setInterval para el contacto\r\n    // Los datos de contacto son estticos, no necesitan actualizacin constante\r\n}\r\n\r\n//////////////////////////\r\n//////////////////////////\r\n//////////////////////////\r\n\r\n// Funcin para formatear la fecha en espaol\r\nfunction formatearFecha(fechaStr) {\r\n  const fecha = new Date(fechaStr + 'T00:00:00');\r\n  const dias = ['Dom', 'Lun', 'Mar', 'Mi', 'Jue', 'Vie', 'Sb'];\r\n  const meses = ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'];\r\n  \r\n  const diaSemana = dias[fecha.getDay()];\r\n  const diaMes = fecha.getDate();\r\n  const mes = meses[fecha.getMonth()];\r\n  \r\n  return `${diaSemana} ${diaMes} ${mes}`;\r\n}\r\n\r\n// Funcin para calcular horario de fin\r\nfunction calcularHorarioFin(horarioInicio, duracionMinutos) {\r\n  const [horas, minutos] = horarioInicio.split(':').map(Number);\r\n  const totalMinutos = horas * 60 + minutos + duracionMinutos;\r\n  \r\n  const horasFin = Math.floor(totalMinutos / 60);\r\n  const minutosFin = totalMinutos % 60;\r\n  \r\n  return `${horasFin.toString().padStart(2, '0')}:${minutosFin.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Funcin para cargar y mostrar los turnos del usuario\r\nasync function cargarTurnosUsuario() {\r\n  const usuario = firebase.auth().currentUser;\r\n  if (!usuario) return;\r\n\r\n  const submenuUl = document.querySelector('#nav-mis-turnos .submenu ul');\r\n  if (!submenuUl) return;\r\n\r\n  try {\r\n    // Actualizar timestamp de ltima carga\r\n    ultimaCargaTurnos = Date.now();\r\n\r\n    // Mostrar loading solo si no hay datos previos\r\n    if (!submenuUl.querySelector('.turno-item')) {\r\n      submenuUl.innerHTML = '<li><p>Cargando turnos...</p></li>';\r\n    }\r\n\r\n    const turnos = await window.firestoreDB.obtenerTurnosPorUsuario(usuario.uid);\r\n    \r\n    if (turnos.length === 0) {\r\n      submenuUl.innerHTML = '<li><p>No tens turnos reservados</p></li>';\r\n      return;\r\n    }\r\n\r\n    // Generar HTML de los turnos\r\n    const turnosHTML = turnos.map(turno => {\r\n      const fechaFormateada = formatearFecha(turno.fecha);\r\n      const horarioFin = calcularHorarioFin(turno.horarioInicio, turno.duracionTotal || 30);\r\n      const montoFormateado = turno.montoTotal ? `$${turno.montoTotal.toLocaleString('es-AR')}` : 'Sin sear';\r\n      \r\n      return `\r\n        <li class=\"turno-item\">\r\n          <p><strong>${fechaFormateada}</strong> de ${turno.horarioInicio} a ${horarioFin}</p>\r\n          <p style=\"margin-top: 4px; color: #4CAF50; font-weight: 500;\">${montoFormateado}</p>\r\n        </li>\r\n      `;\r\n    }).join('');\r\n\r\n    submenuUl.innerHTML = turnosHTML;\r\n\r\n  } catch (error) {\r\n    console.error('Error cargando turnos:', error);\r\n    // Solo mostrar error si no hay datos previos\r\n    if (!submenuUl.querySelector('.turno-item')) {\r\n      submenuUl.innerHTML = '<li><p>Error al cargar turnos</p></li>';\r\n    }\r\n  }\r\n}\r\n\r\n// Funcin para inicializar el sistema de turnos del usuario\r\nfunction inicializarSistemaTurnosUsuario() {\r\n  console.log(' Inicializando sistema de turnos usuario (optimizado)...');\r\n  \r\n  // Cargar turnos cuando el usuario inicie sesin\r\n  firebase.auth().onAuthStateChanged((user) => {\r\n    if (user) {\r\n      // Cargar turnos inicialmente\r\n      setTimeout(() => {\r\n        cargarTurnosUsuario();\r\n      }, 1000);\r\n      \r\n      // Configurar observador para el men\r\n      configurarObservadorMenu();\r\n    } else {\r\n      // Limpiar intervalo si existe\r\n      detenerActualizacionAutomatica();\r\n    }\r\n  });\r\n}\r\n\r\nfunction configurarObservadorMenu() {\r\n  // Observar cambios en la clase del body para detectar cuando se abre/cierra el men\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      if (mutation.attributeName === 'class') {\r\n        const body = document.body;\r\n        if (body.classList.contains('nav-active')) {\r\n          // Men abierto - cargar solo si los datos son antiguos\r\n          const ahora = Date.now();\r\n          if (ahora - ultimaCargaTurnos > CACHE_DURACION) {\r\n            cargarTurnosUsuario();\r\n          }\r\n          \r\n          // Iniciar actualizaciones lentas (solo cuando el men est abierto)\r\n          iniciarActualizacionAutomatica();\r\n        } else {\r\n          // Men cerrado - detener actualizaciones\r\n          detenerActualizacionAutomatica();\r\n        }\r\n      }\r\n    });\r\n  });\r\n  \r\n  observer.observe(document.body, { attributes: true });\r\n}\r\n\r\nfunction iniciarActualizacionAutomatica() {\r\n  // Si ya hay un intervalo activo, no crear otro\r\n  if (intervaloActualizacionTurnos) return;\r\n  \r\n  console.log(' Men abierto - iniciando actualizaciones lentas');\r\n  \r\n  // Actualizar cada 5 minutos (en lugar de 30 segundos)\r\n  intervaloActualizacionTurnos = setInterval(() => {\r\n    cargarTurnosUsuario();\r\n  }, 300000); // 5 minutos\r\n}\r\n\r\nfunction detenerActualizacionAutomatica() {\r\n  if (intervaloActualizacionTurnos) {\r\n    console.log(' Men cerrado - deteniendo actualizaciones automticas');\r\n    clearInterval(intervaloActualizacionTurnos);\r\n    intervaloActualizacionTurnos = null;\r\n  }\r\n}\r\n\r\n// Funcin para forzar recarga manual (til para despus de nuevas reservas)\r\nfunction forzarActualizacionTurnos() {\r\n  ultimaCargaTurnos = 0; // Invalidar cach\r\n  cargarTurnosUsuario();\r\n}\r\n\r\n// Inicializar SIN event listeners de ningn tipo\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    console.log(' DOM cargado - Iniciando solucin definitiva');\r\n    inicializarMenuContactoDefinitivo();\r\n    console.log(' Sistema de turnos usuario inicializado');\r\n    inicializarSistemaTurnosUsuario();\r\n});","// =============================================\r\n// 0. VERIFICACIN DE PGINA - NO EJECUTAR EN INDEX.HTML\r\n// =============================================\r\n\r\n// Verificar si estamos en la pgina correcta antes de ejecutar cualquier cosa\r\nconst esAdminPage = window.location.pathname.includes('admin.html');\r\n\r\nif (!esAdminPage) {\r\n    console.log(' admin.js: No estamos en admin.html - modo silencioso activado');\r\n    \r\n    // Sobrescribir todas las funciones principales con versiones vacas\r\n    const funcionesVacias = {\r\n        initAdmin: function() {},\r\n        inicializarGestionServicios: function() {},\r\n        inicializarGestionPersonal: function() {},\r\n        inicializarNavegacionAdmin: function() {},\r\n        inicializarNavegacionCuandoPanelListo: function() {},\r\n        handleAuthState: function() {},\r\n        signInWithGoogle: function() {},\r\n        signOut: function() {},\r\n        showAdminPanel: function() {},\r\n        showLoginScreen: function() {},\r\n        // Agregar cualquier otra funcin global que pueda ser llamada\r\n    };\r\n    \r\n    // Aplicar funciones vacas al objeto window\r\n    Object.keys(funcionesVacias).forEach(funcName => {\r\n        window[funcName] = funcionesVacias[funcName];\r\n    });\r\n    \r\n    // NO ejecutar el resto del cdigo\r\n    \r\n} else {\r\n    console.log(' admin.js: Inicializando en admin.html');\r\n    \r\n    // =============================================\r\n    // 1. CONSTANTES Y VARIABLES GLOBALES (solo para admin.html)\r\n    // =============================================\r\n    const ADMIN_UID = 'YI2RkSy5j9W2xPVnPqNnghuif9f1';\r\n    \r\n    // Funcin para obtener elementos de forma segura\r\n    function obtenerElementosAdmin() {\r\n        return {\r\n            authContainer: document.getElementById('auth-container'),\r\n            adminPanel: document.getElementById('admin-panel'),\r\n            loginBtn: document.getElementById('btn-admin-login'),\r\n            logoutBtn: document.getElementById('logout-btn'),\r\n            calendar: document.getElementById('calendar'),\r\n            turnosList: document.getElementById('turnos-list'),\r\n            fechaTitulo: document.getElementById('fecha-titulo'),\r\n            modalEditar: document.getElementById('modal-editar'),\r\n            formEditar: document.getElementById('form-editar'),\r\n            btnEliminarModal: document.getElementById('btn-eliminar-modal'),\r\n            closeModal: document.querySelector('.close-modal')\r\n        };\r\n    }\r\n    \r\n    const elements = obtenerElementosAdmin();\r\n    let calendar;\r\n    let currentTurnoId = null;\r\n    let especialistasMap = {};\r\n    let especialistasCargando = false;\r\n    let pendientesDeActualizacion = [];\r\n    let serviciosMap = {};\r\n    // let categoriasMap = {};\r\n    // let personalMap = {};\r\n\r\n    // =============================================\r\n    // 2. FUNCIONES DE INICIALIZACIN PRINCIPAL\r\n    // =============================================\r\n    async function initAdmin() {\r\n        if (!(await verificarFirestore())) return;\r\n        \r\n        if (!elements.authContainer) {\r\n            console.log(' Elementos de admin no encontrados, reintentando...');\r\n            // Reintentar obtener elementos\r\n            Object.assign(elements, obtenerElementosAdmin());\r\n            if (!elements.authContainer) return;\r\n        }\r\n\r\n        firebase.auth().onAuthStateChanged(handleAuthState);\r\n        \r\n        if (elements.loginBtn) {\r\n            elements.loginBtn.addEventListener('click', signInWithGoogle);\r\n        }\r\n        \r\n        if (elements.logoutBtn) {\r\n            elements.logoutBtn.addEventListener('click', signOut);\r\n        }\r\n\r\n        // Eventos del modal de turnos\r\n        if (elements.closeModal) {\r\n            elements.closeModal.addEventListener('click', () => {\r\n                elements.modalEditar.style.display = 'none';\r\n            });\r\n        }\r\n\r\n        if (elements.formEditar) {\r\n            elements.formEditar.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                await guardarCambiosTurno();\r\n            });\r\n        }\r\n\r\n        // Cerrar modal al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === elements.modalEditar) {\r\n                elements.modalEditar.style.display = 'none';\r\n            }\r\n            if (e.target === document.getElementById('modal-servicio')) {\r\n                document.getElementById('modal-servicio').style.display = 'none';\r\n            }\r\n        });\r\n\r\n        // Configurar eventos del modal de turnos\r\n        setupModalEvents();\r\n\r\n        // Inicializar gestin de servicios\r\n        inicializarGestionServicios();\r\n\r\n        // Inicializar gestin de personal\r\n        inicializarGestionPersonal();\r\n\r\n        // Usar la navegacin corregida\r\n        inicializarNavegacionAdmin();\r\n\r\n        // Asegurar que los eventos se reconfiguren despus de renderizar\r\n        setTimeout(() => {\r\n            setupModalEvents();\r\n        }, 1000);\r\n        \r\n        console.log(' admin.js inicializado completamente');\r\n    }\r\n\r\n    async function verificarFirestore() {\r\n        try {\r\n            const config = await obtenerConfiguracion();\r\n            \r\n            // Cargar especialistas y servicios - esperar a que termine\r\n            await cargarEspecialistas();\r\n            await cargarServicios();\r\n            \r\n            console.log(\" Firestore verificado y datos cargados\");\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error conectando con Firestore:\", error);\r\n            alert(\"Error al conectar con la base de datos. Recargando...\");\r\n            setTimeout(() => location.reload(), 3000);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // 3. FUNCIONES DE AUTENTICACIN\r\n    // =============================================\r\n    async function handleAuthState(user) {\r\n        console.log('Estado de autenticacin cambiado:', user ? user.uid : 'No user');\r\n        \r\n        if (user && user.uid === ADMIN_UID) {\r\n            console.log('Usuario es admin, mostrando panel...');\r\n            await showAdminPanel();\r\n            await initCalendar();\r\n        } else {\r\n            console.log('Usuario no es admin, mostrando login...');\r\n            showLoginScreen();\r\n        }\r\n    }\r\n\r\n    async function signInWithGoogle() {\r\n        try {\r\n            const provider = new firebase.auth.GoogleAuthProvider();\r\n            await firebase.auth().signInWithPopup(provider);\r\n        } catch (error) {\r\n            console.error(\"Error de autenticacin:\", error);\r\n            alert(\"Error al iniciar sesin: \" + error.message);\r\n        }\r\n    }\r\n\r\n    async function signOut() {\r\n        try {\r\n            await firebase.auth().signOut();\r\n        } catch (error) {\r\n            console.error(\"Error al cerrar sesin:\", error);\r\n        }\r\n    }\r\n\r\n    async function showAdminPanel() {\r\n        console.log('Ejecutando showAdminPanel');\r\n        \r\n        if (elements.authContainer) {\r\n            elements.authContainer.style.display = 'none';\r\n            console.log('Auth container oculto');\r\n        }\r\n        \r\n        if (elements.adminPanel) {\r\n            elements.adminPanel.style.display = 'block';\r\n            console.log('Admin panel mostrado');\r\n        } else {\r\n            console.error('elements.adminPanel es null o undefined');\r\n        }\r\n    }\r\n\r\n    function showLoginScreen() {\r\n        if (elements.authContainer) elements.authContainer.style.display = 'flex';\r\n        if (elements.adminPanel) elements.adminPanel.style.display = 'none';\r\n        if (calendar) calendar.destroy();\r\n    }\r\n\r\n    // =============================================\r\n    // 4. FUNCIONES DE NAVEGACIN Y UI\r\n    // =============================================\r\n    function inicializarNavegacionAdmin() {\r\n        console.log(' Inicializando navegacin del panel admin...');\r\n        \r\n        // Elementos de navegacin\r\n        const navEnlaces = document.querySelectorAll('.nav-enlace');\r\n        const overlay = document.querySelector('.nav-enlace-overlay');\r\n        \r\n        // Secciones del panel\r\n        const seccionCalendario = document.querySelector('.container-cal-tur');\r\n        const seccionServicios = document.querySelector('.admin-container_servicios');\r\n        const seccionPersonal = document.querySelector('.admin-container_personal');\r\n        \r\n        // Verificar que todos los elementos existan\r\n        if (!navEnlaces.length || !seccionCalendario || !seccionServicios || !seccionPersonal) {\r\n            console.error(' No se encontraron todos los elementos de navegacin');\r\n            return;\r\n        }\r\n        \r\n        console.log(' Elementos de navegacin encontrados:', {\r\n            enlaces: navEnlaces.length,\r\n            calendario: !!seccionCalendario,\r\n            servicios: !!seccionServicios,\r\n            personal: !!seccionPersonal\r\n        });\r\n\r\n        // Funcin para ocultar todas las secciones\r\n        function ocultarTodasLasSecciones() {\r\n            seccionCalendario.style.display = 'none';\r\n            seccionServicios.style.display = 'none';\r\n            seccionPersonal.style.display = 'none';\r\n        }\r\n\r\n        // Funcin para mostrar una seccin especfica\r\n        function mostrarSeccion(seccion) {\r\n            ocultarTodasLasSecciones();\r\n            seccion.style.display = 'flex';\r\n        }\r\n\r\n        // Funcin para actualizar el overlay de navegacin\r\n        function actualizarOverlay(enlaceActivo) {\r\n            const overlay = document.querySelector('.nav-enlace-overlay');\r\n            if (!overlay) return;\r\n            \r\n            const navAdmin = enlaceActivo.closest('.nav-admin');\r\n            const rect = enlaceActivo.getBoundingClientRect();\r\n            const navRect = navAdmin.getBoundingClientRect();\r\n            \r\n            //  CORREGIDO: Mismo clculo considerando padding\r\n            const enlaceStyles = getComputedStyle(enlaceActivo);\r\n            const paddingLeft = parseFloat(enlaceStyles.paddingLeft);\r\n            const paddingRight = parseFloat(enlaceStyles.paddingRight);\r\n            \r\n            const overlayLeft = (rect.left - navRect.left) - paddingLeft;\r\n            const overlayWidth = rect.width + paddingRight;\r\n            \r\n            overlay.style.width = `${overlayWidth}px`;\r\n            overlay.style.left = `${overlayLeft}px`;\r\n        }\r\n\r\n        // Funcin para manejar el cambio de seccin\r\n        function cambiarSeccion(enlace, seccion, textoEnlace) {\r\n            console.log(` Cambiando a seccin: ${textoEnlace}`);\r\n            \r\n            // Remover active de todos los enlaces\r\n            navEnlaces.forEach(e => e.classList.remove('active'));\r\n            \r\n            // Agregar active al enlace clickeado\r\n            enlace.classList.add('active');\r\n            \r\n            // Actualizar overlay\r\n            actualizarOverlay(enlace);\r\n            \r\n            // Mostrar la seccin correspondiente\r\n            mostrarSeccion(seccion);\r\n            \r\n            // Cargar datos especficos de la seccin si es necesario\r\n            if (textoEnlace === 'Servicios') {\r\n                cargarServiciosYMostrar();\r\n            } else if (textoEnlace === 'Personal') {\r\n                cargarPersonalYMostrar();\r\n            }\r\n            \r\n            console.log(` Seccin ${textoEnlace} activada`);\r\n        }\r\n\r\n        // Agregar event listeners a cada enlace\r\n        navEnlaces.forEach(enlace => {\r\n            enlace.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n                \r\n                const textoEnlace = this.querySelector('.nav-enlace-texto').textContent.trim();\r\n                \r\n                switch(textoEnlace) {\r\n                    case 'Calendario':\r\n                        cambiarSeccion(this, seccionCalendario, textoEnlace);\r\n                        break;\r\n                        \r\n                    case 'Servicios':\r\n                        cambiarSeccion(this, seccionServicios, textoEnlace);\r\n                        break;\r\n                        \r\n                    case 'Personal':\r\n                        cambiarSeccion(this, seccionPersonal, textoEnlace);\r\n                        break;\r\n                        \r\n                    default:\r\n                        console.warn(' Seccin no reconocida:', textoEnlace);\r\n                }\r\n            });\r\n        });\r\n\r\n        // Inicializar posicin del overlay\r\n        const enlaceActivoInicial = document.querySelector('.nav-enlace.active');\r\n        if (enlaceActivoInicial && overlay) {\r\n            actualizarOverlay(enlaceActivoInicial);\r\n        }\r\n\r\n        // Asegurar que solo la seccin activa est visible al inicio\r\n        if (enlaceActivoInicial) {\r\n            const textoEnlaceInicial = enlaceActivoInicial.querySelector('.nav-enlace-texto').textContent.trim();\r\n            switch(textoEnlaceInicial) {\r\n                case 'Calendario':\r\n                    mostrarSeccion(seccionCalendario);\r\n                    break;\r\n                case 'Servicios':\r\n                    mostrarSeccion(seccionServicios);\r\n                    cargarServiciosYMostrar();\r\n                    break;\r\n                case 'Personal':\r\n                    mostrarSeccion(seccionPersonal);\r\n                    break;\r\n            }\r\n        } else {\r\n            // Por defecto mostrar calendario\r\n            mostrarSeccion(seccionCalendario);\r\n        }\r\n\r\n        console.log(' Navegacin del panel admin inicializada correctamente');\r\n    }\r\n\r\n    function inicializarNavegacionCuandoPanelListo() {\r\n        const adminPanel = document.getElementById('admin-panel');\r\n        if (adminPanel && adminPanel.style.display !== 'none') {\r\n            inicializarNavegacionAdmin(); //  CORREGIDO: Usa el nombre correcto\r\n        } else {\r\n            setTimeout(inicializarNavegacionCuandoPanelListo, 500);\r\n        }\r\n    }\r\n\r\n    function inicializarTabBar() {\r\n      const navAdmin = document.querySelector('.nav-admin');\r\n      const enlaces = navAdmin.querySelectorAll('.nav-enlace');\r\n      const overlay = navAdmin.querySelector('.nav-enlace-overlay');\r\n      \r\n      // Funcin para activar un enlace\r\n      function activarEnlace(enlace) {\r\n        enlaces.forEach(e => e.classList.remove('active'));\r\n        enlace.classList.add('active');\r\n        \r\n        //  CORREGIDO: Considerar el padding del enlace en el clculo\r\n        const rect = enlace.getBoundingClientRect();\r\n        const navRect = navAdmin.getBoundingClientRect();\r\n        \r\n        // Obtener el padding del enlace\r\n        const enlaceStyles = getComputedStyle(enlace);\r\n        const paddingLeft = parseFloat(enlaceStyles.paddingLeft);\r\n        const paddingRight = parseFloat(enlaceStyles.paddingRight);\r\n        \r\n        // Calcular posicin y tamao CONSIDERANDO el padding\r\n        const overlayLeft = (rect.left - navRect.left) - paddingLeft;\r\n        const overlayWidth = rect.width + paddingRight;\r\n        \r\n        overlay.style.width = `${overlayWidth}px`;\r\n        overlay.style.left = `${overlayLeft}px`;\r\n      }\r\n      \r\n      // Agregar event listeners\r\n      enlaces.forEach(enlace => {\r\n        enlace.addEventListener('click', () => activarEnlace(enlace));\r\n      });\r\n      \r\n      // Inicializar posicin del overlay\r\n      const activeEnlace = navAdmin.querySelector('.nav-enlace.active');\r\n      if (activeEnlace) {\r\n        setTimeout(() => activarEnlace(activeEnlace), 100);\r\n      }\r\n\r\n      window.addEventListener('resize', () => {\r\n        const currentActive = navAdmin.querySelector('.nav-enlace.active');\r\n        if (currentActive) {\r\n          setTimeout(() => activarEnlace(currentActive), 50);\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener('DOMContentLoaded', inicializarTabBar);\r\n\r\n    // =============================================\r\n    // 5. FUNCIONES DE MENSAJES Y NOTIFICACIONES\r\n    // =============================================\r\n    function mostrarMensajeExito(mensaje) {\r\n      // Eliminar mensaje existente si hay uno\r\n      let mensajeExito = document.getElementById('mensaje-exito-admin');\r\n      if (mensajeExito) {\r\n        mensajeExito.remove();\r\n      }\r\n\r\n      // Crear nuevo elemento\r\n      mensajeExito = document.createElement('div');\r\n      mensajeExito.id = 'mensaje-exito-admin';\r\n      mensajeExito.className = 'mensaje-exito';\r\n      \r\n      mensajeExito.innerHTML = `\r\n        <div class=\"mensaje-contenido\">\r\n          <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n            <path fill=\"#4CAF50\" d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n          </svg>\r\n          <span>${mensaje}</span>\r\n          <div class=\"barra-progreso-notificacion\"></div>\r\n        </div>\r\n      `;\r\n      \r\n      document.body.appendChild(mensajeExito);\r\n      \r\n      // Mostrar con animacin\r\n      setTimeout(() => {\r\n        mensajeExito.classList.add('visible');\r\n      }, 10);\r\n      \r\n      // Eliminar despus de 5 segundos\r\n      setTimeout(() => {\r\n        mensajeExito.classList.remove('visible');\r\n        setTimeout(() => {\r\n          if (mensajeExito.parentNode) {\r\n            mensajeExito.remove();\r\n          }\r\n        }, 300);\r\n      }, 5000);\r\n    }\r\n\r\n    function mostrarMensajeError(mensaje) {\r\n      // Eliminar mensaje existente si hay uno\r\n      let mensajeError = document.getElementById('mensaje-error-admin');\r\n      if (mensajeError) {\r\n        mensajeError.remove();\r\n      }\r\n\r\n      // Crear nuevo elemento\r\n      mensajeError = document.createElement('div');\r\n      mensajeError.id = 'mensaje-error-admin';\r\n      mensajeError.className = 'mensaje-error';\r\n      \r\n      mensajeError.innerHTML = `\r\n        <div class=\"mensaje-contenido error\">\r\n          <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n            <path fill=\"#f44336\" d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/>\r\n          </svg>\r\n          <span>${mensaje}</span>\r\n          <div class=\"barra-progreso-notificacion\"></div>\r\n        </div>\r\n      `;\r\n      \r\n      document.body.appendChild(mensajeError);\r\n      \r\n      // Mostrar con animacin\r\n      setTimeout(() => {\r\n        mensajeError.classList.add('visible');\r\n      }, 10);\r\n      \r\n      // Eliminar despus de 5 segundos\r\n      setTimeout(() => {\r\n        mensajeError.classList.remove('visible');\r\n        setTimeout(() => {\r\n          if (mensajeError.parentNode) {\r\n            mensajeError.remove();\r\n          }\r\n        }, 300);\r\n      }, 5000);\r\n    }\r\n\r\n    function mostrarLoading() {\r\n      const loading = document.createElement('div');\r\n      loading.className = 'loading-indicator';\r\n      loading.textContent = 'Procesando...';\r\n      document.body.appendChild(loading);\r\n      return loading;\r\n    }\r\n\r\n    // =============================================\r\n    // 6. FUNCIONES DE CARGA DE DATOS\r\n    // =============================================\r\n    async function cargarServicios() {\r\n      try {\r\n        const snapshot = await db.collection('servicios').get();\r\n        serviciosMap = {};\r\n        snapshot.forEach(doc => {\r\n          serviciosMap[doc.id] = doc.data();\r\n        });\r\n        console.log(\"Servicios cargados:\", Object.keys(serviciosMap).length);\r\n      } catch (error) {\r\n        console.error(\"Error cargando servicios:\", error);\r\n      }\r\n    }\r\n\r\n    async function cargarEspecialistas() {\r\n      try {\r\n        console.log(\" Iniciando carga de especialistas...\");\r\n        especialistasCargando = true;\r\n        \r\n        const snapshot = await db.collection('especialistas').get();\r\n        const nuevoMapa = {};\r\n        \r\n        console.log(` Encontrados ${snapshot.size} especialistas en Firestore`);\r\n        \r\n        let cargados = 0;\r\n        snapshot.forEach(doc => {\r\n          const data = doc.data();\r\n          nuevoMapa[doc.id] = data;\r\n          console.log(` Cargado: ${doc.id} -> ${data.nombre}`);\r\n          cargados++;\r\n        });\r\n        \r\n        // Actualizar el mapa de forma atmica\r\n        especialistasMap = { ...especialistasMap, ...nuevoMapa };\r\n        \r\n        console.log(\" Especialistas cargados exitosamente:\", cargados);\r\n        console.log(\" IDs en el mapa:\", Object.keys(especialistasMap));\r\n        \r\n        // Reprocesar eventos pendientes si los hay\r\n        if (pendientesDeActualizacion.length > 0) {\r\n          console.log(\" Reprocesando eventos pendientes...\");\r\n          pendientesDeActualizacion.forEach(callback => callback());\r\n          pendientesDeActualizacion = [];\r\n        }\r\n        \r\n        return cargados;\r\n      } catch (error) {\r\n        console.error(\" Error cargando especialistas:\", error);\r\n        return 0;\r\n      } finally {\r\n        especialistasCargando = false;\r\n      }\r\n    }\r\n\r\n    function obtenerNombreEspecialista(especialistaId) {\r\n      if (!especialistaId || especialistaId === 'sin-especialista') {\r\n        return 'Sin especialista asignado';\r\n      }\r\n      \r\n      // Verificar si ya tenemos el especialista en el mapa\r\n      const especialista = especialistasMap[especialistaId];\r\n      if (especialista && especialista.nombre) {\r\n        return especialista.nombre;\r\n      }\r\n      \r\n      // Si no est en el mapa, intentar cargarlo bajo demanda\r\n      if (!especialistasCargando) {\r\n        console.log(` Especialista ${especialistaId} no encontrado, cargando bajo demanda...`);\r\n        cargarEspecialistaIndividual(especialistaId);\r\n      }\r\n      \r\n      // Mientras se carga, devolver el ID formateado como fallback temporal\r\n      return formatearNombreDesdeId(especialistaId);\r\n    }\r\n\r\n    async function cargarEspecialistaIndividual(especialistaId) {\r\n      try {\r\n        const doc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (doc.exists) {\r\n          const data = doc.data();\r\n          // Actualizar el mapa\r\n          especialistasMap[especialistaId] = data;\r\n          console.log(` Especialista cargado bajo demanda: ${especialistaId} -> ${data.nombre}`);\r\n          \r\n          // Refrescar el calendario para mostrar los nombres actualizados\r\n          if (calendar) {\r\n            calendar.refetchEvents();\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(` Error cargando especialista individual ${especialistaId}:`, error);\r\n      }\r\n    }\r\n\r\n    function formatearNombreDesdeId(especialistaId) {\r\n      // Remover prefijo \"esp_\" y reemplazar guiones bajos por espacios\r\n      let nombre = especialistaId.replace(/^esp_/, '');\r\n      nombre = nombre.replace(/_/g, ' ');\r\n      \r\n      // Capitalizar palabras\r\n      nombre = nombre.replace(/\\w\\S*/g, function(txt) {\r\n        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();\r\n      });\r\n      \r\n      return nombre;\r\n    }\r\n\r\n    async function recargarEspecialistasYVista() {\r\n      await cargarEspecialistas();\r\n      if (calendar) {\r\n        calendar.refetchEvents();\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 7. FUNCIONES DE CONFIGURACIN\r\n    // =============================================\r\n    async function obtenerConfiguracion() {\r\n      try {\r\n        const doc = await db.collection('config').doc('horarios').get();\r\n        if (!doc.exists) return obtenerConfiguracionPorDefecto();\r\n        \r\n        const data = doc.data();\r\n        \r\n        // Funcin robusta para normalizar das laborales\r\n        const normalizarDias = (dias) => {\r\n          if (!dias) return [1,2,3,4,5];\r\n          \r\n          // Si ya es un array de nmeros, devolverlo\r\n          if (Array.isArray(dias) && dias.every(item => typeof item === 'number')) {\r\n            return dias;\r\n          }\r\n          \r\n          // Si es un string que parece contener un array\r\n          if (typeof dias === 'string') {\r\n            try {\r\n              // Limpiar el string\r\n              const strClean = dias.trim().replace(/[\\[\\]'\"\\s]/g, '');\r\n              if (strClean === '') return [1,2,3,4,5];\r\n              \r\n              // Convertir a array de nmeros\r\n              return strClean.split(',').map(Number).filter(n => !isNaN(n) && n >= 0 && n <= 6);\r\n            } catch (e) {\r\n              console.warn(\"Error parseando das laborales:\", e);\r\n              return [1,2,3,4,5];\r\n            }\r\n          }\r\n          \r\n          // Si es un array con strings\r\n          if (Array.isArray(dias)) {\r\n            return dias.map(item => {\r\n              if (typeof item === 'number') return item;\r\n              if (typeof item === 'string') {\r\n                return parseInt(item.replace(/\\D/g, ''), 10);\r\n              }\r\n              return null;\r\n            }).filter(n => !isNaN(n) && n >= 0 && n <= 6);\r\n          }\r\n          \r\n          return [1,2,3,4,5]; // Default\r\n        };\r\n        \r\n        const diasLaborales = normalizarDias(data.diasLaborales)\r\n          .filter(n => n >= 0 && n <= 6) // Filtrar valores invlidos\r\n          .sort((a, b) => a - b); // Ordenar\r\n        \r\n        return {\r\n          horarioApertura: data.horarioApertura || \"09:00\",\r\n          horarioCierre: data.horarioCierre || \"19:00\",\r\n          duracionTurno: data.duracionTurno || 30,\r\n          diasLaborales: diasLaborales.length > 0 ? diasLaborales : [1,2,3,4,5]\r\n        };\r\n      } catch (error) {\r\n        console.error(\"Error obteniendo configuracin:\", error);\r\n        return obtenerConfiguracionPorDefecto();\r\n      }\r\n    }\r\n\r\n    function obtenerConfiguracionPorDefecto() {\r\n      return {\r\n        horarioApertura: \"09:00\",\r\n        horarioCierre: \"19:00\",\r\n        duracionTurno: 30,\r\n        diasLaborales: [1,2,3,4,5] // Lunes a Viernes\r\n      };\r\n    }\r\n\r\n    function validarHorario(horario, config) {\r\n      // Convertir horario a minutos desde medianoche\r\n      const [horas, minutos] = horario.split(':').map(Number);\r\n      const horarioEnMinutos = horas * 60 + minutos;\r\n      \r\n      // Convertir horarios de apertura/cierre\r\n      const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n      const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n      const aperturaEnMinutos = aperturaH * 60 + aperturaM;\r\n      const cierreEnMinutos = cierreH * 60 + cierreM;\r\n      \r\n      // Validar que est dentro del horario laboral\r\n      if (horarioEnMinutos < aperturaEnMinutos || horarioEnMinutos >= cierreEnMinutos) {\r\n        return {\r\n          valido: false,\r\n          mensaje: `El horario debe estar entre ${config.horarioApertura} y ${config.horarioCierre}`\r\n        };\r\n      }\r\n      \r\n      // Validar que sea en intervalos de 30 minutos\r\n      if (minutos % config.duracionTurno !== 0) {\r\n        return {\r\n          valido: false,\r\n          mensaje: `Los turnos deben ser en intervalos de ${config.duracionTurno} minutos (ej: 09:00, 09:30, etc.)`\r\n        };\r\n      }\r\n      \r\n      return { valido: true };\r\n    }\r\n\r\n    // =============================================\r\n    // 8. FUNCIONES DEL CALENDARIO\r\n    // =============================================\r\n    async function initCalendar() {\r\n      if (!elements.calendar) return;\r\n      \r\n      calendar = new FullCalendar.Calendar(elements.calendar, {\r\n        initialView: 'dayGridMonth',\r\n        locale: 'es',\r\n        headerToolbar: {\r\n          left: 'prev,next today',\r\n          center: 'title',\r\n          right: 'dayGridMonth,timeGridWeek,timeGridDay'\r\n        },\r\n        selectable: true,\r\n        selectMirror: true,\r\n        dayMaxEvents: true,\r\n        selectOverlap: false,\r\n        \r\n        height: 'auto', // Altura automtica\r\n        contentHeight: 'auto', // Altura del contenido automtica\r\n\r\n        allDaySlot: false, // Ocultar la ranura \"todo el da\"\r\n        slotMinTime: \"09:00:00\", // Ajustar segn tu horario de apertura\r\n        slotMaxTime: \"20:00:00\", // Ajustar segn tu horario de cierre\r\n        slotDuration: \"00:30:00\", // Duracin de cada slot (30 minutos)\r\n        slotLabelInterval: \"01:00:00\", // Mostrar etiquetas cada hora\r\n        slotLabelFormat: {\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n          hour12: false\r\n        },\r\n        \r\n        // Modificar el evento dateClick en initCalendar\r\n        dateClick: async function(info) {\r\n          // Remover la clase de seleccin de todas las celdas primero\r\n          document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n            el.classList.remove('fc-daygrid-day-selected');\r\n          });\r\n          \r\n          // Aadir la clase de seleccin a la celda clickeada\r\n          info.dayEl.classList.add('fc-daygrid-day-selected');\r\n          \r\n          // Buscar el enlace \"more\" (contador) en este da\r\n          const moreLink = info.dayEl.querySelector('.fc-daygrid-more-link');\r\n          \r\n          if (moreLink) {\r\n            // Si hay contador, simular click en l para abrir el popover\r\n            moreLink.click();\r\n          } else {\r\n            // Si no hay contador, verificar si hay eventos en este da\r\n            const events = calendar.getEvents().filter(event => {\r\n              const eventStart = event.start;\r\n              return eventStart && \r\n                    eventStart.toISOString().split('T')[0] === info.dateStr &&\r\n                    !event.extendedProps.esContador; // Excluir eventos contador\r\n            });\r\n            \r\n            if (events.length > 0) {\r\n              // Si hay eventos pero no contador (menos del lmite), mostrar en el panel lateral\r\n              await loadTurnosForDate(info.dateStr);\r\n            } else {\r\n              // Si no hay eventos, tambin cargar en el panel lateral (mostrar \"No hay turnos\")\r\n              await loadTurnosForDate(info.dateStr);\r\n            }\r\n          }\r\n        },\r\n        \r\n        events: async function(fetchInfo, successCallback, failureCallback) {\r\n          try {\r\n            const snapshot = await db.collection('turnos')\r\n              .where('fecha', '>=', fetchInfo.startStr)\r\n              .where('fecha', '<=', fetchInfo.endStr)\r\n              .get();\r\n            \r\n            const events = [];\r\n\r\n            snapshot.docs.forEach(doc => {\r\n              const data = doc.data();\r\n              const clienteNombre = data.cliente?.nombre || 'Cliente no especificado';\r\n              const serviciosNombres = obtenerNombresServicios(data.serviciosIds);\r\n              \r\n              // Manejar mltiples especialistas\r\n              const especialistaIds = data.especialistaIds || [];\r\n              \r\n              if (especialistaIds.length === 0) {\r\n                // Caso sin especialistas\r\n                const horario = data.horario || data.horarioInicio || '00:00';\r\n                events.push(crearEventoTurno(doc.id, data, clienteNombre, serviciosNombres, 'sin-especialista', horario, horario));\r\n              } else if (especialistaIds.length === 1) {\r\n                // Caso con un solo especialista\r\n                const especialistaId = especialistaIds[0];\r\n                const horario = data.horario || data.horarioInicio || '00:00';\r\n                events.push(crearEventoTurno(doc.id, data, clienteNombre, serviciosNombres, especialistaId, horario, horario));\r\n              } else {\r\n                // Caso con mltiples especialistas - crear un evento por cada uno\r\n                especialistaIds.forEach(especialistaId => {\r\n                  let horarioInicio = data.horarioInicio;\r\n                  let horarioFin = data.horarioInicio;\r\n                  \r\n                  if (data.slotsPorEspecialista && data.slotsPorEspecialista[especialistaId]) {\r\n                    const slots = data.slotsPorEspecialista[especialistaId];\r\n                    if (slots.length > 0) {\r\n                      horarioInicio = slots[0];\r\n                      \r\n                      // Calcular duracin especfica para este especialista\r\n                      let duracion = 30; // Default\r\n                      if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n                        const serviciosEspecialista = data.serviciosPorEspecialista[especialistaId];\r\n                        duracion = serviciosEspecialista.reduce((total, servicio) => total + (servicio.duracion || 30), 0);\r\n                      }\r\n                      \r\n                      // Calcular horario fin preciso\r\n                      const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n                      const inicioMinutos = hora * 60 + minuto;\r\n                      const finMinutos = inicioMinutos + duracion;\r\n                      const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n                      const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n                      horarioFin = `${horaFin}:${minutoFin}`;\r\n                    }\r\n                  }\r\n                  \r\n                  // Obtener servicios especficos para este especialista\r\n                  let serviciosEspecificos = serviciosNombres;\r\n                  if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n                    const servicios = data.serviciosPorEspecialista[especialistaId];\r\n                    serviciosEspecificos = servicios.map(s => s.nombre).join(', ');\r\n                  }\r\n                  \r\n                  events.push(crearEventoTurno(\r\n                    `${doc.id}_${especialistaId}`, // ID nico por especialista\r\n                    data, \r\n                    clienteNombre, \r\n                    serviciosEspecificos, \r\n                    especialistaId, \r\n                    horarioInicio, \r\n                    horarioFin,\r\n                    true // Es mltiple\r\n                  ));\r\n                });\r\n              }\r\n            });\r\n            \r\n            successCallback(events);\r\n          } catch (error) {\r\n            console.error(\"Error cargando eventos:\", error);\r\n            successCallback([]);\r\n          }\r\n        },\r\n        \r\n        eventClick: function(info) {\r\n          abrirModalEdicion(info.event);\r\n        },\r\n        \r\n        select: function(info) {\r\n          calendar.unselect();\r\n        },\r\n        \r\n        // Configuracin especfica para cada vista\r\n        views: {\r\n          dayGridMonth: {\r\n            dayMaxEvents: 0,\r\n            dayMaxEventRows: 1, // Lmite de eventos por da en vista mensual\r\n            displayEventTime: false, // No mostrar hora en eventos de vista mensual\r\n          },\r\n          timeGridWeek: {\r\n            dayHeaderFormat: { weekday: 'short', day: 'numeric', month: 'short' },\r\n            slotEventOverlap: false, // Evitar superposicin visual de eventos\r\n            eventMinHeight: 20, // Altura mnima para eventos cortos\r\n            allDaySlot: false // Ocultar \"todo el da\" en vista semanal\r\n          },\r\n          timeGridDay: {\r\n            dayHeaderFormat: { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' },\r\n            slotEventOverlap: false,\r\n            eventMinHeight: 20,\r\n            allDaySlot: false\r\n          }\r\n        },\r\n        \r\n        // Asegurar que los eventos usen la duracin correcta\r\n        eventTimeFormat: {\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n          hour12: false\r\n        },\r\n        \r\n        // Limpiar seleccin al cambiar de vista\r\n        viewDidMount: function() {\r\n          document.querySelectorAll('.fc-daygrid-day-selected').forEach(el => {\r\n            el.classList.remove('fc-daygrid-day-selected');\r\n          });\r\n        },\r\n        \r\n        // Mejorar el tooltip para mostrar duracin\r\n        eventDidMount: function(info) {\r\n          const { event } = info;\r\n          const startTime = event.start.toLocaleTimeString('es-ES', { \r\n            hour: '2-digit', \r\n            minute: '2-digit',\r\n            hour12: false \r\n          });\r\n          \r\n          const endTime = event.end ? event.end.toLocaleTimeString('es-ES', { \r\n            hour: '2-digit', \r\n            minute: '2-digit',\r\n            hour12: false \r\n          }) : 'Fin no definido';\r\n          \r\n          const duracion = event.end ? \r\n            Math.round((event.end - event.start) / (1000 * 60)) + ' min' : \r\n            'Duracin no definida';\r\n          \r\n          const tooltipContent = `\r\n            <strong>Cliente:</strong> ${event.extendedProps.cliente}<br>\r\n            <strong>Especialista:</strong> ${event.extendedProps.especialista}<br>\r\n            <strong>Servicios:</strong> ${event.extendedProps.servicios}<br>\r\n            <strong>Horario:</strong> ${startTime} - ${endTime}<br>\r\n            <strong>Duracin:</strong> ${duracion}\r\n          `;\r\n          \r\n          info.el.setAttribute('title', tooltipContent.replace(/<br>/g, '\\n'));\r\n        }\r\n      });\r\n      \r\n      calendar.render();\r\n    }\r\n\r\n    function crearEventoTurno(id, data, clienteNombre, serviciosNombres, especialistaId, horarioInicio, horarioFin, esMultiplesEspecialistas = false) {\r\n      const especialistaNombre = obtenerNombreEspecialista(especialistaId);\r\n      const titulo = esMultiplesEspecialistas \r\n        ? `${clienteNombre} - ${especialistaNombre}`\r\n        : `${clienteNombre} - ${especialistaNombre}`;\r\n      \r\n      // Asegurar que horarioFin sea posterior a horarioInicio\r\n      let horaFinCalculada = horarioFin;\r\n      if (horarioInicio === horarioFin) {\r\n        // Si no hay horarioFin, calcularlo basado en la duracin\r\n        let duracion = 30; // Default 30 minutos\r\n        \r\n        // Buscar duracin en serviciosPorEspecialista\r\n        if (data.serviciosPorEspecialista && data.serviciosPorEspecialista[especialistaId]) {\r\n          const servicios = data.serviciosPorEspecialista[especialistaId];\r\n          duracion = servicios.reduce((total, servicio) => total + (servicio.duracion || 30), 0);\r\n        } else if (data.duracionTotal && data.especialistaIds && data.especialistaIds.length > 0) {\r\n          // Dividir la duracin total entre especialistas como fallback\r\n          duracion = Math.round(data.duracionTotal / data.especialistaIds.length);\r\n        }\r\n        \r\n        // Calcular horarioFin\r\n        const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n        const inicioMinutos = hora * 60 + minuto;\r\n        const finMinutos = inicioMinutos + duracion;\r\n        const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n        const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n        horaFinCalculada = `${horaFin}:${minutoFin}`;\r\n      }\r\n      \r\n      //  NUEVO: Generar un color nico basado en el ID del turno padre para eventos mltiples\r\n      const turnoBaseId = esMultiplesEspecialistas ? id.split('_')[0] : null;\r\n      const colorBordeGrupo = turnoBaseId ? generarColorDesdeId(turnoBaseId) : null;\r\n      \r\n      return {\r\n        id: id,\r\n        title: titulo,\r\n        start: `${data.fecha}T${horarioInicio}`,\r\n        end: `${data.fecha}T${horaFinCalculada}`,\r\n        allDay: false,\r\n        extendedProps: {\r\n          turnoId: data.id || id.split('_')[0],\r\n          cliente: clienteNombre,\r\n          telefono: data.cliente?.telefono || 'No especificado',\r\n          email: data.cliente?.email || 'No especificado',\r\n          servicios: serviciosNombres,\r\n          especialista: especialistaNombre,\r\n          especialistaId: especialistaId,\r\n          todosLosEspecialistas: data.especialistaIds ? data.especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ') : especialistaNombre,\r\n          observaciones: data.observaciones || 'Sin observaciones',\r\n          estado: data.estado || 'pendiente',\r\n          esMultiplesEspecialistas: esMultiplesEspecialistas,\r\n          horarioInicio: horarioInicio,\r\n          horarioFin: horaFinCalculada,\r\n          duracion: calcularDuracionEnMinutos(horarioInicio, horaFinCalculada),\r\n          //  NUEVO: Guardar el ID base para agrupamiento visual\r\n          turnoBaseId: turnoBaseId,\r\n          colorBordeGrupo: colorBordeGrupo\r\n        },\r\n        className: `fc-event-${data.estado || 'pendiente'} ${esMultiplesEspecialistas ? 'fc-event-grupo-multiple' : ''}`,\r\n        borderColor: esMultiplesEspecialistas ? colorBordeGrupo : 'transparent',\r\n        backgroundColor: getEventColorBySpecialist(especialistaId),\r\n        textColor: '#ffffff'\r\n      };\r\n    }\r\n\r\n    function generarColorDesdeId(id) {\r\n      // Colores distintivos para bordes de grupos\r\n      const coloresGrupo = [\r\n        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',\r\n        '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',\r\n        '#F8C471', '#82E0AA', '#F1948A', '#D7BDE2', '#A3E4D7'\r\n      ];\r\n      \r\n      // Generar ndice basado en el ID\r\n      let hash = 0;\r\n      for (let i = 0; i < id.length; i++) {\r\n        hash = id.charCodeAt(i) + ((hash << 5) - hash);\r\n      }\r\n      const index = Math.abs(hash) % coloresGrupo.length;\r\n      \r\n      return coloresGrupo[index];\r\n    }\r\n\r\n    function getEventColorBySpecialist(especialistaId) {\r\n      // Mapa de colores fijos para especialistas conocidos\r\n      const coloresFijos = {\r\n        'esp_analia_solange': '#b285bfff',\r\n        'esp_agustin_matias': '#aaaad3ff',\r\n        'esp_blondie_flores': '#95bec3ff',\r\n        'esp_monica_flores': '#92bc8bff',\r\n        // Agregar ms especialistas segn necesites\r\n      };\r\n      \r\n      // Si tenemos un color fijo para este especialista, usarlo\r\n      if (coloresFijos[especialistaId]) {\r\n        return coloresFijos[especialistaId];\r\n      }\r\n      \r\n      // Para especialistas no mapeados, usar colores de respaldo\r\n      const coloresRespaldo = [\r\n        '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F',\r\n        '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A',\r\n        '#D7BDE2', '#A3E4D7', '#F9E79F', '#D2B4DE', '#A9CCE3'\r\n      ];\r\n      \r\n      // Generar ndice basado en el ID del especialista\r\n      let hash = 0;\r\n      for (let i = 0; i < especialistaId.length; i++) {\r\n        hash = especialistaId.charCodeAt(i) + ((hash << 5) - hash);\r\n      }\r\n      const index = Math.abs(hash) % coloresRespaldo.length;\r\n      \r\n      return coloresRespaldo[index];\r\n    }\r\n\r\n    function getEventColor(estado) {\r\n      switch(estado) {\r\n        case 'confirmado': return '#4CAF50';\r\n        case 'cancelado': return '#F44336';\r\n        case 'completado': return '#2196F3';\r\n        default: return '#FF9800';\r\n      }\r\n    }\r\n\r\n    function calcularDuracionEnMinutos(horarioInicio, horarioFin) {\r\n      const [horaInicio, minutoInicio] = horarioInicio.split(':').map(Number);\r\n      const [horaFin, minutoFin] = horarioFin.split(':').map(Number);\r\n      \r\n      const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n      const finMinutos = horaFin * 60 + minutoFin;\r\n      \r\n      return finMinutos - inicioMinutos;\r\n    }\r\n\r\n    async function recargarVistaCalendario() {\r\n      if (!calendar) return;\r\n      \r\n      try {\r\n        console.log(' Recargando vista del calendario...');\r\n        \r\n        // Obtener informacin de la vista actual\r\n        const vistaActual = calendar.view;\r\n        const tipoVista = vistaActual.type;\r\n        const fechaActual = vistaActual.currentStart;\r\n        \r\n        console.log(` Vista actual: ${tipoVista}, Fecha: ${fechaActual}`);\r\n        \r\n        // Mtodo 1: Forzar recarga cambiando temporalmente la vista\r\n        // Esto es ms efectivo que refetchEvents() solo\r\n        if (tipoVista === 'timeGridWeek' || tipoVista === 'timeGridDay') {\r\n          // Para vistas semanales y diarias, cambiar temporalmente a month y volver\r\n          calendar.changeView('dayGridMonth', fechaActual);\r\n          setTimeout(() => {\r\n            calendar.changeView(tipoVista, fechaActual);\r\n          }, 100);\r\n        } else {\r\n          // Para vista mensual, recargar directamente\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n      } catch (error) {\r\n        console.error(' Error recargando vista calendario:', error);\r\n        // Fallback: recarga bsica\r\n        if (calendar) {\r\n          calendar.refetchEvents();\r\n        }\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 9. FUNCIONES DE TURNOS (CRUD)\r\n    // =============================================\r\n    async function loadTurnosForDate(date) {\r\n      try {\r\n        console.log(' Cargando turnos para fecha:', date);\r\n        \r\n        // Corregir formato de fecha para el ttulo\r\n        const fechaObj = new Date(date);\r\n        const fechaAjustada = new Date(fechaObj.getTime() + fechaObj.getTimezoneOffset() * 60000);\r\n        \r\n        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\r\n        elements.fechaTitulo.textContent = `Turnos para ${fechaAjustada.toLocaleDateString('es-AR', options)}`;\r\n        \r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', date)\r\n          .orderBy('horario', 'asc')\r\n          .get();\r\n        \r\n        console.log(` Encontrados ${snapshot.docs.length} turnos`);\r\n        renderTurnos(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n        \r\n      } catch (error) {\r\n        console.error(\" Error cargando turnos:\", error);\r\n        elements.turnosList.innerHTML = '<p>Error al cargar los turnos. Intente nuevamente.</p>';\r\n      }\r\n    }\r\n\r\n    function renderTurnos(turnos) {\r\n      if (!elements.turnosList) return;\r\n      \r\n      if (turnos.length === 0) {\r\n        elements.turnosList.innerHTML = '<p class=\"sin-turnos\">No hay turnos para esta fecha.</p>';\r\n        return;\r\n      }\r\n      \r\n      elements.turnosList.innerHTML = turnos.map(turno => {\r\n        const especialistaIds = turno.especialistaIds || [];\r\n        const nombresEspecialistas = especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ');\r\n        \r\n        // Obtener servicios especficos por especialista\r\n        let serviciosInfo = obtenerNombresServicios(turno.serviciosIds);\r\n        if (turno.serviciosPorEspecialista) {\r\n          serviciosInfo = '';\r\n          Object.keys(turno.serviciosPorEspecialista).forEach(espId => {\r\n            const servicios = turno.serviciosPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            const nombresServicios = servicios.map(s => s.nombre).join(', ');\r\n            serviciosInfo += `<strong>${nombreEsp}:</strong> ${nombresServicios}<br>`;\r\n          });\r\n        }\r\n        \r\n        // Obtener horarios por especialista\r\n        let horariosInfo = turno.horarioInicio || 'No especificado';\r\n        if (turno.slotsPorEspecialista) {\r\n          horariosInfo = '';\r\n          Object.keys(turno.slotsPorEspecialista).forEach(espId => {\r\n            const slots = turno.slotsPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            if (slots.length > 0) {\r\n              horariosInfo += `<strong>${nombreEsp}:</strong> ${slots[0]}<br>`;\r\n            }\r\n          });\r\n        }\r\n        \r\n        return `\r\n        <div class=\"turno-card\" data-id=\"${turno.id}\">\r\n          <div class=\"turno-header\" data-id=\"${turno.id}\">\r\n            <div class=\"turno-sumario\">\r\n              <span class=\"turno-horario\">${turno.horarioInicio}</span>\r\n              <span class=\"turno-cliente\">${turno.cliente.nombre}</span>\r\n              <span class=\"turno-especialista\">${nombresEspecialistas}</span>\r\n              <span class=\"turno-estado ${turno.estado || 'pendiente'}\">${turno.estado || 'pendiente'}</span>\r\n            </div>\r\n            <span class=\"toggle-icon\"></span>\r\n          </div>\r\n          <div class=\"turno-detalles\">\r\n            <div class=\"turno-info\">\r\n              <p><strong>Servicios por especialista:</strong><br>${serviciosInfo}</p>\r\n              <p><strong>Especialistas:</strong> ${nombresEspecialistas}</p>\r\n              <p><strong>Horarios:</strong><br>${horariosInfo}</p>\r\n              <p><strong>Telfono:</strong> ${turno.cliente.telefono}</p>\r\n              <p><strong>Email:</strong> ${turno.cliente.email}</p>\r\n              ${turno.duracionTotal ? `<p><strong>Duracin total:</strong> ${turno.duracionTotal} minutos</p>` : ''}\r\n              ${turno.montoTotal ? `<p><strong>Monto total:</strong> $${turno.montoTotal}</p>` : ''}\r\n              ${turno.observaciones ? `<p><strong>Observaciones:</strong> ${turno.observaciones}</p>` : ''}\r\n            </div>\r\n            <div class=\"turno-actions\">\r\n              <button class=\"btn-editar\" data-id=\"${turno.id}\">Editar</button>\r\n              <button class=\"btn-eliminar-lista\" data-id=\"${turno.id}\">Eliminar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        `;\r\n      }).join('');\r\n      \r\n      // El resto del cdigo de event listeners se mantiene igual...\r\n      document.querySelectorAll('.turno-header').forEach(header => {\r\n        header.addEventListener('click', function(e) {\r\n          if (e.target.tagName === 'BUTTON') return;\r\n          \r\n          const card = this.closest('.turno-card');\r\n          const detalles = card.querySelector('.turno-detalles');\r\n          const icon = this.querySelector('.toggle-icon');\r\n          \r\n          card.classList.toggle('expanded');\r\n          detalles.style.display = card.classList.contains('expanded') ? 'block' : 'none';\r\n          icon.textContent = card.classList.contains('expanded') ? '' : '';\r\n        });\r\n      });\r\n      \r\n      // Configurar eventos para los botones eliminar\r\n      document.querySelectorAll('.btn-eliminar-lista').forEach(btn => {\r\n        btn.addEventListener('click', async (e) => {\r\n          e.stopPropagation();\r\n          const turnoId = e.currentTarget.getAttribute('data-id');\r\n          \r\n          if (confirm('Ests seguro de eliminar este turno?')) {\r\n            const loading = mostrarLoading();\r\n            try {\r\n              await eliminarTurno(turnoId);\r\n              const fechaActual = new Date().toISOString().split('T')[0];\r\n              await loadTurnosForDate(fechaActual);\r\n            } catch (error) {\r\n              console.error(\"Error eliminando desde lista:\", error);\r\n              alert(\"Error al eliminar el turno\");\r\n            } finally {\r\n              loading.remove();\r\n            }\r\n          }\r\n        });\r\n      });\r\n      \r\n      // Configurar eventos para los botones editar\r\n      document.querySelectorAll('.btn-editar').forEach(btn => {\r\n        btn.addEventListener('click', async (e) => {\r\n          e.stopPropagation();\r\n          const turnoId = e.currentTarget.getAttribute('data-id');\r\n          await abrirModalEdicionPorId(turnoId);\r\n        });\r\n      });\r\n    }\r\n\r\n    async function abrirModalEdicion(event) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        await generarOpcionesHorario(config);\r\n        \r\n        currentTurnoId = event.extendedProps.turnoId;\r\n        \r\n        document.getElementById('turno-id').value = currentTurnoId;\r\n        document.getElementById('edit-fecha').value = event.start.toISOString().split('T')[0];\r\n        \r\n        const hora = event.start.getHours().toString().padStart(2, '0');\r\n        const minutos = event.start.getMinutes().toString().padStart(2, '0');\r\n        document.getElementById('edit-horario').value = `${hora}:${minutos}`;\r\n        \r\n        // Mostrar informacin completa, incluyendo todos los especialistas si es mltiple\r\n        const infoHTML = event.extendedProps.esMultiplesEspecialistas \r\n          ? `\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z\" />\r\n                </svg>\r\n              </strong>\r\n              <span>${event.extendedProps.cliente}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.servicios}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.especialista}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M17.8 19.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                  <path d=\"M6.2 19.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                  <path d=\"M12 9.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.todosLosEspecialistas}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                  <path d=\"M12 12h3.5\" />\r\n                  <path d=\"M12 7v5\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.horarioInicio} - ${event.extendedProps.horarioFin}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.telefono}</span>\r\n            </p>\r\n          `\r\n          : `\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.cliente}</span>\r\n              </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.servicios}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                  <path d=\"M12 12h3.5\" />\r\n                  <path d=\"M12 7v5\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.horarioInicio} - ${event.extendedProps.horarioFin}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0\" />\r\n                  <path d=\"M6 21v-2a4 4 0 0 1 4 -4h.5\" />\r\n                  <path d=\"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.especialista}</span>\r\n            </p>\r\n            <p>\r\n              <strong>\r\n                <svg\r\n                  xmlns=\"http://www.w3.org/2000/svg\"\r\n                  width=\"20\"\r\n                  height=\"20\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  fill=\"none\"\r\n                  stroke=\"#020202\"\r\n                  stroke-width=\"1.5\"\r\n                  stroke-linecap=\"round\"\r\n                  stroke-linejoin=\"round\"\r\n                >\r\n                  <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                </svg>\r\n              </strong> \r\n              <span>${event.extendedProps.telefono}</span>\r\n            </p>\r\n          `;\r\n        \r\n        document.getElementById('turno-info').innerHTML = infoHTML;\r\n        \r\n        elements.modalEditar.style.display = 'block';\r\n      } catch (error) {\r\n        console.error(\"Error abriendo modal de edicin:\", error);\r\n        alert(\"Error al cargar los datos del turno\");\r\n      }\r\n    }\r\n\r\n    async function abrirModalEdicionPorId(turnoId) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        await generarOpcionesHorario(config);\r\n        \r\n        const doc = await db.collection('turnos').doc(turnoId).get();\r\n        if (!doc.exists) {\r\n          alert('Turno no encontrado');\r\n          return;\r\n        }\r\n        \r\n        const turno = doc.data();\r\n        currentTurnoId = turnoId;\r\n        \r\n        // Obtener informacin completa de todos los especialistas\r\n        const especialistaIds = turno.especialistaIds || [];\r\n        const nombresEspecialistas = especialistaIds.map(id => obtenerNombreEspecialista(id)).join(', ');\r\n        \r\n        // Obtener servicios especficos por especialista\r\n        let serviciosInfo = obtenerNombresServicios(turno.serviciosIds);\r\n        if (turno.serviciosPorEspecialista) {\r\n          serviciosInfo = '';\r\n          Object.keys(turno.serviciosPorEspecialista).forEach(espId => {\r\n            const servicios = turno.serviciosPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            const nombresServicios = servicios.map(s => s.nombre).join(', ');\r\n            serviciosInfo += `<strong>${nombreEsp}:</strong> ${nombresServicios}<br>`;\r\n          });\r\n        }\r\n        \r\n        // Obtener horarios por especialista\r\n        let horariosInfo = turno.horarioInicio || 'No especificado';\r\n        if (turno.slotsPorEspecialista) {\r\n          horariosInfo = '';\r\n          Object.keys(turno.slotsPorEspecialista).forEach(espId => {\r\n            const slots = turno.slotsPorEspecialista[espId];\r\n            const nombreEsp = obtenerNombreEspecialista(espId);\r\n            if (slots.length > 0) {\r\n              // Calcular hora de fin aproximada\r\n              const horarioInicio = slots[0];\r\n              let duracion = 30; // Default\r\n              if (turno.serviciosPorEspecialista && turno.serviciosPorEspecialista[espId]) {\r\n                duracion = turno.serviciosPorEspecialista[espId].reduce((total, servicio) => total + servicio.duracion, 0);\r\n              }\r\n              \r\n              const [hora, minuto] = horarioInicio.split(':').map(Number);\r\n              const inicioMinutos = hora * 60 + minuto;\r\n              const finMinutos = inicioMinutos + duracion;\r\n              const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n              const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n              const horarioFin = `${horaFin}:${minutoFin}`;\r\n              \r\n              horariosInfo += `<strong>${nombreEsp}:</strong> ${horarioInicio} - ${horarioFin}<br>`;\r\n            }\r\n          });\r\n        }\r\n        \r\n        document.getElementById('turno-id').value = turnoId;\r\n        document.getElementById('edit-fecha').value = turno.fecha;\r\n        document.getElementById('edit-horario').value = turno.horario || turno.horarioInicio;\r\n        \r\n        // Mostrar informacin completa del turno\r\n        document.getElementById('turno-info').innerHTML = `\r\n          <p><strong>Cliente:</strong> ${turno.cliente.nombre}</p>\r\n          <p><strong>Servicios por especialista:</strong><br>${serviciosInfo}</p>\r\n          <p><strong>Especialistas:</strong> ${nombresEspecialistas}</p>\r\n          <p><strong>Horarios por especialista:</strong><br>${horariosInfo}</p>\r\n          <p><strong>Telfono:</strong> ${turno.cliente.telefono}</p>\r\n          <p><strong>Estado:</strong> ${turno.estado || 'pendiente'}</p>\r\n          ${turno.duracionTotal ? `<p><strong>Duracin total:</strong> ${turno.duracionTotal} minutos</p>` : ''}\r\n          ${turno.montoTotal ? `<p><strong>Monto total:</strong> $${turno.montoTotal}</p>` : ''}\r\n          ${turno.seaAbonada ? `<p><strong>Sea abonada:</strong> $${turno.seaAbonada}</p>` : ''}\r\n        `;\r\n        \r\n        // Configurar el botn eliminar (cdigo existente)\r\n        const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n        if (btnEliminarModal) {\r\n          btnEliminarModal.onclick = async (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            \r\n            if (confirm('Ests seguro de eliminar este turno permanentemente?')) {\r\n              try {\r\n                const success = await eliminarTurno(currentTurnoId);\r\n                if (success) {\r\n                  await loadTurnosForDate(turno.fecha);\r\n                  calendar.refetchEvents();\r\n                  elements.modalEditar.style.display = 'none';\r\n                  alert('Turno eliminado correctamente');\r\n                }\r\n              } catch (error) {\r\n                console.error(\"Error al eliminar turno:\", error);\r\n                alert(\"Error al eliminar el turno: \" + error.message);\r\n              }\r\n            }\r\n          };\r\n        }\r\n        \r\n        elements.modalEditar.style.display = 'block';\r\n      } catch (error) {\r\n        console.error(\"Error abriendo modal de edicin:\", error);\r\n        alert(\"Error al cargar los datos del turno\");\r\n      }\r\n    }\r\n\r\n    function configurarModalEliminar() {\r\n      const btnEliminarModal = document.getElementById('btn-eliminar-modal');\r\n      if (!btnEliminarModal) return;\r\n\r\n      // Limpiar eventos previos\r\n      btnEliminarModal.onclick = null;\r\n      \r\n      // Asignar nuevo evento\r\n      btnEliminarModal.onclick = async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        \r\n        if (!currentTurnoId) {\r\n          console.error('No hay turno seleccionado');\r\n          alert('No hay turno seleccionado para eliminar');\r\n          return;\r\n        }\r\n\r\n        if (confirm('Ests seguro de eliminar este turno permanentemente? Esta accin no se puede deshacer.')) {\r\n          const loadingIndicator = mostrarLoading();\r\n          try {\r\n            await eliminarTurno(currentTurnoId);\r\n          } catch (error) {\r\n            console.error(\"Error en eliminacin:\", error);\r\n          } finally {\r\n            loadingIndicator.remove();\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    async function generarOpcionesHorario(config) {\r\n      const selectHorario = document.getElementById('edit-horario');\r\n      selectHorario.innerHTML = '';\r\n      \r\n      // Convertir horarios de apertura/cierre a minutos\r\n      const [aperturaH, aperturaM] = config.horarioApertura.split(':').map(Number);\r\n      const [cierreH, cierreM] = config.horarioCierre.split(':').map(Number);\r\n      \r\n      let horaActual = aperturaH;\r\n      let minutoActual = aperturaM;\r\n      \r\n      while (horaActual < cierreH || (horaActual === cierreH && minutoActual < cierreM)) {\r\n        const horaStr = horaActual.toString().padStart(2, '0');\r\n        const minutoStr = minutoActual.toString().padStart(2, '0');\r\n        const option = document.createElement('option');\r\n        option.value = `${horaStr}:${minutoStr}`;\r\n        option.textContent = `${horaStr}:${minutoStr}`;\r\n        selectHorario.appendChild(option);\r\n        \r\n        // Avanzar el tiempo\r\n        minutoActual += config.duracionTurno;\r\n        if (minutoActual >= 60) {\r\n          horaActual += Math.floor(minutoActual / 60);\r\n          minutoActual = minutoActual % 60;\r\n        }\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidad(fecha, horario, turnoId = null) {\r\n      try {\r\n        const config = await obtenerConfiguracion();\r\n        \r\n        // Convertir horario a minutos\r\n        const [hora, minuto] = horario.split(':').map(Number);\r\n        const inicioEnMinutos = hora * 60 + minuto;\r\n        const finEnMinutos = inicioEnMinutos + config.duracionTurno;\r\n        \r\n        // Consultar todos los turnos para la fecha\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .get();\r\n        \r\n        // Filtrar localmente los turnos que se solapan\r\n        const turnosSolapados = snapshot.docs.filter(doc => {\r\n          // Si estamos editando, excluir el turno actual\r\n          if (turnoId && doc.id === turnoId) return false;\r\n          \r\n          const turno = doc.data();\r\n          const turnoHorario = turno.horario || turno.horarioInicio;\r\n          \r\n          if (!turnoHorario) return false;\r\n          \r\n          const [turnoHora, turnoMinuto] = turnoHorario.split(':').map(Number);\r\n          const turnoInicio = turnoHora * 60 + turnoMinuto;\r\n          const turnoFin = turnoInicio + (turno.duracionTotal || config.duracionTurno);\r\n          \r\n          // Verificar solapamiento\r\n          return (inicioEnMinutos < turnoFin && finEnMinutos > turnoInicio);\r\n        });\r\n        \r\n        return {\r\n          disponible: turnosSolapados.length === 0,\r\n          mensaje: turnosSolapados.length > 0 ? \r\n            `El horario se solapa con ${turnosSolapados.length} turno(s) existente(s)` : \r\n            null\r\n        };\r\n      } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad: \" + error.message\r\n        };\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidadCompletaEspecialista(especialistaId, fecha, horarioInicio, duracionTotal, turnoIdExcluir = null) {\r\n      try {\r\n        console.log(` Verificando disponibilidad completa para ${especialistaId} en ${fecha} a las ${horarioInicio}`);\r\n        \r\n        // 1. Verificar si el especialista existe y est activo\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) {\r\n          return { disponible: false, mensaje: 'Especialista no encontrado' };\r\n        }\r\n        \r\n        const especialista = especialistaDoc.data();\r\n        if (!especialista.activo) {\r\n          return { disponible: false, mensaje: 'El especialista no est activo' };\r\n        }\r\n        \r\n        // 2. Verificar da laboral del especialista (CORREGIDO)\r\n        const [year, month, day] = fecha.split('-').map(Number);\r\n        const fechaObj = new Date(year, month - 1, day);\r\n        const diaSemana = fechaObj.getDay(); // 0=Domingo, 1=Lunes, ..., 6=Sbado\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        const horarioDia = especialista.horarioLaboral?.[diaKey];\r\n        if (!horarioDia || !horarioDia.activo) {\r\n          const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n          const diasNombres = ['Domingos', 'Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbados'];\r\n          return { \r\n            disponible: false, \r\n            mensaje: `${nombreEspecialista} no trabaja los ${diasNombres[diaSemana]}` \r\n          };\r\n        }\r\n        \r\n        // 3. Verificar horario dentro de la jornada laboral (resto del cdigo igual)\r\n        const [horaInicio, minutoInicio] = horarioInicio.split(':').map(Number);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        const [horaApertura, minutoApertura] = horarioDia.inicio.split(':').map(Number);\r\n        const [horaCierre, minutoCierre] = horarioDia.fin.split(':').map(Number);\r\n        const aperturaMinutos = horaApertura * 60 + minutoApertura;\r\n        const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n        \r\n        if (inicioMinutos < aperturaMinutos) {\r\n          return { \r\n            disponible: false, \r\n            mensaje: `El horario ${horarioInicio} es antes de la apertura (${horarioDia.inicio})` \r\n          };\r\n        }\r\n        \r\n        if (finMinutos > cierreMinutos) {\r\n          return { \r\n            disponible: false, \r\n            mensaje: `El turno termina despus del cierre (${horarioDia.fin})` \r\n          };\r\n        }\r\n        \r\n        // 4. Verificar conflictos con otros turnos (resto del cdigo igual)\r\n        const snapshot = await db.collection('turnos')\r\n          .where('fecha', '==', fecha)\r\n          .where('especialistaIds', 'array-contains', especialistaId)\r\n          .get();\r\n        \r\n        const turnosConflictivos = snapshot.docs.filter(doc => {\r\n          if (turnoIdExcluir && doc.id === turnoIdExcluir) return false;\r\n          \r\n          const turnoExistente = doc.data();\r\n          const turnoHorario = turnoExistente.horarioInicio || turnoExistente.horario;\r\n          \r\n          if (!turnoHorario) return false;\r\n          \r\n          const [existenteHora, existenteMinuto] = turnoHorario.split(':').map(Number);\r\n          const existenteInicio = existenteHora * 60 + existenteMinuto;\r\n          const existenteFin = existenteInicio + (turnoExistente.duracionTotal || 30);\r\n          \r\n          // Verificar solapamiento\r\n          const haySolapamiento = (inicioMinutos < existenteFin && finMinutos > existenteInicio);\r\n          \r\n          if (haySolapamiento) {\r\n            console.log(` Conflicto con turno ${doc.id}: ${turnoHorario} (${existenteInicio}-${existenteFin}) vs ${horarioInicio} (${inicioMinutos}-${finMinutos})`);\r\n          }\r\n          \r\n          return haySolapamiento;\r\n        });\r\n        \r\n        if (turnosConflictivos.length > 0) {\r\n          const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n          return {\r\n            disponible: false,\r\n            mensaje: `${nombreEspecialista} tiene ${turnosConflictivos.length} turno(s) conflictivo(s) en ese horario`\r\n          };\r\n        }\r\n        \r\n        return { disponible: true, mensaje: null };\r\n        \r\n      } catch (error) {\r\n        console.error(\"Error en verificacin completa especialista:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad del especialista\"\r\n        };\r\n      }\r\n    }\r\n\r\n    async function verificarDisponibilidadCompleta(nuevoTurno, turnoActual, turnoIdExcluir) {\r\n      try {\r\n        // Verificar disponibilidad para cada especialista\r\n        if (nuevoTurno.slotsPorEspecialista) {\r\n          for (const [especialistaId, slots] of Object.entries(nuevoTurno.slotsPorEspecialista)) {\r\n            if (slots.length === 0) continue;\r\n            \r\n            const primerSlot = slots[0];\r\n            const duracionTotal = slots.length * 30; // 30 minutos por slot\r\n            \r\n            // Verificar disponibilidad completa del especialista\r\n            const disponibilidad = await verificarDisponibilidadCompletaEspecialista(\r\n              especialistaId, \r\n              nuevoTurno.fecha, \r\n              primerSlot, \r\n              duracionTotal, \r\n              turnoIdExcluir\r\n            );\r\n            \r\n            if (!disponibilidad.disponible) {\r\n              return disponibilidad;\r\n            }\r\n          }\r\n        } else {\r\n          // Para turnos con un solo especialista (compatibilidad con versiones anteriores)\r\n          const especialistaId = turnoActual.especialistaId || (turnoActual.especialistaIds && turnoActual.especialistaIds[0]);\r\n          if (especialistaId) {\r\n            const duracionTotal = turnoActual.duracionTotal || 30;\r\n            const disponibilidad = await verificarDisponibilidadCompletaEspecialista(\r\n              especialistaId, \r\n              nuevoTurno.fecha, \r\n              nuevoTurno.horarioInicio, \r\n              duracionTotal, \r\n              turnoIdExcluir\r\n            );\r\n            \r\n            if (!disponibilidad.disponible) {\r\n              return disponibilidad;\r\n            }\r\n          }\r\n        }\r\n        \r\n        return { disponible: true, mensaje: null };\r\n        \r\n      } catch (error) {\r\n        console.error(\"Error en verificacin completa:\", error);\r\n        return {\r\n          disponible: false,\r\n          mensaje: \"Error al verificar disponibilidad: \" + error.message\r\n        };\r\n      }\r\n    }\r\n\r\n    async function guardarCambiosTurno() {\r\n      if (!currentTurnoId) {\r\n        console.error('currentTurnoId no definido');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const user = firebase.auth().currentUser;\r\n        if (!user) {\r\n          alert('Debes iniciar sesin para realizar esta accin');\r\n          return;\r\n        }\r\n\r\n        // Verificar si el usuario es administrador\r\n        const token = await user.getIdTokenResult();\r\n        const isAdmin = token.claims.admin === true || user.uid === ADMIN_UID;\r\n        \r\n        if (!isAdmin) {\r\n          alert('No tienes permisos de administrador para realizar esta accin');\r\n          return;\r\n        }\r\n\r\n        const config = await obtenerConfiguracion();\r\n        const nuevoHorario = document.getElementById('edit-horario').value;\r\n        const nuevaFecha = document.getElementById('edit-fecha').value;\r\n        \r\n        // Validar horario\r\n        const validacionHorario = validarHorario(nuevoHorario, config);\r\n        if (!validacionHorario.valido) {\r\n          alert(validacionHorario.mensaje);\r\n          return;\r\n        }\r\n        \r\n        // Crear fecha sin problemas de zona horaria\r\n        const [year, month, day] = nuevaFecha.split('-').map(Number);\r\n        const fechaObj = new Date(year, month - 1, day);\r\n        \r\n        // Obtener da de la semana (0=Domingo, 1=Lunes, ..., 6=Sbado)\r\n        const diaSemana = fechaObj.getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // OBTENER EL TURNO ACTUAL PRIMERO\r\n        const turnoDoc = await db.collection('turnos').doc(currentTurnoId).get();\r\n        if (!turnoDoc.exists) {\r\n          alert('El turno no existe');\r\n          return;\r\n        }\r\n\r\n        const turnoActual = turnoDoc.data();\r\n\r\n        //  NUEVA VALIDACIN: VERIFICAR DISPONIBILIDAD POR ESPECIALISTA\r\n        const especialistaIds = turnoActual.especialistaIds || [];\r\n        \r\n        if (especialistaIds.length > 0) {\r\n          let algunEspecialistaDisponible = false;\r\n          let mensajesError = [];\r\n          \r\n          for (const especialistaId of especialistaIds) {\r\n            const especialista = especialistasMap[especialistaId];\r\n            if (especialista && especialista.horarioLaboral) {\r\n              const horarioDia = especialista.horarioLaboral[diaKey];\r\n              \r\n              if (horarioDia && horarioDia.activo) {\r\n                algunEspecialistaDisponible = true;\r\n                console.log(` ${especialista.nombre} trabaja los ${diaKey}s`);\r\n                break; // Al menos uno trabaja, es suficiente\r\n              } else {\r\n                const nombreEspecialista = obtenerNombreEspecialista(especialistaId);\r\n                mensajesError.push(`${nombreEspecialista} no trabaja los ${diaKey}s`);\r\n              }\r\n            }\r\n          }\r\n          \r\n          if (!algunEspecialistaDisponible) {\r\n            alert(`No se puede agendar el turno:\\n${mensajesError.join('\\n')}`);\r\n            return;\r\n          }\r\n        } else {\r\n          //  VALIDACIN FALLBACK: Si no hay especialistas, usar configuracin general\r\n          // Pero primero ajustar el ndice para coincidir con tu configuracin\r\n          // (Tu configuracin usa 1=Lunes, 2=Martes, etc., mientras que getDay() usa 0=Domingo)\r\n          const diaSemanaConfig = diaSemana === 0 ? 7 : diaSemana; // Ajustar domingo de 0 a 7\r\n          \r\n          if (!config.diasLaborales.includes(diaSemanaConfig)) {\r\n            const diasNombres = ['Domingo', 'Lunes', 'Martes', 'Mircoles', 'Jueves', 'Viernes', 'Sbado'];\r\n            alert(`No se pueden agendar turnos los ${diasNombres[diaSemana]}s`);\r\n            return;\r\n          }\r\n        }\r\n        \r\n        // CALCULAR EL DESPLAZAMIENTO TEMPORAL\r\n        const [nuevaHora, nuevoMinuto] = nuevoHorario.split(':').map(Number);\r\n        const [horaOriginal, minutoOriginal] = (turnoActual.horarioInicio || turnoActual.horario).split(':').map(Number);\r\n        \r\n        const desplazamientoMinutos = (nuevaHora * 60 + nuevoMinuto) - (horaOriginal * 60 + minutoOriginal);\r\n        \r\n        console.log(' Desplazamiento calculado:', desplazamientoMinutos, 'minutos');\r\n\r\n        // PREPARAR ACTUALIZACIN\r\n        const turnoActualizado = {\r\n          fecha: nuevaFecha,\r\n          horario: nuevoHorario,\r\n          horarioInicio: nuevoHorario,\r\n          actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n        };\r\n\r\n        // MANEJAR ESPECIALISTAS MLTIPLES - CORREGIDO\r\n        if (turnoActual.slotsPorEspecialista && Object.keys(turnoActual.slotsPorEspecialista).length > 1) {\r\n          console.log(' Turno con mltiples especialistas detectado');\r\n          \r\n          const nuevosSlotsPorEspecialista = {};\r\n          const nuevosServiciosPorEspecialista = {};\r\n          let todosLosSlots = [];\r\n          let horarioInicioGlobal = null;\r\n          let horarioFinGlobal = null;\r\n          \r\n          // Primero, encontrar el horario de inicio ms temprano entre todos los especialistas\r\n          Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n            const slots = turnoActual.slotsPorEspecialista[especialistaId];\r\n            if (slots && slots.length > 0) {\r\n              const primerSlot = slots[0];\r\n              if (!horarioInicioGlobal || primerSlot < horarioInicioGlobal) {\r\n                horarioInicioGlobal = primerSlot;\r\n              }\r\n            }\r\n          });\r\n          \r\n          // Calcular el desplazamiento basado en el horario global\r\n          const [horaInicioGlobal, minutoInicioGlobal] = horarioInicioGlobal.split(':').map(Number);\r\n          const minutosInicioGlobal = horaInicioGlobal * 60 + minutoInicioGlobal;\r\n          const minutosNuevoInicio = minutosInicioGlobal + desplazamientoMinutos;\r\n          \r\n          // Procesar cada especialista manteniendo la secuencia temporal RELATIVA\r\n          Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n            const slotsOriginales = turnoActual.slotsPorEspecialista[especialistaId];\r\n            \r\n            if (slotsOriginales && slotsOriginales.length > 0) {\r\n              // Calcular el desplazamiento relativo de este especialista\r\n              const primerSlotOriginal = slotsOriginales[0];\r\n              const [horaSlot, minutoSlot] = primerSlotOriginal.split(':').map(Number);\r\n              const minutosSlotOriginal = horaSlot * 60 + minutoSlot;\r\n              const desplazamientoRelativo = minutosSlotOriginal - minutosInicioGlobal;\r\n              \r\n              // Aplicar desplazamiento global + relativo\r\n              const minutosNuevoSlot = minutosNuevoInicio + desplazamientoRelativo;\r\n              const nuevaHoraSlot = Math.floor(minutosNuevoSlot / 60);\r\n              const nuevoMinutoSlot = minutosNuevoSlot % 60;\r\n              const nuevoPrimerSlot = `${nuevaHoraSlot.toString().padStart(2, '0')}:${nuevoMinutoSlot.toString().padStart(2, '0')}`;\r\n              \r\n              // Calcular todos los slots para este especialista\r\n              const nuevosSlotsEspecialista = [];\r\n              for (let i = 0; i < slotsOriginales.length; i++) {\r\n                const slotMinutos = minutosNuevoSlot + (i * 30);\r\n                const slotHora = Math.floor(slotMinutos / 60);\r\n                const slotMinuto = slotMinutos % 60;\r\n                const nuevoSlot = `${slotHora.toString().padStart(2, '0')}:${slotMinuto.toString().padStart(2, '0')}`;\r\n                nuevosSlotsEspecialista.push(nuevoSlot);\r\n                todosLosSlots.push(nuevoSlot);\r\n                \r\n                // Actualizar horario fin global\r\n                const slotFinMinutos = slotMinutos + 30;\r\n                if (!horarioFinGlobal || slotFinMinutos > horarioFinGlobal) {\r\n                  horarioFinGlobal = slotFinMinutos;\r\n                }\r\n              }\r\n              \r\n              nuevosSlotsPorEspecialista[especialistaId] = nuevosSlotsEspecialista;\r\n              \r\n              // Preservar servicios por especialista\r\n              if (turnoActual.serviciosPorEspecialista && turnoActual.serviciosPorEspecialista[especialistaId]) {\r\n                nuevosServiciosPorEspecialista[especialistaId] = turnoActual.serviciosPorEspecialista[especialistaId];\r\n              }\r\n              \r\n              console.log(` Especialista ${especialistaId}: ${slotsOriginales[0]}  ${nuevoPrimerSlot}`);\r\n            }\r\n          });\r\n          \r\n          // Calcular nuevo horario de fin\r\n          const horaFinGlobal = Math.floor(horarioFinGlobal / 60);\r\n          const minutoFinGlobal = horarioFinGlobal % 60;\r\n          const nuevoHorarioFin = `${horaFinGlobal.toString().padStart(2, '0')}:${minutoFinGlobal.toString().padStart(2, '0')}`;\r\n          \r\n          // Eliminar duplicados y ordenar slots\r\n          todosLosSlots = [...new Set(todosLosSlots)].sort();\r\n          \r\n          turnoActualizado.slotsPorEspecialista = nuevosSlotsPorEspecialista;\r\n          turnoActualizado.slotsOcupados = todosLosSlots;\r\n          turnoActualizado.horarioFin = nuevoHorarioFin;\r\n          \r\n          if (Object.keys(nuevosServiciosPorEspecialista).length > 0) {\r\n            turnoActualizado.serviciosPorEspecialista = nuevosServiciosPorEspecialista;\r\n          }\r\n          \r\n          console.log(' Slots actualizados para mltiples especialistas:', nuevosSlotsPorEspecialista);\r\n          console.log(' Nuevo horario fin:', nuevoHorarioFin);\r\n          \r\n        } else {\r\n          // COMPORTAMIENTO ORIGINAL PARA UN SOLO ESPECIALISTA\r\n          const duracionTotal = turnoActual.duracionTotal || 30;\r\n          \r\n          // Convertir horario a minutos para calcular fin\r\n          const [hora, minuto] = nuevoHorario.split(':').map(Number);\r\n          const inicioMinutos = hora * 60 + minuto;\r\n          const finMinutos = inicioMinutos + duracionTotal;\r\n          const horaFin = Math.floor(finMinutos / 60).toString().padStart(2, '0');\r\n          const minutoFin = (finMinutos % 60).toString().padStart(2, '0');\r\n          const nuevoHorarioFin = `${horaFin}:${minutoFin}`;\r\n\r\n          // Calcular nuevos slots ocupados\r\n          const nuevosSlotsOcupados = [];\r\n          for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const horaSlot = Math.floor(min / 60);\r\n            const minutoSlot = min % 60;\r\n            nuevosSlotsOcupados.push(`${horaSlot.toString().padStart(2, '0')}:${minutoSlot.toString().padStart(2, '0')}`);\r\n          }\r\n\r\n          turnoActualizado.horarioFin = nuevoHorarioFin;\r\n          turnoActualizado.slotsOcupados = nuevosSlotsOcupados;\r\n          \r\n          // Actualizar slots por especialista si existe\r\n          if (turnoActual.slotsPorEspecialista) {\r\n            const nuevosSlotsPorEspecialista = {};\r\n            Object.keys(turnoActual.slotsPorEspecialista).forEach(especialistaId => {\r\n              nuevosSlotsPorEspecialista[especialistaId] = nuevosSlotsOcupados;\r\n            });\r\n            turnoActualizado.slotsPorEspecialista = nuevosSlotsPorEspecialista;\r\n          }\r\n        }\r\n\r\n        // VERIFICAR DISPONIBILIDAD COMPLETA (no por slots individuales)\r\n        const disponibilidad = await verificarDisponibilidadCompleta(turnoActualizado, turnoActual, currentTurnoId);\r\n        if (!disponibilidad.disponible) {\r\n          alert(disponibilidad.mensaje);\r\n          return;\r\n        }\r\n\r\n        console.log(' Actualizando turno:', currentTurnoId, 'con:', turnoActualizado);\r\n        \r\n        // ACTUALIZAR EN FIRESTORE\r\n        await db.collection('turnos').doc(currentTurnoId).update(turnoActualizado);\r\n        console.log(' Turno actualizado en Firestore');\r\n        \r\n        // ACTUALIZAR VISTAS\r\n        await loadTurnosForDate(nuevaFecha);\r\n\r\n        if (calendar) {\r\n          //  SOLUCIN MEJORADA: Forzar recarga completa de la vista actual\r\n          await recargarVistaCalendario();\r\n        }\r\n        \r\n        if (calendar) {\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n        // Cerrar modal\r\n        elements.modalEditar.style.display = 'none';\r\n        \r\n        mostrarMensajeExito('Turno actualizado correctamente');\r\n        \r\n      } catch (error) {\r\n        console.error(\" Error actualizando turno:\", error);\r\n        alert(\"Error al actualizar el turno: \" + error.message);\r\n      }\r\n    }\r\n\r\n    async function eliminarTurno(turnoId) {\r\n      // Validacin mejorada del ID\r\n      if (!turnoId || typeof turnoId !== 'string') {\r\n        console.error('ID de turno invlido:', turnoId);\r\n        return false;\r\n      }\r\n\r\n      try {\r\n        console.log(' Iniciando eliminacin para ID:', turnoId);\r\n        \r\n        // Obtener la fecha del turno antes de eliminarlo\r\n        const doc = await db.collection('turnos').doc(turnoId).get();\r\n        if (!doc.exists) {\r\n          alert('El turno ya no existe');\r\n          return false;\r\n        }\r\n        \r\n        const turnoData = doc.data();\r\n        const fechaTurno = turnoData.fecha;\r\n        \r\n        console.log(' Datos del turno a eliminar:', turnoData);\r\n        \r\n        // Eliminar el documento\r\n        await db.collection('turnos').doc(turnoId).delete();\r\n        console.log(' Turno eliminado de Firestore');\r\n        \r\n        // Actualizar la vista del calendario\r\n        if (calendar) {\r\n          console.log(' Actualizando calendario...');\r\n          calendar.refetchEvents();\r\n        }\r\n        \r\n        // Actualizar la lista de turnos\r\n        console.log(' Actualizando lista de turnos para fecha:', fechaTurno);\r\n        await loadTurnosForDate(fechaTurno);\r\n        \r\n        // Cerrar modal si est abierto\r\n        if (elements.modalEditar && elements.modalEditar.style.display === 'block') {\r\n          elements.modalEditar.style.display = 'none';\r\n          console.log(' Modal cerrado');\r\n        }\r\n        \r\n        // Mostrar mensaje de xito\r\n        mostrarMensajeExito('Turno eliminado correctamente');\r\n        \r\n        return true;\r\n      } catch (error) {\r\n        console.error(' Error al eliminar:', error);\r\n        \r\n        // Mensajes de error ms especficos\r\n        let mensajeError = 'Error al eliminar el turno';\r\n        if (error.code === 'permission-denied') {\r\n          mensajeError = 'No tienes permisos para eliminar turnos';\r\n        } else if (error.code === 'not-found') {\r\n          mensajeError = 'El turno ya no existe';\r\n        }\r\n        \r\n        alert(mensajeError + ': ' + (error.message || 'Por favor intente nuevamente'));\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 10. FUNCIONES DE SERVICIOS Y UTILIDADES\r\n    // =============================================\r\n    function obtenerNombresServicios(serviciosIds) {\r\n      if (!Array.isArray(serviciosIds) || serviciosIds.length === 0) {\r\n        return 'Servicios no especificados';\r\n      }\r\n      \r\n      const nombres = serviciosIds.map(servicioId => {\r\n        const servicio = serviciosMap[servicioId];\r\n        return servicio ? servicio.nombre : servicioId; // Si no encuentra, muestra el ID\r\n      });\r\n      \r\n      return nombres.join(', ');\r\n    }\r\n\r\n    function setupModalEvents() {\r\n      const modal = document.getElementById('modal-editar');\r\n      const btnEliminar = document.getElementById('btn-eliminar-modal');\r\n      \r\n      if (btnEliminar) {\r\n        // Limpiar eventos previos completamente\r\n        btnEliminar.replaceWith(btnEliminar.cloneNode(true));\r\n        const newBtnEliminar = document.getElementById('btn-eliminar-modal');\r\n        \r\n        newBtnEliminar.addEventListener('click', async (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          \r\n          console.log(' Botn eliminar clickeado, currentTurnoId:', currentTurnoId);\r\n          \r\n          if (!currentTurnoId) {\r\n            console.error(' No hay turno seleccionado para eliminar');\r\n            alert('No hay turno seleccionado para eliminar');\r\n            return;\r\n          }\r\n\r\n          if (confirm('Ests seguro de eliminar este turno permanentemente? Esta accin no se puede deshacer.')) {\r\n            console.log(' Confirmacin recibida, eliminando turno:', currentTurnoId);\r\n            \r\n            const loadingIndicator = mostrarLoading();\r\n            try {\r\n              const success = await eliminarTurno(currentTurnoId);\r\n              if (success) {\r\n                console.log(' Eliminacin completada exitosamente');\r\n                // El modal se cierra dentro de eliminarTurno\r\n              } else {\r\n                console.error(' Eliminacin fall');\r\n              }\r\n            } catch (error) {\r\n              console.error(' Error en eliminacin:', error);\r\n            } finally {\r\n              loadingIndicator.remove();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // =============================================\r\n    // 11. INICIALIZACIN DE NAVEGACIN (al final)\r\n    // =============================================\r\n    document.addEventListener('DOMContentLoaded', function() {\r\n        // Inicializar despus de un pequeo delay para asegurar que todo est cargado\r\n        setTimeout(() => {\r\n            inicializarNavegacionAdmin();\r\n        }, 100);\r\n    });\r\n\r\n    window.addEventListener('load', inicializarNavegacionCuandoPanelListo);\r\n\r\n    // =============================================\r\n    // 12. FUNCIONES DE GESTIN DE SERVICIOS\r\n    // =============================================\r\n\r\n    let categoriasMap = {};\r\n\r\n    // Inicializar gestin de servicios\r\n    function inicializarGestionServicios() {\r\n        console.log(' Inicializando gestin de servicios...');\r\n        \r\n        // Configurar evento del botn agregar servicio\r\n        const btnAgregarServicio = document.getElementById('btn-agregar-servicio');\r\n        if (btnAgregarServicio) {\r\n            btnAgregarServicio.addEventListener('click', () => {\r\n                abrirModalServicio();\r\n            });\r\n        }\r\n        \r\n        // Cargar servicios y categoras\r\n        cargarServiciosYMostrar();\r\n        \r\n        // Configurar modal de servicio\r\n        configurarModalServicio();\r\n    }\r\n\r\n    // Cargar servicios y categoras desde Firestore\r\n    async function cargarServiciosYMostrar() {\r\n        try {\r\n            console.log(' Cargando servicios y categoras...');\r\n            \r\n            // Cargar en paralelo\r\n            const [serviciosSnapshot, categoriasSnapshot] = await Promise.all([\r\n                db.collection('servicios').orderBy('orden').get(),\r\n                db.collection('categorias').orderBy('orden').get()\r\n            ]);\r\n            \r\n            // Mapear categoras\r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            // Mapear servicios - USAR EL ID DEL DOCUMENTO\r\n            serviciosMap = {};\r\n            serviciosSnapshot.forEach(doc => {\r\n                serviciosMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Cargados ${serviciosSnapshot.size} servicios y ${categoriasSnapshot.size} categoras`);\r\n            console.log(' IDs de servicios:', Object.keys(serviciosMap));\r\n            \r\n            // Mostrar en la interfaz\r\n            mostrarServiciosEnUI();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando servicios:', error);\r\n            mostrarMensajeError('Error al cargar los servicios');\r\n        }\r\n    }\r\n\r\n    // Mostrar servicios agrupados por categora en la UI\r\n    function mostrarServiciosEnUI() {\r\n        const serviciosList = document.getElementById('servicios-list');\r\n        if (!serviciosList) return;\r\n        \r\n        // Agrupar servicios por categora\r\n        const serviciosPorCategoria = {};\r\n        \r\n        Object.values(serviciosMap).forEach(servicio => {\r\n            const categoriaId = servicio.categoriaId;\r\n            if (!serviciosPorCategoria[categoriaId]) {\r\n                serviciosPorCategoria[categoriaId] = [];\r\n            }\r\n            serviciosPorCategoria[categoriaId].push(servicio);\r\n        });\r\n        \r\n        // Crear HTML\r\n        let html = '';\r\n        \r\n        Object.keys(categoriasMap).forEach(categoriaId => {\r\n            const categoria = categoriasMap[categoriaId];\r\n            const servicios = serviciosPorCategoria[categoriaId] || [];\r\n            \r\n            if (servicios.length === 0) return; // No mostrar categoras vacas\r\n            \r\n            html += `\r\n                <div class=\"categoria\">\r\n                    <h2>${categoria.nombre}</h2>\r\n                    <div class=\"servicios\">\r\n                        ${servicios.map(servicio => crearHTMLServicio(servicio)).join('')}\r\n                    </div>\r\n                </div>\r\n            `;\r\n        });\r\n        \r\n        serviciosList.innerHTML = html || '<p class=\"sin-servicios\">No hay servicios cargados</p>';\r\n        \r\n        // Configurar eventos de los botones\r\n        configurarEventosServicios();\r\n    }\r\n\r\n    // Crear HTML para un servicio individual\r\n    function crearHTMLServicio(servicio) {\r\n        const precioFormateado = formatearPrecio(servicio.precio);\r\n        const duracionFormateada = formatearDuracionAdmin(servicio.duracion);\r\n        \r\n        return `\r\n            <div class=\"servicio\" data-servicio-id=\"${servicio.id}\">\r\n                <h3>${servicio.nombre}</h3>\r\n                \r\n                <div class=\"mediaq-servicio\">\r\n                    <p class=\"precio-servicio\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#3e843a\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2\" />\r\n                            <path d=\"M12 3v3m0 12v3\" />\r\n                        </svg>\r\n                        <span>${precioFormateado}</span>\r\n                    </p>\r\n\r\n                    <p class=\"duracion-servicio\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#667dc4\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                            <path d=\"M12 12h3.5\" />\r\n                            <path d=\"M12 7v5\" />\r\n                        </svg>\r\n                        <span>${duracionFormateada}</span>\r\n                    </p>\r\n\r\n                    <p class=\"activo-servicio\">\r\n                        <span>Activo:</span>\r\n                        ${servicio.activo ? \r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#35c522\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                                <path d=\"M9 12l2 2l4 -4\" />\r\n                            </svg>` :\r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#d71919\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M18 6l-12 12\" />\r\n                                <path d=\"M6 6l12 12\" />\r\n                            </svg>`\r\n                        }\r\n                    </p>\r\n                    \r\n                    <p class=\"promo-servicio\">\r\n                        <span>Promo:</span>\r\n                        ${servicio.promo ? \r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#9328a9ff\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1\" />\r\n                                <path d=\"M9 12l2 2l4 -4\" />\r\n                            </svg>` :\r\n                            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#d71919\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M18 6l-12 12\" />\r\n                                <path d=\"M6 6l12 12\" />\r\n                            </svg>`\r\n                        }\r\n                    </p>\r\n                </div>\r\n\r\n                <div class=\"acciones-servicio\">\r\n                    <button class=\"btn-editar-servicio\" data-servicio-id=\"${servicio.id}\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1\" />\r\n                            <path d=\"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z\" />\r\n                            <path d=\"M16 5l3 3\" />\r\n                        </svg>\r\n                    </button>\r\n\r\n                    <button class=\"btn-eliminar-servicio\" data-servicio-id=\"${servicio.id}\">\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                            <path d=\"M4 7l16 0\" />\r\n                            <path d=\"M10 11l0 6\" />\r\n                            <path d=\"M14 11l0 6\" />\r\n                            <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\" />\r\n                            <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\" />\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Configurar eventos para los botones de servicios\r\n    function configurarEventosServicios() {\r\n        // Botones editar\r\n        document.querySelectorAll('.btn-editar-servicio').forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                const servicioId = e.currentTarget.getAttribute('data-servicio-id');\r\n                abrirModalServicio(servicioId);\r\n            });\r\n        });\r\n        \r\n        // Botones eliminar\r\n        document.querySelectorAll('.btn-eliminar-servicio').forEach(btn => {\r\n            btn.addEventListener('click', async (e) => {\r\n                const servicioId = e.currentTarget.getAttribute('data-servicio-id');\r\n                await eliminarServicio(servicioId);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Configurar modal de servicio\r\n    function configurarModalServicio() {\r\n        const modal = document.getElementById('modal-servicio');\r\n        const form = document.getElementById('form-servicio');\r\n        const closeBtn = modal.querySelector('.close-modal');\r\n        \r\n        if (!modal || !form) return;\r\n        \r\n        // Cerrar modal\r\n        closeBtn.addEventListener('click', () => {\r\n            modal.style.display = 'none';\r\n        });\r\n        \r\n        // Cerrar al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === modal) {\r\n                modal.style.display = 'none';\r\n            }\r\n        });\r\n        \r\n        // Enviar formulario\r\n        form.addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n            await guardarServicio();\r\n        });\r\n        \r\n        // Cargar categoras en el select\r\n        cargarCategoriasEnSelect();\r\n    }\r\n\r\n    // Cargar categoras en el select del modal\r\n    async function cargarCategoriasEnSelect() {\r\n        const select = document.getElementById('servicio-categoria');\r\n        if (!select) {\r\n            console.error(' No se encontr el select de categoras');\r\n            return;\r\n        }\r\n        \r\n        // Si ya tenemos categoras cargadas, usarlas\r\n        if (Object.keys(categoriasMap).length > 0) {\r\n            console.log(' Usando categoras ya cargadas:', Object.keys(categoriasMap).length);\r\n            llenarSelectConCategorias(select);\r\n            return;\r\n        }\r\n        \r\n        // Si no hay categoras, cargarlas desde Firestore\r\n        try {\r\n            console.log(' Cargando categoras desde Firestore...');\r\n            const categoriasSnapshot = await db.collection('categorias').orderBy('orden').get();\r\n            \r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Categoras cargadas: ${categoriasSnapshot.size}`);\r\n            llenarSelectConCategorias(select);\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando categoras:', error);\r\n            select.innerHTML = '<option value=\"\">Error al cargar categoras</option>';\r\n        }\r\n    }\r\n\r\n    // Funcin auxiliar para llenar el select\r\n    function llenarSelectConCategorias(select) {\r\n        select.innerHTML = '<option value=\"\">Selecciona una categora</option>';\r\n        \r\n        Object.values(categoriasMap)\r\n            .sort((a, b) => (a.orden || 0) - (b.orden || 0))\r\n            .forEach(categoria => {\r\n                const option = document.createElement('option');\r\n                option.value = categoria.id;\r\n                option.textContent = categoria.nombre;\r\n                select.appendChild(option);\r\n            });\r\n        \r\n        console.log(` Select de categoras llenado con ${Object.keys(categoriasMap).length} opciones`);\r\n    }\r\n\r\n    // Abrir modal para crear/editar servicio\r\n    async function abrirModalServicio(servicioId = null) {\r\n        const modal = document.getElementById('modal-servicio');\r\n        const titulo = document.getElementById('modal-servicio-titulo');\r\n        const form = document.getElementById('form-servicio');\r\n        \r\n        if (!modal || !titulo || !form) return;\r\n        \r\n        // Resetear formulario PERO mantener las categoras cargadas\r\n        form.reset();\r\n        \r\n        // Asegurar que las categoras estn cargadas en el select\r\n        await cargarCategoriasEnSelect();\r\n        \r\n        if (servicioId) {\r\n            // Modo edicin\r\n            titulo.textContent = 'Editar Servicio';\r\n            document.getElementById('servicio-id').value = servicioId;\r\n            \r\n            const servicio = serviciosMap[servicioId];\r\n            if (servicio) {\r\n                document.getElementById('servicio-nombre').value = servicio.nombre || '';\r\n                document.getElementById('servicio-categoria').value = servicio.categoriaId || '';\r\n                document.getElementById('servicio-descripcion').value = servicio.descripcion || '';\r\n                document.getElementById('servicio-duracion').value = servicio.duracion || 30;\r\n                document.getElementById('servicio-precio').value = servicio.precio || '';\r\n                document.getElementById('servicio-activo').checked = servicio.activo !== false;\r\n                document.getElementById('servicio-promo').checked = servicio.promo === true; //  Campo promo\r\n                \r\n                console.log(` Campos establecidos para edicin - Promo: ${servicio.promo}`);\r\n            }\r\n        } else {\r\n            // Modo creacin\r\n            titulo.textContent = 'Crear Servicio';\r\n            document.getElementById('servicio-id').value = '';\r\n            document.getElementById('servicio-activo').checked = true;\r\n            document.getElementById('servicio-promo').checked = false; //  Promo false por defecto\r\n        }\r\n        \r\n        modal.style.display = 'block';\r\n    }\r\n\r\n    // Guardar servicio (crear o actualizar)\r\n    async function guardarServicio() {\r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            const servicioId = document.getElementById('servicio-id').value;\r\n            const servicioData = {\r\n                nombre: document.getElementById('servicio-nombre').value.trim(),\r\n                categoriaId: document.getElementById('servicio-categoria').value,\r\n                descripcion: document.getElementById('servicio-descripcion').value.trim(),\r\n                duracion: parseInt(document.getElementById('servicio-duracion').value),\r\n                precio: parseInt(document.getElementById('servicio-precio').value),\r\n                activo: document.getElementById('servicio-activo').checked,\r\n                promo: document.getElementById('servicio-promo').checked,\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            };\r\n            \r\n            // Validaciones bsicas\r\n            if (!servicioData.nombre) {\r\n                throw new Error('El nombre es obligatorio');\r\n            }\r\n            if (!servicioData.categoriaId) {\r\n                throw new Error('La categora es obligatoria');\r\n            }\r\n            if (isNaN(servicioData.duracion) || servicioData.duracion < 1) {\r\n                throw new Error('La duracin debe ser un nmero mayor a 0');\r\n            }\r\n            if (isNaN(servicioData.precio) || servicioData.precio < 0) {\r\n                throw new Error('El precio debe ser un nmero no negativo');\r\n            }\r\n            \r\n            if (servicioId) {\r\n                // Actualizar servicio existente\r\n                console.log(` Actualizando servicio: ${servicioId}`, servicioData);\r\n                await db.collection('servicios').doc(servicioId).update(servicioData);\r\n                mostrarMensajeExito('Servicio actualizado correctamente');\r\n            } else {\r\n                // Crear nuevo servicio CON ID PERSONALIZADO\r\n                const nuevoId = generarIdServicio(servicioData.nombre);\r\n                \r\n                // Verificar que el ID no exista\r\n                const idUnico = await verificarIdUnico('servicios', nuevoId);\r\n                if (!idUnico) {\r\n                    throw new Error(`Ya existe un servicio con un nombre similar. El ID \"${nuevoId}\" ya est en uso.`);\r\n                }\r\n                \r\n                servicioData.creadoEl = firebase.firestore.FieldValue.serverTimestamp();\r\n                servicioData.orden = Object.keys(serviciosMap).length + 1;\r\n                servicioData.id = nuevoId; // Tambin guardar el ID en los datos\r\n                \r\n                console.log(' Creando nuevo servicio con ID:', nuevoId, servicioData);\r\n                await db.collection('servicios').doc(nuevoId).set(servicioData);\r\n                mostrarMensajeExito('Servicio creado correctamente');\r\n            }\r\n            \r\n            // Recargar servicios\r\n            await cargarServiciosYMostrar();\r\n            \r\n            // Cerrar modal\r\n            document.getElementById('modal-servicio').style.display = 'none';\r\n            \r\n        } catch (error) {\r\n            console.error(' Error guardando servicio:', error);\r\n            mostrarMensajeError(error.message || 'Error al guardar el servicio');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Eliminar servicio\r\n    async function eliminarServicio(servicioId) {\r\n        if (!servicioId) return;\r\n        \r\n        const servicio = serviciosMap[servicioId];\r\n        if (!servicio) return;\r\n        \r\n        if (!confirm(`Ests seguro de eliminar el servicio \"${servicio.nombre}\"? Esta accin no se puede deshacer.`)) {\r\n            return;\r\n        }\r\n        \r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            await db.collection('servicios').doc(servicioId).delete();\r\n            mostrarMensajeExito('Servicio eliminado correctamente');\r\n            \r\n            // Recargar servicios\r\n            await cargarServiciosYMostrar();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error eliminando servicio:', error);\r\n            mostrarMensajeError('Error al eliminar el servicio');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Funciones de utilidad para servicios\r\n    function formatearPrecio(precio) {\r\n        // Formatear sin decimales y con separador de miles\r\n        return new Intl.NumberFormat('es-AR', {\r\n            minimumFractionDigits: 0,\r\n            maximumFractionDigits: 0\r\n        }).format(precio);\r\n    }\r\n\r\n    function formatearDuracionAdmin(minutos) {\r\n        const horas = Math.floor(minutos / 60);\r\n        const mins = minutos % 60;\r\n        \r\n        if (horas === 0) {\r\n            // Menos de 1 hora: \"30 min\"\r\n            return `${minutos} min`;\r\n        } else if (mins === 0) {\r\n            // Horas exactas: \"1 hora\", \"2 horas\"\r\n            return `${horas} ${horas === 1 ? 'hora' : 'horas'}`;\r\n        } else {\r\n            // Horas y minutos: \"1 h 30 m\", \"2 h 30 m\"\r\n            return `${horas} h ${mins} m`;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // 15. FUNCIONES DE GESTIN DE PERSONAL\r\n    // =============================================\r\n\r\n    // Variables globales para personal\r\n    let personalMap = {};\r\n\r\n    // Inicializar gestin de personal\r\n    function inicializarGestionPersonal() {\r\n        console.log(' Inicializando gestin de personal...');\r\n        \r\n        // Configurar evento del botn agregar personal\r\n        const btnAgregarPersonal = document.getElementById('btn-agregar-personal');\r\n        if (btnAgregarPersonal) {\r\n            btnAgregarPersonal.addEventListener('click', () => {\r\n                abrirModalPersonal();\r\n            });\r\n        }\r\n        \r\n        // Cargar personal\r\n        cargarPersonalYMostrar();\r\n        \r\n        // Configurar modal de personal\r\n        configurarModalPersonal();\r\n    }\r\n\r\n    // Cargar personal desde Firestore\r\n    async function cargarPersonalYMostrar() {\r\n        try {\r\n            console.log(' Cargando personal...');\r\n            \r\n            const personalSnapshot = await db.collection('especialistas')\r\n                .where('activo', '==', true)\r\n                .orderBy('orden')\r\n                .get();\r\n            \r\n            personalMap = {};\r\n            personalSnapshot.forEach(doc => {\r\n                personalMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            console.log(` Cargados ${personalSnapshot.size} especialistas`);\r\n            console.log(' IDs de personal:', Object.keys(personalMap));\r\n            \r\n            // Mostrar en la interfaz\r\n            mostrarPersonalEnUI();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando personal:', error);\r\n            mostrarMensajeError('Error al cargar el personal');\r\n        }\r\n    }\r\n\r\n    // Mostrar personal en la UI\r\n    function mostrarPersonalEnUI() {\r\n        const personalList = document.getElementById('personal-list');\r\n        if (!personalList) return;\r\n        \r\n        if (Object.keys(personalMap).length === 0) {\r\n            personalList.innerHTML = '<p class=\"sin-personal\">No hay personal cargado</p>';\r\n            return;\r\n        }\r\n        \r\n        let html = '';\r\n        \r\n        Object.values(personalMap).forEach(personal => {\r\n            html += crearHTMLPersonal(personal);\r\n        });\r\n        \r\n        personalList.innerHTML = html;\r\n        \r\n        // Configurar eventos de los botones\r\n        configurarEventosPersonal();\r\n    }\r\n\r\n    // Crear HTML para un miembro del personal\r\n    function crearHTMLPersonal(personal) {\r\n        const diasLaborales = obtenerDiasLaborales(personal.horarioLaboral);\r\n        \r\n        return `\r\n            <div class=\"personal\" data-personal-id=\"${personal.id}\">\r\n                <div class=\"personal-identidad\">\r\n                    <img src=\"${personal.fotoUrl || ''}\" alt=\"Imagen del Empleado\" onerror=\"this.style.display='none'\">\r\n                    <h3>${personal.nombre}</h3>\r\n                </div>\r\n\r\n                <div class=\"contenedor-datos-personal\">\r\n                    <div class=\"contenedor-centro-datos\">\r\n                        <div class=\"personal-datos\">\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2\" />\r\n                                </svg>\r\n                                <span>${personal.telefono || 'No especificado'}</span>\r\n                            </p>\r\n\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z\" />\r\n                                    <path d=\"M3 7l9 6l9 -6\" />\r\n                                </svg>\r\n                                <span>${personal.email || 'No especificado'}</span>\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div class=\"personal-disponibilidad\">\r\n                            <p>\r\n                                <span>Activo:</span>\r\n                                ${personal.activo ? \r\n                                    `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                        <path d=\"M5 12l5 5l10 -10\" />\r\n                                    </svg>` :\r\n                                    `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                        <path d=\"M18 6l-12 12\" />\r\n                                        <path d=\"M6 6l12 12\" />\r\n                                    </svg>`\r\n                                }\r\n                            </p>\r\n\r\n                            <p>\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                    <path d=\"M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z\" />\r\n                                    <path d=\"M16 3v4\" />\r\n                                    <path d=\"M8 3v4\" />\r\n                                    <path d=\"M4 11h16\" />\r\n                                    <path d=\"M7 14h.013\" />\r\n                                    <path d=\"M10.01 14h.005\" />\r\n                                    <path d=\"M13.01 14h.005\" />\r\n                                    <path d=\"M16.015 14h.005\" />\r\n                                    <path d=\"M13.015 17h.005\" />\r\n                                    <path d=\"M7.01 17h.005\" />\r\n                                    <path d=\"M10.01 17h.005\" />\r\n                                </svg>\r\n                                <span>${diasLaborales}</span>\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class=\"acciones-personal\">\r\n                        <button class=\"btn-editar-personal\" data-personal-id=\"${personal.id}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1\" />\r\n                                <path d=\"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z\" />\r\n                                <path d=\"M16 5l3 3\" />\r\n                            </svg>\r\n                        </button>\r\n    \r\n                        <button class=\"btn-eliminar-personal\" data-personal-id=\"${personal.id}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#020202\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"M4 7l16 0\" />\r\n                                <path d=\"M10 11l0 6\" />\r\n                                <path d=\"M14 11l0 6\" />\r\n                                <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\" />\r\n                                <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Obtener das laborales formateados\r\n    function obtenerDiasLaborales(horarioLaboral) {\r\n        if (!horarioLaboral) return 'No definido';\r\n        \r\n        const dias = {\r\n            lunes: 'L',\r\n            martes: 'M',\r\n            miercoles: 'M',\r\n            jueves: 'J',\r\n            viernes: 'V',\r\n            sabado: 'S',\r\n            domingo: 'D'\r\n        };\r\n        \r\n        const diasActivos = [];\r\n        \r\n        for (const [dia, config] of Object.entries(horarioLaboral)) {\r\n            if (config && config.activo) {\r\n                diasActivos.push(dias[dia] || dia.charAt(0).toUpperCase());\r\n            }\r\n        }\r\n        \r\n        return diasActivos.join(' - ') || 'No definido';\r\n    }\r\n\r\n    // Configurar eventos para los botones de personal\r\n    function configurarEventosPersonal() {\r\n        // Botones editar\r\n        document.querySelectorAll('.btn-editar-personal').forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                const personalId = e.currentTarget.getAttribute('data-personal-id');\r\n                abrirModalPersonal(personalId);\r\n            });\r\n        });\r\n        \r\n        // Botones eliminar\r\n        document.querySelectorAll('.btn-eliminar-personal').forEach(btn => {\r\n            btn.addEventListener('click', async (e) => {\r\n                const personalId = e.currentTarget.getAttribute('data-personal-id');\r\n                await eliminarPersonal(personalId);\r\n            });\r\n        });\r\n    }\r\n\r\n    // Configurar modal de personal\r\n    function configurarModalPersonal() {\r\n        const modal = document.getElementById('modal-personal');\r\n        const form = document.getElementById('form-personal');\r\n        const closeBtn = modal.querySelector('.close-modal');\r\n        \r\n        if (!modal || !form) return;\r\n        \r\n        // Cerrar modal\r\n        closeBtn.addEventListener('click', () => {\r\n            modal.style.display = 'none';\r\n        });\r\n        \r\n        // Cerrar al hacer click fuera\r\n        window.addEventListener('click', (e) => {\r\n            if (e.target === modal) {\r\n                modal.style.display = 'none';\r\n            }\r\n        });\r\n        \r\n        // Enviar formulario\r\n        form.addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n            await guardarPersonal();\r\n        });\r\n        \r\n        // Cargar checkboxes de categoras\r\n        cargarCategoriasCheckboxesPersonal();\r\n        \r\n        //  CONFIGURAR UPLOADER DE IMAGEN\r\n        configurarUploaderImagen();\r\n    }\r\n\r\n    // Cargar categoras en checkboxs de personal\r\n    async function cargarCategoriasCheckboxesPersonal() {\r\n        const contenedorCheckboxes = document.getElementById('personal-categorias-checkboxes');\r\n        if (!contenedorCheckboxes) {\r\n            console.error(' No se encontr el contenedor de checkboxes de categoras');\r\n            return;\r\n        }\r\n        \r\n        // Limpiar contenedor\r\n        contenedorCheckboxes.innerHTML = '';\r\n        \r\n        // Si ya tenemos categoras cargadas, usarlas\r\n        if (Object.keys(categoriasMap).length > 0) {\r\n            llenarCheckboxesConCategorias(contenedorCheckboxes);\r\n            return;\r\n        }\r\n        \r\n        // Si no hay categoras, cargarlas desde Firestore\r\n        try {\r\n            const categoriasSnapshot = await db.collection('categorias').orderBy('orden').get();\r\n            \r\n            categoriasMap = {};\r\n            categoriasSnapshot.forEach(doc => {\r\n                categoriasMap[doc.id] = { id: doc.id, ...doc.data() };\r\n            });\r\n            \r\n            llenarCheckboxesConCategorias(contenedorCheckboxes);\r\n            \r\n        } catch (error) {\r\n            console.error(' Error cargando categoras para personal:', error);\r\n            contenedorCheckboxes.innerHTML = '<p>Error al cargar categoras</p>';\r\n        }\r\n    }\r\n\r\n    // Llenar checkboxes con categoras\r\n    function llenarCheckboxesConCategorias(contenedor) {\r\n        const categoriasOrdenadas = Object.values(categoriasMap)\r\n            .sort((a, b) => (a.orden || 0) - (b.orden || 0));\r\n        \r\n        if (categoriasOrdenadas.length === 0) {\r\n            contenedor.innerHTML = '<p>No hay categoras disponibles</p>';\r\n            return;\r\n        }\r\n        \r\n        let html = '<div class=\"categorias-checkboxes-grid\">';\r\n        \r\n        categoriasOrdenadas.forEach(categoria => {\r\n            html += `\r\n                <div class=\"checkbox-categoria-item\">\r\n                    <label class=\"checkbox-categoria-label\">\r\n                        <input type=\"checkbox\" \r\n                              name=\"personal-categorias\" \r\n                              value=\"${categoria.id}\" \r\n                              class=\"checkbox-categoria\">\r\n                        <span class=\"checkbox-custom\"></span>\r\n                        <span class=\"checkbox-text\">${categoria.nombre}</span>\r\n                    </label>\r\n                </div>\r\n            `;\r\n        });\r\n        \r\n        html += '</div>';\r\n        contenedor.innerHTML = html;\r\n        \r\n        console.log(` Checkboxes de categoras creados: ${categoriasOrdenadas.length} opciones`);\r\n    }\r\n\r\n    // Abrir modal para crear/editar personal\r\n    async function abrirModalPersonal(personalId = null) {\r\n        const modal = document.getElementById('modal-personal');\r\n        const titulo = document.getElementById('modal-personal-titulo');\r\n        const form = document.getElementById('form-personal');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const previewImg = document.getElementById('personal-foto-preview-img');\r\n        const uploadLabel = document.querySelector('.file-upload-label');\r\n        \r\n        if (!modal || !titulo || !form) return;\r\n        \r\n        // Resetear formulario\r\n        resetearFormularioPersonal();\r\n        \r\n        // Asegurar que las categoras estn cargadas en los checkboxes\r\n        await cargarCategoriasCheckboxesPersonal();\r\n        \r\n        if (personalId) {\r\n            // Modo edicin\r\n            titulo.textContent = 'Editar Personal';\r\n            document.getElementById('personal-id').value = personalId;\r\n            \r\n            const personal = personalMap[personalId];\r\n            if (personal) {\r\n                // Llenar campos bsicos\r\n                document.getElementById('personal-nombre').value = personal.nombre || '';\r\n                document.getElementById('personal-telefono').value = personal.telefono || '';\r\n                document.getElementById('personal-email').value = personal.email || '';\r\n                document.getElementById('personal-duracion').value = personal.duracionTurnoBase || 30;\r\n                document.getElementById('personal-activo').checked = personal.activo !== false;\r\n                \r\n                // Mostrar imagen existente si hay una\r\n                if (personal.fotoUrl) {\r\n                    previewImg.src = personal.fotoUrl;\r\n                    filePreview.style.display = 'block';\r\n                    uploadLabel.style.display = 'none';\r\n                    document.getElementById('personal-foto-url').value = personal.fotoUrl;\r\n                }\r\n                \r\n                // Establecer categoras\r\n                if (personal.categoriasId) {\r\n                    establecerCategoriasSeleccionadas(personal.categoriasId);\r\n                }\r\n                \r\n                // Establecer horario laboral\r\n                if (personal.horarioLaboral) {\r\n                    establecerHorarioLaboral(personal.horarioLaboral);\r\n                }\r\n            }\r\n        } else {\r\n            // Modo creacin\r\n            titulo.textContent = 'Crear Personal';\r\n            document.getElementById('personal-id').value = '';\r\n            document.getElementById('personal-activo').checked = true;\r\n            document.getElementById('personal-duracion').value = 30;\r\n            \r\n            // Limpiar checkboxes\r\n            const checkboxes = document.querySelectorAll('.checkbox-categoria');\r\n            checkboxes.forEach(checkbox => {\r\n                checkbox.checked = false;\r\n            });\r\n            \r\n            // Establecer horario laboral por defecto\r\n            const horarioPorDefecto = {\r\n                lunes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                martes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                miercoles: { inicio: '09:00', fin: '20:00', activo: true },\r\n                jueves: { inicio: '09:00', fin: '20:00', activo: true },\r\n                viernes: { inicio: '09:00', fin: '20:00', activo: true },\r\n                sabado: { inicio: '09:00', fin: '20:00', activo: false },\r\n                domingo: { inicio: '09:00', fin: '20:00', activo: false }\r\n            };\r\n            establecerHorarioLaboral(horarioPorDefecto);\r\n        }\r\n        \r\n        modal.style.display = 'block';\r\n    }\r\n\r\n    // Establecer horario laboral en el formulario\r\n    function establecerHorarioLaboral(horarioLaboral) {\r\n        const dias = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'];\r\n        \r\n        dias.forEach(dia => {\r\n            const config = horarioLaboral[dia];\r\n            const activoCheckbox = document.getElementById(`personal-${dia}-activo`);\r\n            const inicioInput = document.getElementById(`personal-${dia}-inicio`);\r\n            const finInput = document.getElementById(`personal-${dia}-fin`);\r\n            \r\n            if (activoCheckbox && inicioInput && finInput) {\r\n                if (config && config.activo) {\r\n                    activoCheckbox.checked = true;\r\n                    inicioInput.value = config.inicio || '09:00';\r\n                    finInput.value = config.fin || '18:00';\r\n                } else {\r\n                    activoCheckbox.checked = false;\r\n                    inicioInput.value = '09:00';\r\n                    finInput.value = '18:00';\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Guardar personal (crear o actualizar)\r\n    async function guardarPersonal() {\r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            const personalId = document.getElementById('personal-id').value;\r\n            const fileInput = document.getElementById('personal-foto-file');\r\n            const archivoImagen = fileInput.files[0];\r\n            const fotoUrlExistente = document.getElementById('personal-foto-url').value;\r\n            \r\n            const personalData = {\r\n                nombre: document.getElementById('personal-nombre').value.trim(),\r\n                telefono: document.getElementById('personal-telefono').value.trim(),\r\n                email: document.getElementById('personal-email').value.trim(),\r\n                duracionTurnoBase: parseInt(document.getElementById('personal-duracion').value),\r\n                activo: document.getElementById('personal-activo').checked,\r\n                categoriasId: obtenerCategoriasSeleccionadas(),\r\n                horarioLaboral: obtenerHorarioLaboralFromForm(),\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            };\r\n            \r\n            // Validaciones bsicas\r\n            if (!personalData.nombre) {\r\n                throw new Error('El nombre es obligatorio');\r\n            }\r\n            if (personalData.duracionTurnoBase < 1) {\r\n                throw new Error('La duracin del turno debe ser mayor a 0');\r\n            }\r\n            \r\n            let nuevoId = personalId;\r\n            \r\n            if (personalId) {\r\n                // Modo edicin - manejar imagen\r\n                if (archivoImagen) {\r\n                    // Subir nueva imagen\r\n                    personalData.fotoUrl = await subirImagenPersonal(archivoImagen, personalId);\r\n                } else if (fotoUrlExistente) {\r\n                    // Mantener imagen existente\r\n                    personalData.fotoUrl = fotoUrlExistente;\r\n                } else {\r\n                    // Eliminar imagen si no hay ninguna\r\n                    personalData.fotoUrl = '';\r\n                }\r\n                \r\n                await db.collection('especialistas').doc(personalId).update(personalData);\r\n                mostrarMensajeExito('Personal actualizado correctamente');\r\n                \r\n            } else {\r\n                // Modo creacin\r\n                nuevoId = generarIdPersonal(personalData.nombre);\r\n                \r\n                // Verificar que el ID no exista\r\n                const idUnico = await verificarIdUnico('especialistas', nuevoId);\r\n                if (!idUnico) {\r\n                    throw new Error(`Ya existe un especialista con un nombre similar. El ID \"${nuevoId}\" ya est en uso.`);\r\n                }\r\n                \r\n                // Subir imagen si se proporcion\r\n                if (archivoImagen) {\r\n                    personalData.fotoUrl = await subirImagenPersonal(archivoImagen, nuevoId);\r\n                } else {\r\n                    personalData.fotoUrl = '';\r\n                }\r\n                \r\n                personalData.creadoEl = firebase.firestore.FieldValue.serverTimestamp();\r\n                personalData.orden = Object.keys(personalMap).length + 1;\r\n                personalData.id = nuevoId;\r\n                \r\n                await db.collection('especialistas').doc(nuevoId).set(personalData);\r\n                mostrarMensajeExito('Personal creado correctamente');\r\n            }\r\n            \r\n            // Recargar personal\r\n            await cargarPersonalYMostrar();\r\n            \r\n            // Cerrar modal y resetear\r\n            document.getElementById('modal-personal').style.display = 'none';\r\n            resetearFormularioPersonal();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error guardando personal:', error);\r\n            mostrarMensajeError(error.message || 'Error al guardar el personal');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // Funcin para resetear el formulario de personal\r\n    function resetearFormularioPersonal() {\r\n        const form = document.getElementById('form-personal');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const uploadLabel = document.querySelector('.file-upload-label');\r\n        \r\n        form.reset();\r\n        filePreview.style.display = 'none';\r\n        uploadLabel.style.display = 'flex';\r\n        document.getElementById('personal-foto-url').value = '';\r\n    }\r\n\r\n    // Obtener categoras seleccionadas en checkboxs\r\n    function obtenerCategoriasSeleccionadas() {\r\n        const checkboxes = document.querySelectorAll('.checkbox-categoria:checked');\r\n        return Array.from(checkboxes).map(checkbox => checkbox.value);\r\n    }\r\n\r\n    // Establecer categoras seleccionadas al editar\r\n    function establecerCategoriasSeleccionadas(categoriasIds) {\r\n        if (!categoriasIds || !Array.isArray(categoriasIds)) return;\r\n        \r\n        const checkboxes = document.querySelectorAll('.checkbox-categoria');\r\n        checkboxes.forEach(checkbox => {\r\n            checkbox.checked = categoriasIds.includes(checkbox.value);\r\n        });\r\n    }\r\n\r\n    // Obtener horario laboral desde el formulario\r\n    function obtenerHorarioLaboralFromForm() {\r\n        const dias = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'];\r\n        const horarioLaboral = {};\r\n        \r\n        dias.forEach(dia => {\r\n            const activoCheckbox = document.getElementById(`personal-${dia}-activo`);\r\n            const inicioInput = document.getElementById(`personal-${dia}-inicio`);\r\n            const finInput = document.getElementById(`personal-${dia}-fin`);\r\n            \r\n            if (activoCheckbox && inicioInput && finInput) {\r\n                horarioLaboral[dia] = {\r\n                    activo: activoCheckbox.checked,\r\n                    inicio: inicioInput.value,\r\n                    fin: finInput.value\r\n                };\r\n            }\r\n        });\r\n        \r\n        return horarioLaboral;\r\n    }\r\n\r\n    // Eliminar personal (soft delete: establecer activo = false)\r\n    async function eliminarPersonal(personalId) {\r\n        if (!personalId) return;\r\n        \r\n        const personal = personalMap[personalId];\r\n        if (!personal) return;\r\n        \r\n        if (!confirm(`Ests seguro de eliminar a \"${personal.nombre}\"? Esta accin no se puede deshacer.`)) {\r\n            return;\r\n        }\r\n        \r\n        const loading = mostrarLoading();\r\n        \r\n        try {\r\n            // Soft delete: establecer activo = false\r\n            await db.collection('especialistas').doc(personalId).update({\r\n                activo: false,\r\n                actualizadoEl: firebase.firestore.FieldValue.serverTimestamp()\r\n            });\r\n            \r\n            mostrarMensajeExito('Personal eliminado correctamente');\r\n            \r\n            // Recargar personal\r\n            await cargarPersonalYMostrar();\r\n            \r\n        } catch (error) {\r\n            console.error(' Error eliminando personal:', error);\r\n            mostrarMensajeError('Error al eliminar el personal');\r\n        } finally {\r\n            loading.remove();\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // FUNCIONES PARA GENERAR IDs PERSONALIZADOS\r\n    // =============================================\r\n\r\n    // Funcin para normalizar texto para IDs\r\n    function normalizarParaId(texto) {\r\n        return texto\r\n            .toLowerCase()\r\n            .normalize(\"NFD\") // Separar acentos\r\n            .replace(/[\\u0300-\\u036f]/g, \"\") // Eliminar acentos\r\n            .replace(/[^a-z0-9]/g, \"_\") // Reemplazar caracteres no alfanumricos con _\r\n            .replace(/_+/g, \"_\") // Reemplazar mltiples _ por uno solo\r\n            .replace(/^_|_$/g, \"\"); // Eliminar _ al inicio y final\r\n    }\r\n\r\n    // Generar ID para servicio\r\n    function generarIdServicio(nombre) {\r\n        return `serv_${normalizarParaId(nombre)}`;\r\n    }\r\n\r\n    // Generar ID para personal\r\n    function generarIdPersonal(nombre) {\r\n        return `esp_${normalizarParaId(nombre)}`;\r\n    }\r\n\r\n    // Verificar si un ID ya existe en una coleccin\r\n    async function verificarIdUnico(coleccion, id) {\r\n        try {\r\n            const doc = await db.collection(coleccion).doc(id).get();\r\n            return !doc.exists;\r\n        } catch (error) {\r\n            console.error(`Error verificando ID ${id}:`, error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // =============================================\r\n    // FUNCIONES PARA SUBIDA DE ARCHIVOS A STORAGE\r\n    // =============================================\r\n\r\n    // Referencia al storage\r\n    const storage = firebase.storage();\r\n\r\n    // Funcin para subir imagen a Firebase Storage\r\n    async function subirImagenPersonal(archivo, personalId) {\r\n        try {\r\n            console.log(' Iniciando subida de imagen...', archivo.name);\r\n            \r\n            // Crear referencia nica en Storage\r\n            const extension = archivo.name.split('.').pop().toLowerCase();\r\n            const nombreArchivo = `especialistas/${personalId}_${Date.now()}.${extension}`;\r\n            const storageRef = storage.ref().child(nombreArchivo);\r\n            \r\n            // Subir el archivo\r\n            const snapshot = await storageRef.put(archivo);\r\n            \r\n            // Obtener URL de descarga\r\n            const downloadURL = await snapshot.ref.getDownloadURL();\r\n            \r\n            console.log(' Imagen subida correctamente:', downloadURL);\r\n            return downloadURL;\r\n            \r\n        } catch (error) {\r\n            console.error(' Error subiendo imagen:', error);\r\n            throw new Error('Error al subir la imagen: ' + error.message);\r\n        }\r\n    }\r\n\r\n    // Configurar el uploader de archivos\r\n    function configurarUploaderImagen() {\r\n        const fileInput = document.getElementById('personal-foto-file');\r\n        const filePreview = document.getElementById('personal-foto-preview');\r\n        const previewImg = document.getElementById('personal-foto-preview-img');\r\n        const removeBtn = document.getElementById('btn-remove-image');\r\n        const uploadContainer = document.querySelector('.file-upload-container');\r\n        const uploadLabel = uploadContainer.querySelector('.file-upload-label');\r\n        \r\n        if (!fileInput) return;\r\n        \r\n        // Manejar seleccin de archivo\r\n        fileInput.addEventListener('change', function(e) {\r\n            const archivo = e.target.files[0];\r\n            if (archivo) {\r\n                // Validar tipo de archivo\r\n                if (!archivo.type.startsWith('image/')) {\r\n                    mostrarMensajeError('Por favor selecciona un archivo de imagen vlido');\r\n                    return;\r\n                }\r\n                \r\n                // Validar tamao (2MB mximo)\r\n                if (archivo.size > 2 * 1024 * 1024) {\r\n                    mostrarMensajeError('La imagen es demasiado grande. Mximo 2MB permitido.');\r\n                    return;\r\n                }\r\n                \r\n                // Mostrar previsualizacin\r\n                const reader = new FileReader();\r\n                reader.onload = function(e) {\r\n                    previewImg.src = e.target.result;\r\n                    filePreview.style.display = 'block';\r\n                    uploadLabel.style.display = 'none';\r\n                };\r\n                reader.readAsDataURL(archivo);\r\n            }\r\n        });\r\n        \r\n        // Manejar eliminacin de imagen\r\n        removeBtn.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            \r\n            fileInput.value = '';\r\n            filePreview.style.display = 'none';\r\n            uploadLabel.style.display = 'flex';\r\n            document.getElementById('personal-foto-url').value = '';\r\n        });\r\n        \r\n        // Drag & drop functionality\r\n        uploadContainer.addEventListener('dragover', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.add('dragover');\r\n        });\r\n        \r\n        uploadContainer.addEventListener('dragleave', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.remove('dragover');\r\n        });\r\n        \r\n        uploadContainer.addEventListener('drop', function(e) {\r\n            e.preventDefault();\r\n            uploadContainer.classList.remove('dragover');\r\n            \r\n            const archivos = e.dataTransfer.files;\r\n            if (archivos.length > 0) {\r\n                fileInput.files = archivos;\r\n                fileInput.dispatchEvent(new Event('change'));\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    document.addEventListener('DOMContentLoaded', initAdmin);\r\n}","(() => {\r\n  window.enviarEmailConfirmacion = async (datosTurno) => {\r\n    try {\r\n      const emailData = {\r\n        senderName: window.brevoConfig.senderName,\r\n        senderEmail: window.brevoConfig.senderEmail,\r\n        to: [{ email: datosTurno.email, name: datosTurno.nombre }],\r\n        subject: `Confirmacin de turno - ${datosTurno.fecha} a las ${datosTurno.horario}`,\r\n        htmlContent: `\r\n          <!DOCTYPE html>\r\n          <html>\r\n          <head>\r\n              <style>\r\n                  body { font-family: 'Poppins', sans-serif; line-height: 1.6; color: #333; }\r\n                  .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n                  .header { background-color: #f8f1e9; padding: 20px; text-align: center; }\r\n                  .content { padding: 20px; }\r\n                  .footer { text-align: center; font-size: 12px; color: #777; margin-top: 20px; }\r\n                  .resumen { margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }\r\n                  .servicio { margin-bottom: 5px; }\r\n              </style>\r\n          </head>\r\n          <body>\r\n              <div class=\"container\">\r\n                  <div class=\"header\">\r\n                      <h2>DemoPro GestionTurno</h2>\r\n                      <p>Tu turno ha sido confirmado!</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"content\">\r\n                      <p>Hola <strong>${datosTurno.nombre}</strong>,</p>\r\n                      <p>Tu turno ha sido reservado con xito. A continuacin los detalles:</p>\r\n                      \r\n                      <div class=\"resumen\">\r\n                          <h3>Resumen de tu reserva</h3>\r\n                          <p><strong>Especialista(s):</strong> ${datosTurno.especialistas.join(', ')}</p>\r\n                          <p><strong>Fecha:</strong> ${datosTurno.fecha}</p>\r\n                          <p><strong>Hora:</strong> ${datosTurno.horario}</p>\r\n                          <p><strong>Servicios:</strong></p>\r\n                          <ul>\r\n                              ${datosTurno.servicios.map(s => `<li class=\"servicio\">${s}</li>`).join('')}\r\n                          </ul>\r\n                          <p><strong>Sea abonada:</strong> $${datosTurno.reserva.toLocaleString()}</p>\r\n                          <p><strong>A abonar en local:</strong> $${(datosTurno.montoTotal).toLocaleString()}</p>\r\n                      </div>\r\n                      \r\n                      <p>Si necesitas modificar o cancelar tu turno, por favor contctanos a: contacto@gestionturno.com</p>\r\n                  </div>\r\n                  \r\n                  <div class=\"footer\">\r\n                      <p> ${new Date().getFullYear()} DemoPro GestionTurno. Todos los derechos reservados.</p>\r\n                  </div>\r\n              </div>\r\n          </body>\r\n          </html>\r\n        `\r\n      };\r\n\r\n      // Opcional: enviar copia al admin\r\n      if (window.brevoConfig.adminEmail) {\r\n        emailData.bcc = [{ email: window.brevoConfig.adminEmail, name: 'Administrador DemoPro GestinTurno' }];\r\n      }\r\n\r\n      // Llamar a la Cloud Function\r\n      const enviarEmail = firebase.functions().httpsCallable('enviarEmailConfirmacion');\r\n      const resultado = await enviarEmail(emailData);\r\n      \r\n      return resultado.data.success;\r\n    } catch (error) {\r\n      console.error('Error en enviarEmailConfirmacion:', error);\r\n      return false;\r\n    }\r\n  };\r\n})();","\r\n// Variables globales\r\nlet pasoActual = 1;\r\nconst totalPasos = 5; // Ahora son 5 pasos antes de confirmacin\r\nlet datosReserva = {\r\n    servicios: [],\r\n    especialistas: [],\r\n    especialistaNombre: null,\r\n    categorias: [],\r\n    precios: {\r\n        \"Corte\": 15000,\r\n        \"Teido\": 40000,\r\n        \"Alisado\": 30000\r\n    },\r\n    duraciones: {\r\n        \"Corte\": 30,\r\n        \"Teido\": 30,\r\n        \"Alisado\": 30\r\n    },\r\n    reserva: 1000,\r\n    fecha: null,\r\n    horario: null,\r\n    nombre: null,\r\n    email: null,\r\n    telefono: null,\r\n    observacion: null\r\n};\r\nlet datosGenerales = {};\r\n\r\nlet mejorEspecialistaPorCategoria = {};\r\n\r\nlet fechaSeleccionada = null;\r\n\r\nlet calendarioFechaActual = new Date();\r\nlet fechasDisponiblesCalendario = [];\r\n\r\n// Variable global para almacenar coordenadas\r\nlet coordenadasLocal = null;\r\n\r\n// Elementos DOM\r\nconst elementos = {\r\n    progreso: document.getElementById('progreso'),\r\n    btnAnterior: document.querySelector('.btn-anterior'),\r\n    btnSiguiente: document.querySelector('.btn-siguiente'),\r\n    pasos: document.querySelectorAll('.paso'),\r\n    // Elementos de resumen\r\n    resumenNombre: document.getElementById('cliente-nombre'),\r\n    resumenEmail: document.getElementById('cliente-email'),\r\n    resumenTelefono: document.getElementById('cliente-telefono'),\r\n    resumenServicio: document.getElementById('servicio-seleccionado'),\r\n    resumenFecha: document.getElementById('fecha-seleccionado'), // Cambiado a fecha-seleccionado\r\n    resumenHorario: document.getElementById('horario-seleccionado'),\r\n    resumenObservacion: document.getElementById('observacion-texto'),\r\n    resumenEspecialistas: document.getElementById('especialistas-nombres'),\r\n\r\n    contenedorEspecialistas: document.querySelector('.contenedor-especialistas')\r\n};\r\n\r\nconst db = window.db || firebase.firestore();\r\n\r\n// Usar las referencias globales con validacin\r\nconst auth = window.firebaseAuth || {\r\n  onAuthStateChanged: () => console.warn('Auth no inicializado'),\r\n};\r\n\r\nif (!window.firestoreDB) {\r\n    console.error('Firestore no est disponible');\r\n  // Podras mostrar un mensaje al usuario o deshabilitar funcionalidad\r\n}\r\n\r\n// Prueba de conexin (puedes eliminar esto despus)\r\nasync function probarConexion() {\r\n    try {\r\n        // console.log(\"Probando conexin a Firestore...\");\r\n        \r\n        // 1. Obtener configuracin\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        // console.log(\"Configuracin obtenida:\", config);\r\n        \r\n        // 2. Obtener turnos de hoy\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        const turnos = await firestoreDB.obtenerTurnosPorFecha(hoy);\r\n        // console.log(`Turnos para hoy (${hoy}):`, turnos);\r\n        \r\n        // 3. Generar horarios disponibles para hoy\r\n        const horarios = await firestoreSeguro.generarHorariosDisponibles(hoy);\r\n        // console.log(\"Horarios disponibles hoy:\", horarios);\r\n    \r\n    } catch (error) {\r\n        console.error(\"Error en prueba de conexin:\", error);\r\n    }\r\n}\r\n\r\n// Inicializacin\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n  // Cargar configuracin primero\r\n  await cargarConfiguracion();\r\n\r\n  cargarDatosGenerales()\r\n\r\n  // Inicializar autenticacin\r\n  inicializarAuth();\r\n\r\n  // Verificar si hay usuario en LocalStorage\r\n  const usuarioLS = localStorage.getItem('usuario');\r\n  if (usuarioLS) {\r\n    const user = JSON.parse(usuarioLS);\r\n    // actualizarUIUsuario(user);\r\n  }\r\n\r\n  // Inicializar el acorden del men\r\n  inicializarAcordeonMenu();\r\n\r\n  // Inicializar cierre del men al hacer clic fuera (NUEVO)\r\n  inicializarCierreMenuOverlay();\r\n\r\n  if (document.querySelector('.contenedor-pasos')) {\r\n    inicializarEventos();\r\n    actualizarInterfaz();\r\n    inicializarAuth();\r\n    \r\n    // Cargar categoras y servicios con manejo de errores integrado\r\n    const [categorias, servicios] = await Promise.all([\r\n    firestoreSeguro.obtenerCategorias(),\r\n    firestoreSeguro.obtenerServicios()\r\n    ]);\r\n\r\n    // Filtrar datos invlidos\r\n    const categoriasValidas = Validador.filtrarInvalidos(categorias, 'categoria');\r\n    const serviciosValidos = Validador.filtrarInvalidos(servicios, 'servicio');\r\n\r\n    // Guardar en datosReserva solo si hay datos vlidos\r\n    if (categoriasValidas.length > 0) {\r\n    datosReserva.categorias = categoriasValidas;\r\n    } else {\r\n    ErrorHandler.mostrar(\"No se pudieron cargar las categoras vlidas\", \"warning\");\r\n    }\r\n\r\n    if (serviciosValidos.length > 0) {\r\n    datosReserva.serviciosDisponibles = serviciosValidos;\r\n    } else {\r\n    ErrorHandler.mostrar(\"No se pudieron cargar los servicios vlidos\", \"warning\");\r\n    }\r\n\r\n    // Actualizar UI con servicios organizados por categora\r\n    actualizarUIServicios(categoriasValidas, serviciosValidos);\r\n    }\r\n\r\n    datosGenerales = await firestoreSeguro.obtenerConfigGeneral();\r\n\r\n    // Observar cambios en los pasos para cargar fechas/horarios cuando sea necesario\r\n    const observer = new MutationObserver(function(mutations) {\r\n        mutations.forEach(function(mutation) {\r\n            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\r\n                const paso3 = document.querySelector('.paso-3');\r\n                if (paso3 && paso3.classList.contains('activo') && !fechaSeleccionada) {\r\n                    cargarFechasYHorarios();\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Observar el paso 3\r\n    const paso3 = document.querySelector('.paso-3');\r\n    if (paso3) {\r\n        observer.observe(paso3, { attributes: true });\r\n    }\r\n\r\n    await precacheDatosEsenciales();\r\n\r\n    if (typeof inicializarSistemaTurnosUsuario === 'function') {\r\n        inicializarSistemaTurnosUsuario();\r\n    }\r\n});\r\n\r\n// Wrap seguro para funciones de Firestore\r\nconst firestoreSeguro = {\r\n  obtenerCategorias: async () => {\r\n        try {\r\n            if (cache.esValido('categorias')) {\r\n                console.log(' Obteniendo categoras desde cach');\r\n                return cache.obtener('categorias');\r\n            }\r\n            \r\n            const categorias = await firestoreDB.obtenerCategorias();\r\n            cache.guardar('categorias', categorias);\r\n            return categorias;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'cargar categoras');\r\n        }\r\n    },\r\n  \r\n  obtenerServicios: async () => {\r\n        try {\r\n            if (cache.esValido('servicios')) {\r\n                console.log(' Obteniendo servicios desde cach');\r\n                return cache.obtener('servicios');\r\n            }\r\n            \r\n            const servicios = await firestoreDB.obtenerServicios();\r\n            cache.guardar('servicios', servicios);\r\n            return servicios;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'cargar servicios');\r\n        }\r\n    },\r\n\r\n    obtenerEspecialistasPorCategoria: async (categoriaId) => {\r\n        try {\r\n            if (cache.esValido('especialistas', categoriaId)) {\r\n                console.log(` Obteniendo especialistas para categora ${categoriaId} desde cach`);\r\n                const cached = cache.obtener('especialistas', categoriaId);\r\n                //  CORRECCIN: Verificar que el cach no sea un array vaco incorrecto\r\n                if (cached && Array.isArray(cached) && cached.length > 0) {\r\n                    return cached;\r\n                } else {\r\n                    // Si el cach est vaco o es invlido, forzar recarga\r\n                    console.log(` Cach vaco/invlido para ${categoriaId}, recargando...`);\r\n                    cache.limpiarEspecifico('especialistas', categoriaId);\r\n                }\r\n            }\r\n            \r\n            const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n            \r\n            //  CORRECCIN: Guardar en cach solo si hay especialistas reales\r\n            if (especialistas && Array.isArray(especialistas) && especialistas.length > 0) {\r\n                cache.guardar('especialistas', especialistas, categoriaId);\r\n            } else {\r\n                // No guardar arrays vacos en cach para evitar problemas\r\n                console.warn(` No se guardar cach vaco para categora ${categoriaId}`);\r\n            }\r\n            \r\n            return especialistas || [];\r\n        } catch (error) {\r\n            console.error(` Error obteniendo especialistas para categora ${categoriaId}:`, error);\r\n            //  Siempre devolver un array vaco en caso de error\r\n            return [];\r\n        }\r\n    },\r\n    \r\n  obtenerConfiguracion: async () => {\r\n        try {\r\n            if (cache.esValido('config')) {\r\n                console.log(' Obteniendo configuracin desde cach');\r\n                return cache.obtener('config');\r\n            }\r\n            \r\n            const config = await firestoreDB.obtenerConfiguracion();\r\n            cache.guardar('config', config);\r\n            return config;\r\n        } catch (error) {\r\n            ErrorHandler.manejarErrorFirestore(error, 'cargar configuracin');\r\n            // Retornar configuracin por defecto\r\n            return {\r\n                diasLaborales: [1, 2, 3, 4, 5, 6],\r\n                horarioApertura: \"09:00\",\r\n                horarioCierre: \"20:00\",\r\n                duracionTurnoBase: 30\r\n            };\r\n        }\r\n    },\r\n\r\n  verificarDisponibilidad: async (fecha, horario) => {\r\n    try {\r\n      return await firestoreDB.verificarDisponibilidad(fecha, horario);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'verificar disponibilidad');\r\n      return false; // Por defecto, no disponible si hay error\r\n    }\r\n  },\r\n\r\n  generarHorariosDisponibles: async (fecha) => {\r\n    try {\r\n      return await firestoreDB.generarHorariosDisponibles(fecha);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'generar horarios');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  generarHorariosDisponiblesEspecialista: async (especialistaId, fecha) => {\r\n        try {\r\n            const cacheKey = `${especialistaId}_${fecha}`;\r\n            \r\n            // Verificar si ya tenemos los horarios de este especialista\r\n            const horariosCache = cache.obtener('horarios', cacheKey);\r\n            if (horariosCache) {\r\n                cacheMonitor.incrementHit();\r\n                return horariosCache;\r\n            }\r\n            \r\n            cacheMonitor.incrementMiss();\r\n            \r\n            // OPTIMIZACIN: Si ya consultamos este especialista hoy, reutilizar lgica\r\n            const horarios = await firestoreDB.generarHorariosDisponiblesEspecialista(especialistaId, fecha);\r\n            cache.guardar('horarios', horarios, cacheKey);\r\n            return horarios;\r\n        } catch (error) {\r\n            return ErrorHandler.manejarErrorFirestore(error, 'generar horarios de especialista');\r\n        }\r\n    },\r\n\r\n    generarHorariosMultiplesEspecialistas: async (especialistasIds, fecha) => {\r\n        try {\r\n            const cacheKey = `multi_${especialistasIds.sort().join('_')}_${fecha}`;\r\n            \r\n            // Intentar obtener del cache primero\r\n            const horariosCache = cache.obtener('horarios_multi', cacheKey);\r\n            if (horariosCache) {\r\n                return horariosCache;\r\n            }\r\n            \r\n            // Obtener horarios para todos los especialistas en paralelo\r\n            const promises = especialistasIds.map(id => \r\n                this.generarHorariosDisponiblesEspecialista(id, fecha)\r\n            );\r\n            \r\n            const resultados = await Promise.allSettled(promises);\r\n            const horariosPorEspecialista = {};\r\n            \r\n            resultados.forEach((result, index) => {\r\n                if (result.status === 'fulfilled') {\r\n                    horariosPorEspecialista[especialistasIds[index]] = result.value;\r\n                }\r\n            });\r\n            \r\n            cache.guardar('horarios_multi', horariosPorEspecialista, cacheKey);\r\n            return horariosPorEspecialista;\r\n            \r\n        } catch (error) {\r\n            console.error('Error generando horarios mltiples:', error);\r\n            return {};\r\n        }\r\n    },\r\n\r\n  obtenerHorariosComunesDisponibles: async (fecha, especialistasIds, duracionTotal) => {\r\n    try {\r\n        return await firestoreDB.obtenerHorariosComunesDisponibles(fecha, especialistasIds, duracionTotal);\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'obtener horarios comunes');\r\n        return [];\r\n    }\r\n  },\r\n\r\n  obtenerTurnosPorFecha: async (fecha) => {\r\n    try {\r\n      return await firestoreDB.obtenerTurnosPorFecha(fecha);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'obtener turnos por fecha');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  obtenerTurnosSolapados: async (fecha, horario, duracion) => {\r\n    try {\r\n      return await firestoreDB.obtenerTurnosSolapados(fecha, horario, duracion);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'obtener turnos solapados');\r\n      return [];\r\n    }\r\n  },\r\n\r\n  obtenerConfigGeneral: async () => {\r\n    try {\r\n        return await firestoreDB.obtenerConfigGeneral();\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'cargar configuracin general');\r\n        return {};\r\n    }\r\n  },\r\n\r\n  //  NUEVA FUNCIN: Autenticacin para reservas\r\n  autenticarParaReserva: async () => {\r\n    try {\r\n      if (!usuarioActual) {\r\n        console.log(' Iniciando autenticacin annima para reserva...');\r\n        const userCredential = await firebase.auth().signInAnonymously();\r\n        usuarioActual = userCredential.user;\r\n        console.log(' Usuario annimo autenticado:', usuarioActual.uid);\r\n      }\r\n      return usuarioActual;\r\n    } catch (error) {\r\n      console.error('Error en autenticacin para reserva:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n    guardarTurno: async (turnoData) => {\r\n    try {\r\n        //  Asegurar autenticacin antes de guardar\r\n        await firestoreSeguro.autenticarParaReserva();\r\n        \r\n        return await firestoreDB.guardarTurno(turnoData);\r\n    } catch (error) {\r\n        ErrorHandler.manejarErrorFirestore(error, 'guardar turno');\r\n        throw error;\r\n    }\r\n    },\r\n\r\n  bloquearTurnoTemporal: async (fecha, horario, usuarioId) => {\r\n    try {\r\n      return await firestoreDB.bloquearTurnoTemporal(fecha, horario, usuarioId);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'bloquear turno temporal');\r\n      return null;\r\n    }\r\n  },\r\n\r\n  eliminarBloqueoTemporal: async (bloqueoId) => {\r\n    try {\r\n      return await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n    } catch (error) {\r\n      ErrorHandler.manejarErrorFirestore(error, 'eliminar bloqueo temporal');\r\n      // No hacemos nada, es una operacin de limpieza\r\n    }\r\n  }\r\n};\r\n\r\n// Funciones principales\r\nasync function inicializarEventos() {\r\n    // Navegacin\r\n    elementos.btnAnterior.addEventListener('click', retrocederPaso);\r\n    elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    \r\n    // Seleccin de servicios (manejo delegado)\r\n    document.querySelectorAll('.flotante.servicio').forEach(servicio => {\r\n        servicio.addEventListener('click', function() {\r\n            this.classList.toggle('seleccionado');\r\n            actualizarServiciosSeleccionados();\r\n        });\r\n    });\r\n    \r\n    // Fechas y horarios\r\n    document.querySelectorAll('.flotante.fecha').forEach(fecha => {\r\n        fecha.addEventListener('click', function() {\r\n            seleccionarElemento(this, 'fecha');\r\n        });\r\n    });\r\n    \r\n    document.querySelectorAll('.flotante.horario').forEach(horario => {\r\n        horario.addEventListener('click', async function() {\r\n            if (!this.classList.contains('ocupado')) {\r\n                const horarioSeleccionado = this.querySelector('.p1').textContent;\r\n                const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n                \r\n                // Verificar disponibilidad solo para los especialistas seleccionados\r\n                const validacion = await validarDisponibilidadCompleta(\r\n                    datosReserva.fecha, \r\n                    horarioSeleccionado,\r\n                    calcularDuracionTotal(),\r\n                    especialistasIds\r\n                );\r\n                \r\n                if (validacion.disponible && validacion.turnosSolapados.length === 0) {\r\n                    seleccionarElemento(this, 'horario');\r\n                } else {\r\n                    mostrarError(validacion.mensaje || \"Horario no disponible\");\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Validacin en tiempo real\r\n    document.getElementById('nombre')?.addEventListener('input', validarNombre);\r\n    document.getElementById('email')?.addEventListener('input', validarEmail);\r\n    document.getElementById('telefono')?.addEventListener('input', validarTelefono);\r\n\r\n    document.addEventListener('click', async function(e) {\r\n        if (e.target.closest('.flotante.especialista')) {\r\n            const especialistaEl = e.target.closest('.flotante.especialista');\r\n            const especialistaId = especialistaEl.dataset.id;\r\n            const categoriaId = especialistaEl.dataset.categoriaId;\r\n            \r\n            // Buscar el especialista en los datos disponibles\r\n            const categoriaSection = especialistaEl.closest('.categoria-especialistas');\r\n            if (categoriaSection) {\r\n                const especialistasContainer = categoriaSection.querySelector('.especialistas-container');\r\n                const especialistaElement = especialistasContainer.querySelector(`[data-id=\"${especialistaId}\"]`);\r\n                \r\n                if (especialistaElement) {\r\n                    // Crear objeto especialista con los datos mnimos necesarios\r\n                    const especialista = {\r\n                        id: especialistaId,\r\n                        nombre: especialistaElement.querySelector('.p1')?.textContent || 'Especialista',\r\n                        categoriaId: categoriaId\r\n                    };\r\n                    \r\n                    seleccionarEspecialista(especialistaEl, especialista, categoriaId);\r\n                }\r\n            }\r\n\r\n            setTimeout(() => {\r\n                if (pasoActual >= 2) {\r\n                    actualizarResumenEspecialistas();\r\n                }\r\n            }, 100);\r\n        }\r\n        \r\n        // Solo manejar clic en .seleccion-predeterminada para abrir/cerrar la lista\r\n        if (e.target.closest('.seleccion-predeterminada') && !e.target.closest('.botones-especialista')) {\r\n            const seleccionPredeterminada = e.target.closest('.seleccion-predeterminada');\r\n            const categoriaSection = seleccionPredeterminada.closest('.categoria-especialistas');\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n            const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n            \r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas primero\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherBtn = l.closest('.categoria-especialistas').querySelector('.btn-ver-especialistas');\r\n                    const otherIcon = otherBtn.querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            \r\n            // Alternar la rotacin del icono en lugar de cambiar el texto\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction calcularSubtotal() {\r\n    const subtotal = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n    \r\n    // Calcular ahorro total por promociones\r\n    const ahorroTotal = datosReserva.servicios.reduce((total, servicio) => {\r\n        return servicio.promo ? total + (servicio.precioOriginal - servicio.precio) : total;\r\n    }, 0);\r\n    \r\n    // Mostrar ahorro si hay promociones\r\n    if (ahorroTotal > 0) {\r\n        console.log(` Ahorro total por promociones: $${ahorroTotal.toLocaleString()}`);\r\n        // Puedes mostrar esto en la UI si quieres\r\n        const elementoAhorro = document.getElementById('ahorro-total');\r\n        if (elementoAhorro) {\r\n            elementoAhorro.textContent = `-$${ahorroTotal.toLocaleString()}`;\r\n            elementoAhorro.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    return subtotal;\r\n}\r\n\r\nfunction actualizarServiciosSeleccionados() {\r\n    try {\r\n        console.log(' actualizarServiciosSeleccionados llamado');\r\n        \r\n        const serviciosSeleccionados = document.querySelectorAll('.flotante.servicio.seleccionado');\r\n        \r\n        if (!datosReserva.servicios || !Array.isArray(datosReserva.servicios)) {\r\n            datosReserva.servicios = [];\r\n        }\r\n        \r\n        console.log('Servicios seleccionados en DOM:', serviciosSeleccionados.length);\r\n        \r\n        if (!serviciosSeleccionados || serviciosSeleccionados.length === 0) {\r\n            console.log('No hay servicios seleccionados, limpiando datos');\r\n            datosReserva.servicios = [];\r\n            \r\n            const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n            if (contenedorEspecialistas) {\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            }\r\n            \r\n            actualizarContadoresCategoria();\r\n            calcularSubtotal();\r\n            return;\r\n        }\r\n        \r\n        const serviciosProcesados = Array.from(serviciosSeleccionados).map(serv => {\r\n            try {\r\n                const servicioId = serv.getAttribute('data-servicio-id');\r\n                const servicioNombre = serv.getAttribute('data-servicio');\r\n                const categoriaId = serv.getAttribute('data-categoria-id');\r\n                \r\n                if (!servicioId || !categoriaId) {\r\n                    console.warn(\"Servicio sin ID o categora ID:\", serv);\r\n                    return null;\r\n                }\r\n                \r\n                const servicioCompleto = datosReserva.serviciosDisponibles?.find(s => s && s.id === servicioId);\r\n                \r\n                // CALCULAR PRECIO CON DESCUENTO SI APLICA\r\n                const precioOriginal = servicioCompleto ? servicioCompleto.precio : (datosReserva.precios[servicioNombre] || 0);\r\n                const tienePromo = servicioCompleto ? servicioCompleto.promo : false;\r\n                const precioFinal = tienePromo ? Math.round(precioOriginal * 0.75) : precioOriginal;\r\n                \r\n                return {\r\n                    id: servicioId,\r\n                    nombre: servicioNombre || (servicioCompleto ? servicioCompleto.nombre : 'Servicio'),\r\n                    precio: precioFinal, // Guardamos el precio con descuento aplicado\r\n                    precioOriginal: precioOriginal, // Guardamos el precio original para referencia\r\n                    promo: tienePromo, // Guardamos si tiene promocin\r\n                    duracion: servicioCompleto ? servicioCompleto.duracion : (datosReserva.duraciones[servicioNombre] || 30),\r\n                    categoriaId: categoriaId\r\n                };\r\n            } catch (error) {\r\n                console.error('Error procesando servicio:', error);\r\n                return null;\r\n            }\r\n        }).filter(servicio => servicio !== null);\r\n\r\n        datosReserva.servicios = serviciosProcesados;\r\n        console.log('Servicios procesados:', datosReserva.servicios);\r\n\r\n        if (!Array.isArray(datosReserva.servicios)) {\r\n            console.error('datosReserva.servicios no es un array, forzando a array vaco');\r\n            datosReserva.servicios = [];\r\n        }\r\n\r\n        datosReserva.reserva = calcularSenia();\r\n\r\n        actualizarContadoresCategoria();\r\n        \r\n        if (datosReserva.servicios.length > 0) {\r\n            document.getElementById('error-servicio').classList.remove('visible');\r\n        }\r\n        \r\n        console.log('Debe mostrar especialistas?', datosReserva.servicios.length > 0);\r\n        \r\n        if (datosReserva.servicios.length > 0) {\r\n            const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            console.log(\"Categoras con servicios:\", categoriasIds);\r\n            mostrarEspecialistas(categoriasIds);\r\n        } else {\r\n            console.log('Limpiando especialistas porque no hay servicios');\r\n            const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n            if (contenedorEspecialistas) {\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            }\r\n        }\r\n        \r\n        calcularSubtotal();\r\n\r\n        if (pasoActual >= 2) {\r\n            actualizarResumenServicios();\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error en actualizarServiciosSeleccionados:\", error);\r\n    }\r\n}\r\n\r\nasync function cargarEspecialistas() {\r\n    try {\r\n        // Obtener categoras nicas de los servicios seleccionados\r\n        const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n        \r\n        if (categoriasIds.length === 0) {\r\n            console.warn(\"No hay categoras para cargar especialistas\");\r\n            return;\r\n        }\r\n        \r\n        // Obtener especialistas para cada categora\r\n        const especialistasPromises = categoriasIds.map(catId => \r\n            firestoreSeguro.obtenerEspecialistasPorCategoria(catId)\r\n        );\r\n        \r\n        const resultados = await Promise.allSettled(especialistasPromises);\r\n        \r\n        // Procesar resultados\r\n        const especialistasPorCategoria = {};\r\n        resultados.forEach((result, index) => {\r\n            if (result.status === 'fulfilled') {\r\n                especialistasPorCategoria[categoriasIds[index]] = result.value;\r\n            } else {\r\n                console.error(`Error cargando especialistas para categora ${categoriasIds[index]}:`, result.reason);\r\n                especialistasPorCategoria[categoriasIds[index]] = [];\r\n            }\r\n        });\r\n        \r\n        // Mostrar especialistas en la UI\r\n        mostrarEspecialistas(categoriasIds, especialistasPorCategoria);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando especialistas:\", error);\r\n        mostrarError(\"Error al cargar los especialistas. Intenta nuevamente.\");\r\n    }\r\n}\r\n\r\nfunction seleccionarEspecialista(elemento, especialista, categoriaId) {\r\n    // Verificar si ya est seleccionado\r\n    const yaSeleccionado = elemento.classList.contains('seleccionado');\r\n    \r\n    if (yaSeleccionado) {\r\n        // Deseleccionar\r\n        elemento.classList.remove('seleccionado');\r\n        datosReserva.especialistas = datosReserva.especialistas.filter(esp => \r\n            !(esp.id === especialista.id && esp.categoriaId === categoriaId)\r\n        );\r\n    } else {\r\n        // Verificar si ya hay un especialista seleccionado para esta categora\r\n        const especialistaExistenteIndex = datosReserva.especialistas.findIndex(esp => \r\n            esp.categoriaId === categoriaId\r\n        );\r\n        \r\n        if (especialistaExistenteIndex !== -1) {\r\n            // Deseleccionar el especialista anterior de esta categora\r\n            const elementoAnterior = document.querySelector(`.flotante.especialista[data-id=\"${datosReserva.especialistas[especialistaExistenteIndex].id}\"]`);\r\n            if (elementoAnterior) {\r\n                elementoAnterior.classList.remove('seleccionado');\r\n            }\r\n            datosReserva.especialistas.splice(especialistaExistenteIndex, 1);\r\n        }\r\n        \r\n        // Seleccionar el nuevo\r\n        elemento.classList.add('seleccionado');\r\n        datosReserva.especialistas.push({\r\n            ...especialista,\r\n            categoriaId: categoriaId\r\n        });\r\n    }\r\n    \r\n    console.log(\"Especialistas seleccionados:\", datosReserva.especialistas);\r\n}\r\n\r\nasync function cargarFechasYHorarios() {\r\n    try {\r\n        await cargarFechasDisponibles();\r\n        if (datosReserva.fecha) {\r\n            await cargarHorariosDisponibles(datosReserva.fecha);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas y horarios:\", error);\r\n        mostrarError(\"Error al cargar disponibilidad. Intenta nuevamente.\");\r\n    }\r\n}\r\n\r\nasync function cargarFechasDisponibles() {\r\n    const contenedorFechas = document.querySelector('.contenedor-fechas');\r\n    if (!contenedorFechas) return;\r\n    \r\n    contenedorFechas.innerHTML = '<p>Cargando fechas disponibles...</p>';\r\n    \r\n    try {\r\n        // Obtener configuracin para das laborales\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        const diasLaborales = config?.diasLaborales || [1, 2, 3, 4, 5, 6]; // Lunes a Sbado por defecto\r\n        \r\n        // Generar prximas 4 semanas\r\n        const hoy = new Date();\r\n        const fechasDisponibles = [];\r\n        \r\n        for (let i = 0; i < 28; i++) { // 4 semanas\r\n            const fecha = new Date(hoy);\r\n            fecha.setDate(hoy.getDate() + i);\r\n            \r\n            // Verificar si es da laboral\r\n            if (diasLaborales.includes(fecha.getDay())) {\r\n                fechasDisponibles.push(fecha.toISOString().split('T')[0]);\r\n            }\r\n        }\r\n        \r\n        // Actualizar UI\r\n        contenedorFechas.innerHTML = '';\r\n        fechasDisponibles.forEach(fechaStr => {\r\n            const fecha = new Date(fechaStr);\r\n            const fechaElement = document.createElement('div');\r\n            fechaElement.className = 'flotante fecha';\r\n            fechaElement.dataset.fecha = fechaStr;\r\n            \r\n            const opciones = { weekday: 'long', day: 'numeric', month: 'long' };\r\n            const fechaFormateada = fecha.toLocaleDateString('es-ES', opciones);\r\n            fechaElement.innerHTML = `\r\n                <p class=\"p1\">${fechaFormateada.charAt(0).toUpperCase() + fechaFormateada.slice(1)}</p>\r\n            `;\r\n            \r\n            fechaElement.addEventListener('click', function() {\r\n                seleccionarElemento(this, 'fecha');\r\n                cargarHorariosDisponibles(fechaStr);\r\n            });\r\n            \r\n            contenedorFechas.appendChild(fechaElement);\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        contenedorFechas.innerHTML = '<p>Error al cargar fechas</p>';\r\n    }\r\n}\r\n\r\nasync function cargarHorariosDisponibles(fecha) {\r\n    const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n    if (!contenedorHorarios) return;\r\n    \r\n    contenedorHorarios.innerHTML = '<p>Cargando horarios...</p>';\r\n    \r\n    try {\r\n        // Calcular duracin total\r\n        const duracionTotal = calcularDuracionTotal();\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n        \r\n        // Obtener horarios disponibles\r\n        let horariosDisponibles = [];\r\n        \r\n        if (especialistasIds.length > 0) {\r\n            // Usar la funcin optimizada para mltiples especialistas\r\n            horariosDisponibles = await firestoreSeguro.obtenerHorariosComunesDisponibles(\r\n                fecha, \r\n                especialistasIds, \r\n                duracionTotal\r\n            );\r\n        } else {\r\n            // Fallback: horarios generales (sin especialista especfico)\r\n            horariosDisponibles = await firestoreSeguro.generarHorariosDisponibles(fecha);\r\n        }\r\n        \r\n        // Actualizar UI\r\n        contenedorHorarios.innerHTML = '';\r\n        \r\n        if (horariosDisponibles.length === 0) {\r\n            contenedorHorarios.innerHTML = '<p>No hay horarios disponibles para esta fecha</p>';\r\n            return;\r\n        }\r\n        \r\n        horariosDisponibles.forEach(horario => {\r\n            const horarioElement = document.createElement('div');\r\n            horarioElement.className = 'flotante horario disponible';\r\n            horarioElement.innerHTML = `\r\n                <p class=\"p1\">${horario}</p>\r\n            `;\r\n            \r\n            horarioElement.addEventListener('click', async function() {\r\n                if (!this.classList.contains('ocupado')) {\r\n                    // Verificar disponibilidad antes de seleccionar\r\n                    const validacion = await validarDisponibilidadCompleta(\r\n                        fecha, \r\n                        horario,\r\n                        duracionTotal,\r\n                        especialistasIds\r\n                    );\r\n                    \r\n                    if (validacion.disponible && validacion.turnosSolapados.length === 0) {\r\n                        seleccionarElemento(this, 'horario');\r\n                    } else {\r\n                        mostrarError(validacion.mensaje || \"Horario no disponible\");\r\n                    }\r\n                }\r\n            });\r\n            \r\n            contenedorHorarios.appendChild(horarioElement);\r\n        });\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando horarios:\", error);\r\n        contenedorHorarios.innerHTML = '<p>Error al cargar horarios</p>';\r\n    }\r\n}\r\n\r\nasync function validarDisponibilidadCompleta(fecha, horario, duracion, especialistasIds) {\r\n    try {\r\n        // Verificar disponibilidad general primero\r\n        const disponible = await firestoreSeguro.verificarDisponibilidad(fecha, horario);\r\n        if (!disponible) {\r\n            return {\r\n                disponible: false,\r\n                mensaje: \"Este horario ya no est disponible\"\r\n            };\r\n        }\r\n        \r\n        // Verificar turnos solapados\r\n        const turnosSolapados = await firestoreSeguro.obtenerTurnosSolapados(fecha, horario, duracion);\r\n        \r\n        if (turnosSolapados.length > 0) {\r\n            return {\r\n                disponible: false,\r\n                turnosSolapados: turnosSolapados,\r\n                mensaje: `El horario seleccionado se cruza con ${turnosSolapados.length} turno(s) existente(s)`\r\n            };\r\n        }\r\n        \r\n        // Si hay especialistas especficos, verificar su disponibilidad\r\n        if (especialistasIds.length > 0) {\r\n            for (const especialistaId of especialistasIds) {\r\n                const horariosEspecialista = await firestoreSeguro.generarHorariosDisponiblesEspecialista(especialistaId, fecha);\r\n                if (!horariosEspecialista.includes(horario)) {\r\n                    return {\r\n                        disponible: false,\r\n                        mensaje: `El especialista no est disponible en este horario`\r\n                    };\r\n                }\r\n            }\r\n        }\r\n        \r\n        return {\r\n            disponible: true,\r\n            turnosSolapados: []\r\n        };\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error validando disponibilidad:\", error);\r\n        return {\r\n            disponible: false,\r\n            mensaje: \"Error al verificar disponibilidad\"\r\n        };\r\n    }\r\n}\r\n\r\nfunction validarDatosContacto() {\r\n    const nombre = document.getElementById('nombre').value.trim();\r\n    const email = document.getElementById('email').value.trim();\r\n    const telefono = document.getElementById('telefono').value.trim();\r\n    \r\n    // Validar nombre\r\n    if (nombre.length < 2) {\r\n        mostrarError('Ingresa tu nombre completo');\r\n        return false;\r\n    }\r\n    \r\n    // Validar email\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    if (!emailRegex.test(email)) {\r\n        mostrarError('Ingresa un email vlido');\r\n        return false;\r\n    }\r\n    \r\n    // Validar telfono (mnimo 8 dgitos)\r\n    const telefonoRegex = /^\\d{8,}$/;\r\n    if (!telefonoRegex.test(telefono.replace(/\\D/g, ''))) {\r\n        mostrarError('Ingresa un telfono vlido (mnimo 8 dgitos)');\r\n        return false;\r\n    }\r\n    \r\n    // Guardar datos\r\n    datosReserva.nombre = nombre;\r\n    datosReserva.email = email;\r\n    datosReserva.telefono = telefono;\r\n    datosReserva.observacion = document.getElementById('observacion').value.trim();\r\n    \r\n    return true;\r\n}\r\n\r\nfunction actualizarResumenServicios() {\r\n    const resumenServicios = document.getElementById('servicio-seleccionado');\r\n    if (resumenServicios) {\r\n        const serviciosHTML = datosReserva.servicios.map(servicio => {\r\n            const precioMostrado = servicio.promo ? \r\n                `<span class=\"precio-con-descuento\">$${servicio.precio.toLocaleString()}</span>\r\n                <span class=\"precio-original\">$${servicio.precioOriginal.toLocaleString()}</span>` :\r\n                `$${servicio.precio.toLocaleString()}`;\r\n            \r\n            const badgePromo = servicio.promo ? '<span class=\"badge-promo-resumen\">-25%</span>' : '';\r\n            \r\n            return `<li>${servicio.nombre} ${badgePromo} - ${precioMostrado}</li>`;\r\n        }).join('');\r\n        resumenServicios.innerHTML = serviciosHTML;\r\n    }\r\n}\r\n\r\nfunction obtenerNombreCategoria(categoriaId) {\r\n    const categoria = datosReserva.categorias.find(cat => cat.id === categoriaId);\r\n    return categoria ? categoria.nombre : 'General';\r\n}\r\n\r\nasync function confirmarReserva() {\r\n    if (!validarDatosContacto()) {\r\n        return;\r\n    }\r\n    \r\n    // Mostrar loading\r\n    elementos.btnSiguiente.innerHTML = '<div class=\"spinner\"></div> Confirmando...';\r\n    elementos.btnSiguiente.disabled = true;\r\n    \r\n    try {\r\n        // Verificar disponibilidad final\r\n        const validacion = await validarDisponibilidadCompleta(\r\n            datosReserva.fecha,\r\n            datosReserva.horario,\r\n            calcularDuracionTotal(),\r\n            datosReserva.especialistas.map(esp => esp.id)\r\n        );\r\n        \r\n        if (!validacion.disponible) {\r\n            mostrarError(validacion.mensaje || \"El horario ya no est disponible\");\r\n            elementos.btnSiguiente.innerHTML = 'Confirmar Reserva';\r\n            elementos.btnSiguiente.disabled = false;\r\n            return;\r\n        }\r\n        \r\n        // Crear objeto de turno\r\n        const turnoData = {\r\n            servicios: datosReserva.servicios,\r\n            especialistas: datosReserva.especialistas,\r\n            fecha: datosReserva.fecha,\r\n            horario: datosReserva.horario,\r\n            duracion: calcularDuracionTotal(),\r\n            cliente: {\r\n                nombre: datosReserva.nombre,\r\n                email: datosReserva.email,\r\n                telefono: datosReserva.telefono\r\n            },\r\n            observaciones: datosReserva.observacion,\r\n            estado: 'pendiente',\r\n            fechaCreacion: new Date().toISOString(),\r\n            senia: datosReserva.reserva,\r\n            total: calcularSubtotal()\r\n        };\r\n        \r\n        // Guardar en Firestore\r\n        const resultado = await firestoreSeguro.guardarTurno(turnoData);\r\n        \r\n        if (resultado) {\r\n            // Mostrar confirmacin\r\n            mostrarConfirmacion(turnoData);\r\n            \r\n            // Reiniciar formulario\r\n            reiniciarFormulario();\r\n        } else {\r\n            throw new Error('Error al guardar el turno');\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error confirmando reserva:\", error);\r\n        mostrarError(\"Error al confirmar la reserva. Intenta nuevamente.\");\r\n    } finally {\r\n        elementos.btnSiguiente.innerHTML = 'Confirmar Reserva';\r\n        elementos.btnSiguiente.disabled = false;\r\n    }\r\n}\r\n\r\nfunction reiniciarFormulario() {\r\n    // Reiniciar datos\r\n    datosReserva = {\r\n        servicios: [],\r\n        especialistas: [],\r\n        fecha: null,\r\n        horario: null,\r\n        nombre: null,\r\n        email: null,\r\n        telefono: null,\r\n        observacion: null,\r\n        reserva: 1000\r\n    };\r\n    \r\n    // Reiniciar UI\r\n    pasoActual = 1;\r\n    actualizarInterfaz();\r\n    \r\n    // Limpiar selecciones\r\n    document.querySelectorAll('.flotante.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Limpiar formulario\r\n    document.getElementById('nombre').value = '';\r\n    document.getElementById('email').value = '';\r\n    document.getElementById('telefono').value = '';\r\n    document.getElementById('observacion').value = '';\r\n}\r\n\r\n// Sistema de autenticacin\r\n\r\nasync function cargarDatosUsuario(uid) {\r\n    try {\r\n        const userDoc = await db.collection('usuarios').doc(uid).get();\r\n        if (userDoc.exists) {\r\n            const userData = userDoc.data();\r\n            // Prellenar formulario si est disponible\r\n            if (document.getElementById('nombre') && userData.nombre) {\r\n                document.getElementById('nombre').value = userData.nombre;\r\n            }\r\n            if (document.getElementById('telefono') && userData.telefono) {\r\n                document.getElementById('telefono').value = userData.telefono;\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error cargando datos usuario:\", error);\r\n    }\r\n}\r\n\r\n// Logout\r\nasync function logout() {\r\n    try {\r\n        await auth.signOut();\r\n        localStorage.removeItem('usuario');\r\n    } catch (error) {\r\n        console.error(\"Error en logout:\", error);\r\n    }\r\n}\r\n\r\n// Cargar configuracin general\r\nasync function cargarConfiguracion() {\r\n    try {\r\n        const config = await firestoreSeguro.obtenerConfigGeneral();\r\n        datosGenerales = config;\r\n        \r\n        // Actualizar UI con configuracin si es necesario\r\n        if (config.nombreLocal) {\r\n            document.querySelectorAll('.nombre-local').forEach(el => {\r\n                el.textContent = config.nombreLocal;\r\n            });\r\n        }\r\n        \r\n        if (config.logoUrl) {\r\n            document.querySelectorAll('.logo').forEach(logo => {\r\n                logo.src = config.logoUrl;\r\n                logo.alt = config.nombreLocal;\r\n            });\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando configuracin:\", error);\r\n    }\r\n}\r\n\r\n// Funcin para abrir WhatsApp con mensaje predefinido\r\nfunction contactarPorWhatsApp() {\r\n    const telefono = datosGenerales.telefono || '5491112345678'; // Nmero por defecto\r\n    const mensaje = `Hola! Me gustara hacer una reserva en ${datosGenerales.nombreLocal || 'su local'}`;\r\n    const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;\r\n    window.open(url, '_blank');\r\n}\r\n\r\n// Funcin para abrir Google Maps con la ubicacin\r\nfunction abrirUbicacion() {\r\n    if (coordenadasLocal) {\r\n        const { lat, lng } = coordenadasLocal;\r\n        const url = `https://www.google.com/maps?q=${lat},${lng}`;\r\n        window.open(url, '_blank');\r\n    } else if (datosGenerales.direccion) {\r\n        const url = `https://www.google.com/maps?q=${encodeURIComponent(datosGenerales.direccion)}`;\r\n        window.open(url, '_blank');\r\n    } else {\r\n        mostrarError('No hay informacin de ubicacin disponible');\r\n    }\r\n}\r\n\r\nfunction actualizarUIServicios(categorias, servicios) {\r\n    \r\n  // Validacin adicional para asegurar que tenemos datos\r\n  if (!categorias || !servicios) {\r\n    ErrorHandler.mostrar(\"Datos de categoras o servicios no definidos\", \"error\");\r\n    return;\r\n  }\r\n  \r\n  const contenedorServicios = document.querySelector('.contenedor-servicios');\r\n  if (!contenedorServicios) {\r\n    console.error(\"No se encontr el contenedor de servicios\");\r\n    return;\r\n  }\r\n  \r\n  console.log(\"Actualizando UI con:\", categorias.length, \"categoras y\", servicios.length, \"servicios\");\r\n  \r\n  // Limpiar contenedor\r\n  contenedorServicios.innerHTML = '';\r\n  \r\n  // Si no hay categoras, mostrar mensaje\r\n  if (categorias.length === 0) {\r\n    contenedorServicios.innerHTML = '<p class=\"sin-servicios\">No cargaron las categoras disponibles.</p>';\r\n    return;\r\n  }\r\n  \r\n  // Organizar servicios por categora\r\n  const serviciosPorCategoria = {};\r\n  categorias.forEach(categoria => {\r\n    serviciosPorCategoria[categoria.id] = servicios.filter(s => s.categoriaId === categoria.id);\r\n  });\r\n  \r\n  // Crear HTML para cada categora (mostrar TODAS las categoras)\r\n  categorias.forEach(categoria => {\r\n    let serviciosCategoria = serviciosPorCategoria[categoria.id] || [];\r\n    \r\n    // NUEVO: Verificar si esta categora tiene servicios con promocin\r\n    const tienePromociones = serviciosCategoria.some(servicio => servicio.promo === true);\r\n    \r\n    // NUEVO: Ordenar servicios - los con promo primero\r\n    serviciosCategoria = serviciosCategoria.sort((a, b) => {\r\n      // Si a tiene promo y b no, a va primero\r\n      if (a.promo && !b.promo) return -1;\r\n      // Si b tiene promo y a no, b va primero\r\n      if (!a.promo && b.promo) return 1;\r\n      // Si ambos tienen promo o no, mantener orden original\r\n      return 0;\r\n    });\r\n    \r\n    // Crear elemento de categora (acorden) - SIEMPRE se crea, incluso si no hay servicios\r\n    const categoriaEl = document.createElement('div');\r\n    categoriaEl.className = 'categoria-acordeon';\r\n    categoriaEl.dataset.categoriaId = categoria.id;\r\n    \r\n    // SVG de promocin (solo si la categora tiene promociones)\r\n    const svgPromo = tienePromociones ? `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#9328a9ff\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n        <path d=\"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1\" />\r\n        <path d=\"M9 12l2 2l4 -4\" />\r\n      </svg>\r\n    ` : '';\r\n    \r\n    // Crear encabezado de categora\r\n    const header = document.createElement('div');\r\n    header.className = 'categoria-header';\r\n    if (tienePromociones) {\r\n      header.classList.add('con-promociones');\r\n    }\r\n    header.dataset.categoriaId = categoria.id;\r\n    header.innerHTML = `\r\n      <div class=\"categoria-info\">\r\n        <h3>${categoria.nombre} ${svgPromo}</h3>\r\n        <span class=\"contador-seleccionados-categoria\"></span>\r\n      </div>\r\n        <svg\r\n        class=\"acordeon-icon\" \r\n        width=\"18\"\r\n        height=\"18\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"2\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M18 6l-12 12\" />\r\n        <path d=\"M6 6l12 12\" />\r\n        </svg>\r\n    `;\r\n    \r\n    // Crear contenedor de servicios (inicialmente oculto)\r\n    const serviciosContainer = document.createElement('div');\r\n    serviciosContainer.className = 'servicios-container';\r\n    serviciosContainer.style.display = 'none';\r\n    \r\n    // Solo agregar servicios si existen\r\n    if (serviciosCategoria.length > 0) {\r\n      serviciosCategoria.forEach(servicio => {\r\n        const servicioEl = document.createElement('div');\r\n        servicioEl.className = 'flotante servicio';\r\n        if (servicio.promo) {\r\n            servicioEl.classList.add('descuento');\r\n        }\r\n        servicioEl.dataset.servicioId = servicio.id;\r\n        servicioEl.dataset.categoriaId = servicio.categoriaId;\r\n        servicioEl.dataset.servicio = servicio.nombre;\r\n        \r\n        // Calcular precio mostrado (con descuento si aplica)\r\n        const precioMostrado = servicio.promo ? \r\n            Math.round(servicio.precio * 0.75) : servicio.precio;\r\n        \r\n        servicioEl.innerHTML = `\r\n            <p class=\"p1\">${servicio.nombre}</p>\r\n            <p class=\"detalles-servicio\">\r\n                <span class=\"${servicio.promo ? 'precio-con-descuento' : ''}\">\r\n                    ${precioMostrado.toLocaleString()}\r\n                    ${servicio.promo ? \r\n                        `<span class=\"precio-original\">${servicio.precio.toLocaleString()}</span>` : \r\n                        ''\r\n                    }\r\n                    <svg\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"18\"\r\n                    height=\"18\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    fill=\"none\"\r\n                    stroke=\"#000000\"\r\n                    stroke-width=\"1\"\r\n                    stroke-linecap=\"round\"\r\n                    stroke-linejoin=\"round\"\r\n                    >\r\n                    <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                    <path d=\"M14.8 9a2 2 0 0 0 -1.8 -1h-2a2 2 0 1 0 0 4h2a2 2 0 1 1 0 4h-2a2 2 0 0 1 -1.8 -1\" />\r\n                    <path d=\"M12 7v10\" />\r\n                    </svg>\r\n                </span>\r\n                <span>${servicio.duracion} min\r\n                    <svg\r\n                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                    width=\"18\"\r\n                    height=\"18\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    fill=\"none\"\r\n                    stroke=\"#000000\"\r\n                    stroke-width=\"1\"\r\n                    stroke-linecap=\"round\"\r\n                    stroke-linejoin=\"round\"\r\n                    >\r\n                    <path d=\"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0\" />\r\n                    <path d=\"M12 12l3 -2\" />\r\n                    <path d=\"M12 7v5\" />\r\n                    </svg>\r\n                </span>\r\n            </p>\r\n            ${servicio.promo ? '<div class=\"badge-promo\">-25%</div>' : ''}\r\n            <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n        `;\r\n        \r\n        servicioEl.addEventListener('click', function(e) {\r\n          e.stopPropagation();\r\n          this.classList.toggle('seleccionado');\r\n          actualizarServiciosSeleccionados();\r\n        });\r\n        \r\n        serviciosContainer.appendChild(servicioEl);\r\n      });\r\n    } else {\r\n      // Mostrar mensaje cuando no hay servicios en la categora\r\n      serviciosContainer.innerHTML = '<p class=\"sin-servicios-categoria\">No hay servicios disponibles en esta categora</p>';\r\n      serviciosContainer.classList.add('sin-servicios');\r\n    }\r\n    \r\n    // Evento para expandir/colapsar la categora (toggle individual)\r\n    header.addEventListener('click', function() {\r\n    // Si no hay servicios, no hacer nada al hacer clic\r\n    if (serviciosCategoria.length === 0) return;\r\n    \r\n    const estaAbierto = serviciosContainer.classList.contains('activo');\r\n    \r\n    // Cerrar todas las dems categoras primero\r\n    document.querySelectorAll('.categoria-acordeon .servicios-container.activo').forEach(container => {\r\n        if (container !== serviciosContainer) {\r\n        container.classList.remove('activo');\r\n        container.closest('.categoria-acordeon').querySelector('.categoria-header').classList.remove('activo');\r\n        }\r\n    });\r\n    \r\n    // Alternar esta categora\r\n    serviciosContainer.classList.toggle('activo', !estaAbierto);\r\n    this.classList.toggle('activo', !estaAbierto);\r\n    });\r\n    \r\n    // Si no hay servicios, deshabilitar el header\r\n    if (serviciosCategoria.length === 0) {\r\n      header.classList.add('sin-servicios');\r\n      header.style.cursor = 'default';\r\n      header.querySelector('.acordeon-icon').style.display = 'none';\r\n    }\r\n    \r\n    // Ensamblar la categora\r\n    categoriaEl.appendChild(header);\r\n    categoriaEl.appendChild(serviciosContainer);\r\n    contenedorServicios.appendChild(categoriaEl);\r\n  });\r\n}\r\n\r\nfunction actualizarContadoresCategoria() {\r\n  // Ocultar todos los contadores primero\r\n  document.querySelectorAll('.contador-seleccionados-categoria').forEach(contador => {\r\n    contador.textContent = '';\r\n    contador.classList.remove('mostrar');\r\n  });\r\n  \r\n  // Contar servicios por categora\r\n  const serviciosPorCategoria = {};\r\n  \r\n  datosReserva.servicios.forEach(servicio => {\r\n    if (servicio.categoriaId) {\r\n      if (!serviciosPorCategoria[servicio.categoriaId]) {\r\n        serviciosPorCategoria[servicio.categoriaId] = 0;\r\n      }\r\n      serviciosPorCategoria[servicio.categoriaId]++;\r\n    }\r\n  });\r\n  \r\n  // Actualizar contadores\r\n  Object.keys(serviciosPorCategoria).forEach(categoriaId => {\r\n    const contador = document.querySelector(\r\n      `.categoria-header[data-categoria-id=\"${categoriaId}\"] .contador-seleccionados-categoria`\r\n    );\r\n    \r\n    if (contador && serviciosPorCategoria[categoriaId] > 0) {\r\n      contador.textContent = serviciosPorCategoria[categoriaId];\r\n      // Pequeo retraso para permitir que el DOM se actualice antes de la animacin\r\n      setTimeout(() => {\r\n        contador.classList.add('mostrar');\r\n      }, 10);\r\n    }\r\n  });\r\n}\r\n\r\nfunction debugServicios() {\r\n    console.log(\"=== DEBUG SERVICIOS ===\");\r\n    console.log(\"Servicios disponibles:\", datosReserva.serviciosDisponibles);\r\n    console.log(\"Servicios seleccionados:\", datosReserva.servicios);\r\n    \r\n    // Verificar elementos en el DOM\r\n    const serviciosDOM = document.querySelectorAll('.flotante.servicio');\r\n    serviciosDOM.forEach(serv => {\r\n        console.log(\"Elemento DOM:\", {\r\n            id: serv.getAttribute('data-servicio-id'),\r\n            nombre: serv.getAttribute('data-servicio'),\r\n            categoria: serv.getAttribute('data-categoria-id'),\r\n            texto: serv.textContent\r\n        });\r\n    });\r\n}\r\n\r\nfunction calcularDuracionTotal() {\r\n    return datosReserva.servicios.reduce((total, servicio) => total + servicio.duracion, 0);\r\n}\r\n\r\nasync function avanzarPaso() {\r\n    if (pasoActual >= totalPasos) return;\r\n  \r\n    try {\r\n        toggleLoader(true);\r\n\r\n        // Si estamos avanzando al paso 3, verificar si hay selecciones automticas\r\n        if (pasoActual === 2) {\r\n            const tieneAutomaticos = datosReserva.especialistas.some(esp => esp.id === 'auto');\r\n            \r\n            if (tieneAutomaticos) {\r\n                const success = await buscarEspecialistasAutomaticos();\r\n                if (!success) {\r\n                    toggleLoader(false);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        \r\n        const pasoValido = await validarPaso(pasoActual);\r\n        \r\n        if (!pasoValido) {\r\n            toggleLoader(false);\r\n            return;\r\n        }\r\n\r\n        pasoActual++;\r\n        actualizarInterfaz();\r\n        actualizarResumenContinuo(pasoActual);\r\n\r\n        setTimeout(() => {\r\n            scrollAlInicio();\r\n        }, 100); // Pequeo delay para asegurar que la UI se haya actualizado\r\n        \r\n        // Acciones especficas por paso\r\n        if (pasoActual === 4 && usuarioActual) {\r\n            autocompletarFormulario(usuarioActual);\r\n        }\r\n        \r\n        if (pasoActual === 5) {\r\n            try {\r\n                guardarDatosFormulario();\r\n                actualizarResumen();\r\n                cargarDatosGenerales();\r\n            } catch (error) {\r\n                console.error('Error actualizando resumen:', error);\r\n                mostrarError('Error al generar el resumen. Por favor, recarga la pgina.');\r\n                // Retroceder al paso anterior si hay error\r\n                pasoActual--;\r\n                actualizarInterfaz();\r\n            }\r\n        }\r\n        \r\n        if (pasoActual === 6) {\r\n            // Aqu va la lgica de confirmacin\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al avanzar paso:', error);\r\n        mostrarError('Ocurri un error al procesar la solicitud');\r\n    } finally {\r\n        toggleLoader(false);\r\n    }\r\n}\r\n\r\nfunction retrocederPaso() {\r\n    if (pasoActual > 1) {\r\n        switch (pasoActual) {\r\n            case 2: // Si retrocedemos a servicios\r\n                // Limpiar especialistas y forzar recarga\r\n                datosReserva.especialistas = [];\r\n                // Limpiar selecciones visuales\r\n                document.querySelectorAll('.flotante.especialista.seleccionado').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                });\r\n                document.querySelectorAll('.seleccion-predeterminada.seleccionado').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                    // Restaurar texto predeterminado\r\n                    const infoEspecialista = el.querySelector('.info-especialista');\r\n                    if (infoEspecialista) {\r\n                        infoEspecialista.innerHTML = '<span class=\"texto-predeterminado\">Selecciona un especialista</span>';\r\n                    }\r\n                });\r\n                break;\r\n                \r\n            case 3: // Si retrocedemos a fechas desde horarios\r\n                limpiarSeleccion('horario');\r\n                datosReserva.horario = null;\r\n                break;\r\n                \r\n            case 4: // Si retrocedemos a datos desde resumen\r\n                break;\r\n        }\r\n        \r\n        pasoActual--;\r\n        actualizarInterfaz();\r\n        actualizarResumenContinuo(pasoActual);\r\n\r\n        setTimeout(() => {\r\n            scrollAlInicio();\r\n        }, 100);\r\n        \r\n        // FORZAR RECARGA si volvemos al paso 2 (especialistas)\r\n        if (pasoActual === 2) {\r\n            // Recargar especialistas basado en servicios actuales\r\n            const categoriasIds = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            mostrarEspecialistas(categoriasIds);\r\n        }\r\n    }\r\n}\r\n\r\nfunction limpiarSeleccion(tipo) {\r\n    document.querySelectorAll(`.flotante.${tipo}.seleccionado`).forEach(elemento => {\r\n        elemento.classList.remove('seleccionado');\r\n    });\r\n    \r\n    const errorElement = document.getElementById(`error-${tipo}`);\r\n    if (errorElement) {\r\n        errorElement.classList.remove('visible');\r\n    }\r\n}\r\n\r\nfunction actualizarInterfaz() {\r\n    actualizarPasos();\r\n    actualizarBotones();\r\n    actualizarResumenContinuo(pasoActual);\r\n}\r\n\r\n// Funcin para hacer scroll al inicio del contenedor de pasos\r\nfunction scrollAlInicio() {\r\n    const contenedorMaqueta = document.querySelector('.contenedor-maqueta');\r\n    if (contenedorMaqueta) {\r\n        // Scroll suave al inicio del contenedor\r\n        contenedorMaqueta.scrollTo({\r\n            top: 0,\r\n            behavior: 'smooth'\r\n        });\r\n    }\r\n}\r\n\r\nasync function simularReserva() {\r\n    if (pasoActual === totalPasos) {\r\n        const loader = document.getElementById('reserva-loader');\r\n        const btnSiguiente = document.querySelector('.btn-siguiente');\r\n        const errorReserva = document.getElementById('error-reserva');\r\n        const duracionTotal = calcularDuracionTotal();\r\n\r\n        // Ocultar cualquier error previo\r\n        if (errorReserva) errorReserva.style.display = 'none';\r\n        \r\n        btnSiguiente.classList.add('hidden');\r\n        setTimeout(() => {\r\n        loader.style.display = 'inline-block';\r\n        }, 200);\r\n        \r\n        try {\r\n        // Validacin completa\r\n        const validacion = await validarDisponibilidadCompleta(\r\n            datosReserva.fecha, \r\n            datosReserva.horario,\r\n            duracionTotal\r\n        );\r\n        \r\n        if (!validacion.disponible) {\r\n            requestAnimationFrame(() => {\r\n            loader.style.display = 'none';\r\n            btnSiguiente.style.display = 'flex';\r\n            });\r\n            \r\n            console.error('Validacin fallida:', validacion);\r\n            \r\n            // Mostrar error en el elemento integrado\r\n            if (errorReserva) {\r\n            errorReserva.textContent = validacion.mensaje || \"El horario ya no est disponible\";\r\n            errorReserva.style.display = 'block';\r\n            }\r\n            return;\r\n        }\r\n\r\n        // DEBUG: Verificar la estructura de datosReserva.especialistas\r\n        console.log('Especialistas en datosReserva:', datosReserva.especialistas);\r\n\r\n        const especialistasPorCategoria = {};\r\n            datosReserva.especialistas.forEach(esp => {\r\n            especialistasPorCategoria[esp.categoriaId] = esp.id;\r\n            });\r\n\r\n        const serviciosIds = datosReserva.servicios.map(s => s.id);\r\n        \r\n        const turnoData = {\r\n            cliente: {\r\n                nombre: datosReserva.nombre,\r\n                email: datosReserva.email,\r\n                telefono: datosReserva.telefono\r\n            },\r\n            serviciosIds: datosReserva.servicios.map(s => s.id), //  Asegurar que esto sea un array de IDs\r\n            fecha: datosReserva.fecha,\r\n            horarioInicio: datosReserva.horario,\r\n            duracionTotal: duracionTotal,\r\n            montoTotal: calcularSubtotal(),\r\n            seaAbonada: datosReserva.reserva,\r\n            observaciones: datosReserva.observacion || '',\r\n            userId: usuarioActual ? usuarioActual.uid : null,\r\n            estado: 'pendiente',\r\n            especialistasPorCategoria: especialistasPorCategoria,\r\n            especialistaIds: datosReserva.especialistas.map(esp => esp.id)\r\n            };\r\n\r\n        // DEBUG: Verificar el objeto turnoData antes de guardar\r\n        console.log('Datos del turno a guardar:', turnoData);\r\n        console.log('Usuario actual:', usuarioActual);\r\n\r\n        // Guardar en Firestore\r\n        const turnoGuardado = await firestoreSeguro.guardarTurno(turnoData);\r\n\r\n        if (turnoGuardado) {\r\n            try {\r\n                await window.enviarEmailConfirmacion({\r\n                    nombre: datosReserva.nombre,\r\n                    email: datosReserva.email,\r\n                    fecha: datosReserva.fecha,\r\n                    horario: datosReserva.horario,\r\n                    servicios: datosReserva.servicios.map(s => s.nombre),\r\n                    especialistas: datosReserva.especialistas.map(e => e.nombre),\r\n                    reserva: datosReserva.reserva,\r\n                    montoTotal: calcularSubtotal()\r\n                });\r\n            } catch (error) {\r\n                console.error('Error al enviar email:', error);\r\n                // No impedir la reserva aunque falle el email\r\n            }\r\n        }\r\n\r\n        // Ocultar loader despues de reserva exitosa\r\n        loader.style.display = 'none';\r\n        \r\n        // Mostrar confirmacin de xito\r\n        mostrarConfirmacion(true);\r\n        \r\n        } catch (error) {\r\n        console.error('Error al reservar:', error);\r\n        // Restaurar UI si hay error\r\n        requestAnimationFrame(() => {\r\n            loader.style.display = 'none';\r\n            btnSiguiente.style.display = 'flex';\r\n        });\r\n        \r\n        // Mostrar error en el elemento integrado\r\n        if (errorReserva) {\r\n            errorReserva.textContent = 'Ocurri un error al procesar la reserva. Por favor, intenta nuevamente.';\r\n            errorReserva.style.display = 'block';\r\n        }\r\n        }\r\n    }\r\n}\r\n\r\nasync function completarReserva() {\r\n    let bloqueoId = null;\r\n    \r\n    try {\r\n        const userIdParaBloqueo = usuarioActual ? usuarioActual.uid : 'sesion_' + Date.now();\r\n\r\n        // 1. Crear bloqueo (con ID automtico)\r\n        bloqueoId = await firestoreSeguro.bloquearTurnoTemporal(\r\n        datosReserva.fecha,\r\n        datosReserva.horario,\r\n        userIdParaBloqueo\r\n        );\r\n\r\n        // 2. Validacin final\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        const [disponible, turnosSolapados] = await Promise.all([\r\n        firestoreSeguro.verificarDisponibilidad(datosReserva.fecha, datosReserva.horario),\r\n        firestoreSeguro.obtenerTurnosSolapados(\r\n            datosReserva.fecha, \r\n            datosReserva.horario,\r\n            config.duracionTurno\r\n        )\r\n        ]);\r\n\r\n        if (!disponible || turnosSolapados.length > 0) {\r\n            await firestoreSeguro.eliminarBloqueoTemporal(bloqueoId);\r\n            mostrarError(turnosSolapados.length > 0 \r\n                ? `El horario se solapa con un turno existente (${turnosSolapados[0].servicios.join(', ')})`\r\n                : \"El horario ya fue reservado\");\r\n            return;\r\n        }\r\n\r\n        // 3. Guardar turno\r\n        const turnoData = { /* ... tus datos de turno ... */ };\r\n        await firestoreDB.guardarTurno(turnoData);\r\n\r\n        // 4. Limpiar bloqueo\r\n        await firestoreDB.eliminarBloqueoTemporal(bloqueoId);\r\n\r\n        mostrarConfirmacion(true);\r\n    } catch (error) {\r\n        console.error(\"Error en reserva:\", error);\r\n        if (bloqueoId) {\r\n        await firestoreDB.eliminarBloqueoTemporal(bloqueoId).catch(e => console.error(\"Error limpiando bloqueo:\", e));\r\n        }\r\n        mostrarConfirmacion(false);\r\n    }\r\n}\r\n\r\n// Simular disponibilidad de turnos\r\nasync function inicializarDisponibilidad() {\r\n  try {\r\n    const config = await firestoreSeguro.obtenerConfiguracion();\r\n    // console.log(\"Configuracin procesada:\", {\r\n    //   apertura: config.horarioApertura,\r\n    //   cierre: config.horarioCierre,\r\n    //   diasLaborales: config.diasLaborales,\r\n    //   diasNoLaborables: config.diasNoLaborables\r\n    // });\r\n\r\n    const fechasDisponibles = generarFechasDisponibles(config);\r\n    // console.log(\"Fechas generadas:\", fechasDisponibles);\r\n    \r\n    actualizarUIFechas(fechasDisponibles);\r\n  } catch (error) {\r\n    console.error(\"Error inicializando disponibilidad:\", error);\r\n    mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n  }\r\n}\r\n\r\nasync function validarDisponibilidadCompleta(fecha, horario, duracion) {\r\n    try {\r\n        // Agregar validacin para horario\r\n        if (!horario) {\r\n            return {\r\n                disponible: false,\r\n                turnosSolapados: [],\r\n                slotsOcupados: [],\r\n                mensaje: \"Horario no seleccionado\"\r\n            };\r\n        }\r\n\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(esp => esp.id);\r\n        \r\n        // Convertir horario de inicio a minutos\r\n        const [horaStr, minutoStr] = horario.split(':');\r\n        const horaInicio = parseInt(horaStr);\r\n        const minutoInicio = parseInt(minutoStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        const finMinutos = inicioMinutos + duracion;\r\n        \r\n        // Obtener todos los turnos del da para los especialistas seleccionados\r\n        const turnosDelDia = await firestoreDB.obtenerTurnosPorEspecialistasYFecha(especialistasIds, fecha);\r\n        \r\n        // Verificar solapamientos solo para los especialistas seleccionados\r\n        const turnosSolapados = turnosDelDia.filter(turno => {\r\n            const [turnoHora, turnoMinuto] = turno.horarioInicio.split(':').map(Number);\r\n            const turnoInicioMin = turnoHora * 60 + turnoMinuto;\r\n            const turnoFinMin = turnoInicioMin + (turno.duracionTotal || 30);\r\n            \r\n            // Verificar solapamiento\r\n            return !(finMinutos <= turnoInicioMin || inicioMinutos >= turnoFinMin);\r\n        });\r\n        \r\n        // Verificar disponibilidad de cada slot individual para los especialistas seleccionados\r\n        const slotsOcupados = [];\r\n        for (let min = inicioMinutos; min < finMinutos; min += 30) {\r\n            const hora = Math.floor(min / 60);\r\n            const minuto = min % 60;\r\n            const horarioSlot = `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n            \r\n            // Verificar disponibilidad para los especialistas seleccionados\r\n            const disponible = await firestoreDB.verificarDisponibilidadParaEspecialistas(\r\n                fecha, \r\n                horarioSlot, \r\n                especialistasIds\r\n            );\r\n            \r\n            if (!disponible) {\r\n                slotsOcupados.push(horarioSlot);\r\n            }\r\n        }\r\n        \r\n        const disponible = turnosSolapados.length === 0 && slotsOcupados.length === 0;\r\n        \r\n        let mensaje = '';\r\n        if (!disponible) {\r\n            const horas = Math.floor(duracion / 60);\r\n            const minutos = duracion % 60;\r\n            \r\n            mensaje = `Tu turno necesita ${horas > 0 ? horas + ' hora' + (horas > 1 ? 's' : '') + ' y ' : ''}${minutos} minutos continuos.`;\r\n        }\r\n        \r\n        return {\r\n            disponible,\r\n            turnosSolapados,\r\n            slotsOcupados,\r\n            mensaje\r\n        };\r\n    } catch (error) {\r\n        console.error(\"Error en validacin:\", error);\r\n        return {\r\n            disponible: false,\r\n            turnosSolapados: [],\r\n            slotsOcupados: [],\r\n            mensaje: \"Error al verificar disponibilidad. Por favor, intenta nuevamente.\"\r\n        };\r\n    }\r\n}\r\n\r\nasync function cargarFechasDisponibles() {\r\n    if (!datosReserva.especialistas.length) return;\r\n    \r\n    try {\r\n        // Obtener fechas disponibles considerando TODOS los especialistas\r\n        const fechasComunes = await obtenerFechasComunesDisponibles();\r\n        actualizarUIFechas(fechasComunes);\r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n    }\r\n}\r\n\r\nasync function obtenerFechasComunesDisponibles() {\r\n    const config = await firestoreSeguro.obtenerConfiguracion();\r\n    const todasLasFechas = generarFechasDisponibles(config);\r\n    \r\n    // Filtrar fechas donde TODOS los especialistas estn disponibles\r\n    const fechasValidas = [];\r\n    \r\n    for (const fecha of todasLasFechas) {\r\n        const todosDisponibles = await verificarDisponibilidadEspecialistas(fecha);\r\n        if (todosDisponibles) {\r\n            fechasValidas.push(fecha);\r\n        }\r\n    }\r\n    \r\n    return fechasValidas;\r\n}\r\n\r\n// Nueva funcin para generar fechas disponibles\r\nfunction generarFechasDisponibles(config) {\r\n    // Obtener fecha y hora actual en Argentina (UTC-3)\r\n    const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n    const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n    \r\n    // Verificar si ya pas el horario de cierre (usando hora Argentina)\r\n    const [horaCierre, minCierre] = config.horarioCierre.split(':').map(Number);\r\n    const empezarDesdeManana = ahoraArg.getHours() > horaCierre || (ahoraArg.getHours() === horaCierre && ahoraArg.getMinutes() >= minCierre);\r\n\r\n    const fechasDisponibles = [];\r\n    const DIAS_A_MOSTRAR = 7;\r\n    \r\n    // Comenzar desde hoy o maana segn horario\r\n    const diaInicial = empezarDesdeManana ? 1 : 0;\r\n    \r\n    for (let i = diaInicial; i < DIAS_A_MOSTRAR + diaInicial; i++) {\r\n        const fecha = new Date(hoyArg);\r\n        fecha.setDate(hoyArg.getDate() + i);\r\n        \r\n        // Verificar da laboral (usando fecha Argentina)\r\n        if (!esDiaLaboral(fecha, config)) {\r\n            // console.log(`Saltando ${fecha.toDateString()} - No es da laboral`);\r\n            continue;\r\n        }\r\n        \r\n        const fechaStr = fecha.toISOString().split('T')[0];\r\n        \r\n        // Verificar das no laborables\r\n        if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n            // console.log(`Saltando ${fechaStr} - Da no laborable configurado`);\r\n            continue;\r\n        }\r\n        \r\n        // No agregar hoy si ya pas el horario de cierre\r\n        if (i === 0 && empezarDesdeManana) continue;\r\n        \r\n        fechasDisponibles.push({\r\n            fecha: fechaStr,\r\n            display: formatearFechaDisplay(fecha)\r\n        });\r\n    }\r\n    \r\n    // console.log(\"Fechas disponibles generadas:\", fechasDisponibles);\r\n    return fechasDisponibles;\r\n}\r\n\r\nfunction esDiaLaboral(fecha, config) {\r\n  const diaSemana = fecha.getDay(); // 0=Domingo, 1=Lunes, etc.\r\n  \r\n  // Asegurarnos que diasLaborales es un array de nmeros vlidos\r\n  let diasLaborales = [];\r\n  \r\n  try {\r\n    if (Array.isArray(config.diasLaborales)) {\r\n      diasLaborales = config.diasLaborales.map(Number).filter(n => !isNaN(n));\r\n    } else if (typeof config.diasLaborales === 'string') {\r\n      diasLaborales = config.diasLaborales.split(',').map(Number).filter(n => !isNaN(n));\r\n    }\r\n  } catch (e) {\r\n    console.error(\"Error procesando das laborales:\", e);\r\n    diasLaborales = [1,2,3,4,5]; // Valor por defecto: Lunes a Viernes\r\n  }\r\n  \r\n  // Si no hay das definidos, usar valor por defecto\r\n  if (diasLaborales.length === 0) {\r\n    diasLaborales = [1,2,3,4,5];\r\n  }\r\n  \r\n  return diasLaborales.includes(diaSemana);\r\n}\r\n\r\nfunction obtenerFechaSeleccionada() {\r\n  // Asume que la fecha est en formato \"Lunes 9/01\" o similar\r\n  // Necesitas convertir esto a un formato que coincida con tu DB (YYYY-MM-DD)\r\n  if (!datosReserva.fecha) return new Date().toISOString().split('T')[0];\r\n  \r\n  // Implementacin bsica - ajusta segn tu formato de fecha\r\n  const partes = datosReserva.fecha.split(' ');\r\n  const [dia, mes] = partes[1].split('/');\r\n  const ao = new Date().getFullYear();\r\n  \r\n  return `${ao}-${mes.padStart(2, '0')}-${dia.padStart(2, '0')}`;\r\n}\r\n\r\nasync function actualizarUIFechas(fechasDisponibles) {\r\n    console.log(\"Actualizando UI con fechas:\", fechasDisponibles);\r\n    \r\n    // Guardar las fechas disponibles para el calendario\r\n    fechasDisponiblesCalendario = fechasDisponibles || [];\r\n    \r\n    // Ocultar mensaje de carga\r\n    const cargandoFechas = document.querySelector('.cargando-fechas');\r\n    const contenedorCalendario = document.querySelector('.contenedor-calendario');\r\n    const sinFechas = document.querySelector('.sin-fechas');\r\n    \r\n    if (cargandoFechas) cargandoFechas.style.display = 'none';\r\n    \r\n    if (!fechasDisponibles || fechasDisponibles.length === 0) {\r\n        console.log(\"No hay fechas disponibles\");\r\n        if (sinFechas) {\r\n            sinFechas.style.display = 'block';\r\n            sinFechas.textContent = 'No hay fechas disponibles en este momento';\r\n        }\r\n        if (contenedorCalendario) {\r\n            contenedorCalendario.style.display = 'none';\r\n        }\r\n        return;\r\n    }\r\n    \r\n    // Mostrar el calendario\r\n    if (contenedorCalendario) {\r\n        contenedorCalendario.style.display = 'block';\r\n    }\r\n    if (sinFechas) {\r\n        sinFechas.style.display = 'none';\r\n    }\r\n    \r\n    // NUEVA LGICA: Buscar la primera fecha disponible de los especialistas seleccionados\r\n    const primeraFechaDisponible = await obtenerPrimeraFechaDisponibleEspecialistas();\r\n    \r\n    if (primeraFechaDisponible) {\r\n        // Cambiar el calendario al mes de la primera fecha disponible\r\n        const fechaPrimera = new Date(primeraFechaDisponible + 'T03:00:00');\r\n        calendarioFechaActual = new Date(fechaPrimera.getFullYear(), fechaPrimera.getMonth(), 1);\r\n    } else {\r\n        // Fallback: usar la primera fecha disponible de la lista\r\n        calendarioFechaActual = new Date();\r\n    }\r\n    \r\n    // Renderizar el calendario\r\n    renderizarCalendario();\r\n    debugVisualizacionFechas();\r\n    \r\n    // Seleccionar automticamente la primera fecha disponible\r\n    if (primeraFechaDisponible) {\r\n        seleccionarFechaAutomaticamente(primeraFechaDisponible);\r\n    } else if (fechasDisponibles.length > 0) {\r\n        // Fallback: seleccionar la primera fecha de la lista\r\n        seleccionarFechaAutomaticamente(fechasDisponibles[0].fecha);\r\n    }\r\n}\r\n\r\nasync function obtenerPrimeraFechaDisponibleEspecialistas() {\r\n    try {\r\n        if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n            return null;\r\n        }\r\n        \r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        const hoy = new Date();\r\n        const hoyArg = new Date(hoy.toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n        \r\n        // Buscar en los prximos 60 das\r\n        for (let i = 0; i < 60; i++) {\r\n            const fecha = new Date(hoyArg);\r\n            fecha.setDate(hoyArg.getDate() + i);\r\n            const fechaStr = fecha.toISOString().split('T')[0];\r\n            \r\n            // Verificar si es da laboral segn configuracin general\r\n            if (!esDiaLaboral(fecha, config)) {\r\n                continue;\r\n            }\r\n            \r\n            // Verificar das no laborables\r\n            if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n                continue;\r\n            }\r\n            \r\n            // Verificar disponibilidad de TODOS los especialistas seleccionados\r\n            const todosDisponibles = await verificarDisponibilidadEspecialistas(fechaStr);\r\n            \r\n            if (todosDisponibles) {\r\n                console.log(` Primera fecha disponible encontrada: ${fechaStr}`);\r\n                return fechaStr;\r\n            }\r\n        }\r\n        \r\n        console.log(\" No se encontr fecha disponible en los prximos 60 das\");\r\n        return null;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error obteniendo primera fecha disponible:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Inicializar el calendario cuando se cargue la pgina\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    inicializarCalendario();\r\n});\r\n\r\n// Funcin para cargar horarios para una fecha especfica\r\nasync function cargarHorariosParaFecha(fecha) {\r\n    try {\r\n        // Mostrar loader\r\n        const cargandoHorarios = document.querySelector('.cargando-horarios');\r\n        const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n        const sinHorarios = document.querySelector('.sin-horarios');\r\n        \r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'block';\r\n        if (contenedorHorarios) contenedorHorarios.innerHTML = '';\r\n        if (sinHorarios) sinHorarios.style.display = 'none';\r\n        \r\n        // Obtener IDs de especialistas seleccionados\r\n        const especialistasIds = datosReserva.especialistas.map(e => e.id);\r\n        const duracionTotal = calcularDuracionTotal();\r\n        \r\n        console.log(`Buscando horarios para ${fecha} con duracin: ${duracionTotal} minutos`);\r\n        \r\n        // Obtener horarios disponibles considerando todos los especialistas y la duracin\r\n        const horariosDisponibles = await firestoreDB.obtenerHorariosComunesDisponibles(\r\n            fecha, \r\n            especialistasIds, \r\n            duracionTotal\r\n        );\r\n        \r\n        console.log(`Horarios disponibles encontrados: ${horariosDisponibles.length}`);\r\n        \r\n        // Si es hoy, filtrar horarios que ya pasaron\r\n        const hoy = new Date().toISOString().split('T')[0];\r\n        let horariosFiltrados = horariosDisponibles;\r\n        \r\n        if (fecha === hoy) {\r\n            // CORRECCIN: Solo filtrar por hora actual, la duracin ya se consider en Firestore\r\n            horariosFiltrados = filtrarHorariosPorHoraActual(horariosDisponibles, duracionTotal);\r\n            console.log(`Horarios despus de filtrar por hora actual: ${horariosFiltrados.length}`);\r\n        }\r\n\r\n        // Ocultar loader\r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'none';\r\n        \r\n        // Actualizar UI\r\n        actualizarUIHorarios(horariosFiltrados);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando horarios:\", error);\r\n        mostrarError(\"No se pudieron cargar los horarios disponibles\");\r\n        \r\n        // Ocultar loader en caso de error\r\n        const cargandoHorarios = document.querySelector('.cargando-horarios');\r\n        if (cargandoHorarios) cargandoHorarios.style.display = 'none';\r\n    }\r\n}\r\n\r\n// Funcin para filtrar horarios por hora actual\r\nfunction filtrarHorariosPorHoraActual(horarios, duracionTotal) {\r\n    const ahora = new Date();\r\n    const horaActual = ahora.getHours();\r\n    const minutoActual = ahora.getMinutes();\r\n    const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n    \r\n    console.log(`Filtrando horarios para hoy - Hora actual: ${horaActual}:${minutoActual}`);\r\n    console.log(`Se requieren horarios despus de: ${tiempoActualMinutos + 30} minutos (${Math.floor((tiempoActualMinutos + 30) / 60)}:${(tiempoActualMinutos + 30) % 60})`);\r\n    \r\n    const horariosFiltrados = horarios.filter(horario => {\r\n        const [horaStr, minutoStr] = horario.split(':');\r\n        const horaHorario = parseInt(horaStr);\r\n        const minutoHorario = parseInt(minutoStr);\r\n        const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n        \r\n        // Solo considerar el buffer de 30 minutos\r\n        return tiempoHorarioMinutos >= (tiempoActualMinutos + 30);\r\n    });\r\n    \r\n    console.log(`Horarios despus de filtrar: ${horariosFiltrados.length}`);\r\n    return horariosFiltrados;\r\n}\r\n\r\nfunction encontrarHorariosComunes(horariosPorEspecialista) {\r\n    const especialistasIds = Object.keys(horariosPorEspecialista);\r\n    if (especialistasIds.length === 0) return [];\r\n    \r\n    // Empezar con los horarios del primer especialista\r\n    let horariosComunes = horariosPorEspecialista[especialistasIds[0]];\r\n    \r\n    // Intersectar con los horarios de los dems especialistas\r\n    for (let i = 1; i < especialistasIds.length; i++) {\r\n        const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n        horariosComunes = horariosComunes.filter(hora => \r\n            horariosEspecialista.includes(hora)\r\n        );\r\n    }\r\n    \r\n    return horariosComunes;\r\n}\r\n\r\nasync function generarHorariosDisponibles(fecha) {\r\n  const [config, turnosOcupados] = await Promise.all([\r\n    this.obtenerConfiguracion(),\r\n    this.obtenerTurnosPorFecha(fecha)\r\n  ]);\r\n  \r\n  const horariosOcupados = turnosOcupados.map(t => t.horario);\r\n  const horarios = this._generarHorarios(config, horariosOcupados, fecha);\r\n  \r\n  // console.log(\"Horarios generados para\", fecha, \":\", horarios);\r\n  return horarios;\r\n}\r\n\r\n// Funcin para actualizar la UI de horarios\r\nfunction actualizarUIHorarios(horariosDisponibles) {\r\n    const contenedor = document.querySelector('.contenedor-horarios');\r\n    const sinHorarios = document.querySelector('.sin-horarios');\r\n    \r\n    if (!contenedor) return;\r\n    \r\n    // Limpiar contenedor\r\n    contenedor.innerHTML = '';\r\n    \r\n    // Mostrar mensaje si no hay horarios\r\n    if (!horariosDisponibles || horariosDisponibles.length === 0) {\r\n        if (sinHorarios) {\r\n            sinHorarios.style.display = 'block';\r\n            sinHorarios.textContent = 'No hay horarios disponibles para esta fecha';\r\n        }\r\n        return;\r\n    }\r\n    \r\n    // Ocultar mensaje de no horarios\r\n    if (sinHorarios) sinHorarios.style.display = 'none';\r\n    \r\n    // Crear elementos de horarios\r\n    horariosDisponibles.forEach(horario => {\r\n        const elemento = document.createElement('div');\r\n        elemento.className = 'flotante horario';\r\n        elemento.dataset.horario = horario;\r\n        \r\n        elemento.innerHTML = `\r\n            <p class=\"p1\">${horario}</p>\r\n            <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n            </svg>\r\n        `;\r\n        \r\n        elemento.addEventListener('click', function() {\r\n            seleccionarHorario(this, horario);\r\n        });\r\n        \r\n        contenedor.appendChild(elemento);\r\n    });\r\n}\r\n\r\nasync function verificarDisponibilidadEnTiempoReal(fecha, horario) {\r\n  try {\r\n    const disponible = await firestoreSeguro.verificarDisponibilidad(fecha, horario);\r\n    if (!disponible) {\r\n      mostrarError('Este horario ya no est disponible. Por favor selecciona otro.');\r\n      // Remover el horario ocupado de la UI\r\n      document.querySelectorAll('.flotante.horario').forEach(el => {\r\n        if (el.textContent.trim() === horario) {\r\n          el.classList.add('ocupado');\r\n          el.removeEventListener('click', manejarClickHorario);\r\n        }\r\n      });\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error verificando disponibilidad:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Funcin auxiliar para crear el contenedor si no existe\r\nfunction crearContenedorHorarios(paso3) {\r\n  const contenedor = document.createElement('div');\r\n  contenedor.className = 'contenedor-horarios';\r\n  paso3.appendChild(contenedor);\r\n  return contenedor;\r\n}\r\n\r\n// Funciones de apoyo\r\nfunction actualizarPasos() {\r\n    elementos.pasos.forEach((paso, index) => {\r\n        paso.classList.toggle('activo', index + 1 === pasoActual);\r\n    });\r\n}\r\n\r\nfunction actualizarBotones() {\r\n    // Ocultar spinner al cambiar de paso\r\n    const loader = document.getElementById('reserva-loader');\r\n    if (loader) loader.style.display = 'none';\r\n\r\n    // Botn anterior\r\n    if (pasoActual === 1) {\r\n        elementos.btnAnterior.classList.remove('activo');\r\n    } else {\r\n        elementos.btnAnterior.classList.add('activo');\r\n    }\r\n    \r\n    // Limpiar eventos previos del botn siguiente\r\n    elementos.btnSiguiente.replaceWith(elementos.btnSiguiente.cloneNode(true));\r\n    elementos.btnSiguiente = document.querySelector('.btn-siguiente');\r\n    \r\n    // Configurar botn siguiente segn el paso actual\r\n    if (pasoActual === totalPasos) {\r\n        elementos.btnSiguiente.classList.add('btn-reserva');\r\n        elementos.btnSiguiente.innerHTML = `\r\n            <span class=\"circulo\" aria-hidden=\"true\">\r\n                <span class=\"icono-flecha flecha\"></span>\r\n            </span>\r\n            <span class=\"texto-reserva\">Reservar</span>\r\n        `;\r\n        elementos.btnSiguiente.addEventListener('click', async () => {\r\n            await simularReserva();\r\n        });\r\n    } else {\r\n        elementos.btnSiguiente.classList.remove('btn-reserva');\r\n        elementos.btnSiguiente.innerHTML = `\r\n            <svg class=\"flecha\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\">\r\n                <path d=\"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z\" fill=\"ffffff\"/>\r\n            </svg>\r\n        `;\r\n        elementos.btnSiguiente.addEventListener('click', avanzarPaso);\r\n    }\r\n}\r\n\r\nfunction seleccionarElemento(elemento, tipo) {\r\n    // Si ya est seleccionado y es servicio, deseleccionar\r\n    if (elemento.classList.contains('seleccionado') && tipo === 'servicio') {\r\n        elemento.classList.remove('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n        return;\r\n    }\r\n\r\n    // Para servicios (seleccin mltiple)\r\n    if (tipo === 'servicio') {\r\n        elemento.classList.add('seleccionado');\r\n        actualizarServiciosSeleccionados();\r\n    } \r\n    // Para fechas/horarios (seleccin nica)\r\n    else {\r\n        document.querySelectorAll(`.flotante.${tipo}`).forEach(el => {\r\n            el.classList.remove('seleccionado');\r\n        });\r\n        elemento.classList.add('seleccionado');\r\n        datosReserva[tipo] = elemento.querySelector('.p1').textContent;\r\n        \r\n        // Remover mensaje de error si se selecciona\r\n        if (tipo === 'fecha') {\r\n            document.getElementById('error-fecha').classList.remove('visible');\r\n        } else if (tipo === 'horario') {\r\n            document.getElementById('error-horario').classList.remove('visible');\r\n        }\r\n    }\r\n}\r\n\r\nasync function validarPaso(paso) {\r\n    const pasoElement = document.querySelector(`.paso-${paso}`);\r\n    if (!pasoElement) {\r\n        console.error(`Elemento del paso ${paso} no encontrado`);\r\n        return false;\r\n    }\r\n\r\n    // Ocultar todos los mensajes de error primero\r\n    const errores = pasoElement.querySelectorAll('.error-mensaje');\r\n    if (errores) {\r\n        errores.forEach(msg => msg.classList.remove('visible'));\r\n    }\r\n\r\n    switch (paso) {\r\n        case 1: \r\n        const errorServicio = pasoElement.querySelector('#error-servicio');\r\n        if (datosReserva.servicios.length === 0) {\r\n            if (errorServicio) {\r\n                errorServicio.classList.add('visible');\r\n                errorServicio.style.animation = 'shake 0.5s';\r\n                setTimeout(() => errorServicio.style.animation = '', 500);\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n            \r\n        case 2: // Validacin especialistas\r\n            const errorEspecialista = document.getElementById('error-especialista');\r\n            \r\n            // Verificar que tenemos un especialista para cada categora de servicios seleccionados\r\n            const categoriasServicios = [...new Set(datosReserva.servicios.map(s => s.categoriaId))];\r\n            const categoriasConEspecialista = [...new Set(datosReserva.especialistas.map(e => e.categoriaId))];\r\n            \r\n            const todasCategoriasCubiertas = categoriasServicios.every(categoriaId => \r\n                categoriasConEspecialista.includes(categoriaId)\r\n            );\r\n            \r\n            if (!todasCategoriasCubiertas) {\r\n                if (errorEspecialista) {\r\n                    errorEspecialista.textContent = 'Selecciona un especialista para cada categora de servicios!';\r\n                    errorEspecialista.classList.add('visible');\r\n                }\r\n                return false;\r\n            }\r\n            return true;\r\n            \r\n        case 3: // Fechas y Horarios\r\n            const errorFecha = document.getElementById('error-fecha');\r\n            const errorHorario = document.getElementById('error-horario');\r\n            \r\n            // DEBUG: Verificar los valores actuales\r\n            console.log('Validando paso 3 - fecha:', datosReserva.fecha, 'horario:', datosReserva.horario);\r\n            \r\n            if (!datosReserva.fecha) {\r\n                if (errorFecha) errorFecha.classList.add('visible');\r\n                return false;\r\n            }\r\n            \r\n            if (!datosReserva.horario) {\r\n                if (errorHorario) errorHorario.classList.add('visible');\r\n                return false;\r\n            }\r\n            \r\n            // Validar disponibilidad en tiempo real\r\n            toggleLoader(true);\r\n            try {\r\n                const duracionTotal = calcularDuracionTotal();\r\n                const validacion = await validarDisponibilidadCompleta(\r\n                    datosReserva.fecha, \r\n                    datosReserva.horario,\r\n                    duracionTotal\r\n                );\r\n                \r\n                if (!validacion.disponible || validacion.turnosSolapados.length > 0) {\r\n                    mostrarError(validacion.mensaje || 'El horario ya no est disponible para la duracin requerida');\r\n                    return false;\r\n                }\r\n                return true;\r\n            } finally {\r\n                toggleLoader(false);\r\n            }\r\n            \r\n        case 4:\r\n            // Validacin de campos del formulario\r\n            const formularioValido = validarFormulario();\r\n            \r\n            if (!formularioValido) {\r\n                // Mostrar mensaje general de error\r\n                const errorGeneral = document.createElement('div');\r\n                errorGeneral.className = 'error-general visible';\r\n                errorGeneral.innerHTML = `\r\n                    <svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\">\r\n                        <path fill=\"#ff6b6b\" d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>\r\n                    </svg>\r\n                    <span>Completa todos los campos correctamente para continuar</span>\r\n                `;\r\n                \r\n                return false;\r\n            }\r\n            \r\n            // Si el formulario es vlido, quitar cualquier error general\r\n            const errorGeneralExistente = document.querySelector('.error-general');\r\n            if (errorGeneralExistente) {\r\n                errorGeneralExistente.remove();\r\n            }\r\n            \r\n            return true;\r\n            \r\n        case 5:\r\n            return validarFormulario();\r\n            \r\n        default:\r\n            return true;\r\n    }\r\n}\r\n\r\nfunction validarFormulario() {\r\n    let valido = true;\r\n    \r\n    // Ocultar todos los mensajes de error primero\r\n    document.querySelectorAll('.error-mensaje').forEach(msg => {\r\n        msg.classList.remove('visible');\r\n    });\r\n    \r\n    // Validar cada campo\r\n    const nombreValido = validarNombre();\r\n    const emailValido = validarEmail();\r\n    const telefonoValido = validarTelefono();\r\n    \r\n    // Mostrar errores generales si los campos estn vacos\r\n    if (!document.getElementById('nombre').value.trim()) {\r\n        document.getElementById('error-nombre').textContent = 'El nombre es obligatorio';\r\n        document.getElementById('error-nombre').classList.add('visible');\r\n        document.getElementById('nombre').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    if (!document.getElementById('email').value.trim()) {\r\n        document.getElementById('error-email').textContent = 'El email es obligatorio';\r\n        document.getElementById('error-email').classList.add('visible');\r\n        document.getElementById('email').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    if (!document.getElementById('telefono').value) {\r\n        document.getElementById('error-telefono').textContent = 'El telfono es obligatorio';\r\n        document.getElementById('error-telefono').classList.add('visible');\r\n        document.getElementById('telefono').classList.add('invalido');\r\n        valido = false;\r\n    }\r\n    \r\n    // Si hay valores pero son invlidos\r\n    if (!nombreValido && document.getElementById('nombre').value.trim()) {\r\n        valido = false;\r\n    }\r\n    \r\n    if (!emailValido && document.getElementById('email').value.trim()) {\r\n        valido = false;\r\n    }\r\n    \r\n    if (!telefonoValido && document.getElementById('telefono').value) {\r\n        valido = false;\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction guardarDatosFormulario() {\r\n    datosReserva.nombre = document.getElementById('nombre').value.trim();\r\n    datosReserva.email = document.getElementById('email').value.trim();\r\n    datosReserva.telefono = document.getElementById('telefono').value.trim();\r\n    datosReserva.observacion = document.getElementById('observacion').value.trim() || 'Sin observaciones';\r\n}\r\n\r\nfunction actualizarResumen() {\r\n    guardarDatosFormulario();\r\n\r\n    // 1. Datos del cliente\r\n    elementos.resumenNombre.textContent = datosReserva.nombre || \"[No ingresado]\";\r\n    elementos.resumenEmail.textContent = datosReserva.email || \"[No ingresado]\";\r\n    elementos.resumenTelefono.textContent = datosReserva.telefono || \"[No ingresado]\";\r\n}\r\n\r\n// Funcin para calcular la sea basada en la duracin\r\nfunction calcularSenia() {\r\n    const duracionTotal = calcularDuracionTotal();\r\n    // $1.000 por cada 30 minutos, redondeando hacia arriba\r\n    const multiplicador = Math.ceil(duracionTotal / 30);\r\n    return multiplicador * 1000;\r\n}\r\n\r\nfunction validarNombre() {\r\n    const input = document.getElementById('nombre');\r\n    const errorMsg = document.getElementById('error-nombre');\r\n    const valor = input.value.trim();\r\n    \r\n    // Validar que tenga al menos 2 palabras con mnimo 2 caracteres cada una\r\n    const palabras = valor.split(' ').filter(word => word.length > 1);\r\n    const valido = palabras.length >= 1 && valor.length >= 5;\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'Debe tener al menos 5 caracteres';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction validarTelefono() {\r\n    const input = document.getElementById('telefono');\r\n    const errorMsg = document.getElementById('error-telefono');\r\n    const valor = input.value.replace(/\\D/g, ''); // Solo nmeros\r\n    const valido = valor.length === 10; // 10 dgitos para Argentina\r\n    \r\n    // Actualizar el valor solo con nmeros\r\n    input.value = valor;\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'El telfono debe tener 10 nmeros';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\n// Nueva funcin para validar email\r\nfunction validarEmail() {\r\n    const input = document.getElementById('email');\r\n    const errorMsg = document.getElementById('error-email');\r\n    const valor = input.value.trim();\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    const valido = emailRegex.test(valor);\r\n    \r\n    if (valido) {\r\n        input.classList.remove('invalido');\r\n        errorMsg.classList.remove('visible');\r\n    } else {\r\n        input.classList.add('invalido');\r\n        if (valor.length > 0) {\r\n            errorMsg.textContent = 'Ingresa un email vlido';\r\n            errorMsg.classList.add('visible');\r\n        }\r\n    }\r\n    \r\n    return valido;\r\n}\r\n\r\nfunction mostrarConfirmacion() {\r\n    // Ocultar todos los pasos\r\n    document.querySelectorAll('.paso').forEach(paso => {\r\n        paso.classList.remove('activo');\r\n    });\r\n    \r\n    // Ocultar resumen continuo\r\n    const resumenContinuo = document.querySelector('.resumen-continuo');\r\n    if (resumenContinuo) {\r\n        resumenContinuo.style.display = 'none';\r\n    }\r\n    \r\n    // Mostrar paso 6\r\n    const paso6 = document.querySelector('.paso-6');\r\n    paso6.classList.add('activo');\r\n    \r\n    // SVG para xito (usando tu SVG actual)\r\n    const successSVG = `\r\n    <div class=\"check-icon\">\r\n        <span class=\"icon-line line-tip\"></span>\r\n        <span class=\"icon-line line-long\"></span>\r\n        <div class=\"icon-circle\"></div>\r\n        <div class=\"icon-fix\"></div>\r\n    </div>\r\n    `;\r\n    \r\n    // Botn SVG (usando tu SVG actual)\r\n    const buttonSVG = `\r\n        <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"20\"\r\n        height=\"20\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"1.5\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M15 4.55a8 8 0 0 0 -6 14.9m0 -4.45v5h-5\" />\r\n        <path d=\"M18.37 7.16l0 .01\" />\r\n        <path d=\"M13 19.94l0 .01\" />\r\n        <path d=\"M16.84 18.37l0 .01\" />\r\n        <path d=\"M19.37 15.1l0 .01\" />\r\n        <path d=\"M19.94 11l0 .01\" />\r\n        </svg>\r\n    `;\r\n\r\n    // Mostrar solo el estado de xito\r\n    const exitoContainer = document.querySelector('.paso-6 .exito');\r\n    exitoContainer.innerHTML = `\r\n        ${successSVG}\r\n        <h2>Turno reservado!</h2>\r\n        <p>Buensimo <span>${datosReserva.nombre || 'cliente'}</span>, recibirs un email de confirmacin con los datos de tu reserva.</p>\r\n        <p class=\"nos-vemos\">Nos vemos en el local!</p>\r\n    `;\r\n    \r\n    document.querySelector('.paso-6 .exito').classList.add('visible');\r\n    \r\n    // Ocultar controles de navegacin\r\n    elementos.btnAnterior.style.display = 'none';\r\n    elementos.btnSiguiente.style.display = 'none';\r\n    \r\n    // Botn para nueva reserva\r\n    if (!document.getElementById('nueva-reserva')) {\r\n        const botonNuevaReserva = `\r\n            <button id=\"nueva-reserva\" class=\"btn-reserva\">\r\n                ${buttonSVG}\r\n                Volver\r\n            </button>\r\n        `;\r\n        paso6.insertAdjacentHTML('beforeend', botonNuevaReserva);\r\n        \r\n        document.getElementById('nueva-reserva').addEventListener('click', () => {\r\n            location.reload();\r\n        });\r\n    }\r\n}\r\n\r\n// Funcin para probar el paso 6 sin hacer una reserva real\r\nfunction demoPaso6() {\r\n    // Simular datos de reserva\r\n    const datosDemo = {\r\n        servicios: [\r\n            { nombre: 'Corte de pelo', precio: 15000, duracion: 30 },\r\n            { nombre: 'Teido', precio: 40000, duracion: 60 }\r\n        ],\r\n        fecha: '2025-01-20',\r\n        horario: '10:00',\r\n        nombre: 'Cliente Demo',\r\n        email: 'demo@email.com',\r\n        telefono: '1234567890',\r\n        reserva: 1000,\r\n        especialistas: [\r\n            { id: 'esp_1', nombre: 'Especialista Demo', categoriaId: 'cat_1' }\r\n        ]\r\n    };\r\n    \r\n    // Guardar datos de demo\r\n    datosReserva = { ...datosReserva, ...datosDemo };\r\n    \r\n    // Ocultar todos los pasos\r\n    document.querySelectorAll('.paso').forEach(paso => {\r\n        paso.classList.remove('activo');\r\n    });\r\n    \r\n    // Mostrar paso 6\r\n    const paso6 = document.querySelector('.paso-6');\r\n    paso6.classList.add('activo');\r\n    \r\n    // Mostrar confirmacin\r\n    mostrarConfirmacion();\r\n    \r\n    // Ocultar botones de navegacin\r\n    elementos.btnAnterior.style.display = 'none';\r\n    elementos.btnSiguiente.style.display = 'none';\r\n}\r\n\r\n// Hacer la funcin accesible globalmente para probar desde la consola\r\nwindow.demoPaso6 = demoPaso6;\r\n\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n//////////////////////////////\r\n\r\nfunction seleccionarEspecialista(elemento, especialista, categoriaId) {\r\n    // Validar parmetros\r\n    if (!especialista || !categoriaId) {\r\n        console.error('Parmetros invlidos en seleccionarEspecialista:', { elemento, especialista, categoriaId });\r\n        return;\r\n    }\r\n    \r\n    // Obtener el contenedor de la categora\r\n    const categoriaSection = document.querySelector(`.categoria-especialistas[data-categoria-id=\"${categoriaId}\"]`);\r\n    if (!categoriaSection) return;\r\n    \r\n    const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n    const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n    const infoEspecialista = seleccionPredeterminada.querySelector('.info-especialista');\r\n    \r\n    // Verificar si ya est seleccionado para esta categora\r\n    const especialistaExistenteIndex = datosReserva.especialistas.findIndex(\r\n        e => e.categoriaId === categoriaId\r\n    );\r\n    \r\n    // Si ya hay un especialista para esta categora, eliminarlo\r\n    if (especialistaExistenteIndex !== -1) {\r\n        datosReserva.especialistas.splice(especialistaExistenteIndex, 1);\r\n    }\r\n    \r\n    //  MEJORAR: Obtener la foto del especialista\r\n    let fotoUrl = 'img/avatar-default.png';\r\n    if (especialista.fotoUrl) {\r\n        fotoUrl = especialista.fotoUrl;\r\n    } else if (elemento) {\r\n        const img = elemento.querySelector('.avatar-especialista');\r\n        if (img) fotoUrl = img.src;\r\n    }\r\n    \r\n    // Guardar datos\r\n    datosReserva.especialistas.push({\r\n        id: especialista.id,\r\n        nombre: especialista.nombre,\r\n        categoriaId: categoriaId,\r\n        fotoUrl: fotoUrl //  GUARDAR LA FOTO CONSISTENTEMENTE\r\n    });\r\n    \r\n    // Remover error si existe\r\n    const errorEspecialista = document.getElementById('error-especialista');\r\n    if (errorEspecialista) errorEspecialista.classList.remove('visible');\r\n    \r\n    // Actualizar la UI\r\n    \r\n    // 1. Deseleccionar todos los especialistas en esta categora\r\n    especialistasContainer.querySelectorAll('.flotante.especialista').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // 2. Seleccionar el elemento clickeado\r\n    if (elemento) {\r\n        elemento.classList.add('seleccionado');\r\n    }\r\n    \r\n    // 3. Actualizar la seleccin predeterminada\r\n    seleccionPredeterminada.classList.add('seleccionado');\r\n    \r\n    // Actualizar solo el contenido de info-especialista, no todo el HTML\r\n    if (especialista.id === 'auto') {\r\n        infoEspecialista.innerHTML = `\r\n            <span class=\"texto-predeterminado\">Con quien tenga disponibilidad</span>\r\n        `;\r\n    } else {\r\n        // Buscar el especialista en la lista para obtener ms datos (como la foto)\r\n        const especialistaCompleto = Array.from(especialistasContainer.querySelectorAll('.flotante.especialista'))\r\n            .find(el => el.dataset.id === especialista.id);\r\n        \r\n        let avatarUrl = 'img/avatar-default.png';\r\n        if (especialistaCompleto) {\r\n            const img = especialistaCompleto.querySelector('.avatar-especialista');\r\n            if (img) avatarUrl = img.src;\r\n        }\r\n        \r\n        infoEspecialista.innerHTML = `\r\n            <img src=\"${avatarUrl}\" alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n            <div>\r\n                <span class=\"nombre-especialista\">${especialista.nombre}</span>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    // El botn con el SVG ya existe, no necesitamos recrearlo\r\n    // Solo necesitamos asegurarnos de que el evento est configurado\r\n    \r\n    // Configurar el evento del botn si no est configurado\r\n    const btnVerEspecialistas = seleccionPredeterminada.querySelector('.btn-ver-especialistas');\r\n    if (btnVerEspecialistas && !btnVerEspecialistas.hasEventListener) {\r\n        btnVerEspecialistas.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            const lista = categoriaSection.querySelector('.especialistas-lista');\r\n            const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n            const estaAbierto = lista.classList.contains('abierto');\r\n            \r\n            // Cerrar todas las dems listas primero\r\n            document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                if (l !== lista) {\r\n                    l.classList.remove('abierto');\r\n                    const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                    if (otherIcon) otherIcon.classList.remove('girado');\r\n                }\r\n            });\r\n            \r\n            // Alternar esta lista\r\n            lista.classList.toggle('abierto', !estaAbierto);\r\n            if (icono) {\r\n                icono.classList.toggle('girado', !estaAbierto);\r\n            }\r\n        });\r\n        \r\n        // Marcar que este botn ya tiene el event listener\r\n        btnVerEspecialistas.hasEventListener = true;\r\n    }\r\n    \r\n    if (pasoActual >= 2) {\r\n        actualizarResumenEspecialistas();\r\n    }\r\n\r\n    // FORZAR RECARGA de fechas cuando cambia la seleccin\r\n    limpiarFechasYHorarios();\r\n    \r\n    console.log(\"Especialistas seleccionados:\", datosReserva.especialistas);\r\n}\r\n\r\nasync function mostrarEspecialistas(categoriasIds) {\r\n    try {\r\n        console.log(' mostrarEspecialistas llamado con:', categoriasIds);\r\n        console.log(' Estado de datosReserva:', {\r\n            servicios: datosReserva.servicios,\r\n            serviciosLength: datosReserva.servicios ? datosReserva.servicios.length : 'null',\r\n            categorias: datosReserva.categorias ? datosReserva.categorias.length : 'null'\r\n        });\r\n        \r\n        const contenedorEspecialistas = document.querySelector('.contenedor-especialistas');\r\n        \r\n        // VALIDACIN CRTICA: Verificar que el contenedor existe\r\n        if (!contenedorEspecialistas) {\r\n            console.error(\" No se encontr el contenedor de especialistas\");\r\n            return;\r\n        }\r\n\r\n        // VALIDACIN CRTICA: Verificar que categoriasIds es vlido\r\n        if (!categoriasIds || !Array.isArray(categoriasIds)) {\r\n            console.warn(\" categoriasIds no es un array vlido:\", categoriasIds);\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Error al cargar especialistas</p>';\r\n            return;\r\n        }\r\n\r\n        // VALIDACIN CRTICA: Verificar que tenemos datos de categoras\r\n        if (!datosReserva.categorias || !Array.isArray(datosReserva.categorias)) {\r\n            console.warn(\" No hay categoras cargadas en datosReserva\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Cargando categoras...</p>';\r\n            \r\n            // Intentar cargar categoras si no estn disponibles\r\n            try {\r\n                datosReserva.categorias = await firestoreSeguro.obtenerCategorias();\r\n                console.log(' Categoras cargadas:', datosReserva.categorias.length);\r\n            } catch (error) {\r\n                console.error(\" Error cargando categoras:\", error);\r\n                contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Error al cargar categoras</p>';\r\n                return;\r\n            }\r\n        }\r\n\r\n        contenedorEspecialistas.innerHTML = '';\r\n        \r\n        // LIMPIAR COMPLETAMENTE las selecciones anteriores\r\n        datosReserva.especialistas = [];\r\n        \r\n        //  VALIDACIN CRTICA: Verificar que datosReserva.servicios existe y es un array\r\n        if (!datosReserva.servicios) {\r\n            console.warn(\" datosReserva.servicios es null/undefined, inicializando a array vaco\");\r\n            datosReserva.servicios = [];\r\n        }\r\n        \r\n        if (!Array.isArray(datosReserva.servicios)) {\r\n            console.warn(\" datosReserva.servicios no es un array:\", datosReserva.servicios);\r\n            datosReserva.servicios = [];\r\n        }\r\n\r\n        //  VALIDACIN ADICIONAL: Verificar que el array no est vaco\r\n        if (datosReserva.servicios.length === 0) {\r\n            console.warn(\" datosReserva.servicios est vaco\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios primero</p>';\r\n            return;\r\n        }\r\n        \r\n        console.log(' datosReserva.servicios es vlido:', datosReserva.servicios.length, 'servicios');\r\n        \r\n        // Agrupar servicios por categora CON VALIDACIN\r\n        const serviciosPorCategoria = {};\r\n        \r\n        console.log(' Procesando servicios...');\r\n        //  CDIGO SEGURO: Ahora sabemos que datosReserva.servicios es un array vlido\r\n        datosReserva.servicios.forEach((servicio, index) => {\r\n            console.log(` Procesando servicio ${index}:`, servicio);\r\n            \r\n            //  VALIDACIN EXTRA PARA CADA SERVICIO\r\n            if (!servicio) {\r\n                console.warn(` Servicio ${index} es null/undefined, omitiendo`);\r\n                return;\r\n            }\r\n            \r\n            if (servicio.categoriaId && servicio.nombre) {\r\n                if (!serviciosPorCategoria[servicio.categoriaId]) {\r\n                    serviciosPorCategoria[servicio.categoriaId] = [];\r\n                }\r\n                if (!serviciosPorCategoria[servicio.categoriaId].includes(servicio.nombre)) {\r\n                    serviciosPorCategoria[servicio.categoriaId].push(servicio.nombre);\r\n                }\r\n            } else {\r\n                console.warn(` Servicio ${index} no tiene categoriaId o nombre:`, servicio);\r\n            }\r\n        });\r\n\r\n        console.log(' Servicios por categora:', serviciosPorCategoria);\r\n\r\n        if (Object.keys(serviciosPorCategoria).length === 0) {\r\n            console.warn(\" No se encontraron servicios vlidos agrupados por categora\");\r\n            contenedorEspecialistas.innerHTML = '<p class=\"sin-especialistas\">Selecciona servicios vlidos primero</p>';\r\n            return;\r\n        }\r\n\r\n        console.log(' Creando UI para especialistas...');\r\n\r\n        // Para cada categora con servicios seleccionados, mostrar sus especialistas\r\n        for (const categoriaId of Object.keys(serviciosPorCategoria)) {\r\n            const serviciosEnCategoria = serviciosPorCategoria[categoriaId];\r\n            if (!serviciosEnCategoria || serviciosEnCategoria.length === 0) {\r\n                console.warn(` Categora ${categoriaId} no tiene servicios, omitiendo`);\r\n                continue;\r\n            }\r\n            \r\n            const categoria = datosReserva.categorias.find(c => c.id === categoriaId);\r\n            if (!categoria) {\r\n                console.warn(` No se encontr categora con id ${categoriaId}`);\r\n                continue;\r\n            }\r\n            \r\n            console.log(` Procesando categora: ${categoria.nombre}`);\r\n            \r\n            // Formatear nombres de servicios para esta categora\r\n            let serviciosTexto = '';\r\n            if (serviciosEnCategoria.length === 1) {\r\n                serviciosTexto = serviciosEnCategoria[0];\r\n            } else if (serviciosEnCategoria.length === 2) {\r\n                serviciosTexto = serviciosEnCategoria.join(' + ');\r\n            } else if (serviciosEnCategoria.length > 2) {\r\n                serviciosTexto = serviciosEnCategoria[0] + ' + ' + (serviciosEnCategoria.length - 1) + ' servicios ms';\r\n            }\r\n            \r\n            // Crear seccin para esta categora\r\n            const categoriaSection = document.createElement('div');\r\n            categoriaSection.className = 'categoria-especialistas';\r\n            categoriaSection.dataset.categoriaId = categoriaId;\r\n            \r\n            categoriaSection.innerHTML = `\r\n                <h3><span>${serviciosTexto}</span> con:</h3>\r\n                <div class=\"seleccion-predeterminada\" data-categoria-id=\"${categoriaId}\">\r\n                    <div class=\"info-especialista\">\r\n                        <span class=\"texto-predeterminado\">Selecciona un especialista</span>\r\n                    </div>\r\n                    <div class=\"botones-especialista\">\r\n                        <button class=\"btn-ver-especialistas\">\r\n                            <svg\r\n                            class=\"acordeon-icon\" \r\n                            width=\"18\"\r\n                            height=\"18\"\r\n                            viewBox=\"0 0 24 24\"\r\n                            fill=\"none\"\r\n                            stroke=\"currentColor\"\r\n                            stroke-width=\"2\"\r\n                            stroke-linecap=\"round\"\r\n                            stroke-linejoin=\"round\"\r\n                            >\r\n                            <path d=\"M18 6l-12 12\" />\r\n                            <path d=\"M6 6l12 12\" />\r\n                            </svg>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div class=\"especialistas-lista\" data-categoria-id=\"${categoriaId}\">\r\n                    <!-- Los especialistas se agregarn aqu -->\r\n                </div>\r\n            `;\r\n            \r\n            // Obtener especialistas para esta categora\r\n            console.log(` Obteniendo especialistas para categora: ${categoriaId}`);\r\n            let especialistas = await firestoreSeguro.obtenerEspecialistasPorCategoria(categoriaId);\r\n            \r\n            //  CORRECCIN CRTICA: Asegurar que especialistas siempre sea un array\r\n            if (!especialistas) {\r\n                console.warn(` especialistas es null para categora ${categoriaId}, forzando a array vaco`);\r\n                especialistas = [];\r\n            } else if (!Array.isArray(especialistas)) {\r\n                console.warn(` especialistas no es un array para categora ${categoriaId}:`, especialistas);\r\n                especialistas = [];\r\n            }\r\n            \r\n            console.log(` Especialistas obtenidos: ${especialistas.length} para ${categoriaId}`);\r\n            \r\n            if (especialistas.length === 0) {\r\n                categoriaSection.querySelector('.especialistas-lista').innerHTML = \r\n                    '<p class=\"sin-especialistas\">No hay especialistas disponibles</p>';\r\n            } else {\r\n                const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n                const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n                const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n                \r\n                // Agregar opcin \"Con quien tenga disponibilidad\"\r\n                const opcionDisponibilidad = document.createElement('div');\r\n                opcionDisponibilidad.className = 'flotante especialista opcion-disponibilidad';\r\n                opcionDisponibilidad.dataset.id = 'auto';\r\n                opcionDisponibilidad.dataset.categoriaId = categoriaId;\r\n                opcionDisponibilidad.innerHTML = `\r\n                    <div class=\"info-especialista\">\r\n                        <p class=\"p1\">Con quien tenga disponibilidad</p>\r\n                        <p class=\"detalles-especialista\">Seleccionaremos el especialista con mejor disponibilidad</p>\r\n                    </div>\r\n                    <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                        <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n                    </svg>\r\n                `;\r\n                \r\n                opcionDisponibilidad.addEventListener('click', (e) => {\r\n                    e.stopPropagation();\r\n                    seleccionarEspecialista(opcionDisponibilidad, {id: 'auto', nombre: 'Con quien tenga disponibilidad'}, categoriaId);\r\n                });\r\n                \r\n                especialistasContainer.appendChild(opcionDisponibilidad);\r\n                \r\n                // Crear elementos para cada especialista\r\n                especialistas.forEach(especialista => {\r\n                    const elemento = document.createElement('div');\r\n                    elemento.className = 'flotante especialista';\r\n                    elemento.dataset.id = especialista.id;\r\n                    elemento.dataset.categoriaId = categoriaId;\r\n                    \r\n                    // Informacin adicional para el especialista\r\n                    const infoAdicional = especialista.descripcion ? \r\n                        `<div class=\"especialista-info-adicional\">${especialista.descripcion}</div>` : '';\r\n                    \r\n                    const calificacion = especialista.calificacion ? \r\n                        `<div class=\"especialista-calificacion\">\r\n                            <span class=\"estrella\"></span>\r\n                            <span>${especialista.calificacion}</span>\r\n                        </div>` : '';\r\n                    \r\n                    elemento.innerHTML = `\r\n                        <img src=\"${especialista.fotoUrl || 'img/avatar-default.png'}\" \r\n                             alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n                        <div class=\"info-especialista\">\r\n                            <p class=\"p1\">${especialista.nombre}</p>\r\n                            ${infoAdicional}\r\n                            ${calificacion}\r\n                        </div>\r\n                        <svg class=\"check-icon\" viewBox=\"0 0 24 24\">\r\n                            <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/>\r\n                        </svg>\r\n                    `;\r\n                    \r\n                    elemento.addEventListener('click', (e) => {\r\n                        e.stopPropagation();\r\n                        seleccionarEspecialista(elemento, especialista, categoriaId);\r\n                    });\r\n                    \r\n                    especialistasContainer.appendChild(elemento);\r\n                });\r\n                \r\n                // Agregar evento al botn para mostrar/ocultar especialistas\r\n                btnVerEspecialistas.addEventListener('click', (e) => {\r\n                    e.stopPropagation();\r\n                    const lista = categoriaSection.querySelector('.especialistas-lista');\r\n                    const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n                    const estaAbierto = lista.classList.contains('abierto');\r\n                    \r\n                    // Cerrar todas las dems listas primero\r\n                    document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n                        if (l !== lista) {\r\n                            l.classList.remove('abierto');\r\n                            const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                            if (otherIcon) otherIcon.classList.remove('girado');\r\n                        }\r\n                    });\r\n                    \r\n                    // Alternar esta lista\r\n                    lista.classList.toggle('abierto', !estaAbierto);\r\n                    icono.classList.toggle('girado', !estaAbierto);\r\n                });\r\n            }\r\n            \r\n            contenedorEspecialistas.appendChild(categoriaSection);\r\n        }\r\n        \r\n        console.log(' mostrarEspecialistas completado exitosamente');\r\n        \r\n    } catch (error) {\r\n        console.error(\" Error crtico en mostrarEspecialistas:\", error);\r\n        console.error(\" Stack trace:\", error.stack);\r\n        const contenedor = document.querySelector('.contenedor-especialistas');\r\n        if (contenedor) {\r\n            contenedor.innerHTML = '<p class=\"sin-especialistas\">Error al cargar especialistas. Intenta nuevamente.</p>';\r\n        }\r\n    }\r\n}\r\n\r\nfunction actualizarUIEspecialistas(especialistas) {\r\n    const paso2 = document.querySelector('.paso-2');\r\n    if (!paso2) return;\r\n    \r\n    const contenedor = paso2.querySelector('.contenedor-especialistas');\r\n    const plantilla = paso2.querySelector('.flotante.especialista');\r\n    const sinEspecialistas = paso2.querySelector('.sin-especialistas');\r\n    \r\n    // Limpiar contenedor\r\n    contenedor.innerHTML = '';\r\n    \r\n    if (especialistas.length === 0) {\r\n        if (sinEspecialistas) sinEspecialistas.style.display = 'block';\r\n        return;\r\n    }\r\n    \r\n    // Crear elementos de especialistas\r\n    especialistas.forEach(especialista => {\r\n        const elemento = plantilla.cloneNode(true);\r\n        elemento.style.display = 'flex';\r\n        elemento.dataset.id = especialista.id;\r\n        \r\n        elemento.querySelector('.p1').textContent = especialista.nombre;\r\n        elemento.querySelector('.p2').textContent = especialista.categorias.join(', ');\r\n        \r\n        elemento.addEventListener('click', () => {\r\n            seleccionarEspecialista(elemento, especialista);\r\n        });\r\n        \r\n        contenedor.appendChild(elemento);\r\n    });\r\n}\r\n\r\nasync function buscarEspecialistasAutomaticos() {\r\n    try {\r\n        const especialistasAutomaticos = datosReserva.especialistas.filter(esp => esp.id === 'auto');\r\n        \r\n        for (const espAuto of especialistasAutomaticos) {\r\n            const mejorEspecialista = await obtenerEspecialistaConMejorDisponibilidad(espAuto.categoriaId);\r\n            \r\n            if (mejorEspecialista) {\r\n                // Reemplazar la seleccin automtica con el especialista real\r\n                const index = datosReserva.especialistas.findIndex(esp => \r\n                    esp.id === 'auto' && esp.categoriaId === espAuto.categoriaId\r\n                );\r\n                \r\n                if (index !== -1) {\r\n                    datosReserva.especialistas[index] = {\r\n                        id: mejorEspecialista.id,\r\n                        nombre: mejorEspecialista.nombre,\r\n                        categoriaId: espAuto.categoriaId,\r\n                        fotoUrl: mejorEspecialista.fotoUrl || 'img/avatar-default.png' //  AGREGAR LA FOTO\r\n                    };\r\n                    \r\n                    console.log(` Especialista automtico reemplazado: ${mejorEspecialista.nombre}`, mejorEspecialista.fotoUrl);\r\n                }\r\n            } else {\r\n                throw new Error(`No se encontr especialista disponible para la categora ${espAuto.categoriaId}`);\r\n            }\r\n        }\r\n        \r\n        return true;\r\n    } catch (error) {\r\n        console.error(\"Error buscando especialistas automticos:\", error);\r\n        mostrarError(\"No se pudo encontrar especialistas disponibles. Por favor, selecciona manualmente.\");\r\n        return false;\r\n    }\r\n}\r\n\r\nasync function obtenerEspecialistaConMejorDisponibilidad(categoriaId) {\r\n    try {\r\n        console.log(\"Buscando mejor especialista para categora:\", categoriaId);\r\n        \r\n        const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n        \r\n        // Si no hay especialistas, retornar null\r\n        if (!especialistas || especialistas.length === 0) {\r\n            console.log(\"No hay especialistas para esta categora\");\r\n            return null;\r\n        }\r\n        \r\n        // Si solo hay un especialista, retornarlo\r\n        if (especialistas.length === 1) {\r\n            console.log(\"Solo hay un especialista, retornando:\", especialistas[0].nombre);\r\n            return especialistas[0]; //  Esto ya incluye fotoUrl\r\n        }\r\n        \r\n        // Obtener la duracin total de los servicios seleccionados para esta categora\r\n        const serviciosCategoria = datosReserva.servicios.filter(s => s.categoriaId === categoriaId);\r\n        const duracionTotal = serviciosCategoria.reduce((total, servicio) => total + servicio.duracion, 0);\r\n        \r\n        console.log(\"Duracin total necesaria:\", duracionTotal, \"minutos\");\r\n        \r\n        // Obtener fecha y hora actual en Argentina (UTC-3)\r\n        const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n        \r\n        // Calcular disponibilidad para cada especialista\r\n        const disponibilidadEspecialistas = [];\r\n        \r\n        for (const especialista of especialistas) {\r\n            console.log(\"Evaluando especialista:\", especialista.nombre);\r\n            \r\n            let puntuacionDisponibilidad = 0;\r\n            let diasEvaluados = 0;\r\n            \r\n            // Evaluar solo los prximos 3 das (para mejorar rendimiento)\r\n            for (let i = 0; i < 3; i++) {\r\n                const fechaEvaluar = new Date(ahoraArg);\r\n                fechaEvaluar.setDate(ahoraArg.getDate() + i);\r\n                const fechaStr = fechaEvaluar.toISOString().split('T')[0];\r\n                \r\n                // Saltar fines de semana\r\n                if (fechaEvaluar.getDay() === 0 || fechaEvaluar.getDay() === 6) {\r\n                    continue;\r\n                }\r\n                \r\n                try {\r\n                    // Obtener horarios disponibles para este especialista en esta fecha\r\n                    const horariosDisponibles = await firestoreDB.generarHorariosDisponiblesEspecialista(\r\n                        especialista.id, \r\n                        fechaStr\r\n                    );\r\n                    \r\n                    // CORRECCIN: Usar let en lugar de const para poder reasignar\r\n                    let horariosDisponiblesFiltrados = horariosDisponibles.filter(h => h.disponible);\r\n                    \r\n                    // Filtrar horarios que sean posteriores a la hora actual si es hoy\r\n                    if (i === 0) {\r\n                        const horaActual = ahoraArg.getHours();\r\n                        const minutoActual = ahoraArg.getMinutes();\r\n                        const tiempoActualMinutos = horaActual * 60 + minutoActual;\r\n                        \r\n                        horariosDisponiblesFiltrados = horariosDisponiblesFiltrados.filter(horario => {\r\n                            const [horaStr, minutoStr] = horario.hora.split(':');\r\n                            const horaHorario = parseInt(horaStr);\r\n                            const minutoHorario = parseInt(minutoStr);\r\n                            const tiempoHorarioMinutos = horaHorario * 60 + minutoHorario;\r\n                            \r\n                            // Considerar margen de 30 minutos para reservas\r\n                            return tiempoHorarioMinutos >= (tiempoActualMinutos + 30);\r\n                        });\r\n                    }\r\n                    \r\n                    // Contar bloques de tiempo disponibles que puedan acomodar la duracin total\r\n                    const bloquesDisponibles = encontrarBloquesDisponibles(horariosDisponiblesFiltrados, duracionTotal);\r\n                    puntuacionDisponibilidad += bloquesDisponibles.length;\r\n                    diasEvaluados++;\r\n                    \r\n                    console.log(`Especialista ${especialista.nombre} - ${fechaStr}: ${bloquesDisponibles.length} bloques disponibles`);\r\n                    \r\n                } catch (error) {\r\n                    console.warn(`Error obteniendo horarios para ${especialista.nombre} en ${fechaStr}:`, error);\r\n                }\r\n            }\r\n            \r\n            // Calcular promedio\r\n            const disponibilidadPromedio = diasEvaluados > 0 ? puntuacionDisponibilidad / diasEvaluados : 0;\r\n            \r\n            console.log(`Especialista ${especialista.nombre} - Puntuacin: ${disponibilidadPromedio}`);\r\n            \r\n            disponibilidadEspecialistas.push({\r\n                especialista,\r\n                puntuacion: disponibilidadPromedio\r\n            });\r\n        }\r\n        \r\n        // Ordenar por puntuacin (mayor a menor)\r\n        disponibilidadEspecialistas.sort((a, b) => b.puntuacion - a.puntuacion);\r\n        \r\n        console.log(\"Ranking de especialistas:\", disponibilidadEspecialistas.map(e => \r\n            `${e.especialista.nombre}: ${e.puntuacion}`\r\n        ));\r\n        \r\n        // Retornar el especialista con mejor puntuacin\r\n        const mejorEspecialista = disponibilidadEspecialistas[0].puntuacion > 0 \r\n            ? disponibilidadEspecialistas[0].especialista \r\n            : especialistas[0];\r\n            \r\n        console.log(\"Mejor especialista encontrado:\", mejorEspecialista.nombre, \"Foto:\", mejorEspecialista.fotoUrl);\r\n        \r\n        // Guardar informacin sobre el mejor especialista\r\n        mejorEspecialistaPorCategoria[categoriaId] = mejorEspecialista;\r\n\r\n        return mejorEspecialista; //  Esto incluye todos los datos del especialista, incluida fotoUrl\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error calculando disponibilidad:\", error);\r\n        // En caso de error, retornar el primer especialista de la lista\r\n        try {\r\n            const especialistas = await firestoreDB.obtenerEspecialistasPorCategoria(categoriaId);\r\n            return especialistas.length > 0 ? especialistas[0] : null;\r\n        } catch (fallbackError) {\r\n            console.error(\"Error de fallback:\", fallbackError);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\n// Funcin auxiliar para encontrar bloques de tiempo disponibles\r\nfunction encontrarBloquesDisponibles(horarios, duracionMinutos) {\r\n    const bloques = [];\r\n    const intervalo = 30; // Intervalo entre horarios en minutos\r\n    const slotsNecesarios = Math.ceil(duracionMinutos / intervalo);\r\n    \r\n    // Si no hay suficientes horarios, retornar array vaco\r\n    if (horarios.length < slotsNecesarios) {\r\n        return bloques;\r\n    }\r\n    \r\n    for (let i = 0; i <= horarios.length - slotsNecesarios; i++) {\r\n        let bloqueValido = true;\r\n        \r\n        // Verificar que todos los slots necesarios estn disponibles\r\n        for (let j = 0; j < slotsNecesarios; j++) {\r\n            if (!horarios[i + j] || !horarios[i + j].disponible) {\r\n                bloqueValido = false;\r\n                break;\r\n            }\r\n        }\r\n        \r\n        if (bloqueValido) {\r\n            bloques.push({\r\n                inicio: horarios[i].hora,\r\n                fin: calcularHoraFin(horarios[i].hora, duracionMinutos)\r\n            });\r\n        }\r\n    }\r\n    \r\n    return bloques;\r\n}\r\n\r\n// Funcin auxiliar para calcular la hora final\r\nfunction calcularHoraFin(horaInicio, duracionMinutos) {\r\n    const [horaStr, minutoStr] = horaInicio.split(':');\r\n    let hora = parseInt(horaStr);\r\n    let minuto = parseInt(minutoStr);\r\n    \r\n    minuto += duracionMinutos;\r\n    hora += Math.floor(minuto / 60);\r\n    minuto = minuto % 60;\r\n    \r\n    return `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n}\r\n\r\nfunction agregarEventosBotones(categoriaSection, categoriaId) {\r\n    const seleccionPredeterminada = categoriaSection.querySelector('.seleccion-predeterminada');\r\n    const btnVerEspecialistas = categoriaSection.querySelector('.btn-ver-especialistas');\r\n    const btnBuscarDisponibilidad = categoriaSection.querySelector('.btn-buscar-disponibilidad');\r\n    const lista = categoriaSection.querySelector('.especialistas-lista');\r\n    const icono = btnVerEspecialistas.querySelector('.acordeon-icon');\r\n    \r\n    // Funcin para alternar la visibilidad de la lista\r\n    const toggleLista = () => {\r\n        const estaAbierto = lista.classList.contains('abierto');\r\n        \r\n        // Cerrar todas las dems listas primero\r\n        document.querySelectorAll('.especialistas-lista.abierto').forEach(l => {\r\n            if (l !== lista) {\r\n                l.classList.remove('abierto');\r\n                const otherIcon = l.closest('.categoria-especialistas').querySelector('.acordeon-icon');\r\n                if (otherIcon) otherIcon.classList.remove('girado');\r\n            }\r\n        });\r\n        \r\n        // Alternar esta lista\r\n        lista.classList.toggle('abierto', !estaAbierto);\r\n        if (icono) {\r\n            icono.classList.toggle('girado', !estaAbierto);\r\n        }\r\n    };\r\n\r\n    // Evento para botn ver especialistas\r\n    btnVerEspecialistas.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        toggleLista();\r\n    });\r\n    \r\n    // Evento para el contenedor seleccion-predeterminada (excepto cuando se hace clic en botones)\r\n    seleccionPredeterminada.addEventListener('click', (e) => {\r\n        // Si el clic fue en un botn, no hacer nada (ya tiene su propio evento)\r\n        if (e.target.closest('.botones-especialista')) {\r\n            return;\r\n        }\r\n        toggleLista();\r\n    });\r\n    \r\n    // Evento para botn buscar disponibilidad\r\n    btnBuscarDisponibilidad.addEventListener('click', async (e) => {\r\n        e.stopPropagation();\r\n        \r\n        const infoEspecialista = seleccionPredeterminada.querySelector('.info-especialista');\r\n        const botonesEspecialista = seleccionPredeterminada.querySelector('.botones-especialista');\r\n        const especialistasContainer = categoriaSection.querySelector('.especialistas-lista');\r\n        \r\n        // Guardar los botones antes de modificar el contenido\r\n        const botonesHTML = botonesEspecialista.innerHTML;\r\n        \r\n        // Mostrar loading - solo modificar el info-especialista\r\n        infoEspecialista.innerHTML = `\r\n            <span class=\"texto-predeterminado\">Buscando mejor disponibilidad...</span>\r\n        `;\r\n        \r\n        try {\r\n            const especialista = await obtenerEspecialistaConMejorDisponibilidad(categoriaId);\r\n            if (especialista) {\r\n                // Deseleccionar todos los especialistas de esta categora\r\n                especialistasContainer.querySelectorAll('.flotante.especialista').forEach(el => {\r\n                    el.classList.remove('seleccionado');\r\n                });\r\n                \r\n                // Seleccionar el nuevo especialista en la lista\r\n                const especialistaElement = especialistasContainer.querySelector(`[data-id=\"${especialista.id}\"]`);\r\n                if (especialistaElement) {\r\n                    especialistaElement.classList.add('seleccionado');\r\n                }\r\n                \r\n                // Actualizar la seleccin predeterminada\r\n                seleccionPredeterminada.classList.add('seleccionado');\r\n                \r\n                // Actualizar solo el contenido de info-especialista, mantener los botones\r\n                infoEspecialista.innerHTML = `\r\n                    <span class=\"badge-recomendado\">Recomendado</span>\r\n                    <img src=\"${especialista.fotoUrl || 'img/avatar-default.png'}\" \r\n                        alt=\"${especialista.nombre}\" class=\"avatar-especialista\">\r\n                    <div>\r\n                        <span class=\"nombre-especialista\">${especialista.nombre}</span>\r\n                        <div class=\"info-disponibilidad\">\r\n                            <span class=\"icono-disponibilidad\"></span>\r\n                            Mejor disponibilidad esta semana\r\n                        </div>\r\n                    </div>\r\n                `;\r\n                \r\n                // Los botones se mantienen intactos, no necesitamos recrearlos\r\n                seleccionarEspecialista(null, especialista, categoriaId);\r\n            } else {\r\n                infoEspecialista.innerHTML = `\r\n                    <span class=\"texto-predeterminado\">No disponible</span>\r\n                `;\r\n                // Restaurar los botones\r\n                botonesEspecialista.innerHTML = botonesHTML;\r\n                // Volver a agregar eventos a los botones restaurados\r\n                agregarEventosBotones(categoriaSection, categoriaId);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error al obtener especialista:\", error);\r\n            infoEspecialista.innerHTML = `\r\n                <span class=\"texto-predeterminado\">Error, intenta nuevamente</span>\r\n            `;\r\n            // Restaurar los botones\r\n            botonesEspecialista.innerHTML = botonesHTML;\r\n            // Volver a agregar eventos a los botones restaurados\r\n            agregarEventosBotones(categoriaSection, categoriaId);\r\n        }\r\n    });\r\n}\r\n\r\n/////////////////////////////////\r\n////////////// fechas y horarios\r\n/////////////////////////////////\r\n\r\nfunction esDuracionValida(horario, duracionTotal, horarioCierre) {\r\n    const [hora, minuto] = horario.split(':').map(Number);\r\n    const totalMinutos = hora * 60 + minuto + duracionTotal;\r\n    const cierreMinutos = parseInt(horarioCierre.split(':')[0]) * 60 + parseInt(horarioCierre.split(':')[1]);\r\n    \r\n    return totalMinutos <= cierreMinutos;\r\n}\r\n\r\nfunction mostrarErrorDisponibilidad(especialistasNoDisponibles) {\r\n    const nombres = especialistasNoDisponibles.map(e => e.nombre).join(', ');\r\n    mostrarError(`Los siguientes especialistas no estn disponibles: ${nombres}`);\r\n}\r\n\r\n// Funcin principal para cargar fechas y horarios\r\nasync function cargarFechasYHorarios() {\r\n    console.log(\"=== CARGANDO FECHAS ===\");\r\n    console.log(\"Especialistas actuales:\", datosReserva.especialistas.map(e => e.nombre));\r\n    \r\n    try {\r\n        const config = await firestoreSeguro.obtenerConfiguracion();\r\n        \r\n        // Ocultar calendario y mostrar carga\r\n        const contenedorCalendario = document.querySelector('.contenedor-calendario');\r\n        const cargandoFechas = document.querySelector('.cargando-fechas');\r\n        const sinFechas = document.querySelector('.sin-fechas');\r\n        \r\n        if (contenedorCalendario) contenedorCalendario.style.display = 'none';\r\n        if (cargandoFechas) cargandoFechas.style.display = 'block';\r\n        if (sinFechas) sinFechas.style.display = 'none';\r\n        \r\n        // Obtener fechas disponibles considerando los das laborales de cada especialista\r\n        const fechasComunes = await generarFechasDisponiblesConEspecialistas(config);\r\n        \r\n        console.log(\" Fechas disponibles despus del filtrado:\", fechasComunes.map(f => f.fecha));\r\n        \r\n        // Actualizar UI con las fechas disponibles\r\n        actualizarUIFechas(fechasComunes);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando fechas:\", error);\r\n        mostrarError(\"No se pudieron cargar las fechas disponibles\");\r\n        \r\n        // Ocultar loader en caso de error\r\n        const cargandoFechas = document.querySelector('.cargando-fechas');\r\n        if (cargandoFechas) cargandoFechas.style.display = 'none';\r\n    }\r\n}\r\n\r\nasync function generarFechasDisponiblesConEspecialistas(config) {\r\n    // Obtener fecha y hora actual en Argentina (UTC-3)\r\n    const ahoraArg = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"America/Argentina/Buenos_Aires\"}));\r\n    const hoyArg = new Date(ahoraArg.getFullYear(), ahoraArg.getMonth(), ahoraArg.getDate());\r\n    \r\n    const fechasDisponibles = [];\r\n    const DIAS_A_MOSTRAR = 14; // Mostrar hasta 14 das en el futuro\r\n    \r\n    for (let i = 0; i < DIAS_A_MOSTRAR; i++) {\r\n        const fecha = new Date(hoyArg);\r\n        fecha.setDate(hoyArg.getDate() + i);\r\n        \r\n        const fechaStr = fecha.toISOString().split('T')[0];\r\n        \r\n        // Verificar das no laborables generales\r\n        if (Array.isArray(config.diasNoLaborables) && config.diasNoLaborables.includes(fechaStr)) {\r\n            console.log(`Saltando ${fechaStr} - Da no laborable configurado`);\r\n            continue;\r\n        }\r\n        \r\n        // Verificar disponibilidad para TODOS los especialistas seleccionados\r\n        const todosDisponibles = await verificarDisponibilidadEspecialistas(fechaStr);\r\n        \r\n        if (todosDisponibles) {\r\n            fechasDisponibles.push({\r\n                fecha: fechaStr,\r\n                display: formatearFechaDisplay(fecha)\r\n            });\r\n        }\r\n    }\r\n    \r\n    console.log(\"Fechas disponibles despus de verificar especialistas:\", fechasDisponibles);\r\n    return fechasDisponibles;\r\n}\r\n\r\nfunction seleccionarFechaAutomaticamente(fecha) {\r\n    // Actualizar los datos de reserva\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // Encontrar el elemento del calendario correspondiente a esta fecha\r\n    const todosLosDias = document.querySelectorAll('.dia-calendario');\r\n    \r\n    todosLosDias.forEach(diaElement => {\r\n        // Solo considerar los das que tienen data-fecha (no los fuera-de-mes)\r\n        if (diaElement.dataset.fecha) {\r\n            if (diaElement.dataset.fecha === fecha) {\r\n                // Seleccionar este da\r\n                diaElement.classList.add('seleccionado');\r\n                \r\n                // Remover mensaje de error si existe\r\n                const errorFecha = document.getElementById('error-fecha');\r\n                if (errorFecha) errorFecha.classList.remove('visible');\r\n                \r\n                // Cargar los horarios para esta fecha\r\n                cargarHorariosParaFecha(fecha);\r\n            } else {\r\n                // Deseleccionar otros das\r\n                diaElement.classList.remove('seleccionado');\r\n            }\r\n        }\r\n    });\r\n\r\n    // Actualizar el subttulo de horarios\r\n    actualizarSubtituloHorarios(fecha);\r\n    \r\n    console.log(\"Fecha seleccionada automticamente:\", fecha);\r\n}\r\n\r\n// Funcin para obtener horarios comunes disponibles\r\nasync function obtenerHorariosComunes(fecha) {\r\n    if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n        return [];\r\n    }\r\n    \r\n    const horariosPorEspecialista = {};\r\n    const duracionTotal = calcularDuracionTotal();\r\n    \r\n    for (const especialista of datosReserva.especialistas) {\r\n        try {\r\n            const horarios = await firestoreSeguro.generarHorariosDisponiblesEspecialista(\r\n                especialista.id,\r\n                fecha,\r\n                duracionTotal // Pasar la duracin total\r\n            );\r\n            \r\n            // Filtrar solo los horarios disponibles\r\n            const horariosFiltrados = horarios\r\n                .filter(horario => horario.disponible)\r\n                .map(horario => horario.hora);\r\n            \r\n            horariosPorEspecialista[especialista.id] = horariosFiltrados;\r\n            \r\n        } catch (error) {\r\n            console.error(`Error obteniendo horarios para ${especialista.nombre}:`, error);\r\n            horariosPorEspecialista[especialista.id] = [];\r\n        }\r\n    }\r\n    \r\n    return encontrarHorariosComunes(horariosPorEspecialista);\r\n}\r\n\r\n// Funcin para verificar si un horario puede acomodar la duracin total\r\nasync function puedeAcomodarDuracion(horarioInicio, duracionTotal, especialistaId, fecha) {\r\n    try {\r\n        // Obtener configuracin REAL del especialista\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) return false;\r\n        \r\n        const especialista = especialistaDoc.data();\r\n        const diaSemana = new Date(fecha).getDay();\r\n        const dias = ['domingo', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado'];\r\n        const diaKey = dias[diaSemana];\r\n        \r\n        // Usar horario del especialista o configuracin general\r\n        let horarioCierre = especialista.horarioLaboral?.[diaKey]?.fin || datosReserva.configuracion.horarioCierre;\r\n        \r\n        // Asegurar formato correcto\r\n        const [horaCierreStr, minutoCierreStr] = horarioCierre.replace('.', ':').split(':');\r\n        const horaCierre = parseInt(horaCierreStr);\r\n        const minutoCierre = parseInt(minutoCierreStr || 0);\r\n        const cierreMinutos = horaCierre * 60 + minutoCierre;\r\n        \r\n        // Convertir horario de inicio a minutos\r\n        const [horaInicioStr, minutoInicioStr] = horarioInicio.split(':');\r\n        const horaInicio = parseInt(horaInicioStr);\r\n        const minutoInicio = parseInt(minutoInicioStr);\r\n        const inicioMinutos = horaInicio * 60 + minutoInicio;\r\n        \r\n        // Calcular horario de fin\r\n        const finMinutos = inicioMinutos + duracionTotal;\r\n        \r\n        // Verificar que el turno termine antes del cierre\r\n        return finMinutos <= cierreMinutos;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error validando horario:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para encontrar horarios comunes entre todos los especialistas\r\nfunction encontrarHorariosComunes(horariosPorEspecialista) {\r\n    const especialistasIds = Object.keys(horariosPorEspecialista);\r\n    if (especialistasIds.length === 0) return [];\r\n    \r\n    // Empezar con los horarios del primer especialista\r\n    let horariosComunes = [...horariosPorEspecialista[especialistasIds[0]]];\r\n    \r\n    // Intersectar con los horarios de los dems especialistas\r\n    for (let i = 1; i < especialistasIds.length; i++) {\r\n        const horariosEspecialista = horariosPorEspecialista[especialistasIds[i]];\r\n        horariosComunes = horariosComunes.filter(hora => \r\n            horariosEspecialista.includes(hora)\r\n        );\r\n    }\r\n    \r\n    return horariosComunes;\r\n}\r\n\r\n// Funcin para seleccionar un horario\r\nfunction seleccionarHorario(elemento, horario) {\r\n    // Deseleccionar todos los horarios\r\n    document.querySelectorAll('.flotante.horario').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar el horario clickeado\r\n    elemento.classList.add('seleccionado');\r\n    datosReserva.horario = horario;\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorHorario = document.getElementById('error-horario');\r\n    if (errorHorario) errorHorario.classList.remove('visible');\r\n    \r\n    // DEBUG: Verificar que se estableci correctamente\r\n    console.log('Horario seleccionado:', datosReserva.horario);\r\n}\r\n\r\n// Funcin para seleccionar una fecha\r\nfunction seleccionarFecha(elemento, fecha) {\r\n    // Deseleccionar todas las fechas\r\n    document.querySelectorAll('.flotante.fecha').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar la fecha clickeada\r\n    elemento.classList.add('seleccionado');\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // Cargar horarios para la fecha seleccionada\r\n    cargarHorariosParaFecha(fecha);\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorFecha = document.getElementById('error-fecha');\r\n    if (errorFecha) errorFecha.classList.remove('visible');\r\n}\r\n\r\n// Funcin para verificar disponibilidad de todos los especialistas en una fecha\r\nasync function verificarDisponibilidadEspecialistas(fecha) {\r\n    console.log(` Verificando fecha ${fecha} para especialistas:`, \r\n        datosReserva.especialistas.map(e => e.nombre));\r\n    \r\n    try {\r\n        if (!datosReserva.especialistas || datosReserva.especialistas.length === 0) {\r\n            console.log(\"No hay especialistas seleccionados\");\r\n            return false;\r\n        }\r\n        \r\n        for (const especialista of datosReserva.especialistas) {\r\n            const disponible = await verificarDisponibilidadEspecialista(especialista.id, fecha);\r\n            console.log(` Especialista ${especialista.nombre} en ${fecha}: ${disponible ? 'DISPONIBLE' : 'NO DISPONIBLE'}`);\r\n            \r\n            if (!disponible) {\r\n                return false;\r\n            }\r\n        }\r\n        \r\n        console.log(` Todos los especialistas disponibles el ${fecha}`);\r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando disponibilidad:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction formatearFechaParaDebug(fechaStr) {\r\n    const fecha = new Date(fechaStr + 'T03:00:00');\r\n    return fecha.toLocaleDateString('es-AR', { \r\n        weekday: 'long', \r\n        year: 'numeric', \r\n        month: 'long', \r\n        day: 'numeric' \r\n    });\r\n}\r\n\r\n// Funcin para verificar disponibilidad de un especialista especfico\r\nasync function verificarDisponibilidadEspecialista(especialistaId, fecha) {\r\n    try {\r\n        // 1. Obtener datos del especialista\r\n        const especialistaDoc = await db.collection('especialistas').doc(especialistaId).get();\r\n        if (!especialistaDoc.exists) {\r\n            return false;\r\n        }\r\n        \r\n        const especialistaData = especialistaDoc.data();\r\n        \r\n        // 2. CORRECCIN: Ajustar la fecha a la zona horaria de Argentina\r\n        const fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n        const diaSemana = fechaObj.getUTCDay(); // Usar getUTCDay() para consistencia\r\n        \r\n        // Mapeo de das\r\n        const diasMap = {\r\n            0: 'domingo',\r\n            1: 'lunes', \r\n            2: 'martes',\r\n            3: 'miercoles',\r\n            4: 'jueves',\r\n            5: 'viernes',\r\n            6: 'sabado'\r\n        };\r\n        \r\n        const diaKey = diasMap[diaSemana];\r\n        \r\n        console.log(`Verificando ${diaKey} (${diaSemana}) para ${especialistaData.nombre}`);\r\n        \r\n        // Si no trabaja ese da, no est disponible\r\n        if (!especialistaData.horarioLaboral || !especialistaData.horarioLaboral[diaKey]?.activo) {\r\n            console.log(`-> ${especialistaData.nombre} NO trabaja los ${diaKey}`);\r\n            return false;\r\n        }\r\n        \r\n        // 3. Verificar si tiene bloqueos/ausencias para esa fecha\r\n        const tieneBloqueos = await verificarBloqueosEspecialista(especialistaId, fecha);\r\n        if (tieneBloqueos) {\r\n            console.log(`-> ${especialistaData.nombre} tiene bloqueos para ${fecha}`);\r\n            return false;\r\n        }\r\n        \r\n        console.log(`-> ${especialistaData.nombre} S trabaja los ${diaKey}`);\r\n        return true;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando disponibilidad del especialista:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para verificar bloqueos del especialista\r\nasync function verificarBloqueosEspecialista(especialistaId, fecha) {\r\n    try {\r\n        // Convertir fecha a timestamp para comparacin\r\n        const fechaTimestamp = new Date(fecha).getTime();\r\n        \r\n        // Buscar bloqueos para este especialista\r\n        const snapshot = await db.collection('bloqueos')\r\n            .where('especialistaId', '==', especialistaId)\r\n            .get();\r\n            \r\n        if (snapshot.empty) {\r\n            return false;\r\n        }\r\n        \r\n        // Verificar cada bloqueo\r\n        for (const doc of snapshot.docs) {\r\n            const bloqueo = doc.data();\r\n            const inicioBloqueo = new Date(bloqueo.fechaInicio).getTime();\r\n            const finBloqueo = new Date(bloqueo.fechaFin).getTime();\r\n            \r\n            // Si la fecha est dentro del rango de bloqueo\r\n            if (fechaTimestamp >= inicioBloqueo && fechaTimestamp <= finBloqueo) {\r\n                return true;\r\n            }\r\n        }\r\n        \r\n        return false;\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error verificando bloqueos:\", error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Funcin para formatear fecha para display\r\nfunction formatearFechaDisplay(fecha) {\r\n  // Asegurarnos de que tenemos un objeto Date vlido\r\n  let fechaObj;\r\n  \r\n  if (typeof fecha === 'string') {\r\n    // Si es una cadena en formato YYYY-MM-DD, convertirla a Date\r\n    fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n  } else if (fecha instanceof Date) {\r\n    fechaObj = fecha;\r\n  } else {\r\n    return \"Fecha invlida\";\r\n  }\r\n  \r\n  return fechaObj.toLocaleDateString('es-AR', {\r\n    weekday: 'long',\r\n    day: 'numeric',\r\n    month: 'short'\r\n  });\r\n}\r\n\r\n// En la funcin donde obtienes la configuracin\r\nasync function cargarConfiguracion() {\r\n    try {\r\n        datosReserva.configuracion = await firestoreSeguro.obtenerConfiguracion();\r\n        return datosReserva.configuracion;\r\n    } catch (error) {\r\n        console.error(\"Error cargando configuracin:\", error);\r\n        // Configuracin por defecto\r\n        datosReserva.configuracion = {\r\n            horarioApertura: \"09:00\",\r\n            horarioCierre: \"20:00\",\r\n            diasLaborales: [1, 2, 3, 4, 5, 6],\r\n            duracionTurnoBase: 30\r\n        };\r\n        return datosReserva.configuracion;\r\n    }\r\n}\r\n\r\nfunction limpiarFechasYHorarios() {\r\n    datosReserva.fecha = null;\r\n    datosReserva.horario = null;\r\n    fechaSeleccionada = null;\r\n    \r\n    const contenedorFechas = document.querySelector('.contenedor-fechas');\r\n    const contenedorHorarios = document.querySelector('.contenedor-horarios');\r\n    \r\n    if (contenedorFechas) contenedorFechas.innerHTML = '';\r\n    if (contenedorHorarios) contenedorHorarios.innerHTML = '';\r\n    \r\n    // Limpiar selecciones visuales\r\n    document.querySelectorAll('.flotante.fecha.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    document.querySelectorAll('.flotante.horario.seleccionado').forEach(el => {\r\n        el.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Ocultar mensajes\r\n    document.querySelectorAll('.sin-fechas, .sin-horarios, .cargando-fechas, .cargando-horarios')\r\n        .forEach(el => el.style.display = 'none');\r\n}\r\n\r\n///////////////////////\r\n//////////// Resumen\r\n///////////////////////\r\n\r\n// Funcin para calcular horario de finalizacin\r\nfunction calcularHorarioFin(horarioInicio, duracionMinutos) {\r\n    const [horaStr, minutoStr] = horarioInicio.split(':');\r\n    let hora = parseInt(horaStr);\r\n    let minuto = parseInt(minutoStr);\r\n    \r\n    minuto += duracionMinutos;\r\n    hora += Math.floor(minuto / 60);\r\n    minuto = minuto % 60;\r\n    \r\n    return `${hora.toString().padStart(2, '0')}:${minuto.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// Funcin para formatear duracin en texto legible\r\nfunction formatearDuracion(minutos) {\r\n    const horas = Math.floor(minutos / 60);\r\n    const mins = minutos % 60;\r\n    \r\n    if (horas > 0 && mins > 0) {\r\n        return `${horas}h ${mins}min`;\r\n    } else if (horas > 0) {\r\n        return `${horas} hora${horas > 1 ? 's' : ''}`;\r\n    } else {\r\n        return `${mins} minutos`;\r\n    }\r\n}\r\n\r\n///////////////////////\r\n//////////// cache y demas\r\n///////////////////////\r\n\r\n// Sistema de debouncing para reducir lecturas durante interaccin\r\nconst debounce = (func, wait) => {\r\n    let timeout;\r\n    return function executedFunction(...args) {\r\n        const later = () => {\r\n            clearTimeout(timeout);\r\n            func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n    };\r\n};\r\n\r\n// Aplicar debouncing a funciones que generan muchas lecturas\r\nconst debouncedCargarHorarios = debounce(async (fecha) => {\r\n    try {\r\n        const horarios = await obtenerHorariosComunes(fecha);\r\n        actualizarUIHorarios(horarios);\r\n    } catch (error) {\r\n        console.error('Error cargando horarios:', error);\r\n    }\r\n}, 300); // 300ms de delay\r\n\r\n////////////////////////\r\n///////////// Calendario\r\n////////////////////////\r\n\r\n// Funcin para inicializar el calendario\r\nfunction inicializarCalendario() {\r\n    const btnPrev = document.querySelector('.btn-calendario-prev');\r\n    const btnNext = document.querySelector('.btn-calendario-next');\r\n    \r\n    // Establecer la fecha actual correctamente\r\n    calendarioFechaActual = new Date();\r\n    \r\n    if (btnPrev && btnNext) {\r\n        btnPrev.addEventListener('click', () => {\r\n            calendarioFechaActual.setMonth(calendarioFechaActual.getMonth() - 1);\r\n            console.log(\"Navegando a mes anterior:\", calendarioFechaActual.getMonth() + 1);\r\n            renderizarCalendario();\r\n            debugVisualizacionFechas();\r\n        });\r\n        \r\n        btnNext.addEventListener('click', () => {\r\n            calendarioFechaActual.setMonth(calendarioFechaActual.getMonth() + 1);\r\n            console.log(\"Navegando a mes siguiente:\", calendarioFechaActual.getMonth() + 1);\r\n            renderizarCalendario();\r\n            debugVisualizacionFechas();\r\n        });\r\n    }\r\n    \r\n    console.log(\"Calendario inicializado\");\r\n}\r\n\r\n// Funcin para renderizar el calendario\r\nfunction renderizarCalendario() {\r\n    const mesAnioElement = document.querySelector('.calendario-mes');\r\n    const diasContainer = document.querySelector('.calendario-dias');\r\n    \r\n    if (!mesAnioElement || !diasContainer) {\r\n        console.error(\"Elementos del calendario no encontrados\");\r\n        return;\r\n    }\r\n    \r\n    // Obtener mes y ao\r\n    const mes = calendarioFechaActual.getMonth();\r\n    const anio = calendarioFechaActual.getFullYear();\r\n    \r\n    // Nombres de los meses\r\n    const nombresMeses = [\r\n        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',\r\n        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'\r\n    ];\r\n    \r\n    // Actualizar el encabezado\r\n    mesAnioElement.innerHTML = `${nombresMeses[mes]} <span>${anio}</span>`;\r\n    \r\n    // Obtener el primer da del mes y la cantidad de das\r\n    const primerDia = new Date(anio, mes, 1);\r\n    const ultimoDia = new Date(anio, mes + 1, 0);\r\n    const diasEnMes = ultimoDia.getDate();\r\n    \r\n    // Obtener el da de la semana del primer da (0 = Domingo, 1 = Lunes, etc.)\r\n    const diaInicio = primerDia.getDay();\r\n    \r\n    // Limpiar el contenedor de das\r\n    diasContainer.innerHTML = '';\r\n    \r\n    // Agregar das vacos para alinear el primer da\r\n    for (let i = 0; i < diaInicio; i++) {\r\n        const diaVacio = document.createElement('div');\r\n        diaVacio.className = 'dia-calendario fuera-de-mes';\r\n        diasContainer.appendChild(diaVacio);\r\n    }\r\n    \r\n    // Obtener la fecha actual para resaltar el da de hoy\r\n    const hoy = new Date();\r\n    const hoyFormateado = hoy.toISOString().split('T')[0];\r\n    \r\n    console.log(\"Fechas disponibles para calendario:\", fechasDisponiblesCalendario);\r\n    \r\n    // Agregar los das del mes\r\n    for (let dia = 1; dia <= diasEnMes; dia++) {\r\n        const diaElement = document.createElement('div');\r\n        diaElement.className = 'dia-calendario';\r\n        diaElement.textContent = dia;\r\n        \r\n        // Formatear la fecha para comparacin (YYYY-MM-DD)\r\n        const fechaFormateada = `${anio}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;\r\n        const fechaObj = new Date(fechaFormateada + 'T03:00:00'); // UTC-3 para Argentina\r\n        const fechaLocal = fechaObj.toISOString().split('T')[0];\r\n        \r\n        // Agregar data-atributo con la fecha\r\n        diaElement.dataset.fecha = fechaLocal;\r\n        \r\n        // Verificar si es hoy\r\n        const hoy = new Date();\r\n        const hoyFormateado = hoy.toISOString().split('T')[0];\r\n        \r\n        if (fechaLocal === hoyFormateado) {\r\n            diaElement.classList.add('hoy');\r\n        }\r\n        \r\n        // Verificar si la fecha est disponible\r\n        const disponible = fechasDisponiblesCalendario.some(f => f.fecha === fechaLocal);\r\n        \r\n        if (disponible) {\r\n            diaElement.classList.add('disponible');\r\n            diaElement.addEventListener('click', () => seleccionarFechaCalendario(fechaLocal, diaElement));\r\n        } else {\r\n            diaElement.classList.add('no-disponible');\r\n        }\r\n        \r\n        diasContainer.appendChild(diaElement);\r\n    }\r\n}\r\n\r\n// Funcin para seleccionar una fecha en el calendario\r\nfunction seleccionarFechaCalendario(fecha, elemento) {\r\n    // Deseleccionar cualquier fecha previamente seleccionada\r\n    document.querySelectorAll('.dia-calendario.seleccionado').forEach(dia => {\r\n        dia.classList.remove('seleccionado');\r\n    });\r\n    \r\n    // Seleccionar la nueva fecha\r\n    elemento.classList.add('seleccionado');\r\n    \r\n    // Actualizar los datos de reserva\r\n    fechaSeleccionada = fecha;\r\n    datosReserva.fecha = fecha;\r\n    \r\n    // DEBUG: Verificar que se estableci correctamente\r\n    console.log('Fecha seleccionada:', datosReserva.fecha);\r\n    \r\n    // Cargar horarios para la fecha seleccionada\r\n    cargarHorariosParaFecha(fecha);\r\n    \r\n    // Remover mensaje de error si existe\r\n    const errorFecha = document.getElementById('error-fecha');\r\n    if (errorFecha) errorFecha.classList.remove('visible');\r\n\r\n    // Actualizar el subttulo de horarios\r\n    actualizarSubtituloHorarios(fecha);\r\n}\r\n\r\n// Funcin para debuggear la visualizacin\r\nfunction debugVisualizacionFechas() {\r\n    console.log(\"=== DEBUG VISUALIZACIN ===\");\r\n    console.log(\"Fecha actual del calendario:\", calendarioFechaActual);\r\n    console.log(\"Fechas disponibles:\", fechasDisponiblesCalendario);\r\n    console.log(\"Datos reserva fecha:\", datosReserva.fecha);\r\n    \r\n    // Verificar qu das deberan mostrarse como disponibles\r\n    const mes = calendarioFechaActual.getMonth();\r\n    const anio = calendarioFechaActual.getFullYear();\r\n    \r\n    const primerDia = new Date(anio, mes, 1);\r\n    const ultimoDia = new Date(anio, mes + 1, 0);\r\n    const diasEnMes = ultimoDia.getDate();\r\n    \r\n    for (let dia = 1; dia <= diasEnMes; dia++) {\r\n        // CORRECCIN: Usar el mismo formato que en renderizarCalendario\r\n        const fechaFormateada = `${anio}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;\r\n        const fechaObj = new Date(fechaFormateada + 'T03:00:00'); // UTC-3 para Argentina\r\n        const fechaLocal = fechaObj.toISOString().split('T')[0];\r\n        \r\n        const disponible = fechasDisponiblesCalendario.some(f => f.fecha === fechaLocal);\r\n        \r\n        if (disponible) {\r\n            console.log(`Da ${dia} (${fechaLocal}) debera estar DISPONIBLE`);\r\n        }\r\n    }\r\n}\r\n// Llama a esta funcin despus de renderizar el calendario\r\ndebugVisualizacionFechas();\r\n\r\nfunction actualizarSubtituloHorarios(fecha) {\r\n    const subtitulo = document.querySelector('.seccion-horarios .subtitulo');\r\n    if (!subtitulo) return;\r\n    \r\n    // Formatear la fecha para mostrar\r\n    const fechaObj = new Date(fecha + 'T03:00:00'); // UTC-3 para Argentina\r\n    const opciones = { weekday: 'long', day: 'numeric' };\r\n    const fechaFormateada = fechaObj.toLocaleDateString('es-AR', opciones);\r\n    \r\n    // Separar el da de la semana y el nmero del da\r\n    const partes = fechaFormateada.split(' ');\r\n    const diaSemana = partes[0];\r\n    const diaNumero = partes[1];\r\n    \r\n    // Actualizar el HTML del subttulo\r\n    subtitulo.innerHTML = `${diaSemana} <span>${diaNumero}</span>`;\r\n}\r\n\r\n// Funcin para actualizar el resumen continuo\r\nfunction actualizarResumenContinuo(paso) {\r\n  const resumenContinuo = document.querySelector('.resumen-continuo');\r\n  const resumenEspecialistas = document.querySelector('.resumen-especialistas');\r\n  const resumenFechaHora = document.querySelector('.resumen-fecha-hora');\r\n  const resumenCliente = document.querySelector('.resumen-cliente');\r\n  // const resumenActions = document.querySelector('.resumen-actions');\r\n  \r\n  // Mostrar/ocultar segn el paso\r\n  if (paso >= 2) {\r\n    resumenContinuo.style.display = 'block';\r\n    actualizarResumenServicios();\r\n    \r\n    if (paso >= 3) {\r\n      if (resumenEspecialistas) {\r\n        resumenEspecialistas.style.display = 'block';\r\n      }\r\n      actualizarResumenEspecialistas();\r\n      \r\n      if (paso >= 4) {\r\n        resumenFechaHora.style.display = 'block';\r\n        actualizarResumenFechaHora();\r\n        \r\n        if (paso >= 5) {\r\n          resumenCliente.style.display = 'block';\r\n          // resumenActions.style.display = 'block';\r\n          actualizarResumenCliente();\r\n        } else {\r\n          resumenCliente.style.display = 'none';\r\n          // resumenActions.style.display = 'none';\r\n        }\r\n      } else {\r\n        resumenFechaHora.style.display = 'none';\r\n        resumenCliente.style.display = 'none';\r\n        // resumenActions.style.display = 'none';\r\n      }\r\n    } else {\r\n      resumenEspecialistas.style.display = 'none';\r\n      resumenFechaHora.style.display = 'none';\r\n      resumenCliente.style.display = 'none';\r\n      // resumenActions.style.display = 'none';\r\n    }\r\n  } else {\r\n    resumenContinuo.style.display = 'none';\r\n  }\r\n}\r\n\r\n// Actualizar seccin de servicios en el resumen\r\nfunction actualizarResumenServicios() {\r\n  const serviciosLista = document.querySelector('.servicios-lista');\r\n  const duracionTotal = document.getElementById('resumen-duracion');\r\n  const precioTotal = document.getElementById('resumen-precio');\r\n  const precioSenia = document.getElementById('resumen-senia');\r\n  \r\n  if (datosReserva.servicios && datosReserva.servicios.length > 0) {\r\n    // Lista de servicios\r\n    serviciosLista.innerHTML = datosReserva.servicios.map(servicio => \r\n      `<div class=\"servicio-item\">\r\n        <svg\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        width=\"18\"\r\n        height=\"18\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"#000000\"\r\n        stroke=\"#000000\"\r\n        stroke-width=\"1\"\r\n        stroke-linecap=\"round\"\r\n        stroke-linejoin=\"round\"\r\n        >\r\n        <path d=\"M17.286 21.09q -1.69 .001 -5.288 -2.615q -3.596 2.617 -5.288 2.616q -2.726 0 -.495 -6.8q -9.389 -6.775 2.135 -6.775h.076q 1.785 -5.516 3.574 -5.516q 1.785 0 3.574 5.516h.076q 11.525 0 2.133 6.774q 2.23 6.802 -.497 6.8\" />\r\n        </svg>\r\n      ${servicio.nombre}\r\n      </div>`\r\n    ).join('');\r\n    \r\n    // Totales\r\n    const totalDuracion = calcularDuracionTotal();\r\n    const totalPrecio = datosReserva.servicios.reduce((total, servicio) => total + servicio.precio, 0);\r\n    const totalSenia = calcularSenia();\r\n    \r\n    duracionTotal.textContent = `${totalDuracion} min`;\r\n    precioTotal.textContent = `${totalPrecio.toLocaleString()}`;\r\n    precioSenia.textContent = `${totalSenia.toLocaleString()}`;\r\n  } else {\r\n    serviciosLista.innerHTML = '<p class=\"sin-datos\">No hay servicios seleccionados</p>';\r\n    duracionTotal.textContent = '0 min';\r\n    precioTotal.textContent = '$0';\r\n    precioSenia.textContent = '$0';\r\n  }\r\n}\r\n\r\n// Actualizar seccin de especialistas en el resumen\r\n// Actualizar seccin de especialistas en el resumen\r\nfunction actualizarResumenEspecialistas() {\r\n  const especialistasLista = document.querySelector('.resumen-especialistas .especialistas-resumen');\r\n  \r\n  if (!especialistasLista) {\r\n    console.error(\"Elemento .especialistas-resumen no encontrado\");\r\n    return;\r\n  }\r\n  \r\n  console.log(\"Actualizando resumen de especialistas:\", datosReserva.especialistas);\r\n  \r\n  if (datosReserva.especialistas && datosReserva.especialistas.length > 0) {\r\n    especialistasLista.innerHTML = datosReserva.especialistas.map(especialista => {\r\n      //  MEJORAR: Asegurarnos de que tenemos una URL de avatar vlida\r\n      let avatarUrl = 'img/avatar-default.png';\r\n      \r\n      if (especialista.fotoUrl) {\r\n        avatarUrl = especialista.fotoUrl;\r\n      } else if (especialista.id !== 'auto') {\r\n        // Si no tiene fotoUrl pero es un especialista real, intentar obtenerla del DOM\r\n        const especialistaElement = document.querySelector(`.flotante.especialista[data-id=\"${especialista.id}\"]`);\r\n        if (especialistaElement) {\r\n          const img = especialistaElement.querySelector('.avatar-especialista');\r\n          if (img) avatarUrl = img.src;\r\n        }\r\n      }\r\n      \r\n      const nombre = especialista.nombre || 'Especialista';\r\n      \r\n      console.log(` Mostrando especialista ${nombre} con avatar: ${avatarUrl}`);\r\n      \r\n      return `<div class=\"especialista-item\">\r\n        <img src=\"${avatarUrl}\" alt=\"${nombre}\" class=\"avatar-especialista\" \r\n             onerror=\"this.src='img/avatar-default.png'\">\r\n        <span>${nombre}</span>\r\n      </div>`;\r\n    }).join('');\r\n  } else {\r\n    especialistasLista.innerHTML = '<p class=\"sin-datos\">No hay especialistas seleccionados</p>';\r\n    console.warn(\"No hay especialistas en datosReserva.especialistas\");\r\n  }\r\n}\r\n\r\n// Actualizar seccin de fecha y hora en el resumen\r\nfunction actualizarResumenFechaHora() {\r\n  const resumenFecha = document.getElementById('resumen-fecha');\r\n  const resumenHora = document.getElementById('resumen-hora');\r\n\r\n  const svgFecha = `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#000000\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n      <path d=\"M11.5 21h-5.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v6\" />\r\n      <path d=\"M16 3v4\" />\r\n      <path d=\"M8 3v4\" />\r\n      <path d=\"M4 11h16\" />\r\n      <path d=\"M15 19l2 2l4 -4\" />\r\n    </svg>\r\n  `;\r\n\r\n  const svgHora = `\r\n    <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width=\"18\"\r\n    height=\"18\"\r\n    viewBox=\"0 0 24 24\"\r\n    fill=\"none\"\r\n    stroke=\"#000000\"\r\n    stroke-width=\"1.5\"\r\n    stroke-linecap=\"round\"\r\n    stroke-linejoin=\"round\"\r\n    >\r\n    <path d=\"M20.942 13.021a9 9 0 1 0 -9.407 7.967\" />\r\n    <path d=\"M12 7v5l3 3\" />\r\n    <path d=\"M15 19l2 2l4 -4\" />\r\n    </svg>\r\n  `;\r\n  \r\n  if (datosReserva.fecha) {\r\n    resumenFecha.innerHTML = `${svgFecha} ${formatearFechaDisplay(datosReserva.fecha)}`;\r\n  } else {\r\n    resumenFecha.innerHTML = `${svgFecha} Fecha no seleccionada`;\r\n  }\r\n  \r\n  if (datosReserva.horario) {\r\n    const duracionTotal = calcularDuracionTotal();\r\n    const horaFin = calcularHorarioFin(datosReserva.horario, duracionTotal);\r\n    \r\n    resumenHora.innerHTML = `${svgHora} ${datosReserva.horario} a ${horaFin}`;\r\n  } else {\r\n    resumenHora.innerHTML = `${svgHora} Horario no seleccionado`;\r\n  }\r\n}\r\n\r\n// Actualizar seccin de datos del cliente en el resumen\r\nfunction actualizarResumenCliente() {\r\n}\r\n\r\nasync function cargarDatosGenerales() {\r\n    try {\r\n        \r\n        if (Object.keys(datosGenerales).length === 0) {\r\n            datosGenerales = await firestoreSeguro.obtenerConfigGeneral();\r\n        }\r\n        \r\n        // Si no hay datos, usar valores por defecto\r\n        if (!datosGenerales || Object.keys(datosGenerales).length === 0) {\r\n            document.getElementById('local-direccion').textContent = \"Direccin no disponible\";\r\n            document.getElementById('local-telefono').textContent = \"Telfono no disponible\";\r\n            document.getElementById('local-email').textContent = \"Email no disponible\";\r\n            document.getElementById('local-atencion').textContent = \"Horarios no disponibles\";\r\n            return;\r\n        }\r\n        \r\n        // Acceder a los datos dentro de empresa\r\n        const empresa = datosGenerales.empresa || {};\r\n        \r\n        // Actualizar direccin\r\n        const direccionElement = document.getElementById('local-direccion');\r\n        if (direccionElement && empresa.direccion) {\r\n            direccionElement.textContent = empresa.direccion;\r\n        } else if (direccionElement) {\r\n            direccionElement.textContent = \"Direccin no disponible\";\r\n        }\r\n        \r\n        // Actualizar telfono\r\n        const telefonoElement = document.getElementById('local-telefono');\r\n        if (telefonoElement && empresa.telefono) {\r\n            telefonoElement.textContent = empresa.telefono;\r\n        } else if (telefonoElement) {\r\n            telefonoElement.textContent = \"Telfono no disponible\";\r\n        }\r\n        \r\n        // Actualizar email\r\n        const emailElement = document.getElementById('local-email');\r\n        if (emailElement && empresa.email) {\r\n            emailElement.textContent = empresa.email;\r\n        } else if (emailElement) {\r\n            emailElement.textContent = \"Email no disponible\";\r\n        }\r\n        \r\n        // Actualizar horarios de atencin (NUEVO)\r\n        const atencionElement = document.getElementById('local-atencion');\r\n        if (atencionElement && empresa.horariosAtencion) {\r\n            atencionElement.textContent = empresa.horariosAtencion;\r\n        } else if (atencionElement) {\r\n            atencionElement.textContent = \"Horarios no disponibles\";\r\n        }\r\n        \r\n        // Actualizar redes sociales (si existen en empresa)\r\n        if (empresa.redesSociales) {\r\n            const instagramLink = document.getElementById('instagram');\r\n            const twitterLink = document.getElementById('equis');\r\n            const whatsappLink = document.getElementById('whatsapp');\r\n            \r\n            if (instagramLink && empresa.redesSociales.instagram) {\r\n                instagramLink.href = empresa.redesSociales.instagram;\r\n            }\r\n            \r\n            if (twitterLink && empresa.redesSociales.twitter) {\r\n                twitterLink.href = empresa.redesSociales.twitter;\r\n            }\r\n            \r\n            if (whatsappLink && empresa.redesSociales.whatsapp) {\r\n                whatsappLink.href = empresa.redesSociales.whatsapp;\r\n            }\r\n        }\r\n        \r\n        // Inicializar mapas despus de cargar los datos\r\n        setTimeout(() => {\r\n            inicializarMapasEnDirecciones();\r\n        }, 100);\r\n        \r\n    } catch (error) {\r\n        console.error(\"Error cargando datos del local:\", error);\r\n        // Establecer valores por defecto en caso de error\r\n        document.getElementById('local-direccion').textContent = \"Direccin no disponible\";\r\n        document.getElementById('local-telefono').textContent = \"Telfono no disponible\";\r\n        document.getElementById('local-email').textContent = \"Email no disponible\";\r\n        const atencionElement = document.getElementById('local-atencion');\r\n        if (atencionElement) {\r\n            atencionElement.textContent = \"Horarios no disponibles\";\r\n        }\r\n    }\r\n}\r\n\r\nfunction escucharCambiosConfigGeneral() {\r\n    db.collection('config').doc('general')\r\n        .onSnapshot((doc) => {\r\n            if (doc.exists) {\r\n                datosGenerales = doc.data();\r\n                cargarDatosGenerales();\r\n            }\r\n        }, (error) => {\r\n            console.error(\"Error escuchando cambios:\", error);\r\n        });\r\n}\r\n\r\n//////////////////////////\r\n//////////////////// Mapas\r\n//////////////////////////\r\n\r\n// Funcin para inicializar los mapas\r\nfunction inicializarMapas() {\r\n    console.log(\"API de Google Maps cargada\");\r\n    // No hacemos nada aqu, la inicializacin se har despus de cargar los datos\r\n}\r\n\r\n// Funcin para geocodificar una direccin\r\nfunction geocodificarDireccion(direccion, callback) {\r\n    if (typeof google === 'undefined' || !google.maps || !google.maps.Geocoder) {\r\n        console.error(\"API de Google Maps no est disponible\");\r\n        callback(\"API de Google Maps no est disponible\", null);\r\n        return;\r\n    }\r\n\r\n    const geocoder = new google.maps.Geocoder();\r\n    geocoder.geocode({ address: direccion }, (results, status) => {\r\n        if (status === 'OK') {\r\n            const location = results[0].geometry.location;\r\n            callback(null, { lat: location.lat(), lng: location.lng() });\r\n        } else {\r\n            callback('Error en geocodificacin: ' + status, null);\r\n        }\r\n    });\r\n}\r\n\r\n// Funcin para inicializar los mapas en las direcciones\r\nfunction inicializarMapasEnDirecciones() {\r\n    const elementoDireccion = document.getElementById('local-direccion');\r\n    if (!elementoDireccion) return;\r\n\r\n    const direccion = elementoDireccion.textContent;\r\n    if (!direccion || direccion === \"Direccin no disponible\") return;\r\n\r\n    // Obtener coordenadas desde datosGenerales\r\n    const empresa = datosGenerales.empresa || {};\r\n    const coordenadas = empresa.coordenadas;\r\n\r\n    // Crear el popup si no existe\r\n    let popup = elementoDireccion.querySelector('.mapa-popup');\r\n    if (!popup) {\r\n        popup = document.createElement('div');\r\n        popup.className = 'mapa-popup';\r\n        elementoDireccion.appendChild(popup);\r\n    }\r\n\r\n    // Usar las coordenadas de la base de datos si estn disponibles\r\n    if (coordenadas && coordenadas.lat && coordenadas.lng) {\r\n        coordenadasLocal = coordenadas;\r\n\r\n        // Construir URL de mapa esttico (reemplaza con tu API key real)\r\n        const apiKey = 'AIzaSyCAO4m-WpFO7Hc9rf8Iy1-gyDMlSLDFong'; //  Reemplaza con tu clave API\r\n        const urlMapaEstatico = `https://maps.googleapis.com/maps/api/staticmap?center=${coordenadas.lat},${coordenadas.lng}&zoom=16&size=300x200&markers=color:red%7C${coordenadas.lat},${coordenadas.lng}&key=${apiKey}`;\r\n\r\n        // Crear imagen del mapa\r\n        const imgMapa = document.createElement('img');\r\n        imgMapa.src = urlMapaEstatico;\r\n        imgMapa.alt = 'Mapa del local';\r\n        imgMapa.style.width = '100%';\r\n        imgMapa.style.height = '100%';\r\n        imgMapa.onload = function() {\r\n            console.log('Mapa cargado correctamente');\r\n        };\r\n        imgMapa.onerror = function() {\r\n            console.error('Error al cargar la imagen del mapa');\r\n            popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Error al cargar el mapa</div>';\r\n        };\r\n        \r\n        popup.innerHTML = '';\r\n        popup.appendChild(imgMapa);\r\n    } else {\r\n        // Fallback: geocodificacin si no hay coordenadas en la base de datos\r\n        popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Cargando mapa...</div>';\r\n\r\n        geocodificarDireccion(direccion, (error, coordenadasGeocodificadas) => {\r\n            if (error) {\r\n                console.error('Error en geocodificacin:', error);\r\n                popup.innerHTML = '<div style=\"padding: 20px; text-align: center;\">Error al cargar el mapa</div>';\r\n                return;\r\n            }\r\n\r\n            coordenadasLocal = coordenadasGeocodificadas;\r\n            const apiKey = 'TU_API_KEY_REAL'; //  Reemplaza con tu clave API\r\n            const urlMapaEstatico = `https://maps.googleapis.com/maps/api/staticmap?center=${coordenadasGeocodificadas.lat},${coordenadasGeocodificadas.lng}&zoom=16&size=300x200&markers=color:red%7C${coordenadasGeocodificadas.lat},${coordenadasGeocodificadas.lng}&key=${apiKey}`;\r\n\r\n            const imgMapa = document.createElement('img');\r\n            imgMapa.src = urlMapaEstatico;\r\n            imgMapa.alt = 'Mapa del local';\r\n            imgMapa.style.width = '100%';\r\n            imgMapa.style.height = '100%';\r\n            popup.innerHTML = '';\r\n            popup.appendChild(imgMapa);\r\n        });\r\n    }\r\n\r\n    // Al hacer clic, abrir Google Maps en una nueva pestaa\r\n    elementoDireccion.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        if (coordenadasLocal) {\r\n            const urlMaps = `https://www.google.com/maps/search/?api=1&query=${coordenadasLocal.lat},${coordenadasLocal.lng}`;\r\n            window.open(urlMaps, '_blank');\r\n        } else {\r\n            // Fallback: buscar por direccin si no hay coordenadas\r\n            const urlMaps = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(direccion)}`;\r\n            window.open(urlMaps, '_blank');\r\n        }\r\n    });\r\n}\r\n\r\n///////////////////////\r\n//////////////// Footer\r\n///////////////////////\r\n\r\nfunction actualizarAnioFooter() {\r\n    const yearElement = document.getElementById('current-year');\r\n    if (yearElement) {\r\n        const currentYear = new Date().getFullYear();\r\n        yearElement.textContent = currentYear;\r\n    }\r\n}\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    actualizarAnioFooter();\r\n});"]}